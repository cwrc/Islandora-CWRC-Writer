/*! For license information please see app.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("$rdf")):"function"==typeof define&&define.amd?define(["$rdf"],e):"object"==typeof exports?exports.GitWriter=e(require("$rdf")):t.GitWriter=e(t.$rdf)}(window,(function(__WEBPACK_EXTERNAL_MODULE__413__){return function(t){function e(e){for(var i,a,s=e[0],l=e[1],c=e[2],u=0,p=[];u<s.length;u++)a=s[u],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);for(d&&d(e);p.length;)p.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(i=!1)}i&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},o={0:0},r=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var s=window.webpackJsonpGitWriter=window.webpackJsonpGitWriter||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=l;return r.push([262,1]),n()}([,,,,,,,function(t,e,n){"use strict";var i=n(3);n(32),n(72),n(15),n(92),n(47);var o=n(49);function r(t){this.w=t.writer,this.$el=t.$el;var e=t.title,n=t.height||650,r=t.width||575;this.showConfig,this.cwrcWriter,this.cwrcWriterConfig=t.cwrcWriterConfig,this.isValid=!0,this.type=t.type,this.mode=null,this.currentData={attributes:{},properties:{},customValues:{}},this.currentId=null,this.$el.dialog({title:e,modal:!0,resizable:!0,dialogClass:"splitButtons",closeOnEscape:!1,open:i.proxy((function(t,e){this.$el.parent().find(".ui-dialog-titlebar-close").hide()}),this),height:n,width:r,position:{my:"center",at:"center",of:this.w.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Cancel",role:"cancel",click:i.proxy((function(){this.$el.trigger("beforeCancel"),this.$el.trigger("beforeClose"),this.$el.dialog("close")}),this)},{text:"Ok",role:"ok",click:i.proxy((function(){this.save()}),this)}]}),i("[data-transform]",this.$el).each(function(t,e){var n=i(e);switch(n.data("transform")){case"buttonset":n.controlgroup();break;case"accordion":n.accordion({heightStyle:"content",animate:!1,collapsible:!0,active:!1});break;case"selectmenu":n.selectmenu({appendTo:this.w.layoutManager.getContainer()})}}.bind(this)),i('[data-type="attributes"]',this.$el).first().each(function(t,e){this.attributesWidget=new o({writer:this.w,$parent:this.$el,$el:i(e)}),this.attWidgetInit=!1}.bind(this))}r.ADD=0,r.EDIT=1,r.processForm=function(t){var e=t.currentData;if(1===i('[data-type="attributes"]',t.$el).length){var n=t.attributesWidget.getData();i.extend(e.attributes,n)}for(var o in i("[data-type]",t.$el).not('[data-type="attributes"]').each((function(t,n){var o=i(this);if(1===o.parents(".cwrcDialogWrapper").length){var r=o.data("type"),a=o.data("mapping");if(void 0!==a){var s,l="attributes",c=0===a.indexOf("custom."),d=0===a.indexOf("prop.");switch(c?(a=a.replace(/^custom\./,""),l="customValues"):d&&(a=a.replace(/^prop\./,""),l="properties"),r){case"radio":s=o.find("input:checked").val(),e[l][a]=s;break;case"textbox":case"hidden":case"select":null!==(s=o.val())&&(e[l][a]=s)}}}})),e.attributes)void 0!==e.attributes[o]&&""!==e.attributes[o]||delete e.attributes[o]},r.populateForm=function(t){var e=t.currentData;i("[data-type]",t.$el).filter((function(t,e){return 1===i(e).parents(".cwrcWrapper").length})).each((function(n,o){var r=i(this),a=r.data("type");if("attributes"===a){t.attributesWidget.setData(e.attributes)&&t.attributesWidget.expand()}else{var s=r.data("mapping");if(void 0!==s){var l,c=0===s.indexOf("custom."),d=0===s.indexOf("prop.");if(c?(s=s.replace(/^custom\./,""),l=e.customValues[s]):d?(s=s.replace(/^prop\./,""),l=e.properties[s]):l=e.attributes[s],"otherType"===s&&(l=e.attributes.type),void 0!==l)switch(a){case"select":i('option[value="'.concat(l,'"]'),r)[0]||(l="other"),r.val(l),"selectmenu"===r.data("transform")&&r.selectmenu("refresh"),r.parents('[data-transform="accordion"]').accordion("option","active",0);break;case"radio":var u=i('input[value="'.concat(l,'"]'),r);u[0]||(u=i('input[value="other"]',r)),u.prop("checked",!0),"buttonset"===r.data("transform")&&i("input",r).button("refresh");break;case"textbox":r.val(l);break;case"label":r.html(l)}}}}))},r.prototype={constructor:r,show:function(t){var e=this;this.showConfig=t,this.mode=t.entry?r.EDIT:r.ADD,null!=this.attributesWidget&&(!1===this.attWidgetInit&&function(t,e){var n;n=e.entry?e.entry.tag:t.w.schemaManager.mapper.getParentTag(t.type);var i=t.w.schemaManager.getAttributesForTag(n);t.attributesWidget.buildWidget(i),t.attWidgetInit=!0}(this,t),this.attributesWidget.reset()),this.$el.trigger("buildDynamicFields",[t,this]),i("[data-type]",this.$el).each((function(t,e){var n=i(this);switch(n.data("type")){case"radio":n.find("input").prop("checked",!1),n.find("[data-default]").prop("checked",!0),"buttonset"===n.data("transform")&&i("input",n).button("refresh");break;case"textbox":case"select":n.val(""),"selectmenu"===n.data("transform")&&n.selectmenu("refresh");break;case"label":n.empty()}})),i('[data-transform="accordion"]',this.$el).each((function(t,e){i(this).accordion("option","active",!1)})),this.$el.one("beforeClose",(function(t){t.stopPropagation()})),this.$el.one("beforeSave",(function(t){t.stopPropagation()})),this.currentData={attributes:{},properties:{},customValues:{}};var n=this.w.schemaManager.mapper.getMappedProperties(this.type);if(this.mode===r.ADD)i.extend(this.currentData.properties,t.properties),n.forEach((function(t){var n=e.currentData.properties[t],i=e.w.schemaManager.mapper.getAttributeForProperty(e.type,t);void 0!==n&&void 0!==i&&(e.currentData.attributes[i]=n)}));else if(this.mode===r.EDIT){this.currentId=t.entry.getId();var o=Object.assign({},t.entry.getAttributes());for(var a in o)o[a]=this.w.utilities.unescapeHTMLString(o[a]);var s=JSON.parse(JSON.stringify(t.entry.getCustomValues()));for(var a in s){var l=s[a];if(i.isArray(l))for(var c=0;c<l.length;c++)s[a][c]=this.w.utilities.unescapeHTMLString(l[c]);else if(i.isPlainObject(l))for(var d in l)s[a][d]=this.w.utilities.unescapeHTMLString(l[d]);else s[a]=this.w.utilities.unescapeHTMLString(l)}this.currentData.attributes=o,this.currentData.customValues=s,this.currentData.properties={tag:t.entry.tag,type:t.entry.type},n.forEach((function(n){e.currentData.properties[n]=t.entry[n]}))}r.populateForm(this),this.$el.trigger("beforeShow",[t,this]),this.$el.dialog("open")},save:function(){this.$el.trigger("beforeSave",[this]),this.isValid&&(r.processForm(this),!0===this.isValid&&(this.$el.trigger("beforeClose"),this.$el.dialog("close"),this.mode===r.EDIT&&null!=this.currentData?this.w.tagger.editEntity(this.currentId,this.currentData):this.w.tagger.finalizeEntity(this.type,this.currentData),this.$el.trigger("save",[this])))},destroy:function(){null!=this.attributesWidget&&this.attributesWidget.destroy(),null!=this.cwrcWriter&&this.cwrcWriter.destroy(),i("[data-transform]",this.$el).each((function(t,e){var n=i(e);if(Object.keys(n.data()).find((function(t){return 0===t.indexOf("ui")})))switch(n.data("transform")){case"buttonset":n.controlgroup("destroy");break;case"accordion":n.accordion("destroy");break;case"selectmenu":n.selectmenu("destroy")}})),this.$el.remove()}},t.exports=r},,,,,,,,,,,,,,,function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=n(3);n(45);function r(t){this.w=t.writer,this.currentMappingsId=void 0,this.mappings={empty:n(310),tei:n(311),teiLite:n(312),orlando:n(313),cwrcEntry:n(314)}}r.reservedAttributes={_entity:!0,_type:!0,_tag:!0,_textallowed:!0,_note:!0,_candidate:!0,_attributes:!0,id:!0,name:!0,class:!0,style:!0},r.getAttributeString=function(t){var e="";for(var n in t){var i=t[n];void 0!==i&&""!==i&&(e+=" "+n+'="'+i+'"')}return e},r.getTagAndDefaultAttributes=function(t,e){e=void 0===e||e;var n=Object.assign({},t.getAttributes());for(var i in n)r.reservedAttributes[i]&&delete n[i];var o="<"+t.getTag();return o+=r.getAttributeString(n),e&&(o+=">"),o},r.getDefaultMapping=function(t){return[r.getTagAndDefaultAttributes(t),"</"+t.getTag()+">"]},r.xmlToString=function(t){var e="";try{e=window.ActiveXObject?t.xml:(new XMLSerializer).serializeToString(t)}catch(t){alert(t)}return e},r.prototype={constructor:r,loadMappings:function(t){this.clearMappings(),this.currentMappingsId=t;var e=this.getMappings();if(void 0!==e.listeners)for(var n in e.listeners)this.w.event(n).subscribe(e.listeners[n])},clearMappings:function(){var t=this.getMappings();if(void 0!==t.listeners)for(var e in t.listeners)this.w.event(e).unsubscribe(t.listeners[e])},getMappings:function(){return void 0!==this.currentMappingsId?this.mappings[this.currentMappingsId]:this.mappings.empty},getMapping:function(t){var e=t.getType(),n=this.getMappings().entities[e];return n.mappingFunction?n.mappingFunction(t):r.getDefaultMapping(t)},getReverseMapping:function(t,e){function n(t,e){var i,o=this.w.utilities.evaluateXPath(t,e);if(null!==o){if(o.nodeType)switch(o.nodeType){case Node.ELEMENT_NODE:i=r.xmlToString(o);break;case Node.TEXT_NODE:i=o.textContent;break;case Node.ATTRIBUTE_NODE:i=o.value}else if("string"==typeof o){i=o;var a=/^local-name\((.*)\)$/.exec(e);if(null!==a){a=a[1];var s=n.call(this,t,a);void 0===s?(console.warn("mapper.getReverseMapping.getValueFromXPath: cannot get match for unrecognizable xpath",e),o=void 0):o=s.match}else console.warn("mapper.getReverseMapping.getValueFromXPath: cannot get match for unrecognizable xpath",e)}return{value:i,match:o}}}e=void 0!==e&&e;var a=t.ownerDocument===this.w.editor.getDoc(),s=this.getEntityTypeForTag(t);if(null===s)return{};var l=this.getMappings().entities[s].mapping,c={attributes:{}};if(a?c.attributes=this.w.tagger.getAttributesForTag(t):o.map(t.attributes,(function(t){c.attributes[t.name]=t.value})),void 0!==l){for(var d in l)if("object"===i(l[d]))for(var u in c[d]={},l[d]){var p=l[d][u];void 0!==(f=n.call(this,t,p))&&(c[d][u]=f)}else if("string"==typeof l[d]){var f;p=l[d];void 0!==(f=n.call(this,t,p))&&(c[d]=f)}var g=this.getTextTag(s);!function(t,e,n,i,r){function a(t){var e;return e=n?t.getAttribute("_tag"):t.nodeName,Array.isArray(i)?-1!==i.indexOf(e):e===i}function s(e){switch(e.nodeType){case Node.ATTRIBUTE_NODE:e.ownerElement!==t&&e.ownerElement.parentElement.removeChild(e.ownerElement);break;case Node.ELEMENT_NODE:e!==t&&(a(e)?o(e.firstChild).unwrap():e.parentElement.removeChild(e));break;case Node.TEXT_NODE:e.parentElement!==t&&(a(e.parentElement)?o(e).unwrap():o(e.parentElement).remove());break;default:console.warn("mapper.getReverseMapping.cleanupMappings: cannot remove node with unknown type",e)}}for(var l in e)if("attributes"!==l){var c=e[l];if(c.match)r&&s(c.match),e[l]=c.value;else for(var d in c){var u=c[d];u.match&&(r&&s(u.match),c[d]=u.value)}}}(t,c,a,g,e)}return c.type=s,c.isNote=this.isEntityTypeNote(s),c},getEntityTypeForTag:function(t){var e,n=!1;"string"==typeof t?e=t:(n=!0,e=t.ownerDocument===this.w.editor.getDoc()?t.getAttribute("_tag"):t.nodeName);var i=this.getMappings(),r=[];for(var a in i.entities){(l=Object.assign({},i.entities[a])).type=a,void 0!==l.xpathSelector?r.splice(0,0,l):r.push(l)}for(var s=0;s<r.length;s++){var l;if(void 0!==(l=r[s]).xpathSelector&&n){if(null!==this.w.utilities.evaluateXPath(t,l.xpathSelector))return l.type}else{var c=l.parentTag;if(o.isArray(c)&&-1!==c.indexOf(e)||c===e)return l.type}}return null},getMappingForProperty:function(t,e){var n=this.getMappings().entities[t];if(n.mapping&&n.mapping[e])return n.mapping[e]},getAttributeForProperty:function(t,e){var n=this.getMappingForProperty(t,e);if(void 0!==n&&/^@\w+$/.test(n))return n.slice(1)},getMappedProperties:function(t){var e=[],n=this.getMappings().entities[t];if(n.mapping)for(var i in n.mapping)"customValues"!==i&&e.push(i);return e},updatePropertiesFromAttributes:function(t){var e=t.getType(),n=this.getMappings().entities[e];if(n.mapping)for(var i in n.mapping)if("customValues"!==i){var o=n.mapping[i];if("string"==typeof o&&/^@\w+$/.test(o)){var r=o.slice(1),a=t.getAttribute(r);void 0!==a&&t.setProperty(i,a)}}},isEntityTypeNote:function(t){if(null==t)return!1;var e=this.getMappings().entities[t].isNote;return void 0!==e&&e},isNamedEntity:function(t){if(null==t)return!1;var e=this.getMappings().entities[t];return!(!e.mapping||!e.mapping.uri)},doesEntityRequireSelection:function(t){if(null==t)return!0;var e=this.getMappings().entities[t].requiresSelection;return void 0===e||e},convertTagToEntity:function(t,e){e=void 0!==e&&e;var n=this.getEntityTypeForTag(t);if(null!==n){var i=t.getAttribute("id"),r=this.isEntityTypeNote(n),a=this.isNamedEntity(n),s={id:i,tag:t.getAttribute("_tag"),type:n,isNote:r,isNamedEntity:a,range:{startXPath:this.w.utilities.getElementXPath(t)}},l=this.getReverseMapping(t,!0);if(o.extend(s,l),r){var c=o(t);s.content=c.text(),s.noteContent=c.html()}var d={_entity:!0,_type:n,class:"entity "+n+" start end",name:i};for(var u in r&&(d._note=!0),d)t.setAttribute(u,d[u]);r&&this.w.tagger.addNoteWrapper(t,n);var p=this.w.entitiesManager.addEntity(s);return e&&(!a||a&&void 0===p.getURI())&&this.w.dialogManager.show(n,{type:n,entry:p}),p}return console.warn("mapper.convertTagToEntity: tag "+t.getAttribute("_tag")+" cannot be converted to an entity!"),null},findEntities:function(t){t=void 0===t?["person","place","date","org","title","link"]:t;var e={},n=this.getHeaderTag(),i=this.getMappings().entities;for(var r in i)if(0==t.length||-1!=t.indexOf(r)){var a=[],s=i[r].parentTag;o.isArray(s)?a=a.concat(s):""!==s&&a.push(s),a=a.map((function(t){return'[_tag="'+t+'"]'}));var l=o(a.join(","),this.w.editor.getBody()).filter(function(t,e){if("true"===e.getAttribute("_entity"))return!1;if(0!==o(e).parents('[_tag="'+n+'"]').length)return!1;var i=this.getEntityTypeForTag(e);if(null===i)return!1;var r=this.getMappings().entities[i];return!r.mapping||!r.mapping.uri||null!==this.w.utilities.evaluateXPath(e,r.mapping.uri)}.bind(this));e[r]=o.makeArray(l)}return e},getParentTag:function(t){var e=this.getMappings().entities[t].parentTag;return void 0===e?"":(o.isArray(e)&&(e=e[0]),e)},getTextTag:function(t){return this.getMappings().entities[t].textTag},getRequiredAttributes:function(t){var e=this.getMappings().entities[t].requiredAttributes;return void 0===e?{}:e},getRootTags:function(){return this.getMappings().root},getHeaderTag:function(){return this.getMappings().header},getNamespace:function(){return this.getMappings().namespace},getIdAttributeName:function(){return this.getMappings().id},getResponsibilityAttributeName:function(){return this.getMappings().responsibility},getRdfParentSelector:function(){return this.getMappings().rdfParentSelector},getBlockLevelElements:function(){return this.getMappings().blockElements},getUrlAttributes:function(){return this.getMappings().urlAttributes||[]},getPopupAttributes:function(){return this.getMappings().popupAttributes||[]}},t.exports=r},,function(t,e,n){var i=window.cwrcQuery;if(void 0===i){var o=window.jQuery;i=n(3),window.jQuery=i,n(283),window.jQuery=o,window.cwrcQuery=i}var r,a,s=n(296).BroadcastChannel;void 0!==s.default&&(s=s.default);var l,c=n(39),d=document.createElement("style");d.setAttribute("type","text/css"),d.appendChild(document.createTextNode('\n.panel-heading a {\n    cursor: pointer;\n}\n.panel-heading a:after {\n    font-family:\'Glyphicons Halflings\';\n    content:"\\e114";\n    float: right;\n    color: grey;\n    cursor: pointer;\n}\n.panel-heading a.collapsed:after {\n    content:"\\e080";\n}\n.list-group .list-group-item {\n    cursor: pointer;\n    float: none !important; /* islandora css conflict */\n}\n.list-group .list-group-item:hover {\n    color: #555;\n    text-decoration: none;\n    background-color: #f5f5f5;\n}\n.list-group .list-group-item.active a {\n    color: #fff;\n}\n.list-group-item .logo {\n    display: inline-block;\n    width: 30px;\n    height: 30px;\n    position: relative;\n    top: -23.5px;\n    float: right;\n    vertical-align: middle;\n    background-size: cover;\n    background-repeat: no-repeat;\n}\n')),document.querySelector("head").appendChild(d);var u="";var p="";var f="";var g=!0;var h=!0;var m=!0;var v=!1,y="cwrc-public-entity-dialogs-lookup-sources",b={entityType:void 0,entityLookupMethodName:void 0,entityLookupTitle:void 0,searchOptions:void 0},w=void 0;function _(t){if(void 0===t)i("#cwrc-entity-lookup [data-toggle=tooltip]").tooltip("destroy"),_("cwrc-entity-lookup"),_("cwrc-entity-lookup-edit-sources-dialog"),_("cwrc-title-entity-dialog");else{var e=i("#"+t);void 0!==e[0]&&(e.modal("hide").data("bs.modal",null),e[0].parentNode.removeChild(e[0]),"cwrc-entity-lookup"===t&&(r&&r.close(),T()))}}function x(t){_(),b.success(t)}function C(){k(i("#cwrc-entity-query").val())}function k(t){w=void 0,i(".cwrc-result-list").empty(),l[b.entityType].forEach((function(e,n){M(n)&&e[b.entityLookupMethodName](t).then((function(t){return function(t,e){var n=i("#cwrc-".concat(e,"-list"));0===t.length?n.append('<li class="list-group-item">No results</li>'):t.forEach((function(t,e){var o=t.description?"<div><b>".concat(t.name,"</b> - <i>").concat(t.description,"</i></div>"):"<div><b>".concat(t.name,"</b></div>");t.externalLink&&(o+='<div><a href="'.concat(t.externalLink,'" target="_blank">Open Full Description in New Tab/Window</a></div>')),t.logo&&(o+='<div class="logo" style="background-image: url('.concat(t.logo,')"></div>'));var r=i('<li class="list-group-item cwrc-result-item">'.concat(o,"</li>")).appendTo(n);i(r).on("click",(function(e){i(".cwrc-result-item",".cwrc-result-panel").removeClass("active"),w===t?w=void 0:(i(this).addClass("active"),w=t,t.uriForDisplay&&function(t,e,n){if(n.stopPropagation(),E){if(E[0]===e)return;T(),setTimeout(o,175)}else o();function o(){(E=i(e)).popover({animation:!1,trigger:"manual",html:!0,title:t.name,sanitize:!1,content:function(){return'<div id="entity-iframe-loading" style="width:38em">Loading...</div>\n            <iframe id="entity-iframe" src="'.concat(t.uriForDisplay,'" style="display:none;border:none;height:40em;width:38em"/>')}}),E.popover("show"),i("#entity-iframe").on("load",(function(t){i("#entity-iframe-loading").hide(),i("#entity-iframe").show()})),E.data("bs.popover").tip().css({"max-width":"40em"}),i("#cwrc-entity-lookup").on("click.popover",(function(t){T()}))}}(t,r,e)),$(),I()})),i(r).on("dblclick",(function(e){x(t)}))}))}(t,n)}),(function(t){return function(t,e){i("#cwrc-".concat(e,"-list")).append('<li class="list-group-item list-group-item-danger">'.concat(t,"</li>"))}(t,n)}))}))}function T(){i("#cwrc-entity-lookup").off(".popover"),i("#entity-iframe").off("load"),E&&(E.popover("destroy"),E=null)}var E=null;var S={cwrc:{title:"CWRC",enabled:!0},viaf:{title:"VIAF",enabled:!0},dbpedia:{title:"DBPedia",enabled:!0},geonames:{title:"GeoNames",enabled:!0},getty:{title:"Getty ULAN",enabled:!0},wikidata:{title:"Wikidata",enabled:!0},lgpn:{title:"LGPN",enabled:!0}};function D(t){for(var e in t)P(e,t[e]);v=!0}function P(t,e){S[t]&&(S[t].enabled=e)}function M(t){var e=S[t];return void 0===e.enabled||e.enabled}function L(){var t={},e=function(e){l[e].forEach((function(n,i){void 0===t[i]&&(t[i]=[]),t[i].push(e)}))};for(var n in l)e(n);var i="";for(var o in t){var r=t[o],a=S[o].title,s=S[o].enabled;i+='\n        <div class="checkbox">\n            <label><input type="checkbox" '.concat(s?"checked":"",' data-source="').concat(o,'"/>').concat(a,'<br/><span class="small">').concat(r.join(", "),"</span></label>\n        </div>")}return i}function A(t){var e={};t.each((function(t,n){var o=i(n).data("source"),r=i(n).prop("checked");e[o]=r})),D(e),c.set(y,e,{expires:93,path:""})}function R(){if(!document.getElementById("cwrc-entity-lookup")){var t="";Object.entries(S).forEach((function(e){var n=e[0],i=e[1].title;t+='\n            <div class="panel panel-default cwrc-result-panel" id="cwrc-'.concat(n,'-panel">\n                <div class="panel-heading">\n                    <h4 class="panel-title">\n                        <a data-toggle="collapse" data-target="#collapse-').concat(n,'">').concat(i,'</a>\n                    </h4>\n                </div>\n                <div id="collapse-').concat(n,'" class="panel-collapse collapse in">\n                    <ul class="list-group cwrc-result-list" id="cwrc-').concat(n,'-list">\n                    </ul>\n                </div>\n            </div>')}));var e=b.parentEl||document.body;i(e).append(i.parseHTML('<div id="cwrc-entity-lookup" role="dialog" class="modal">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h3 id="cwrc-entity-lookup-title" class="modal-title"></h3>\n            </div>\n            <div class="modal-body">\n                <div class="row">\n                    <div class="col-sm-10">\n                        <div class="input-group">\n                            <input type="text" placeholder="Enter a name to find" class="form-control" id="cwrc-entity-query"/>\n                            <span class="input-group-btn">\n                                <button id="cwrc-entity-lookup-redo" type="button" class="btn btn-default"\n                                        data-toggle="tooltip" data-placement="top" title="Search">\n                                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>&nbsp;\n                                </button>\n                            </span>\n                        </div>\n                    </div>\n                    <div class="col-sm-2">\n                        <button id="cwrc-entity-lookup-edit-sources" type="button" class="btn btn-default"\n                                data-toggle="tooltip" data-placement="top" title="Select Lookup Sources" style="float: right;">\n                            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>&nbsp;\n                        </button>\n                    </div>\n                </div>\n                <div style="width: 100%;">\n                    <div class="panel-group">\n                        '.concat(t,'\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                <h4 class="panel-title">Other / Manual Input</h4>\n                            </div>\n                            <div class="panel-body">\n                                <input type="text" placeholder="Enter URL" class="form-control" id="cwrc-manual-input"/>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button id="cwrc-entity-lookup-select" type="button" class="btn btn-default">Select</button>\n                ').concat(m?'<button id="cwrc-entity-lookup-nolink" type="button" class="btn btn-default">Tag Without Linking</button><button id="cwrc-entity-lookup-keeplink" type="button" class="btn btn-default">Keep Current Link</button>':"","\n                ").concat(h?'<button id="cwrc-entity-lookup-edit" type="button" class="btn btn-default">Edit Selected</button>':"","\n                ").concat(g?'<button id="cwrc-entity-lookup-new" type="button" class="btn btn-default" disabled="disabled">Create New</button>':"",'\n                <button id="cwrc-entity-lookup-cancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="cwrc-title-entity-dialog" role="dialog" class="modal">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h3 id="cwrc-entity-lookup-title" class="modal-title">Create a New Entity</h3>\n            </div>\n            <div class="modal-body">\n                <p>A new window will open, where you can navigate to the desired collection and create the new entity (a citation object).</p>\n                <p>Once you\'re done, return to the current window and re-run the title search. The new entity you created will show up in the results and you will be able to tag it.</p>\n            </div>\n            <div class="modal-footer">\n                <button id="cwrc-title-entity-dialog-ok" type="button" class="btn btn-default">Ok</button>\n                <button id="cwrc-title-entity-dialog-cancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="cwrc-entity-lookup-edit-sources-dialog" role="dialog" class="modal">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h3 class="modal-title">Select Lookup Sources</h3>\n            </div>\n            <div class="modal-body">\n                ').concat(L(),'\n            </div>\n            <div class="modal-footer">\n                <button id="cwrc-entity-lookup-edit-sources-ok" type="button" class="btn btn-default">Use Selected</button>\n            </div>\n        </div>\n    </div>\n</div>'))),i('#cwrc-entity-lookup button[data-dismiss="modal"]').on("click",(function(){return _(),void(b.cancelled&&b.cancelled())})),i("#cwrc-entity-lookup-title").text(b.entityLookupTitle),i("#cwrc-entity-query").keyup((function(t){13===t.which&&k(i("#cwrc-entity-query").val())})),i("#cwrc-entity-lookup-redo").click((function(t){C()})),i("#cwrc-entity-lookup-edit-sources").click((function(t){!function(t){function e(){A(t.data("bs.popover").tip().find("input[type=checkbox]")),z(),C(),t.popover("hide")}void 0!==t.data("bs.popover")||(t.popover({animation:!1,trigger:"manual",placement:"bottom",html:!0,title:"Select sources",sanitize:!1,content:function(){return"".concat(L(),'<button class="btn btn-default" type="submit">Use Selected</button>')}}),t.on("hide.bs.popover",(function(){t.data("bs.popover").tip().find("button[type=submit]").off("click",e)}))),t.popover("show"),t.data("bs.popover").tip().css({"min-width":"230px"}),t.popover("show"),t.data("bs.popover").tip().find("button[type=submit]").on("click",e)}(i(this))})),i("#cwrc-entity-lookup-edit-sources-ok").click((function(){A(i("#cwrc-entity-lookup-edit-sources-dialog").find("input[type=checkbox]")),_("cwrc-entity-lookup-edit-sources-dialog"),j()})),i("#cwrc-manual-input").keyup((function(t){i(this).parent().removeClass("has-error").find("span.help-block").remove(),$()})),i("#cwrc-entity-lookup-new").click((function(t){"title"===b.entityType?(i("#cwrc-entity-lookup").modal("hide"),O("cwrc-title-entity-dialog")):N(!1)})),i("#cwrc-entity-lookup-edit").click((function(t){"title"===b.entityType?(i("#cwrc-entity-lookup").modal("hide"),O("cwrc-title-entity-dialog")):void 0!==w&&"CWRC"===w.repository&&N(!0)})),i("#cwrc-entity-lookup-select").click((function(t){if(void 0!==w)x(w);else{var e=i("#cwrc-manual-input").val();if(void 0!==e&&""!==e){/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)?x({id:e,uri:e,name:"Custom Entry",repository:"custom"}):!1===i("#cwrc-manual-input").parent().hasClass("has-error")&&i("#cwrc-manual-input").parent().addClass("has-error").append('<span class="help-block">URL is not valid</span>')}}})),i("#cwrc-entity-lookup-nolink").click((function(t){x({})})),i("#cwrc-entity-lookup-keeplink").click((function(t){x({uri:b.uri,name:b.name})})),i("#cwrc-title-entity-dialog-ok").click((function(t){N(),i("#cwrc-title-entity-dialog").modal("hide"),O("cwrc-entity-lookup")})),i('#cwrc-title-entity-dialog button[data-dismiss="modal"]').click((function(t){i("#cwrc-title-entity-dialog").modal("hide"),O("cwrc-entity-lookup")}))}}function O(t){(i("#"+t).modal("show"),b.parentEl)&&i("#"+t).data("bs.modal").$backdrop.detach().appendTo(b.parentEl)}function N(t){var e;"title"===b.entityType?e=p:(e=u+b.entityType,t&&(e+="?entityId="+w.id));var n=Math.min(1100,.8*window.outerWidth),i=.8*window.outerHeight,o=.5*(window.outerHeight-i),r=.5*(window.outerWidth-n);a=window.open(e,"entityFormWindow","menubar=no,statusbar=no,toolbar=no,width="+n+",height="+i+",top="+o+",left="+r)}function $(){var t=!0;if(void 0!==w)t=!1;else{var e=i("#cwrc-manual-input").val();void 0!==e&&""!==e&&(t=!1)}t?i("#cwrc-entity-lookup-select").addClass("disabled").prop("disabled",!0):i("#cwrc-entity-lookup-select").removeClass("disabled").prop("disabled",!1)}function I(){h&&(void 0===w||"CWRC"!==w.repository?i("#cwrc-entity-lookup-edit").addClass("disabled").prop("disabled",!0):i("#cwrc-entity-lookup-edit").removeClass("disabled").prop("disabled",!1))}function z(){l[b.entityType].forEach((function(t,e){M(e)?i("#cwrc-".concat(e,"-panel")).show():i("#cwrc-".concat(e,"-panel")).hide()}))}function j(){v?(O("cwrc-entity-lookup"),i("#cwrc-entity-lookup [data-toggle=tooltip]").tooltip(),$(),I(),g&&i.ajax({url:f}).then((function(t){try{return t.response.docs}catch(t){return[]}}),(function(){return[]})).then((function(t){t.length>0?i("#cwrc-entity-lookup-new").prop("disabled",""):i("#cwrc-entity-lookup-new").prop("disabled","disabled")})),i(".cwrc-result-panel").hide(),z(),b.query&&(i("#cwrc-entity-query").val(b.query),k(b.query))):O("cwrc-entity-lookup-edit-sources-dialog")}function F(t,e,n,o){(r=new s("cwrc-entity-management-forms")).onmessage=function(t){void 0===t||x({id:t,uri:l[b.entityType].get("cwrc").getEntityRoot()+"/"+t,repository:"cwrc"});a.close()};var d=c.get(y);if(void 0!==d)try{D(JSON.parse(d))}catch(t){console.warn('error parsing cookie "'+y+'"',t)}w=void 0,b=Object.assign({entityType:t,entityLookupMethodName:e,entityLookupTitle:n},o),R(),j(),b.uri?i("#cwrc-entity-lookup-keeplink").show():i("#cwrc-entity-lookup-keeplink").hide()}function B(t){return F("person","findPerson","Find a Person",t)}function U(t){return F("place","findPlace","Find a Place",t)}function W(t){return F("organization","findOrganization","Find an Organization",t)}function H(t){return F("title","findTitle","Find a Title",t)}function X(t){return F("rs","findRS","Find a Referencing String",t)}t.exports={init:R,registerEntitySources:function(t){l=t},setEnabledSources:D,showCreateNewButton:function(t){"boolean"==typeof t&&(g=t)},showNoLinkButton:function(t){"boolean"==typeof t&&(m=t)},showEditButton:function(t){"boolean"==typeof t&&(h=t)},setEntityFormsRoot:function(t){u=t},setCollectionsRoot:function(t){p=t},setEntityCollectionsUrl:function(t){f=t},popSearchPerson:B,popSearchOrganization:W,popSearchPlace:U,popSearchTitle:H,popSearchRS:X,popSearch:{person:B,organization:W,place:U,title:H,rs:X}}},,,,,,,,,,,,function(t,e,n){"use strict";var i=n(3);t.exports=function(t,e){var n=t,o=t.initialConfig.entityLookupDialogs,r=e.cwrcType,a=e.localDialog;return{show:function(t){if(t.entry){var e=t.entry.getContent().trim(),s=t.entry.getURI(),l=t.entry.getLemma();o.popSearch[r]({query:e,uri:s,name:l,parentEl:n.dialogManager.getDialogWrapper(),success:function(o){i.isArray(o.name)&&(o.name=o.name[0]);var r=o.name;"custom"===o.repository&&(r=e),n.entitiesManager.setURIForEntity(t.entry.getId(),o.uri),n.entitiesManager.setLemmaForEntity(t.entry.getId(),r),n.dialogManager.show("schema/"+a,{entry:t.entry})},cancelled:function(){},error:function(t){}})}else{e=(e=n.editor.currentBookmark.rng.toString()).trim().replace(/\s+/g," "),o.popSearch[r]({query:e,parentEl:n.dialogManager.getDialogWrapper(),success:function(t){i.isArray(t.name)&&(t.name=t.name[0]);var o=t.name;"custom"===t.repository&&(o=e),n.dialogManager.show("schema/"+a,{query:e,properties:{uri:t.uri,lemma:o}})},error:function(t){}})}},destroy:function(){}}}},,,,,,,,,function(t,e){function n(t){var e,n,i;if(this.id=void 0,this.type=void 0,this._isNote=!1,this._isNamedEntity=!1,this.tag=void 0,this.content=void 0,this.title=void 0,this.attributes={},this.customValues={},this.noteContent=void 0,this.dateCreated=void 0,this.dateModified=void 0,this.annotationRange={},this.uri=void 0,this.lemma=void 0,this.certainty=void 0,this.creator=void 0,this._didUpdate=!1,this._originalData=void 0,this.id=t.id,this.type=t.type,this.tag=t.tag,void 0!==t.dateCreated){var o=new Date(t.dateCreated);isNaN(o.valueOf())?this.dateCreated=(new Date).toISOString():this.dateCreated=o.toISOString()}else if(null!=t&&null!==(e=t.originalData)&&void 0!==e&&e["dcterms:created"]){var r=new Date(t.originalData["dcterms:created"]);isNaN(r.valueOf())?this.dateCreated=(new Date).toISOString():this.dateCreated=r.toISOString()}else this.dateCreated=(new Date).toISOString();if(null!=t&&t.dateModified){var a=new Date(t.dateModified);isNaN(a.valueOf())?this.dateModified=this.dateCreated:this.dateModified=a.toISOString()}else if(null!=t&&null!==(n=t.originalData)&&void 0!==n&&n["dcterms:modified"]){var s=new Date(t.originalData["dcterms:modified"]);isNaN(s.valueOf())?this.dateModified=this.dateCreated:this.dateModified=s.toISOString()}else this.dateModified=this.dateCreated;void 0!==t.content&&this.setContent(t.content),void 0!==t.attributes&&(this.attributes=t.attributes),void 0!==t.customValues&&(this.customValues=t.customValues),void 0!==t.noteContent&&(this.noteContent=t.noteContent,this._isNote=!0),void 0!==t.isNote&&(this._isNote=t.isNote),void 0!==t.range&&(this.annotationRange=t.range),void 0!==t.uri&&(this.uri=t.uri,this._isNamedEntity=!0),void 0!==t.lemma&&(this.lemma=t.lemma),void 0!==t.certainty&&(this.certainty=t.certainty),void 0!==t.isNamedEntity&&(this._isNamedEntity=t.isNamedEntity),null!=t&&null!==(i=t.originalData)&&void 0!==i&&i["dcterms:creator"]&&(this.creator=t.originalData["dcterms:creator"]),null!=t&&t.didUpdate&&(this._didUpdate=t.didUpdate),null!=t&&t.originalData&&(this._originalData=t.originalData)}n.getTitleFromContent=function(t){return(t=t.trim().replace(/\s+/g," ")).length<=34?t:t.substring(0,34)+"&#8230;"},n.prototype={constructor:n,getId:function(){return this.id},setId:function(t){this.id=t},getType:function(){return this.type},isNote:function(){return this._isNote},isNamedEntity:function(){return this._isNamedEntity},getTag:function(){return this.tag},setTag:function(t){this.tag=t},getContent:function(){return this.content},setContent:function(t){this.content=t,this.title=n.getTitleFromContent(this.content)},getTitle:function(){return void 0!==this.lemma?this.lemma:this.title},getAttribute:function(t){return this.attributes[t]},getAttributes:function(){return this.attributes},setAttribute:function(t,e){this.attributes[t]=e},setAttributes:function(t){for(var e in this.attributes={},t)this.attributes[e]=t[e]},removeAttribute:function(t){delete this.attributes[t]},getCustomValue:function(t){return this.customValues[t]},getCustomValues:function(){return this.customValues},setCustomValue:function(t,e){this.customValues[t]=e},setCustomValues:function(t){this.customValues=t},removeCustomValue:function(t){delete this.customValues[t]},setProperty:function(t,e){this.hasOwnProperty(t)&&(this[t]=e)},getNoteContent:function(){return this.noteContent},setNoteContent:function(t){this.noteContent=t},getDateCreated:function(){return this.dateCreated},getDateModified:function(){return this.dateModified},setDateModified:function(t){this.dateModified=t||(new Date).toISOString()},getURI:function(){return this.uri},setURI:function(t){this.uri=t},getLemma:function(){return this.lemma},setLemma:function(t){this.lemma=t},getCertainty:function(){return this.certainty},setCertainty:function(t){this.certainty=t},getRange:function(){return this.annotationRange},setRange:function(t){this.annotationRange=t},getCreator:function(){return this.creator},setCreator:function(t){this.creator=t},get didUpdate(){return this._didUpdate},setDidUpdate:function(t){this._didUpdate=t},get originalData(){return this._originalData},clone:function(){var t=Object.create(n.prototype);for(var e in this){var i=this[e];"function"!=typeof i&&(t[e]=i)}return t.dateCreated=(new Date).toISOString(),t}},t.exports=n},,,,function(t,e,n){var i=n(3),o=n(22);function r(t){this.w=t.writer,this.$el=t.$el,this.$parent=t.$parent,this.showSchemaHelp=!0===t.showSchemaHelp;var e=this.showSchemaHelp?'<div class="schemaHelp"></div>':"";this.mode=r.ADD,this.isDirty=!1,this.$el.addClass("attributeWidget"),this.$el.append('\n        <div class="attributeSelector">\n            <h2>Attributes</h2>\n            <ul></ul>\n        </div>\n            <div class="attsContainer">\n        </div>\n        '.concat(e,"\n    ")),void 0!==this.$parent&&i("[data-mapping]",this.$parent).each(i.proxy((function(t,e){var n,o=i(e),r=o.data("type"),a=o.data("mapping");-1===a.indexOf("custom.")&&-1===a.indexOf("prop.")&&("radio"===r?n=i("input",o):"textbox"!==r&&"select"!==r||(n=o),void 0!==n&&n.change(i.proxy((function(t,e){var n={};n[t]=i(e.target).val(),this.setData(n)}),this,a)))}),this))}n(72),n(58),r.ADD=0,r.EDIT=1,r.prototype={constructor:r,buildWidget:function(t,e,n){if(e=e||{},i(".attributeSelector ul, .attsContainer, .schemaHelp",this.$el).empty(),this.isDirty=!1,this.showSchemaHelp&&void 0!==n){var r=this.w.schemaManager.getDocumentationForTag(n);""!==r&&i(".schemaHelp",this.$el).html("<h3>".concat(n," Documentation</h3><p>").concat(r,"</p>"))}t.sort((function(t,e){return t.name>e.name?1:t.name<e.name?-1:0}));for(var a,s,l=o.reservedAttributes,c="",d="",u=!1,p=0;p<t.length;p++)if(s="",u=(a=t[p]).required,!0!==l[a.name]){var f=a.name;""!==a.fullName&&(f+=" (".concat(a.fullName,")")),a.defaultValue="";var g="block",h=u?" required":"";if(e[a.name]&&void 0!==e[a.name]?(g="block",d+='<li data-name="'.concat(a.name,'" class="selected').concat(h,'">').concat(f,"</li>"),a.defaultValue=e[a.name]):(g="none",d+='<li data-name="'.concat(a.name,'" class="').concat(h,'">').concat(f,"</li>")),s+='<div data-name="form_'.concat(a.name,'" style="display:').concat(g,';"><label>').concat(f,"</label>"),"string"==typeof a.documentation&&""!==a.documentation&&(s+='<ins class="ui-icon ui-icon-help" title="'.concat(a.documentation,'">&nbsp;</ins>')),s+="<br/>",a.choices&&a.choices.length>0){s+='<select name="'.concat(a.name,'">');for(var m=void 0,v=void 0,y=0;y<a.choices.length;y++)m=a.choices[y],v=a.defaultValue==m?' selected="selected"':"",s+='<option value="'.concat(m,'"').concat(v,">").concat(m,"</option>");s+="</select>"}else s+='<input type="text" name="'.concat(a.name,'" value="').concat(a.defaultValue,'"/>');u&&(s+=' <span class="required">*</span>'),c+=s+="</div>"}i(".attributeSelector ul",this.$el).html(d),i(".attsContainer",this.$el).html(c),i(".attributeSelector li",this.$el).click((function(){var t=i(this).data("name").replace(/:/g,"\\:"),e=i('[data-name="form_'.concat(t,'"]'),this.$el);i(this).toggleClass("selected"),i(this).hasClass("selected")?e.show():e.hide()})),i("ins",this.$el).tooltip({show:!1,hide:!1,classes:{"ui-tooltip":"cwrc-tooltip"}}),i("input, select, option",this.$el).change((function(t){this.isDirty=!0})),i("select, option",this.$el).click((function(t){this.isDirty=!0}))},reset:function(){i(".attributeSelector li",this.$el).each((function(t,e){i(this).removeClass("selected");var n=i(this).data("name").replace(/:/g,"\\:");i('[data-name="form_'.concat(n,'"]'),this.$el).hide()})),i(".attsContainer input, .attsContainer select",this.$el).val("")},setData:function(t){var e=!1;for(var n in t){var i=t[n];e=this.setAttribute(n,i)||e}return e},setAttribute:function(t,e){var n=i('.attributeSelector li[data-name="'.concat(t,'"]'),this.$el);if(1===n.length){if(null!=e){n.addClass("selected");var o=i('[data-name="form_'.concat(t,'"]'),this.$el);i("input, select",o).val(e),o.show()}else{n.removeClass("selected");var r=i('[data-name="form_'.concat(t,'"]'),this.$el);i("input, select",r).val(""),r.hide()}return!0}return console.warn("attributeWidget: no attribute for",t),!1},getData:function(){var t=this,e={};i(".attributeSelector li.selected",this.$el).each((function(n,o){var r=i(o).data("name");i('.attsContainer > div[data-name="form_'.concat(r,'"]'),t.$el).children('input[type!="hidden"], select').each((function(t,n){var o=i(this).val();""!==o&&(e[i(this).attr("name")]=o)}))}));var n=[];if(i(".attsContainer span.required",this.$el).parent().children('input[type!="hidden"], select').each((function(t,o){var r=e[i(this).attr("name")];void 0!==r&&""!=r||n.push(i(this).attr("name"))})),n.length>0){for(var o=0;o<n.length;o++){var r=n[o];i('.attsContainer *[name="'.concat(r,'"]'),this.$el).css({borderColor:"red"}).keyup((function(t){i(this).css({borderColor:"#ccc"})}))}return e}return e},expand:function(){this.$el.parent('[data-transform="accordion"]').accordion("option","active",0)},collapse:function(){this.$el.parent('[data-transform="accordion"]').accordion("option","active",!1)},destroy:function(){try{i("ins",this.$el).tooltip("destroy")}catch(t){console&&console.log("error destroying tooltip")}}},t.exports=r},,,,,,,,,,,function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n,r="note",a=t.schemaManager.getAttributesForTag(r).find((function(t){return"type"===t.name})),s=function(){var e=t.schemaManager.mapper.currentMappingsId;return"orlando"===e||"cwrcEntry"===e||null!=a&&a.required?"required":""},l=t.getUniqueId("noteForm_"),c='\n    <div class="annotationDialog">\n        <div>\n            <label for="'.concat(l,'_type"><b>Type').concat(s()&&"*",'</b></label>\n            <select id="').concat(l,'_type" name="').concat(l,'_type" data-type="select" data-mapping="').concat((n=t.schemaManager.mapper.currentMappingsId,"orlando"===n||"cwrcEntry"===n?"prop.tag":"type"),'" ').concat(s(),'></select>\n            <div id="').concat(l,'_noteOtherTypeSlot">\n                <br/>\n                <label for="').concat(l,'_noteOtherType"><b>Define Type</b></label>\n                <input type="text" id="').concat(l,'_noteOtherType" data-type="textbox" data-mapping="otherType" style="margin-right: 10px;"/>\n            </div>\n        </div>\n        <div>\n            <label for="').concat(l,'_noteContent">Note text</label>\n            <textarea id="').concat(l,'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea>\n            <p>You will be able to tag and edit the text in the main document.</p>\n        </div>\n        <div data-transform="accordion">\n            <h3>Markup options</h3>\n            <div id="').concat(l,'_attParent" class="attributes" data-type="attributes" data-mapping="attributes">\n            </div>\n        </div>\n    '),d=i(c).appendTo(e),u=new o({writer:t,$el:d,type:r,title:"Tag Note",width:600,height:500}),p=u.$el.find("#".concat(l,"_type")),f=u.$el.find("#".concat(l,"_noteOtherType"));u.$el.on("buildDynamicFields",(function(e,n,i){var o=null!=a&&a.choices?a.choices:function(){var e=t.schemaManager.mapper.currentMappingsId;return"orlando"===e||"cwrcEntry"===e?[{value:"RESEARCHNOTE",label:"Research Note",title:"Internal to projects"},{value:"SCHOLARNOTE",label:"Scholarly Note",title:"Footnotes/endnotes"}]:[{value:"researchNote",label:"Research Note",title:"Internal to projects"},{value:"scholarNote",label:"Scholarly Note",title:"Footnotes/endnotes"},{value:"annotation",label:"Annotation",title:"Informal notes"},{value:"other",label:"Other",title:"Other Notes"}]}(),r=h(o);p.html(r)})),u.$el.on("beforeShow",(function(t,e,n){var i=n.mode===o.EDIT;n.$el.find("label[for=".concat(l,"_noteContent]")).toggle(!i),n.$el.find("#".concat(l,"_noteContent")).toggle(!i);var r=p.val(),s=!(null!=a&&a.choices||"other"!==r);g(s)})),u.$el.on("beforeSave",(function(e,n){var i=n.$el.find("#".concat(l,"_type")).val();if(n.isValid=!s()||null!==i,n.isValid){if((null==a||!a.choices)&&"other"===p.val()){var o=n.$el.find("#".concat(l,"_noteOtherType")).val(),r='<option value="'.concat(o,'" selected>').concat(o,"</option>");p.html(r)}}else t.dialogManager.show("message",{title:"Warning",msg:"You must choose a Note type",height:150,type:"info"})}));var g=function(t){u.$el.find("#".concat(l,"_noteOtherTypeSlot")).toggle(t),t||u.$el.find("#".concat(l,"_noteOtherType")).val("")};p.change((function(t){if(null==a||!a.choices){var e="other"===i(t.target).val();g(e)}})),u.$el.find("#".concat(l,"_noteOtherType")).change((function(){var t=u.$el.find("#".concat(l,"_noteOtherType")).val();u.$el.find("#".concat(l,"_other")).attr("value",t)})),f.keyup((function(e){"Space"===e.code&&t.dialogManager.confirm({title:"Warning",msg:'Are you trying to add multiple values for this attribute? If not, remove the "space" you\'ve just added',height:200,type:"info",showConfirmKey:"confirm-space-in-xml-values"})}));var h=function(e){var n='<option value="" disabled selected hidden>Please Choose...</option>',i=t.schemaManager.mapper.currentMappingsId;return"orlando"!==i&&"cwrcEntry"!==i&&(n+='<option value=""></option>'),e.map((function(t){var e="string"==typeof t?t:t.value,i="string"==typeof t?t:t.label,o=(null==a?void 0:a.defaultValue)===e,r=o?"selected":"";n+='<option value="'.concat(e,'" data-default="').concat(o,'" ').concat(r,">").concat(i,"</option>")})),n};return{show:function(t){return u.show(t)},destroy:function(){return u.destroy()}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var i=n(3);n(32),i.widget("custom.popup",i.ui.dialog,{version:"1.10.4",close:function(t){var e=this;this._isOpen&&!1!==this._trigger("beforeClose",t)&&(this._isOpen=!1,this._destroyOverlay(),this._hide(this.uiDialog,this.options.hide,(function(){e._trigger("close",t)})))},open:function(){this._isOpen?this._moveToTop():(this._isOpen=!0,this.opener=i(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,(function(){})),this._trigger("open"))}})},function(t,e,n){var i,o,r;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}o=[n(3)],void 0===(r="function"==typeof(i=function(t,e,n){e=window;var i="watermark",o="watermarkClass",r="watermarkFocus",s="watermarkSubmit",l="watermarkMaxLength",c="watermarkPassword",d="watermarkText",u=/\r/g,p=/^(button|checkbox|hidden|image|radio|range|reset|submit)$/i,f="input:data("+i+"),textarea:data("+i+")",g=":watermarkable",h=["Page_ClientValidate"],m=!1,v="placeholder"in document.createElement("input");t.watermark=t.watermark||{version:"3.2.0",runOnce:!0,options:{className:"watermark",clearAllFormsOnSubmit:!1,hideBeforeUnload:!0,textAttr:"",useNative:!0},hide:function(e){t(e).filter(f).each((function(){t.watermark._hide(t(this))}))},_hide:function(t,n){var i,r,a=t[0],s=(a.value||"").replace(u,""),p=t.data(d)||"",f=t.data(l)||0,g=t.data(o);p.length&&s==p&&(a.value="",t.data(c)&&"text"===(t.attr("type")||"")&&(i=t.data(c)||[],r=t.parent()||[],i.length&&r.length&&(r[0].removeChild(t[0]),r[0].appendChild(i[0]),t=i)),f&&(t.attr("maxLength",f),t.removeData(l)),n&&(t.attr("autocomplete","off"),e.setTimeout((function(){t.select()}),1))),g&&t.removeClass(g)},show:function(e){t(e).filter(f).each((function(){t.watermark._show(t(this))}))},_show:function(e){var n,i,a,s=e[0],p=(s.value||"").replace(u,""),f=e.data(d)||"",g=e.attr("type")||"",h=e.data(o);0!=p.length&&p!=f||e.data(r)?t.watermark._hide(e):(m=!0,e.data(c)&&"password"===g&&(n=e.data(c)||[],i=e.parent()||[],n.length&&i.length&&(i[0].removeChild(e[0]),i[0].appendChild(n[0]),(e=n).attr("maxLength",f.length),s=e[0])),("text"===g||"search"===g)&&(a=e.attr("maxLength")||0)>0&&f.length>a&&(e.data(l,a),e.attr("maxLength",f.length)),h&&e.addClass(h),s.value=f)},hideAll:function(e){m&&(t.watermark.hide(t(g,e)),m=!1)},showAll:function(){t.watermark.show(g)}},t.fn.watermark=t.fn.watermark||function(n,l){if(!this.length)return this;var p=!1,f="string"==typeof n;return f&&(n=n.replace(u,"")),"object"==a(l)?(p="string"==typeof l.className,l=t.extend({},t.watermark.options,l)):"string"==typeof l?(p=!0,l=t.extend({},t.watermark.options,{className:l})):"object"==a(n)?(l=t.extend({},t.watermark.options,n),n=""):l=t.watermark.options,"function"!=typeof l.useNative&&(l.useNative=l.useNative?function(){return!0}:function(){return!1}),this.each((function(){var a,h,m,y,b=t(this);if(b.is(g)){if(l.textAttr&&(n=(b.attr(l.textAttr)||"").replace(u,""),f=!!n),b.data(i))(f||p)&&(t.watermark._hide(b),f&&b.data(d,n),p&&b.data(o,l.className));else{if(v&&l.useNative.call(this,b)&&"TEXTAREA"!==(b.attr("tagName")||""))return void(f&&"placeholder"!==l.textAttr&&b.attr("placeholder",n));b.data(d,f?n:""),b.data(o,l.className),b.data(i,1),"password"===(b.attr("type")||"")?(a=b.wrap("<span>").parent(),(h=t(a.html().replace(/type=["']?password["']?/i,'type="text"'))).data(d,b.data(d)),h.data(o,b.data(o)),h.data(i,1),h.attr("maxLength",n.length),h.focus((function(){t.watermark._hide(h,!0)})).bind("dragenter",(function(){t.watermark._hide(h)})).bind("dragend",(function(){e.setTimeout((function(){h.blur()}),1)})),b.blur((function(){t.watermark._show(b)})).bind("dragleave",(function(){t.watermark._show(b)})),h.data(c,b),b.data(c,h)):b.focus((function(){b.data(r,1),t.watermark._hide(b,!0)})).blur((function(){b.data(r,0),t.watermark._show(b)})).bind("dragenter",(function(){t.watermark._hide(b)})).bind("dragleave",(function(){t.watermark._show(b)})).bind("dragend",(function(){e.setTimeout((function(){t.watermark._show(b)}),1)})).bind("drop",(function(t){var e=b[0],n=t.originalEvent.dataTransfer.getData("Text");(e.value||"").replace(u,"").replace(n,"")===b.data(d)&&(e.value=n),b.focus()})),this.form&&(m=this.form,(y=t(m)).data(s)||(y.submit((function(){return t.watermark.hideAll.apply(this,l.clearAllFormsOnSubmit?[]:[m])})),m.submit?(y.data(s,m.submit),m.submit=function(e,n){return function(){var i=n.data(s);t.watermark.hideAll(l.clearAllFormsOnSubmit?null:e),i.apply?i.apply(e,Array.prototype.slice.call(arguments)):i()}}(m,y)):(y.data(s,1),m.submit=function(e){return function(){t.watermark.hideAll(l.clearAllFormsOnSubmit?null:e),delete e.submit,e.submit()}}(m))))}t.watermark._show(b)}}))},t.watermark.runOnce&&(t.watermark.runOnce=!1,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo((function(e){return function(n){return!!t.data(n,e)}})):function(e,n,i){return!!t.data(e,i[3])},watermarkable:function(t){var e,n=t.nodeName;return"TEXTAREA"===n||"INPUT"===n&&(!(e=t.getAttribute("type"))||!p.test(e))}}),function(e){t.fn.val=function(){var o,r=Array.prototype.slice.call(arguments);return this.length?r.length?(e.apply(this,r),t.watermark.show(this),this):this.data(i)?(o=(this[0].value||"").replace(u,""))===(this.data(d)||"")?"":o:e.apply(this):r.length?this:n}}(t.fn.val),h.length&&t((function(){for(var n,i,o=h.length-1;o>=0;o--)n=h[o],"function"==typeof(i=e[n])&&(e[n]=function(e){return function(){return t.watermark.hideAll(),e.apply(null,Array.prototype.slice.call(arguments))}}(i))})),t(e).bind("beforeunload",(function(){t.watermark.options.hideBeforeUnload&&t.watermark.hideAll()})))})?i.apply(e,o):i)||(t.exports=r)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t){t.exports=JSON.parse('{"_args":[["cwrc-writer-base@8.2.0","/Users/lucaju/locahost/CWRC/Islandora-CWRC-Writer"]],"_from":"cwrc-writer-base@8.2.0","_id":"cwrc-writer-base@8.2.0","_inBundle":false,"_integrity":"sha512-Y7fkBNXarPlZ2Yf/t2w7zlRvCNk1A1MgLVFntVaNqPEszMOq1Fux1dngdHjfsABphDr+4GZTephHJ+11PDoUiQ==","_location":"/cwrc-writer-base","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"cwrc-writer-base@8.2.0","name":"cwrc-writer-base","escapedName":"cwrc-writer-base","rawSpec":"8.2.0","saveSpec":null,"fetchSpec":"8.2.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/cwrc-writer-base/-/cwrc-writer-base-8.2.0.tgz","_spec":"8.2.0","_where":"/Users/lucaju/locahost/CWRC/Islandora-CWRC-Writer","author":{"name":"Andrew MacDonald","email":"andrewjames.code@gmail.com"},"bugs":{"url":"https://github.com/cwrc/CWRC-WriterBase/issues"},"contributors":[{"name":"James Chartrand","email":"jc.chartrand@gmail.com"},{"name":"Luciano Frizzera","email":"lucaju@gmail.com"}],"dependencies":{"@material-ui/core":"^4.12.3","@material-ui/icons":"^4.11.2","css":"^3.0.0","fscreen":"^1.2.0","iso-639-2":"^3.0.0","jquery":"^3.6.0","jquery-contextmenu":"^2.9.2","jquery-ui":"^1.12.1","js-cookie":"^3.0.0","jstree":"^3.3.11","moment":"^2.29.1","openseadragon":"^2.4.2","prism-themes":"^1.8.0","prismjs":"^1.24.1","react":"^16.14.0","react-dom":"^16.14.0","tinymce":"4.9.8"},"description":"intuitive document editing with xml and rdf","devDependencies":{"@babel/core":"^7.15.0","@babel/preset-env":"^7.15.0","@babel/preset-react":"^7.14.5","@jest-runner/electron":"^3.0.1","@semantic-release/changelog":"^5.0.1","@semantic-release/git":"^9.0.0","@testing-library/jest-dom":"^5.14.1","babel-jest":"^26.6.3","codecov":"^3.8.3","commitizen":"^4.2.4","cz-conventional-changelog":"^3.3.0","electron":"^13.1.8","eslint":"^7.32.0","eslint-plugin-react":"^7.24.0","fetch-mock":"^9.11.0","git-cz":"^4.7.6","husky":"^7.0.1","jest":"^26.6.3","jest-transform-stub":"^2.0.0","less":"^4.1.1","less-watch-compiler":"^1.16.2","semantic-release":"^17.4.4"},"files":["src"],"homepage":"https://github.com/cwrc/CWRC-WriterBase#readme","keywords":["xml","rdf","editor","annotation"],"license":"GPL-2.0","main":"src/js/writer.js","name":"cwrc-writer-base","repository":{"type":"git","url":"git+https://github.com/cwrc/CWRC-WriterBase.git"},"scripts":{"build":"npm run build-editor-css","build-dependency-graph":"depcruise --include-only \\"^src\\" --output-type dot src | dot -Gsplines=ortho -T svg | depcruise-wrap-stream-in-html > ./dependency-graph/dependency-graph.html","build-editor-css":"lessc src/css/editor.less src/css/build/editor.css","build-editor-css-dev":"less-watch-compiler src/css src/css/build editor.less","cm":"git-cz","prepare":"","report-coverage":"cat ./coverage/coverage-final.json | codecov","semantic-release":"semantic-release","test":"jest","test:watch":"jest --watch"},"version":"8.2.0"}')},,,,,function(t,e){},,,,,function(t,e,n){"use strict";var i=n(3),o=n(22);n(15),n(47),n(58),t.exports=function(t){var e=t.writer,n=t.parentId,r=e,a=!0,s=!1,l=!1,c=i("#"+n);c.append('<div class="moduleParent entitiesPanel">\n                <div class="moduleHeader">\n                <div>\n                    <button type="button" class="convert">Scrape Candidate Entities</button>\n                    <span style="display: none;">Candidate Entities</span>\n                </div>\n                <div class="convertActions" style="display: none;">\n                    <button type="button" class="accept">Accept All</button>\n                    <button type="button" class="reject">Reject All</button>\n                    <button type="button" class="done">Done</button>\n                </div>\n            </div>\n            <div class="subheader" style="display: none;">\n                <span>Candidate Entities</span>\n            </div>\n            <div class="moduleContent">\n                <ul class="entitiesList"></ul>\n            </div>\n            <div class="moduleFooter" style="display: flex;">\n            <div style="display: inline-block;">\n            <label for="filter" title="Filter" class="fas fa-filter"></label>\n            <select name="filter">\n                <option value="all" selected="selected">All</option>\n                <option value="person">Person</option>\n                <option value="place">Place</option>\n                <option value="date">Date</option>\n                <option value="org">Organization</option>\n                <option value="citation">Citation</option>\n                <option value="note">Note</option>\n                <option value="title">Title</option>\n                <option value="correction">Correction</option>\n                <option value="keyword">Keyword</option>\n                <option value="link">Link</option>\n            </select>\n        </div>\n        <div style="display: inline-block;">\n            <label for="sorting" title="Sorting" class="fas fa-sort"></label>\n            <select name="sorting">\n                <option value="seq" selected="selected">Sequential</option>\n                <option value="alpha">Alphabetical</option>\n                <option value="cat">Categorical</option>\n            </select>\n        </div> \n            </div>\n        </div>'),r.isReadOnly&&c.find(".moduleHeader").hide(),c.find("select").selectmenu({appendTo:r.layoutManager.getContainer(),position:{my:"left bottom",at:"left top",collision:"flipfit"},width:90}),c.find("button.convert").button().click((function(){p.convertEntities()})),c.find("button.accept").button().click((function(){_(),p.update()})),c.find("button.reject").button().click((function(){x(),p.update()})),c.find("button.done").button().click((function(){h().length<=0?C():r.dialogManager.confirm({title:"Warning",msg:"<p>All the remaining entities in the panel will be rejected.</p>\n                <p>Do you wish to proceed?</p>",showConfirmKey:"confirm-reject-candidate-entities",type:"info",callback:function(t){t&&(x(),C())}})}));var d=function(){return c.find('select[name="filter"]').val()},u=function(t){return c.find('select[name="filter"]').val(t).selectmenu("refresh")};c.find('select[name="filter"]').on("selectmenuchange",(function(){return p.update()})),c.find('select[name="sorting"]').on("selectmenuchange",(function(){return p.update()}));var p={};p.update=function(){if(a){g();var t=r.entitiesManager.getEntitiesArray(c.find('select[name="sorting"]').val());t=t.filter((function(t){return"true"!==t.getCustomValue("nerve")}));var e=d();"all"!==e&&(t=t.filter((function(t){return t.getType()===e})));var n="";t.forEach((function(t){return n+=f(t)})),l?c.find("ul.entitiesList").addClass("candidates"):c.find("ul.entitiesList").removeClass("candidates"),c.find("ul.entitiesList").html(n),c.find("ul.entitiesList > li > div").on("click",(function(){i(this).parent().toggleClass("expanded");var t=i(this).parent().data("id");r.entitiesManager.highlightEntity(t,null,!0)})).find(".actions > span").hover((function(){i(this).removeClass("ui-state-default"),i(this).addClass("ui-state-active")}),(function(){i(this).addClass("ui-state-default"),i(this).removeClass("ui-state-active")})).on("click",(function(t){t.stopPropagation();var e=i(this).data("action"),n=i(this).parents("li").data("id");switch(e){case"edit":r.tagger.editTagDialog(n);break;case"accept":v(n),p.update();break;case"reject":y(n),p.update();break;case"remove":r.tagger.removeEntity(n);break;case"acceptmatching":b(n),p.update();break;case"rejectmatching":w(n),p.update()}})),c.find(".actions").tooltip({show:!1,hide:!1,classes:{"ui-tooltip":"cwrc-tooltip"}}),r.entitiesManager.getCurrentEntity()&&c.find('ul.entitiesList > li[data-id="'+r.entitiesManager.getCurrentEntity()+'"]').addClass("expanded").find('div[class="info"]').show()}else s=!0};var f=function(t){var e="true"===t.getAttribute("_candidate"),n="<ul>",i=!1,a=t.getLemma();void 0!==a&&(n+="<li><strong>Standard</strong>: ".concat(a,"</li>"),i=!0);var s=t.getURI();void 0!==s&&(n+='<li><strong>URI</strong>: <a href="'.concat(s,'" target="_blank" rel="noopener">').concat(s,"</a></li>"),i=!0);var c=!1,d=t.getAttributes(),u=r.schemaManager.mapper.getUrlAttributes();for(var p in d)if(!0!==o.reservedAttributes[p]){var f=d[p];if(void 0===f){console.warn("entitiesList: undefined value for "+p+"in ",t);continue}if(-1!==u.indexOf(p)||0===f.indexOf("http")){if(f===s)continue;!c&&i&&(n+="<li><hr /></li>"),n+="<li><strong>".concat(p,'</strong>: <a href="').concat(f,'" target="_blank" rel="noopener">').concat(f,"</a></li>"),c=!0}else{if(f===a)continue;!c&&i&&(n+="<li><hr /></li>"),n+="<li><strong>".concat(p,"</strong>: ").concat(f,"</li>"),c=!0}}var g=t.getCustomValues();for(var h in g){var v=g[h];n+="<li><strong>".concat(h,"</strong>: ").concat(v,"</li>")}n+="</ul>";var y="";!1===r.isReadOnly&&(l&&e?(y='<span data-action="accept" class="ui-state-default" title="Accept"><span class="ui-icon ui-icon-check"/></span><span data-action="reject" class="ui-state-default" title="Reject"><span class="ui-icon ui-icon-close"/></span>',m(t.getId()).length>0&&(y+='<span data-action="acceptmatching" class="ui-state-default" title="Accept All Matching"><span class="ui-icon ui-icon-circle-check"/></span>',y+='<span data-action="rejectmatching" class="ui-state-default" title="Reject All Matching"><span class="ui-icon ui-icon-circle-close"/></span>')):y='<span data-action="edit" class="ui-state-default" title="Edit"><span class="ui-icon ui-icon-pencil"/></span><span data-action="remove" class="ui-state-default" title="Remove"><span class="ui-icon ui-icon-close"/></span>');return'\n        <li class="'.concat(t.getType()," ").concat(e?"candidate":"",'" data-type="').concat(t.getType(),'" data-id="').concat(t.getId(),'">\n            <div>\n                <div class="header">\n                    <span class="icon"/>\n                    <span class="entityTitle">').concat(t.getContent(),'</span>\n                    <div class="actions">').concat(y,'</div>\n                </div>\n                <div class="info">').concat(n,"</div>\n            </div>\n        </li>")};p.enable=function(t){a=!0,(t||s)&&(p.update(),s=!1)},p.disable=function(){return a=!1},p.destroy=function(){c.find("button").button("destroy"),c.find("select").selectmenu("destroy"),c.find(".actions").tooltip("destroy"),c.remove()};var g=function(){return c.find("ul").empty()};p.convertEntities=function(){var t=r.schemaManager.mapper.findEntities(["person","place","date","org","title","link","rs"]),e=[];for(var n in t)e=e.concat(t[n]);if((e=e.filter((function(t,e,n){return n.indexOf(t)===e}))).length<=0)r.dialogManager.show("message",{title:"Entities",msg:"No candidate entities were found.",type:"info"});else{l=!0,c.find(".convertActions").show(),c.find("button.convert").hide().button("option","disabled",!0).next("span").show();var o=r.dialogManager.getDialog("loadingindicator");o.setText("Converting Entities"),o.show(),r.event("massUpdateStarted").publish(),r.utilities.processArray(e,(function(t){var e=r.schemaManager.mapper.convertTagToEntity(t);null!==e&&(e.setAttribute("_candidate","true"),i("#"+e.id,r.editor.getBody()).attr("_candidate","true"))})).then((function(){o.hide(),r.event("contentChanged").publish(),r.event("massUpdateCompleted").publish()}))}};var h=function(){var t=r.entitiesManager.getEntitiesArray();return t=t.filter((function(t){return"true"===t.getAttribute("_candidate")&&"true"!==t.getCustomValue("nerve")}))},m=function(t){var e=[],n=r.entitiesManager.getEntity(t);return r.entitiesManager.eachEntity((function(t,i){i.getId()!==n.getId()&&JSON.stringify(i.getAttributes())===JSON.stringify(n.getAttributes())&&JSON.stringify(i.getCustomValues())===JSON.stringify(n.getCustomValues())&&i.getContent()===n.getContent()&&e.push(i.getId())})),e},v=function(t){var e=r.entitiesManager.getEntity(t);e.removeAttribute("_candidate"),i("#"+e.id,r.editor.getBody()).removeAttr("_candidate")},y=function(t){return r.tagger.removeEntity(t)},b=function(t){var e=m(t);v(t),e.forEach((function(t){return v(t)}))},w=function(t){var e=m(t);y(t),e.forEach((function(t){return y(t)}))},_=function(){var t=d();r.entitiesManager.eachEntity((function(e,n){"true"===n.getAttribute("_candidate")&&"true"!==n.getCustomValue("nerve")&&("all"!==t&&t!==n.getType()||v(n.getId()))})),u("all")},x=function(){r.event("massUpdateStarted").publish();var t=d();r.entitiesManager.eachEntity((function(e,n){"true"===n.getAttribute("_candidate")&&"true"!==n.getCustomValue("nerve")&&("all"!==t&&t!==n.getType()||y(n.getId()))})),u("all"),r.event("massUpdateCompleted").publish()},C=function(){l=!1,c.find(".convertActions").hide(),c.find("button.convert").show().button("option","disabled",!1).next("span").hide(),p.update()};return r.event("loadingDocument").subscribe((function(){g(),C(),p.disable()})),r.event("documentLoaded").subscribe((function(){return p.enable(!0)})),r.event("schemaLoaded").subscribe((function(){return p.update()})),r.event("contentChanged").subscribe((function(){return p.update()})),r.event("contentPasted").subscribe((function(){return p.update()})),r.event("entityAdded").subscribe((function(){return p.update()})),r.event("entityEdited").subscribe((function(){return p.update()})),r.event("entityRemoved").subscribe((function(t){return function(t){return c.find('li[data-id="'+t+'"]').remove()}(t)})),r.event("entityFocused").subscribe((function(t){c.find('ul.entitiesList > li[data-id="'+t+'"]').addClass("expanded")})),r.event("entityUnfocused").subscribe((function(){c.find("ul.entitiesList > li").each((function(t,e){i(this).removeClass("expanded")}))})),r.event("entityPasted").subscribe((function(){return p.update()})),r.event("massUpdateStarted").subscribe((function(){return p.disable()})),r.event("massUpdateCompleted").subscribe((function(){return p.enable(!0)})),r.entitiesList=p,r.event("entitiesListInitialized").publish(p),p}},function(t,e,n){"use strict";var i=n(3);n(16);var o=n(423);t.exports=function(t){var e,n=t.writer,r=t.parentId+"_imageViewer",a=t.tag||"pb",s=t.attribute||"facs";i("#"+t.parentId).append('<div id="'+r+'" class="imageViewer"><div class="toolbar"><div class="navigation"><span id="'+r+'_prev" class="button prev" /><span id="'+r+'_next" class="button next" /><span class="pageInfo"><input type="text" class="currPage" /> / <span class="totalPages" /></span></div><div class="zoom"><span id="'+r+'_zoomIn" class="button zoomIn" /><span id="'+r+'_zoomOut" class="button zoomOut" /><span id="'+r+'_home" class="button home" /></div></div><div id="'+r+'_osd" class="image"></div></div>'),i("#"+t.parentId).css("overflow","hidden");var l,c=i("#"+r),d=-1,u=!1;n.event("loadingDocument").subscribe((function(){f.reset()}));var p=function t(){var e=i(n.editor.getDoc()).find("#schemaRules")[0];null==e?setTimeout(t,50):e.sheet.insertRule('*[_tag="'+a+'"] { display: block; }',0)};n.event("documentLoaded").subscribe((function(t,e){t&&(g(e,!0),setTimeout(p,50))})),n.event("contentChanged").subscribe((function(){g(n.editor.getDoc(),!1)})),n.event("writerInitialized").subscribe((function(){i(n.editor.getDoc()).scroll(m)}));var f={};function g(t,o){if(v(""),0===(l=i(t).find("*[_tag="+a+"]")).length)v("Provide page breaks ("+a+") with "+s+" attributes \n pointing to image URLs in order to \n display the corresponding images/scans \n for pages in this doument."),n.layoutManager.hideModule("imageViewer");else{var r=[];l.each((function(t,e){var n=i(e).attr(s);void 0===n||""===n||r.push({type:"image",url:n})}));var u=o||r.length!==e.tileSources.length;if(!u)for(var p=0;p<r.length;p++)if(r[p].url!==e.tileSources[p].url){u=!0;break}u&&(e.open(r),0===r.length?n.layoutManager.hideModule("imageViewer"):n.layoutManager.showModule("imageViewer"),c.find(".totalPages").html(l.length),d=-1,m())}}function h(t,e){if(t>=0&&t<l.length&&(d=t,c.find(".currPage").val(d+1),!u&&e)){u=!0;var n=l.get(d);0===d&&i(n).show(),n.scrollIntoView(),0===d&&i(n).hide()}}function m(){if(!u){var t=i("iframe",n.editor.getContainer()).height(),o=n.editor.getDoc().scrollingElement.scrollTop,r=o+t,a=-1;l.each((function(t,e){var n=i(e).offset().top;if(n>=o&&n<r)return a=t,!1})),u=!0,e.goToPage(a)}u=!1}function v(t){e.drawer.clear(),e._showMessage(t)}return f.reset=function(){l=null,d=-1,e.drawer.clear(),e.close(),e.tileSources=[]},f.destroy=function(){e.destroy(),e=null},c.find(".image img").on("load",(function(){var t,e,n,i,o,r,a,s;n=c.parent(),i=n.width(),o=n.height()-30,r=c.find(".image img"),a=r.width(),(s=r.height()/a)>=1&&(s>o/i?e=(t=o)/s:t=(e=i)*s),r.css("height",t).css("width",e).css("display","block")})),c.find(".currPage").keyup((function(t){if(13==t.keyCode){var e=parseInt(i(this).val());isNaN(e)||h(e-1,!0)}})),(e=o({id:r+"_osd",sequenceMode:!0,autoHideControls:!1,showFullPageControl:!1,previousButton:r+"_prev",nextButton:r+"_next",zoomInButton:r+"_zoomIn",zoomOutButton:r+"_zoomOut",homeButton:r+"_home"})).addHandler("open-failed",(function(t){var e=t.message;!0===t.source.url&&(e="No URI found for @"+s+"."),v(e)})),e.addHandler("reset-size",(function(t){0==t.contentFactor&&v("No URI found for @"+s+".")})),e.addHandler("page",(function(t){h(t.page,!0)})),f}},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var p={};function f(){}function g(){}function h(){}var m={};c(m,r,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,r)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(r,a,s,l){var c=u(t[r],t,a);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==i(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,s,l)}),(function(t){o("throw",t,s,l)})):e.resolve(p).then((function(t){d.value=t,s(d)}),(function(t){return o("throw",t,s,l)}))}l(c.arg)}var r;this._invoke=function(t,n){function i(){return new e((function(e,i){o(t,n,e,i)}))}return r=r?r.then(i,i):i()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,c(b,"constructor",h),c(h,"constructor",g),g.displayName=c(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(d(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,l,"Generator"),c(b,r,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function s(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}var l=n(3);n(15),n(47),n(58);var c=n(7),d={PERSON:"person",LOCATION:"place",ORGANIZATION:"org",TITLE:"title"};var u=function(t,e,n,i){var o=t.initialConfig.entityLookupDialogs;"org"===n&&(n="organization"),o.popSearch[n]({query:e,parentEl:t.dialogManager.getDialogWrapper(),success:function(t){l.isArray(t.name)&&(t.name=t.name[0]),i.call(o,t)},error:function(t){}})},p=function(t,e){var n=!1,i=l('\n        <div class="annotationDialog">\n            <div>\n                <select data-transform="selectmenu" data-type="select" data-mapping="prop.type">\n                    <option value="person">Person</option>\n                    <option value="place">Place</option>\n                    <option value="org">Organization</option>\n                    <option value="title">Title</option>\n                </select>\n            </div>\n            <div>\n                <label>Standard name:</label>\n                <input type="text" data-type="textbox" data-mapping="prop.lemma" />\n            </div>\n            <div>\n                <label>URI:</label>\n                <input type="text" data-type="textbox" data-mapping="prop.uri" style="margin-right: 5px;" />\n                <button type="button" title="Entity lookup" data-action="lookup"></button>\n            </div>\n        </div>').appendTo(e),o=new c({writer:t,$el:i,type:"person",title:"Edit Entity",width:350,height:300});return o.$el.find("button[data-action=lookup]").button({icon:"ui-icon-search"}).on("click",(function(){var e=o.$el.find("select").val(),n=o.showConfig.entry.content.trim().replace(/\s+/g," ");u(t,n,e,(function(t){var e=t.name,n=t.uri;o.$el.find('input[data-mapping="prop.lemma"]').val(e),o.$el.find('input[data-mapping="prop.uri"]').val(n)}))})),o.$el.on("beforeShow",(function(){n=!1})),o.$el.on("beforeSave",(function(e,i){if(n)i.isValid=!0;else{var o=i.$el.find('input[data-mapping="prop.uri"]').val(),r=new RegExp("^https?://");""!==o&&0!==o.search(r)?(i.isValid=!1,t.dialogManager.confirm({title:"Warning",msg:"\n                        <p>The URI you have entered does not look valid.</p>\n                        <p>Are you sure you want to use it?</p>",showConfirmKey:"confirm-nerve-uri",type:"info",callback:function(t){setTimeout((function(){t&&(n=!0,i.save())}))}})):i.isValid=!0}if(i.isValid){console.log(i.currentData);var a=t.schemaManager,s=i.currentData.properties.type,l=a.mapper.getParentTag(s);i.currentData.properties.tag=l;var c=t.entitiesManager.getEntity(i.currentId).getType();if(s!==c){var d=a.mapper.getRequiredAttributes(c);for(var u in d)delete i.currentData.attributes[u]}var p=a.mapper.getAttributeForProperty(s,"lemma");p&&(i.currentData.attributes[p]=i.$el.find('input[data-mapping="prop.lemma"]').val());var f=a.mapper.getAttributeForProperty(s,"uri");f&&(i.currentData.attributes[f]=i.$el.find('input[data-mapping="prop.uri"]').val()),i.currentData.customValues.edited="true"}})),o};function f(t,e){var n=t,i=[],o=null,r="$$$$OTHER$$$$",a=l('<div class="annotationDialog"><div class="selections"><h3>Selections</h3><ul></ul></div><div><div class="lemma"><label>Standard name:</label><select name="lemma"></select></div><div style="margin-top: 5px;"><label>Other name:</label><input name="otherLemma" type="text" /></div></div><div><div class="link"><label>URI:</label><select name="link"></select></div><div style="margin-top: 5px;"><label>Other URI:</label><input name="otherLink" type="text" style="margin-right: 5px;"/><button type="button" title="Entity lookup" data-action="lookup"></button></div></div></div>').appendTo(e);a.dialog({title:"Merge Entities",modal:!1,resizable:!0,closeOnEscape:!1,height:500,width:400,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Merge",click:function(){var t=a.find("select[name=lemma]").val(),e=a.find("select[name=link]").val();t===r&&(t=a.find("input[name=otherLemma]").val()),e===r&&(e=a.find("input[name=otherLink]").val()),a.trigger("merge",[i,o,t,e]),a.dialog("close")}},{text:"Cancel",click:function(){a.trigger("cancel"),a.dialog("close")}}]}),a.find("button[data-action=lookup]").button({icon:"ui-icon-search"}).on("click",(function(){var t=i[0].getContent(),e=i[0].getType();u(n,t,e,(function(t){a.find("input[name=otherLink]").val(t.uri)}))}));return{show:function(){a.find("ul").empty(),a.find("select").empty().each((function(t,e){void 0!==l(e).selectmenu("instance")&&l(e).selectmenu("destroy")})),a.find("input[name=otherLemma]").val("").parent().hide(),a.find("input[name=otherLink]").val("").parent().hide(),a.dialog("open")},$el:a,populate:function(t,e){i=t,o=e;var n="",s=[],l=[];t.forEach((function(t,e){n+="<li>"+t.getContent()+"</li>";var i=t.getLemma();void 0!==i&&-1===s.indexOf(i)&&s.push(i);var o=t.getURI();void 0!==o&&-1===l.indexOf(o)&&l.push(o)}));var c=0===s.length,d="";s.forEach((function(t){d+='<option value="'+t+'">'+t+"</option>",void 0!==e&&e.lemma!==t&&(c=!0)})),d+='<option value="$$$$OTHER$$$$">Other (specify)</option>';var u=0===l.length,p="";l.forEach((function(t){p+='<option value="'+t+'">'+t+"</option>",void 0!==e&&e.uri!==t&&(u=!0)})),p+='<option value="$$$$OTHER$$$$">Other (lookup)</option>',0===l.length&&a.find("input[name=otherLink]").parent().show(),a.find("ul").html(n),a.find("select[name=lemma]").html(d).selectmenu({select:function(t,e){e.item.value===r?a.find("input[name=otherLemma]").parent().show():a.find("input[name=otherLemma]").parent().hide()}}),a.find("select[name=link]").html(p).selectmenu({select:function(t,e){e.item.value===r?a.find("input[name=otherLink]").parent().show():a.find("input[name=otherLink]").parent().hide()}}),void 0!==e&&(c?(a.find("select[name=lemma]").val(r).selectmenu("refresh"),a.find("input[name=otherLemma]").val(e.lemma).parent().show()):a.find("select[name=lemma]").val(e.lemma),u?(a.find("select[name=link]").val(r).selectmenu("refresh"),a.find("input[name=otherLink]").val(e.uri).parent().show()):a.find("select[name=link]").val(e.uri))}}}t.exports=function(t){var e=t.writer,n=t.parentId,i=t.nerveUrl;void 0===i&&console.error("Nerve: no nerveUrl specified!");var r={},c=null,u=null,g=!1,h=l("#"+n);h.append('\n        <div class="moduleParent nervePanel">\n            <div class="moduleHeader">\n                <div>\n                    <select name="processOptions">\n                        <option value="tag">Entity Recognition</option>\n                        \x3c!--<option value="both">Recognition & Linking</option>\n                        <option value="link">Linking Only</option>--\x3e\n                    </select>\n                    <button type="button" class="run">Run</button>\n                    <button type="button" class="done" style="display: none;">Done</button>\n                </div>\n                <div class="filters" style="display: none; margin: 0px;">\n                    <div style="display: inline-block; margin: 5px;">\n                        <label for="filter" title="Filter" class="fas fa-filter"></label>\n                        <select name="filter">\n                            <option value="all" selected="selected">All</option>\n                            <optgroup label="Type">\n                                <option value="type_person">Person</option>\n                                <option value="type_place">Place</option>\n                                <option value="type_org">Organization</option>\n                                <option value="type_title">Title</option>\n                            </optgroup>\n                            <optgroup label="Status">\n                                <option value="status_edited">Edited</option>\n                                <option value="status_notedited">Not Edited</option>\n                            </optgroup>\n                        </select>\n                    </div>\n                    <div style="display: inline-block; margin: 5px;">\n                        <label for="sorting" title="Sorting" class="fas fa-sort"></label>\n                        <select name="sorting">\n                            <option value="seq" selected="selected">Sequential</option>\n                            <option value="alpha">Alphabetical</option>\n                            <option value="cat">Categorical</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="listActions" style="display: none;">\n                    <button type="button" class="expand">Expand All</button>\n                    <button type="button" class="accept">Accept All</button>\n                    <button type="button" class="reject">Reject All</button>\n                </div>\n            </div>\n            <div class="moduleContent">\n                <ul class="entitiesList"></ul>\n            </div>\n            <div class="moduleFooter">\n                <button type="button" class="mergeEntities">Merge Entities</button>\n                <div class="mergeActions" style="display: none;">\n                    <button type="button" class="merge">Merge</button>\n                    <button type="button" class="cancelMerge">Cancel</button>\n                </div>\n            </div>\n        </div>'),h.find("select[name=processOptions]").selectmenu({appendTo:e.layoutManager.getContainer()}),h.find(".filters select").selectmenu({appendTo:e.layoutManager.getContainer(),width:90}),h.find("button.run").button().on("click",(function(){m()})),h.find("button.done").button().on("click",(function(){var t=w(!0).length+Object.keys(r).length;t>0?e.dialogManager.confirm({title:"Warning",msg:"<p>You are about to lose edits you've made to ".concat(t," Nerve-identified entit").concat(t>1?"ies":"y",".</p>\n                <p>Do you wish to proceed?</p>"),noText:"No, review edited entities",type:"info",callback:function(t){t?(I(!0),V()):(S("status_edited"),T("status_edited"))}}):(I(!0),V())})),h.find('select[name="filter"]').on("selectmenuchange",(function(){T(E())})),h.find('select[name="sorting"]').on("selectmenuchange",(function(){_()})),h.find("button.expand").button().on("click",(function(){"Expand All"===l(this).text()?(l(this).text("Collapse All"),h.find(".entitiesList > li").each((function(t,e){l(e).addClass("expanded")}))):(l(this).text("Expand All"),h.find(".entitiesList > li").each((function(t,e){l(e).removeClass("expanded")})))})),h.find("button.accept").button().on("click",(function(){N()})),h.find("button.reject").button().on("click",(function(){I()})),h.find("button.mergeEntities").button({disabled:!0}).on("click",(function(){j(!0)})),h.find(".moduleFooter button.merge").button().on("click",(function(){B()})),h.find(".moduleFooter button.cancelMerge").button().on("click",(function(){j(!1)}));var m=function(){var t,n=(t=a().mark((function t(){var n,o,r,s,l,c,d,u,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return q.reset(),n=v(),o=y(),r=h.find('select[name="processOptions"]').val(),["tag","link"],"tag"===r?["tag"]:"link"===r&&["link"],(s=e.dialogManager.getDialog("loadingindicator")).setText("Contacting NERVE"),s.setValue(!1),s.show(),t.next=12,fetch("".concat(i,"/ner"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({document:n,context:o})}).catch((function(t){console.warn("encoding failed",t),s.hide(),e.dialogManager.show("message",{title:"Error",msg:"The NERVE server returned an error: ".concat(t.exception),type:"error"})}));case 12:return l=t.sent,t.next=15,l.json();case 15:if(400===(c=t.sent)["http-response-status"]&&(console.warn("The NERVE server returned an error. Bad request (possibly encode error): ".concat(c.message)),s.hide(),e.dialogManager.show("message",{title:"Error",msg:"The NERVE server returned an error. Bad request (possibly encode error): ".concat(c.message),type:"error"})),e.event("massUpdateStarted").publish(),null!==(d=e.utilities.stringToXML(c.document))){t.next=23;break}return console.warn("nerve.run: could not parse response from NERVE"),s.hide(),t.abrupt("return");case 23:return u=JSON.parse(c.context),p=b(d,u),s.setText("Processing Response"),e.tagger.removeNoteWrappersForEntities(),t.next=29,e.utilities.processArray(p,L);case 29:e.tagger.addNoteWrappersForEntities(),s.hide(),_(),e.event("massUpdateCompleted").publish(),e.editor.setMode("readonly"),h.find("button.run").hide(),h.find("button.done").show(),h.find(".filters").show(),h.find(".listActions").show(),h.find('select[name="processOptions"]').selectmenu("option","disabled",!0),h.find("button.mergeEntities").button("enable");case 40:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){s(r,i,o,a,l,"next",t)}function l(t){s(r,i,o,a,l,"throw",t)}a(void 0)}))});return function(){return n.apply(this,arguments)}}(),v=function(){var t='<?xml version="1.0" encoding="UTF-8"?>\n<?xml-model href="'.concat(e.schemaManager.getXMLUrl(),'" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>\n');e.entitiesManager.highlightEntity();var n=e.schemaManager.getRoot();return function n(i){var r,a,s=(r=i.attr("_tag"),a=[],void 0!==r?[].concat(o(a),["<".concat(r,">"),"</".concat(r,">")]):["",""]);"<teiHeader>"!==s[0]&&(t+=s[0],i.contents().each((function(i,o){o.nodeType==Node.ELEMENT_NODE?n(l(o)):o.nodeType==Node.TEXT_NODE&&(t+=e.utilities.convertTextForExport(o.data))})),t+=s[1])}(l(e.editor.getBody()).children("[_tag=".concat(n,"]"))),t=t.replace(/\uFEFF/g,"")},y=function(){var t=e.schemaManager,n={name:t.getCurrentSchema().id,tags:{}},i=t.mapper.getResponsibilityAttributeName();for(var o in d){var r=d[o];n.tags[o]={name:t.mapper.getParentTag(r),lemmaAttribute:t.mapper.getMappingForProperty(r,"lemma").replace("@",""),linkAttribute:t.mapper.getMappingForProperty(r,"uri").replace("@",""),idAttribute:t.mapper.getIdAttributeName(),defaults:{}},n.tags[o].defaults[i]="NERVE",Object.assign(n.tags[o].defaults,t.mapper.getRequiredAttributes(r))}return n},b=function(t,n){var i=e.schemaManager,o=[],r={};for(var a in n.tags){var s=n.tags[a];r[s.name]={lemma:s.lemmaAttribute,uri:s.linkAttribute,type:d[a]}}var c=i.mapper.getResponsibilityAttributeName();return l(t.documentElement).find("["+c+"=NERVE]").each((function(t,n){var r=n.nodeName,a=i.mapper.getReverseMapping(n,!0);if(void 0===a.type)console.warn("nerve: unrecognized entity type for",r);else if(void 0!==a.lemma||void 0!==a.uri){var s=e.utilities.getElementXPath(n.parentElement),l=function(t,e){for(var n=0,i=t.ownerDocument.createTreeWalker(t,NodeFilter.SHOW_ALL);i.nextNode();){var o=i.currentNode;if(o===e)break;o.nodeType===Node.TEXT_NODE&&(n+=o.length)}return n}(n.parentElement,n);a.text=n.textContent,a.xpath=s,a.textOffset=l,a.textLength=n.textContent.length,o.push(a)}})),o},w=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e.entitiesManager.getEntitiesArray(D());return n=n.filter((function(e){return"true"===e.getCustomValue("nerve")&&(t&&"true"===e.getCustomValue("edited")||!t)}))},_=function(){h.find(".moduleContent ul").empty();var t="";for(var n in w().forEach((function(e,n){!1===F(e.getId())&&(t+=x(e,g))})),r)t+=C(n,g);h.find("ul.entitiesList").html(t),h.find("ul.entitiesList > li > div").on("click",(function(t){l(this).parent().toggleClass("expanded");var n=l(this).parent().attr("data-id");e.entitiesManager.highlightEntity(n,null,!0)})).find(".actions > span").hover((function(){l(this).removeClass("ui-state-default"),l(this).addClass("ui-state-active")}),(function(){l(this).addClass("ui-state-default"),l(this).removeClass("ui-state-active")})).on("click",(function(t){t.stopPropagation();var n=l(this).data("action"),i=l(this).parents("li").data("id"),o=l(this).parents("li").hasClass("merged");switch(n){case"accept":o?(W(i),e.entitiesList.update()):(A(i),e.entitiesList.update());break;case"acceptmatching":R(i);break;case"reject":o?H(i):$(i);break;case"edit":o?B(i):z(i);break;case"unmerge":U(i)}})),h.find("ul.entitiesList > li .nav > span").hover((function(){l(this).removeClass("ui-state-default"),l(this).addClass("ui-state-active")}),(function(){l(this).addClass("ui-state-default"),l(this).removeClass("ui-state-active")})).on("click",(function(t){t.stopPropagation();var n=l(this).data("action"),i=r[l(this).parents("li").data("id")],o=e.entitiesManager.getCurrentEntity(),a=0;"previous"===n?(null==o||(a=i.entityIds.indexOf(o)-1)<0)&&(a=i.entityIds.length-1):(null==o||(a=i.entityIds.indexOf(o)+1)>i.entityIds.length-1)&&(a=0);var s=i.entityIds[a];e.entitiesManager.highlightEntity(s,null,!0)})),g&&h.find("ul.entitiesList > li > input").on("click",(function(){var t=X();if(0===t.length)T("all");else{var e=t.first().data("type");T("type_"+e)}})),h.find("ul.entitiesList .actions").tooltip({show:!1,hide:!1,classes:{"ui-tooltip":"cwrc-tooltip"}})},x=function(t,e){var n=O(t.getId()).length>0;return'<li class="'+t.getType()+'" data-type="'+t.getType()+'" data-id="'+t.getId()+'">'+(!0===e?'<input type="checkbox" />':"")+'<div><div class="header"><span class="icon"/><span class="entityTitle">'+("true"===t.getCustomValue("edited")?"&#8226; ":"")+t.getContent()+'</span><div class="actions">'+(!0===e?"":'<span data-action="edit" class="ui-state-default" title="Edit"><span class="ui-icon ui-icon-pencil"/></span><span data-action="accept" class="ui-state-default" title="Accept"><span class="ui-icon ui-icon-check"/></span>'+(!0===n?'<span data-action="acceptmatching" class="ui-state-default" title="Accept All Matching"><span class="ui-icon ui-icon-circle-check"/></span>':"")+'<span data-action="reject" class="ui-state-default" title="Reject"><span class="ui-icon ui-icon-close"/></span>')+'</div></div><div class="info">'+k(t)+"</div></div></li>"},C=function(t,e){var n=r[t];return'<li class="'+n.type+' merged" data-type="'+n.type+'" data-id="'+t+'">'+(!0===e?'<input type="checkbox" />':"")+'<div><div class="header"><span class="icon" style="margin-right: -4px;"/><span class="icon"/><span class="entityTitle">&#8226; '+n.lemma+'</span><div class="actions">'+(!0===e?"":'<div class="nav"><span data-action="previous" class="ui-state-default" title="Previous Entity"><span class="ui-icon ui-icon-circle-arrow-w"></span></span><span data-action="next" class="ui-state-default" title="Next Entity"><span class="ui-icon ui-icon-circle-arrow-e"></span></span></div><span data-action="unmerge" class="ui-state-default" title="Unmerge"><span class="ui-icon ui-icon-scissors"></span></span><span data-action="edit" class="ui-state-default" title="Edit"><span class="ui-icon ui-icon-pencil"></span></span><span data-action="accept" class="ui-state-default" title="Accept"><span class="ui-icon ui-icon-check"></span></span><span data-action="reject" class="ui-state-default" title="Reject"><span class="ui-icon ui-icon-close"></span></span>')+'</div></div><div class="info"><ul><li><strong>URI</strong>: <a href="'+n.uri+'" target="_blank" rel="noopener">'+n.uri+"</a></li></ul></div></div></li>"},k=function(t){var e="<ul>",n=t.getLemma();void 0!==n&&(e+="<li><strong>Standard</strong>: "+n+"</li>");var i=t.getURI();return void 0!==i&&(e+='<li><strong>URI</strong>: <a href="'+i+'" target="_blank" rel="noopener">'+i+"</a></li>"),e+="</ul>"},T=function(t){var n="type";if(-1!==t.indexOf("_")){var i=t.split("_");n=i[0],t=i[1]}h.find("ul.entitiesList > li").each((function(i,o){var r=l(this);if("all"===t)r.show();else if("type"===n)r.hasClass(t)?r.show():r.hide();else{var a=e.entitiesManager.getEntity(r.data("id")),s=a&&"true"===a.getCustomValue("edited")||r.hasClass("merged");"edited"===t&&s||"notedited"===t&&!s?r.show():r.hide()}}))},E=function(){return h.find('select[name="filter"]').val()},S=function(t){h.find('select[name="filter"]').val(t).selectmenu("refresh")},D=function(){return h.find('select[name="sorting"]').val()},P=function(t){return e.entitiesManager.getEntity(t)},M=function(t){h.find("ul.entitiesList li[data-id="+t+"]").remove()},L=function(t){var n=function(t){var n=e.utilities.evaluateXPath(e.editor.getBody(),t.xpath);if(null===n)return console.warn('nerve: could not get parent for "',t.lemma,'" at:',t.xpath),null;for(var i,o=0,r=e.editor.getDoc().createTreeWalker(n,NodeFilter.SHOW_ALL);r.nextNode();)if((i=r.currentNode).nodeType===Node.TEXT_NODE){if(o+i.length>=t.textOffset)break;1===i.length&&"\ufeff"===i.data||(o+=i.length)}var a=t.textOffset-o,s=a+t.textLength,l=e.editor.selection.getRng(!0);try{return l.setStart(i,a),l.setEnd(i,s),l}catch(e){return l.collapse(),console.warn("nerve: could not select range for",t),null}}(t);if(null!==n){var i=n.commonAncestorContainer.parentElement;if(0===n.startOffset){var o=["person","place","org"].map((function(t){return e.schemaManager.mapper.getParentTag(t)}));if("true"===i.getAttribute("_entity")||-1!==o.indexOf(i.getAttribute("_tag")))return console.log("nerve: entity already exists for",t),n.collapse(),!1}var r={type:t.type,content:t.text,attributes:{_candidate:"true"},customValues:{nerve:"true"}};""!==t.lemma&&(r.lemma=t.lemma),""!==t.uri&&(r.uri=t.uri),Object.assign(r.attributes,t.attributes);var a=e.entitiesManager.addEntity(r,n);return l("#"+a.id,e.editor.getBody()).attr("_candidate","true"),n.collapse(),!0}return!1},A=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.entitiesManager.getEntity(t),o=l("#"+t,e.editor.getBody())[0],r=e.schemaManager.mapper.getResponsibilityAttributeName();e.tagger.removeAttributeFromTag(o,r),e.tagger.removeAttributeFromTag(o,"xml:id");var a=void 0!==i.getCustomValue("nerve"),s=i.getURI();a&&void 0===s?e.tagger.removeEntity(t):(i.removeCustomValue("nerve"),i.removeCustomValue("edited"),i.removeAttribute(r),i.removeAttribute("_candidate"),i.removeAttribute("xml:id"),e.tagger.removeAttributeFromTag(o,"_candidate")),n&&M(t)},R=function(t){var n=O(t);A(t),n.forEach((function(t){A(t)})),e.entitiesList.update()},O=function(t){var n=[],i=e.entitiesManager.getEntity(t);return w().forEach((function(t){t.getId()!==i.getId()&&t.getContent()===i.getContent()&&t.getLemma()===i.getLemma()&&t.getURI()==i.getURI()&&n.push(t.getId())})),n},N=function(){e.event("massUpdateStarted").publish();var t=E(),n=e.dialogManager.getDialog("loadingindicator");for(var i in n.setText("Accepting Entities"),n.show(),r){var o=r[i];"all"!==t&&t!==o.type||(o.entityIds.forEach((function(t){e.entitiesManager.setLemmaForEntity(t,o.lemma),e.entitiesManager.setURIForEntity(t,o.uri)})),delete r[i])}e.utilities.processArray(w(),(function(e){"all"!==t&&t!==e.getType()||A(e.getId(),!1)})).then((function(){S("all"),_(),e.event("massUpdateCompleted").publish()})).always((function(){n.hide()}))},$=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.entitiesManager.getEntity(t),o=void 0!==i.getCustomValue("nerve");o?e.tagger.removeStructureTag(t,!1):e.tagger.removeEntity(t),n&&M(t)},I=function(t){e.event("massUpdateStarted").publish();var n=E(),i=e.dialogManager.getDialog("loadingindicator");for(var o in i.setText("Rejecting Entities"),i.show(),r){var a=r[o];"all"!==n&&n!==a.type||delete r[o]}e.utilities.processArray(w(),(function(e){(t||"all"===n||n===e.getType())&&$(e.getId(),!1)})).then((function(){S("all"),_(),e.event("massUpdateCompleted").publish()})).always((function(){i.hide()}))},z=function(t){null===c&&((c=new p(e,h)).$el.dialog("option","modal",!1),c.$el.on("save",(function(t,n){!function(t,e){var n=h.find("ul.entitiesList > li[data-id="+t.getId()+"]");n.data("type",t.getType()).attr("data-type",t.getType());var i=n.hasClass("expanded");n.removeClass(),n.addClass(t.getType()),(i||!0===e)&&n.addClass("expanded");var o=("true"===t.getCustomValue("edited")?"&#8226; ":"")+t.getContent();n.find(".entityTitle").html(o),n.find(".info").html(k(t))}(e.entitiesManager.getEntity(n.currentId),!0),T(E())}))),c.show({entry:P(t)})},j=function(t){(g=t)?(h.find(".mergeActions").show(),h.find("button.mergeEntities").hide(),h.find('select[name="filter"]').val("all").selectmenu("refresh").selectmenu("option","disabled",!0)):(h.find(".mergeActions").hide(),h.find("button.mergeEntities").show(),h.find('select[name="filter"]').selectmenu("option","disabled",!1)),_()},F=function(t){for(var e in r){if(-1!==r[e].entityIds.indexOf(t))return!0}return!1},B=function(t){null===u&&((u=new f(e,h)).$el.on("merge",(function(t,n,i,o,a){if(null!=i)i.lemma=o,i.uri=a,g?(i.entityIds=n.map((function(t){return t.getId()})),j(!1)):_();else{var s=n.map((function(t){return t.getId()})),l=e.getUniqueId("merged_");r[l]={entityIds:s,type:n[0].getType(),lemma:o,uri:a},j(!1)}})),u.$el.on("cancel",(function(){})));var n,i=[];void 0!==t?(n=r[t],i=n.entityIds.map((function(t){return e.entitiesManager.getEntity(t)}))):X().each((function(t,o){var a=l(o).data("id"),s=e.entitiesManager.getEntity(a);void 0===s?(n=r[a])&&n.entityIds.forEach((function(t){i.push(e.entitiesManager.getEntity(t))})):i.push(s)})),i.length>1?(u.show(),u.populate(i,n)):e.dialogManager.show("message",{title:"Warning",msg:"You must select at least 2 entities to merge.",type:"info"})},U=function(t){delete r[t],_()},W=function(t){var n=r[t];n.entityIds.forEach((function(t){e.entitiesManager.setLemmaForEntity(t,n.lemma),e.entitiesManager.setURIForEntity(t,n.uri),A(t)})),delete r[t],M(t)},H=function(t){r[t].entityIds.forEach((function(t){$(t)})),delete r[t],M(t)},X=function(){return h.find("ul.entitiesList > li > input:checked").parent("li")},V=function(){h.find("select").selectmenu("option","disabled",!1),h.find("button.mergeEntities").button("disable"),e.editor.setMode("design"),q.reset(),e.event("contentChanged").publish()},q={reset:function(){r={},h.find(".moduleContent ul").empty(),h.find(".listActions").hide(),h.find(".filters").hide(),h.find("button.run").show(),h.find("button.done").hide()},destroy:function(){h.empty(),h.find("ul.entitiesList .actions").tooltip("destroy")}};return q}},function(t,e,n){"use strict";var i=n(3);n(15),n(238),t.exports=function(t){var e=t.writer,n=t.parentId;i("#"+n).append('<div class="moduleParent"><ul class="moduleContent relationsList"></ul><div class="moduleFooter"><button type="button" role="add">Add Relation</button><button type="button" role="remove">Remove Relation</button></div></div>');var o=i("#"+n),r=o.find(".moduleFooter button[role=add]").button();r.click((function(){e.dialogManager.show("triple")}));var a=o.find(".moduleFooter button[role=remove]").button();a.click((function(){var t=o.find("ul li.selected");if(1==t.length){var n=t.data("index");e.triples.splice(n,1),s.update()}else e.dialogManager.show("message",{title:"No Relation Selected",msg:"You must first select a relation to remove.",type:"error"})})),i.contextMenu({selector:"#"+n+" ul li",zIndex:10,appendTo:"#"+e.containerId,className:"cwrc",items:{remove:{name:"Remove Relation",icon:"tag_remove",callback:function(t,n){var i=n.$trigger.data("index");e.triples.splice(i,1),s.update()}}}}),e.event("loadingDocument").subscribe((function(){s.clear()})),e.event("documentLoaded").subscribe((function(){s.update()})),e.event("schemaLoaded").subscribe((function(){s.update()}));var s={currentlySelectedNode:null,update:function(){s.clear();for(var t="",n=0;n<e.triples.length;n++){var r=e.triples[n];t+="<li>"+r.subject.text+" "+r.predicate.text+" "+r.object.text+"</li>"}o.find("ul").html(t),o.find("ul li").each((function(t,e){i(this).data("index",t)})).click((function(){i(this).addClass("selected").siblings().removeClass("selected")}))},clear:function(){o.find("ul").empty()},destroy:function(){r.button("destroy"),a.button("destroy"),i("#"+n+"_contextMenu").remove()}};return e.relations=s,s}},function(t,e,n){"use strict";var i=n(3),o=n(424);n(93),t.exports=function(t){var e=t.writer,n=e.getUniqueId("selection_"),r=!0,a=5e5,s=(new Date).getTime(),l=!1;i("#"+t.parentId).append('\n    <div class="moduleParent">\n        <div id="'.concat(n,'" class="moduleContent"></div>\n        <div id="').concat(n,'" class="moduleFooter">\n            <label>Include RDF <input type="checkbox" name="includeRdf" /></label>\n        </div>\n        <div id="').concat(n,'_selectionContents" style="display: none;"></div>\n    </div>\n    '));var c=i("#"+n),d=i("#"+n+"_selectionContents"),u=i("#"+n+' [name="includeRdf"]').checkboxradio();u.on("click",(function(t){f(!0)})),e.event("loadingDocument").subscribe((function(){h()})),e.event("selectionChanged").subscribe((function(){e.editor.selection.isCollapsed()?l||f(!0):f()})),e.event("contentChanged").subscribe((function(){f(!0)})),e.event("nodeChanged").subscribe((function(){l||f()})),e.event("tagSelected").subscribe((function(){f()})),e.event("tagAdded").subscribe((function(){f(!0)})),e.event("tagEdited").subscribe((function(){f(!0)})),e.event("tagRemoved").subscribe((function(){f(!0)})),e.event("massUpdateStarted").subscribe((function(){p.disable()})),e.event("massUpdateCompleted").subscribe((function(){p.enable(!0)}));var p={},f=function(t){if(r){var n=(new Date).getTime()-s;if(c.is(":visible")&&n>250)if(s=(new Date).getTime(),t||e.editor.selection.isCollapsed()){l=!0;var i=u.prop("checked");e.converter.getDocumentContent(i,g)}else{l=!1;var o=e.editor.selection.getRng(!0).cloneContents();d.html(o);var a=e.converter.buildXMLString(d);g(a)}}},g=function(t){var n=e.utilities.escapeHTMLString(t);n.length>a&&(n=n.substring(0,a)),c.html('<pre style="width:100%;height:100%;padding:0;margin:0;border:none !important;"><code class="language-markup" style="white-space: pre-wrap;">'+n+"</code></pre>"),o.highlightElement(i("code",c)[0])},h=function(){c.html("")};return p.enable=function(t){r=!0,t&&f(!0)},p.disable=function(){r=!1},p.showSelection=function(){e.layoutManager.showModule("selection"),f(!0)},p.destroy=function(){},e.selection=p,p}},function(t,e,n){"use strict";var i=n(3);n(425),t.exports=function(t){var e,n=t.writer,o=n.getUniqueId("tree_"),r={currentlySelectedNodes:[],selectionType:null,NODE_SELECTED:0,CONTENTS_SELECTED:1,tagFilter:["head","heading"]},a=!1,s=!1,l=!1,c=!0;function d(t){var o=void 0,r=[];i(t).parentsUntil("#tinymce").each((function(t,e){e.getAttribute("_tag")===n.schemaManager.getHeader()&&(o=e.id),r.push(e.id)})),r.reverse();for(var a=0;a<r.length;a++){var s=r[a],l=i('[name="'+s+'"]',e);e.jstree("is_open",l)||e.jstree("open_node",l,null,!1)}return o}function u(t,e,o,s){var l=t.attr("name");if(m(),o||(-1!==r.currentlySelectedNodes.indexOf(l)?r.currentlySelectedNodes=[l]:r.currentlySelectedNodes=[]),l){var c=t.children("a");if((-1===r.currentlySelectedNodes.indexOf(l)||s)&&r.currentlySelectedNodes.push(l),e?(c.addClass("contentsSelected").removeClass("nodeSelected"),r.selectionType=r.CONTENTS_SELECTED):(c.addClass("nodeSelected").removeClass("contentsSelected"),r.selectionType=r.NODE_SELECTED),!s){var d=i("#"+l,n.editor.getBody());"true"===d.attr("_entity")||d.attr("_tag")!==n.schemaManager.getHeader()?(a=!0,n.utilities.selectElementById(r.currentlySelectedNodes,e)):n.dialogManager.show("header")}}}function p(t,e){var i=null,o=t.attr("_tag");if(null==o)return null;if(!1===n.isReadOnly&&t.attr("_entity")){if(void 0===(a=t.attr("name")))return console.warn("structureTree: no id for",o),null;i={text:o,li_attr:{name:a},state:{opened:e<3},level:e}}else if(!1===n.isReadOnly||n.isReadOnly&&(o===n.schemaManager.getRoot()||-1!==r.tagFilter.indexOf(o.toLowerCase()))){var a;if(void 0===(a=t.attr("id")))return console.warn("structureTree: no id for",o),null;n.isReadOnly&&o!==n.schemaManager.getRoot()&&(o=n.utilities.getTitleFromContent(t.text())),i={text:o,li_attr:{name:a},state:{opened:e<3},level:e}}if("cwrcEntry"===n.schemaManager.schemaId){var s=t.attr("subtype");void 0!==s&&(i.level=parseInt(s))}return i}function f(t,e,o,r){t.each((function(t,a){var s=i(this),l=e,c=p(s,o);if(c){if(n.isReadOnly&&null!=r){for(;r.level>=c.level;)r=r.parent;null==r.children&&(r.children=[]),c.parent=r,r.children.push(c)}else null==e.children&&(e.children=[]),e.children.push(c),l=e.children[e.children.length-1];r=c}s.attr("_tag")!=n.schemaManager.getHeader()&&f(s.children(),l,o+1,r)}))}function g(t,e){if(void 0!==e){i(e.event.currentTarget).removeClass("nodeSelected contentsSelected");var n=e.node.li_attr.name,o=r.currentlySelectedNodes.indexOf(n);-1!==o&&r.currentlySelectedNodes.splice(o,1)}else m(),r.currentlySelectedNodes=[];r.selectionType=null}function h(t,o){var r=t.node,a=e.jstree("get_node",t.parent),s=i("#"+r.li_attr.name,n.editor.getBody()),l=i("#"+a.li_attr.name,n.editor.getBody());if(s.parents(".noteWrapper").length>0&&(s=s.parents(".noteWrapper").first()),o&&(s=s.clone()),0===t.position)l.prepend(s);else{var c=a.children[t.position-1],d=e.jstree("get_node",c);(l=i("#"+d.li_attr.name,n.editor.getBody())).after(s)}e.jstree("open_node",a,null,!1),o&&n.tagger.processNewContent(s[0]),n.editor.undoManager.add(),n.event("contentChanged").publish()}function m(){i("a[class*=Selected]","#"+o).removeClass("nodeSelected contentsSelected")}r.update=function(){if(s&&c){var t=i.jstree.reference("#"+o),a=[];i("#cwrc_tree_root",e).find("li.jstree-open").each((function(){var t=i(this).attr("name");a.push(t)})),r.clear();var d=i('[_tag="'+n.schemaManager.getRoot()+'"]',n.editor.getBody());0===d.length&&(d=i("[_tag]",n.editor.getBody()).first());var u=p(d,0);if(null!=u){if(u.li_attr.id="cwrc_tree_root",f(d.children(),u,0,u),n.isReadOnly){!function t(e){delete e.parent,e.children&&e.children.forEach((function(e){t(e)}))}(u)}t.create_node(null,u),i.each(a,(function(n,o){t.open_node(i("li[name="+o+"]",e),null,!1)}))}}else l=!0},r.clear=function(){i.jstree.reference("#"+o).delete_node("#cwrc_tree_root")},r.enable=function(t){c=!0,(t||l)&&(r.update(),l=!1)},r.disable=function(){c=!1},r.destroy=function(){i(document).off("dnd_start.vakata",y),i(document).off("dnd_move.vakata",b),i.jstree.reference("#"+o).destroy()},r.highlightNode=function(t){if(t){var n=t.id;if(n)if(-1===r.currentlySelectedNodes.indexOf(n)){a=!0;var o=i('[name="'+n+'"]',e);if(0===o.length){var s=d(t);o=i(s?'[name="'+s+'"]':'[name="'+n+'"]',e)}e.jstree("deselect_all"),g();e.jstree("select_node",o);a=!1,function(t){if(1===t.length){var n=t.offset().top-e.offset().top+e.scrollTop(),i=n+t.outerHeight(),o=e.innerHeight(),r=.5*o,a=parseInt(e.scrollTop(),10),s=a+o;t.outerHeight()>o||n<a?e.scrollTop(n-r):i>s&&e.scrollTop(i-r)}}(o)}else g()}else g()},r.selectNode=function(t,o){if(t){var r=i('[name="'+t+'"]',e);if(0===r.length){var a=d(i("#"+t,n.editor.getBody()));r=i(a?'[name="'+a+'"]':'[name="'+t+'"]',e)}u(r,o,!1,!0)}},i("#"+t.parentId).append('<div class="moduleParent"><div id="'+o+'" class="moduleContent"></div></div>'),e=i("#"+o);var v=["wholerow","conditionalselect"];function y(t,e){e.helper.addClass("cwrc"),n.layoutManager.isFullScreen()&&i.vakata.dnd.stop(t),e.helper.appendTo(n.layoutManager.getContainer())}function b(t,e){var o=i("#jstree-marker");o.parent()!==n.layoutManager.getContainer()&&o.appendTo(n.layoutManager.getContainer())}return!0!==n.isReadOnly&&v.push("dnd"),e.jstree({plugins:v,core:{worker:!1,check_callback:function(t,e,i,o,r){return!n.editor.readonly||"move_node"!==t&&"copy_node"!==t},animation:!1,themes:{icons:!1,url:!1,responsive:!1},data:{text:"Tags",li_attr:{id:"cwrc_tree_root"},state:{opened:!0}}},multiple:!0,conditionalselect:function(t,e,n){if((tinymce.isMac?n.metaKey:n.ctrlKey)||n.shiftKey){var o=t.jstree("get_selected");if(0==o.length)return!0;var r=o[0];return r==e.id||1==i("#"+r).siblings("#"+e.id).length}return!0}.bind(this,e),dnd:{large_drag_target:!0,large_drop_target:!0}}),e.on("contextmenu",(function(t){t.preventDefault(),t.stopImmediatePropagation();var e=i(t.target).parents("li.jstree-node").first();if(1===e.length){var o=r.currentlySelectedNodes,a=e.attr("name");r.highlightNode(i("#"+a,n.editor.getBody())[0]),-1!==o.indexOf(a)&&o.length>1&&(a=o),setTimeout((function(){n.tagMenu.show(t,a,!1)}),0)}})),e.on("select_node.jstree",(function(t,e){if(!a){var n,o=i(e.event.currentTarget);n=!o.hasClass("contentsSelected")&&(o.hasClass("nodeSelected"),!0);var r=(tinymce.isMac?e.event.metaKey:e.event.ctrlKey)||e.event.shiftKey;u(o.parent(),n,r,!1)}})),e.on("deselect_node.jstree",g),i(document).on("dnd_start.vakata",y),i(document).on("dnd_move.vakata",b),e.on("copy_node.jstree",(function(t,e){h(e,!0)})),e.on("move_node.jstree",(function(t,e){h(e,!1)})),e.on("keydown.jstree",(function(t){})),e.on("ready.jstree",(function(t,e){s=!0,l&&(r.update(),l=!1),n.event("structureTreeInitialized").publish(r)})),n.event("loadingDocument").subscribe((function(){r.clear(),r.disable()})),n.event("documentLoaded").subscribe((function(){r.enable(!0)})),n.event("massUpdateStarted").subscribe((function(){r.disable()})),n.event("massUpdateCompleted").subscribe((function(){r.enable(!0)})),n.event("nodeChanged").subscribe((function(t){a||r.highlightNode(t)})),n.event("contentChanged").subscribe((function(){r.update()})),n.event("contentCopied").subscribe((function(){if(r.currentlySelectedNodes.length>0){var t=i("#"+r.currentlySelectedNodes[0],n.editor.getBody()).clone();n.editor.copiedElement.element=t.wrapAll("<div />").parent()[0],n.editor.copiedElement.selectionType=r.selectionType}})),n.event("contentPasted").subscribe((function(){r.update()})),n.event("writerKeydown").subscribe((function(t){if(r.currentlySelectedNodes.length>0){var e=r.currentlySelectedNodes[0];if(8==t.which||46==t.which)tinymce.dom.Event.cancel(t),r.selectionType==r.NODE_SELECTED?n.tagger.removeStructureTag(e,!0):(n.tagger.removeStructureTagContents(e),n.utilities.selectElementById(e,!0));else if(0==t.ctrlKey&&0==t.metaKey&&t.which>=48&&t.which<=90&&r.selectionType==r.NODE_SELECTED){var o=i("#"+e,n.editor.getBody()),a=!0,s=o.nextAll("[_tag]")[0];if(null==s&&null==(s=o.parent().nextAll("[_tag]")[0])&&(a=!1,s=o.prevAll("[_tag]")[0]),n.tagger.removeStructureTag(e,!0),null!=s){var l=n.editor.selection.getRng(!0);l.selectNodeContents(s),l.collapse(a),n.editor.selection.setRng(l)}}}})),n.event("writerKeyup").subscribe((function(t){})),n.event("entityAdded").subscribe((function(t){r.update()})),n.event("entityRemoved").subscribe((function(t){r.update()})),n.event("entityFocused").subscribe((function(t){})),n.event("entityPasted").subscribe((function(t){r.update()})),n.event("tagAdded").subscribe((function(t){r.update()})),n.event("tagEdited").subscribe((function(t){r.update()})),n.event("tagRemoved").subscribe((function(t){r.update()})),n.event("tagContentsRemoved").subscribe((function(t){r.update()})),n.event("tagSelected").subscribe((function(t){a||r.selectNode(t,!1),a=!1})),n.tree=r,r}},function(t,e,n){"use strict";var i=n(3);n(15),t.exports=function(t){var e=t.writer,n=t.validationUrl;void 0===n&&console.error("Validation: no validationUrl specified!");var o=e.getUniqueId("validation_");i("#"+t.parentId).append('\n    <div class="moduleParent">\n        <div id="'.concat(o,'" class="moduleContent">\n            <ul class="validationList"></ul>\n        </div>\n        <div id="').concat(o,'_buttons" class="moduleFooter">\n            <button type="button" role="validate">Validate</button>\n            <button type="button" role="clear">Clear</button>\n        </div>\n    </div>\n    ')),e.event("documentLoaded").subscribe((function(){r.clearResult()})),e.event("validationRequested").subscribe((function(){var t=i("#"+o+" > ul");t.empty(),t.append('<li class="ui-state-default"><span class="loading"></span> Validating...</li>'),e.layoutManager.showModule("validation"),r.validate()})),e.event("documentValidated").subscribe((function(t,e,n){i("#"+o+"_indicator").hide(),r.showValidationResult(e,n)}));var r={validate:function(){e.converter.getDocumentContent(!1,(function(t){var o=e.schemaManager.getXMLUrl();i.ajax({url:n,type:"POST",dataType:"xml",data:{sch:o,type:"RNG_XML",content:t},success:function(n,o,r){var a="pass"==i("status",n).text();e.event("documentValidated").publish(a,n,t)},error:function(){e.dialogManager.show("message",{title:"Error",msg:"An error occurred while trying to validate the document.",type:"error"}),e.event("documentValidated").publish(null,"","")}})}))},showValidationResult:function(t,n){var r=i("#"+o+" > ul");r.empty(),n=n.split("\n")[1],"pass"==i("status",t).text()&&r.append('<li class="ui-state-default"><span class="ui-icon ui-icon-check" style="float: left; margin-right: 4px;"></span>Your document is valid!</li>'),e.tagger.removeNoteWrappersForEntities(),i("warning",t).each((function(t,o){var a=null,s=o.nodeName,l=i(this).find("message").text(),c=i(this).find("path").text(),d=i(this).find("elementId").text(),u=parseInt(i(this).find("column").text());if(""!=d&&(a=d),null==a&&""!=c){for(var p="",f=c.split("/"),g=0;g<f.length;g++){var h;if(null!=(b=(h=f[g]).match(/^\w+(?=\[)?/)))null===(t=h.match(/\[(\d+)\]/))?t=0:(t=parseInt(t[1]),t--),p+='*[_tag="'+b[0]+'"]:eq('+t+") > "}p=p.substr(0,p.length-3),a=i(p,e.editor.getBody()).attr("id")}if(null==a&&!isNaN(u)&&null!=(f=n.substring(0,u).match(/<.*?>/g)))if(null==(a=(h=f[f.length-1]).match(/id="(.*?)"/i)))if(-1!=l.search("text not allowed here")){var m=0;for(g=f.length-1;g>-1;g--)if(-1!=(h=f[g]).search("/")?m++:m--,-1==m){var v=h.match(/id="(.*?)"/i);null!=v&&v[1]&&(a=v[1]);break}}else{var y=h.match(/<\/(.*)>/);if(null!=y){var b=y[1];for(g=f.length-1;g>-1;g--){var w=(h=f[g]).match(/<(.*?)\s/);if(null!=w&&w[1]==b){a=h.match(/id="(.*?)"/i)[1];break}}}}else a=a[1];if(null!=a){var _,x=l.indexOf(";"),C='<li class="'+("warning"==s?"ui-state-error":"ui-state-highlight")+'"><span class="ui-icon '+("warning"==s?"ui-icon-alert":"ui-icon-info")+'" style="float: left; margin-right: 4px;"></span>Path: '+c+"<br/>Message: "+(_=-1!=x?[l.slice(0,x+1),l.slice(x+2)]:[l])[0];void 0!==_[1]&&(C+=' <span class="message_more">more...</span><span style="display: none;">'+_[1]+"</span>"),C+="</li>";var k=r.append(C).find("li:last");k.find('[class="message_more"]').click((function(){i(this).next("span").show(),i(this).hide()})),k.data("id",a)}else console.warn("validation: couldn't find element for "+c)})),e.tagger.addNoteWrappersForEntities(),r.find("li").click((function(){r.find("li").removeClass("selected"),i(this).addClass("selected");var t=i(this).data("id");e.utilities.selectElementById(t)})),e.layoutManager.showModule("validation")},clearResult:function(){i("#"+o+"_indicator").hide(),i("#"+o+" > ul").empty()}},a=i("#"+o+"_buttons button[role=validate]").button();a.click((function(){r.validate()}));var s=i("#"+o+"_buttons button[role=clear]").button();return s.click((function(){r.clearResult()})),r.destroy=function(){a.button("destroy"),s.button("destroy")},e.validation=r,r}},,,,,,,,,,function(t,e,n){t.exports=n(434)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var i=n(3);t.exports=function(t){var e=t,n=!1,o={};e.event=function(t){var e,r=t&&o[t];return r||(r={publish:function(){n&&console.debug('CWRC-Writer "'+this.event+'":',arguments),e.fire.apply(this,arguments)},subscribe:(e=i.Callbacks()).add,unsubscribe:e.remove,event:t}),t&&(o[t]=r),r},e.event("writerInitialized"),e.event("tinymceInitialized"),e.event("structureTreeInitialized"),e.event("entitiesListInitialized"),e.event("nodeChanged"),e.event("contentChanged"),e.event("loadingDocument"),e.event("processingDocument"),e.event("documentLoaded"),e.event("documentSaved"),e.event("savingDocument"),e.event("loadingSchema"),e.event("schemaLoaded"),e.event("schemaChanged"),e.event("schemaAdded"),e.event("validationInitiated"),e.event("documentValidated"),e.event("contentCopied"),e.event("contentPasted"),e.event("writerKeydown"),e.event("writerKeyup"),e.event("entityAdded"),e.event("entityEdited"),e.event("entityRemoved"),e.event("entityFocused"),e.event("entityUnfocused"),e.event("entityCopied"),e.event("entityPasted"),e.event("tagAdded"),e.event("tagEdited"),e.event("tagRemoved"),e.event("tagContentsRemoved"),e.event("tagSelected"),e.event("selectionChanged"),e.event("massUpdateStarted"),e.event("massUpdateCompleted");var r={getEvents:function(){return o},destroy:function(){},debug:function(t){n=t}};return r}},function(t,e,n){"use strict";var i=n(3),o=n(308);t.exports=function(t){var e,n=t,r={xmlToString:function(t){var e="";try{e=(new XMLSerializer).serializeToString(t)}catch(t){console.warn(t)}return e},stringToXML:function(t){var e=(new DOMParser).parseFromString(t,"text/xml"),n=e.querySelector("parsererror");return null!==n?(console.error("utilities.stringToXML parse error:",n.innerText),null):e},xmlToJSON:function(t){if("string"==i.type(t)&&null===(t=r.stringToXML(t)))return null;var e=new o;return e.attr_prefix="@",e.parseDOM(t)},convertTextForExport:function(t,o){o=void 0!==o&&o,void 0===e&&(e=i('<div style="display: none;"></div>').appendTo(n.layoutManager.getContainer()));var r=t;return null!=r&&(r.match(/&.+?;/gim)&&(e[0].innerHTML=r,r=e[0].innerText||e[0].firstChild.nodeValue),r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),o&&(r=r.replace(/"/g,"&quot;"))),r},addCSS:function(t){var e=n.cwrcRootUrl+t;document.querySelector('link[rel=stylesheet][href="'+e+'"]')||i(document.head).append('<link type="text/css" rel="stylesheet" href="'+e+'" />')},getTitleFromContent:function(t){return(t=t.trim()).length<=34?t:t.substring(0,34)+"&#8230;"},getCamelCase:function(t){return t.replace(/(?:^|\s)\w/g,(function(t){return t.toUpperCase()}))},escapeHTMLString:function(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t},unescapeHTMLString:function(t){return"string"==typeof t?t.replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t},getPreviousTextNode:function(t,e){e=void 0!==e&&e;var n=t.ownerDocument.createTreeWalker(t.ownerDocument,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return!1===e||e&&null===t.textContent.match(/^[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000]*$/)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=t,n.previousNode()},getNextTextNode:function(t,e){e=void 0!==e&&e;var n=t.ownerDocument.createTreeWalker(t.ownerDocument,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return!1===e||e&&null===t.textContent.match(/^[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000]*$/)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=t,n.nextNode()},selectElementById:function(t,e){e=null!=e&&e,n.entitiesManager.removeHighlights(),i.isArray(t)&&(t=t[t.length-1]);var o=i("#"+t,n.editor.getBody()),r=o[0];if(null!=r){o.parents(".noteWrapper").removeClass("hide");var a=n.editor.dom.createRng();e?tinymce.isWebKit?(null==r.firstChild&&o.append("\ufeff"),a.selectNodeContents(r)):a.selectNodeContents(r):(i("[data-mce-bogus]",o.parent()).remove(),a.selectNode(r)),n.editor.selection.setRng(a),n.editor.currentBookmark=n.editor.selection.getBookmark(1);var s=0;o.is(":hidden")?(o.show(),s=o.position().top,o.hide()):s=o.position().top;var l=s-.25*i(n.editor.getContentAreaContainer()).height();i(n.editor.getDoc()).scrollTop(l),window.setTimeout((function(){n.editor.focus(),n.event("tagSelected").publish(t,e)}),0)}},getRootTag:function(){return i("[_tag]:first",n.editor.getBody())},getElementXPath:function(t,e){if(null==t)return null;var n=void 0;void 0!==e?n=e:null!==t.getAttribute("_tag")&&(n="_tag");for(var i=[];t&&1==t.nodeType;t=t.parentNode){for(var o=0,r=t.previousSibling;r;r=r.previousSibling)r.nodeType!=Node.DOCUMENT_TYPE_NODE&&(void 0!==n&&void 0!==r.getAttribute?r.getAttribute(n)==t.getAttribute(n)&&++o:r.nodeName==t.nodeName&&++o);var a=null;if(null!=(a=void 0!==n?t.getAttribute(n):t.nodeName)){var s=o?"["+(o+1)+"]":"";i.splice(0,0,a+s)}}return i.length?i.join("/"):null},evaluateXPath:function(t,e){var i=t.ownerDocument;null===i&&(i=t);var o,r,a=i===n.editor.getDoc(),s=/(\/{0,2})([\w-]+::|@)?(\w+?:)?([\w-(\.\*)]+)(\[.+?\])?/g,l=null,c=i.documentElement.getAttribute("xmlns");if(!a){var d=i.createNSResolver(i.documentElement);l=function(t){return d.lookupNamespaceURI(t)||c},null!==c&&(e=e.replace(s,(function(t,e,n,i,o,r){return void 0!==i?t:void 0!==n&&(0===n.indexOf("attribute")||0===n.indexOf("@"))||null!==o.match(/\(.*?\)/)?[e,n,i,o,r].join(""):[e,n,"foo:",o,r].join("")})))}null===c&&(e=e.replace(s,(function(t,e,n,i,o,r){return[e,n,o,r].join("")}))),a&&(i===t&&(t=i.documentElement),t.getAttribute("_tag")===n.schemaManager.getRoot()&&"@"!==e.charAt(0)&&"/"!==e.charAt(1)&&"/"!==(e="/".concat(e)).charAt(1)&&(e="/".concat(e)),e=e.replace(s,(function(t,e,n,i,o,r){return void 0!==n&&(0===n.indexOf("attribute")||0===n.indexOf("@"))||-1!==o.indexOf(/\(.*?\)/)?[e,n,i,o,r].join(""):[e,n,i,'*[@_tag="'+o+'"]',r].join("")})));try{o=i.evaluate(e,t,l,XPathResult.ANY_TYPE,null)}catch(t){return console.warn("utilities.evaluateXPath: there was an error evaluating the xpath",t),null}switch(o.resultType){case XPathResult.NUMBER_TYPE:r=o.numberValue;break;case XPathResult.STRING_TYPE:r=o.stringValue;break;case XPathResult.BOOLEAN_TYPE:r=o.booleanValue;break;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:case XPathResult.ORDERED_NODE_ITERATOR_TYPE:r=o.iterateNext();break;case XPathResult.ANY_UNORDERED_NODE_TYPE:case XPathResult.FIRST_ORDERED_NODE_TYPE:r=o.singleNodeValue}return r},processArray:function(t,e,o){o=void 0===o?250:o;var r=new i.Deferred,a=n.dialogManager.getDialog("loadingindicator"),s=t.length,l=(new Date).getTime();return function n(){for(;t.length>0;){var i=t.shift();if(e.call(this,i),(new Date).getTime()-l>o)break}var c=Math.abs(t.length-s)/s*100;a.setValue(c),t.length>0?(l=(new Date).getTime(),setTimeout(n,10)):r.resolve()}(),r.promise()},createGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},getOffsetPosition:function(t,e){e=void 0===e?n.layoutManager.getContainer():i(e);for(var o=i(t),r=o.position(),a=o.offsetParent();1==e.find(a).length;){var s=a.position();r.top+=s.top,r.left+=s.left,a=a.offsetParent()}return r},constrain:function(t,e,n){return t<0||t+n>e&&(t=e-n)<0?0:t},destroy:function(){void 0!==e&&e.remove()}};return r}},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=function(){return this};o.VERSION="0.24",o.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n',o.prototype.attr_prefix="-",o.prototype.overrideMimeType="text/xml",o.prototype.parseXML=function(t){var e;if(window.DOMParser){var n=new DOMParser,i=n.parseFromString(t,"application/xml");if(!i)return;e=i.documentElement}else window.ActiveXObject&&((n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,n.loadXML(t),e=n.documentElement);if(e)return this.parseDOM(e)},o.prototype.parseHTTP=function(t,e,n){var i,o={};for(var r in e)o[r]=e[r];if(o.method||(void 0===o.postBody&&void 0===o.postbody&&void 0===o.parameters?o.method="get":o.method="post"),n){o.asynchronous=!0;var a=this,s=n,l=o.onComplete;o.onComplete=function(t){var e;t&&t.responseXML&&t.responseXML.documentElement?e=a.parseDOM(t.responseXML.documentElement):t&&t.responseText&&(e=a.parseXML(t.responseText)),s(e,t),l&&l(t)}}else o.asynchronous=!1;if("undefined"!=typeof HTTP&&HTTP.Request)o.uri=t,(c=new HTTP.Request(o))&&(i=c.transport);else if("undefined"!=typeof Ajax&&Ajax.Request){var c;(c=new Ajax.Request(t,o))&&(i=c.transport)}return n?i:i&&i.responseXML&&i.responseXML.documentElement?this.parseDOM(i.responseXML.documentElement):i&&i.responseText?this.parseXML(i.responseText):void 0},o.prototype.parseDOM=function(t){if(t){if(this.__force_array={},this.force_array)for(var e=0;e<this.force_array.length;e++)this.__force_array[this.force_array[e]]=1;var n=this.parseElement(t);if(this.__force_array[t.nodeName]&&(n=[n]),11!=t.nodeType){var i={};i[t.nodeName]=n,n=i}return n}},o.prototype.parseElement=function(t){if(7!=t.nodeType){if(3==t.nodeType||4==t.nodeType){if(null==t.nodeValue.match(/[^\x00-\x20]/))return;return t.nodeValue}var e,n={};if(t.attributes&&t.attributes.length){e={};for(var o=0;o<t.attributes.length;o++){if("string"==typeof(s=t.attributes[o].nodeName))(l=t.attributes[o].nodeValue)&&(void 0===n[s=this.attr_prefix+s]&&(n[s]=0),n[s]++,this.addNode(e,s,n[s],l))}}if(t.childNodes&&t.childNodes.length){var r=!0;e&&(r=!1);for(o=0;o<t.childNodes.length&&r;o++){var a=t.childNodes[o].nodeType;3!=a&&4!=a&&(r=!1)}if(r){e||(e="");for(o=0;o<t.childNodes.length;o++)e+=t.childNodes[o].nodeValue}else{e||(e={});for(o=0;o<t.childNodes.length;o++){var s,l;if("string"==typeof(s=t.childNodes[o].nodeName))(l=this.parseElement(t.childNodes[o]))&&(void 0===n[s]&&(n[s]=0),n[s]++,"object"==i(l)&&(l.$parent=e,l.$key=s),this.addNode(e,s,n[s],l))}}}return e}},o.prototype.addNode=function(t,e,n,i){this.__force_array[e]?(1==n&&(t[e]=[]),t[e][t[e].length]=i):1==n?t[e]=i:2==n?t[e]=[t[e],i]:t[e][t[e].length]=i},o.prototype.writeXML=function(t){var e=this.hash_to_xml(null,t);return this.xmlDecl+e},o.prototype.hash_to_xml=function(t,e){var n=[],o=[];for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];r.charAt(0)!=this.attr_prefix?void 0===a||null==a?n[n.length]="<"+r+" />":"object"==i(a)&&a.constructor==Array?n[n.length]=this.array_to_xml(r,a):"object"==i(a)?n[n.length]=this.hash_to_xml(r,a):n[n.length]=this.scalar_to_xml(r,a):o[o.length]=" "+r.substring(1)+'="'+this.xml_escape(a)+'"'}var s=o.join(""),l=n.join("");return void 0===t||null==t||(l=n.length>0?l.match(/\n/)?"<"+t+s+">\n"+l+"</"+t+">\n":"<"+t+s+">"+l+"</"+t+">\n":"<"+t+s+" />\n"),l},o.prototype.array_to_xml=function(t,e){for(var n=[],o=0;o<e.length;o++){var r=e[o];void 0===r||null==r?n[n.length]="<"+t+" />":"object"==i(r)&&r.constructor==Array?n[n.length]=this.array_to_xml(t,r):"object"==i(r)?n[n.length]=this.hash_to_xml(t,r):n[n.length]=this.scalar_to_xml(t,r)}return n.join("")},o.prototype.scalar_to_xml=function(t,e){return"#text"==t?this.xml_escape(e):"<"+t+">"+this.xml_escape(e)+"</"+t+">\n"},o.prototype.xml_escape=function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.exports&&(t.exports=o)},function(t,e,n){"use strict";function i(){i=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var p={};function f(){}function g(){}function h(){}var m={};c(m,r,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,r)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function i(o,r,s,l){var c=u(t[o],t,r);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==a(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){i("next",t,s,l)}),(function(t){i("throw",t,s,l)})):e.resolve(p).then((function(t){d.value=t,s(d)}),(function(t){return i("throw",t,s,l)}))}l(c.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,c(b,"constructor",h),c(h,"constructor",g),g.displayName=c(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(d(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,l,"Generator"),c(b,r,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function o(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function s(t){o(a,i,r,s,l,"next",t)}function l(t){o(a,i,r,s,l,"throw",t)}s(void 0)}))}}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function c(t){var e,n,i,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(i&&null!=(e=t[i]))return new d(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function d(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return(d=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new d(t)}var u=n(3),p=n(22),f=n(315),g=n(339);t.exports=function(t,e){var n=t,o={},l="span";o.getBlockTag=function(){return"div"},o.getInlineTag=function(){return l},o.mapper=new p({writer:n}),o.navigator=new g,o.getChildrenForTag=o.navigator.getChildrenForTag,o.getChildrenForPath=o.navigator.getChildrenForPath,o.getAttributesForTag=o.navigator.getAttributesForTag,o.getAttributesForPath=o.navigator.getAttributesForPath,o.getParentsForTag=o.navigator.getParentsForTag,o.getParentsForPath=o.navigator.getParentsForPath,o.proxyXmlEndpoint=e.proxyXmlEndpoint,o.proxyCssEndpoint=e.proxyCssEndpoint,o.schemas=e.schemas||[],o.schemaId=null,o.schemaXML=null,o._xmlUrl=null,o.getXMLUrl=function(){return o._xmlUrl},o.schemaJSON=null,o.schema={elements:[]},o.getCurrentSchema=function(){return o.schemas.find((function(t){return t.id===o.schemaId}))},o.getSchemaIdFromRoot=function(t){for(var e in o.mapper.mappings)if(-1!==o.mapper.mappings[e].root.indexOf(t))return e},o.getSchemaIdFromUrl=function(t){if(void 0!==t){var e=t.split(/^.*?\/\//)[1],n=o.schemas.find((function(t){var n,i=s(t.xmlUrl);try{for(i.s();!(n=i.n()).done;){if(-1!==n.value.indexOf(e))return t}}catch(t){i.e(t)}finally{i.f()}}));return n?n.id:void 0}},o._root=null,o.getRoot=function(){return o._root},o._header=null,o.getHeader=function(){return o._header},o._idName=null,o.getIdName=function(){return o._idName},o._cssUrl=null,o.getCSSUrl=function(){return o._cssUrl},o.isSchemaCustom=function(){return void 0===o.getCurrentSchema().schemaMappingsId},o._currentDocumentSchemaUrl=null,o.getCurrentDocumentSchemaUrl=function(){return o._currentDocumentSchemaUrl},o.setCurrentDocumentSchemaUrl=function(t){o._currentDocumentSchemaUrl=t},o._currentDocumentCSSUrl=null,o.getCurrentDocumentCSSUrl=function(){return o._currentDocumentCSSUrl},o.setCurrentDocumentCSSUrl=function(t){o._currentDocumentCSSUrl=t},o.canTagContainText=function(t){if(t==o.getRoot())return!1;var e={canContainText:!1};return function t(e,n,i,r){if(r.canContainText)return!1;var a=e.find("text");if(a.length>0&&(0===i||0===a.parents("element").length))return r.canContainText=!0,!1;e.find("ref").each((function(e,a){var s=u(a).attr("name");if(!(u(a).parents("element").length>0&&i>0)&&!n[s])return n[s]=!0,t(u('define[name="'+s+'"]',o.schemaXML),n,i+1,r)}))}(u('element[name="'+t+'"]',o.schemaXML),{},0,e),e.canContainText},o.isTagBlockLevel=function(t){return t==o.getRoot()||null!=n.editor.schema.getBlockElements()[t]},o.isTagEntity=function(t){return null!==o.mapper.getEntityTypeForTag(t)},o.getTagForEditor=function(t){return o.isTagBlockLevel(t)?"div":l},o.getDocumentationForTag=function(t){var e=u('element[name="'+t+'"]',o.schemaXML);return u("a\\:documentation, documentation",e).first().text()},o.getFullNameForTag=function(t){var e=u('element[name="'+t+'"]',o.schemaXML),n=u("a\\:documentation, documentation",e).first().text(),i=/^\((.*?)\)/.exec(n);return null!==i?i[1]:""},o.getRequiredChildrenForTag=function(t){for(var e=o.getChildrenForTag(t),n=e.length-1;n>-1;n--)!0!==e[n].required&&e.splice(n,1);return e},o.canTagHaveAttributes=function(t){return 0!==o.getAttributesForTag(t).length},o.isTagValidChildOfParent=function(t,e){for(var n=o.getParentsForTag(t),i=0;i<n.length;i++)if(n[i].name===e)return!0;return!1},o.isAttributeValidForTag=function(t,e){for(var n=o.getAttributesForTag(e),i=0;i<n.length;i++)if(n[i].name===t)return!0;return!1},o.wouldDeleteInvalidate=function(t,e,n){for(var i=t.parentElement,r=i.getAttribute("_tag");null===r;){if(null===(i=i.parentElement))return console.warn("schemaManager.wouldDeleteInvalidate: outside of document!"),!1;r=i.getAttribute("_tag")}if(e){var s=t.getAttribute("_tag");if(o.getRequiredChildrenForTag(r).find((function(t){return t.name===s}))){for(var l=!1,c=0;c<i.children.length;c++){var d=t.children[c];if(d!==t)if(d.getAttribute("_tag")===s){l=!0;break}}if(!l)return!0}if(!n){for(var u=o.getChildrenForTag(r),p=function(e){var n=t.children[e].getAttribute("_tag");if(!u.find((function(t){return t.name===n})))return{v:!0}},f=0;f<t.children.length;f++){var g=p(f);if("object"===a(g))return g.v}var h=!1;if(t.childNodes.forEach((function(t){h||t.nodeType!==Node.TEXT_NODE||"\ufeff"===t.textContent||(h=!0)})),h&&!1===o.canTagContainText(r))return!0}}else if(n){var m=t.getAttribute("_tag");if(o.getRequiredChildrenForTag(m).length>0)return!0}return!1},o.addSchema=function(t){return t.id=n.getUniqueId("schema"),t.xmlUrl&&"string"==typeof t.xmlUrl&&(t.xmlUrl=[t.xmlUrl]),t.cssUrl&&"string"==typeof t.cssUrl&&(t.cssUrl=[t.cssUrl]),o.schemas.push(t),n.event("schemaAdded").publish(t.id),t.id},o.getUrlForSchema=function(t){var e=o.schemas.find((function(e){return e.id===t}));return void 0!==e?e.xmlUrl:null},o.getRootForSchema=function(){var t=r(i().mark((function t(e){var n,r,a,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===o.mapper.mappings[e]){t.next=2;break}return t.abrupt("return",o.mapper.mappings[e].root[0]);case 2:if(n=o.getUrlForSchema(e)){t.next=5;break}throw"schemaManager.getRootForSchema: no url for "+e;case 5:return t.next=7,d(n);case 7:if(r=t.sent){t.next=10;break}throw"schemaManager.getRootForSchema: could not connect to ".concat(e);case 10:return(a=u("start element:first",r).attr("name"))||(s=u("start ref:first",r).attr("name"),a=u('define[name="'+s+'"] element',r).attr("name")),t.abrupt("return",a);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var d=function(){var t=r(i().mark((function t(e){var r,a,s,l,d,u,p,f,g,h;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=!1,s=!1,t.prev=2,d=c(e);case 4:return t.next=6,d.next();case 6:if(!(a=!(u=t.sent).done)){t.next=22;break}return p=u.value,f=o.proxyXmlEndpoint?"".concat(o.proxyXmlEndpoint).concat(encodeURIComponent(p)):p,t.next=11,fetch(f).catch((function(t){console.log(t)}));case 11:if(!(g=t.sent)||200!==g.status){t.next=19;break}return t.next=15,g.text();case 15:return h=t.sent,r=n.utilities.stringToXML(h),o._xmlUrl=p,t.abrupt("break",22);case 19:a=!1,t.next=4;break;case 22:t.next=28;break;case 24:t.prev=24,t.t0=t.catch(2),s=!0,l=t.t0;case 28:if(t.prev=28,t.prev=29,!a||null==d.return){t.next=33;break}return t.next=33,d.return();case 33:if(t.prev=33,!s){t.next=36;break}throw l;case 36:return t.finish(33);case 37:return t.finish(28);case 38:return t.abrupt("return",r);case 39:case"end":return t.stop()}}),t,null,[[2,24,28,38],[29,,33,37]])})));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=r(i().mark((function t(e,n){var o,r,a,s,l;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="",a=n.attr("href"),r=-1!=a.indexOf("/")?a.match(/(.*\/)(.*)/)[2]:a,s=e.url.match(/(.*\/)(.*)/)[1],o=null!=s?s+r:"schema/"+r,t.next=7,d([o]);case 7:if(l=t.sent){t.next=10;break}return t.abrupt("return",null);case 10:return n.children().each((function(t,e){if("start"==e.nodeName)u("start",l).replaceWith(e);else if("define"==e.nodeName){var n=u(e).attr("name"),i=u('define[name="'.concat(n,'"]'),l);1==i.length?i.replaceWith(e):u("grammar",l).append(e)}})),n.replaceWith(u("grammar",l).children()),t.abrupt("return");case 13:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),m=function(){u("#schemaTags",n.editor.dom.doc).remove(),u("head",n.editor.getDoc()).append('<style id="schemaTags" type="text/css" />');var t="",e=[];u("element",o.schemaXML).each((function(n,i){var o=u(i).attr("name");null!=o&&-1==e.indexOf(o)&&(e.push(o),t+=".showTags *[_tag=".concat(o,']:before { color: #aaa !important; font-size: 13px !important; font-weight: normal !important; font-style: normal !important; font-family: monospace !important; font-variant: normal !important; content: "<').concat(o,'>"; }'),t+=".showTags *[_tag=".concat(o,']:after { color: #aaa !important; font-size: 13px !important; font-weight: normal !important; font-style: normal !important; font-family: monospace !important; font-variant: normal !important; content: "</').concat(o,'>"; }'))})),e.sort();var i=o.getTagForEditor(o._header);t+=i+"[_tag=".concat(o._header,"] { display: none !important; }"),u("#schemaTags",n.editor.getDoc()).text(t),o.schema.elements=e,o.navigator.setSchemaElements(o.schema.elements),u("a\\:documentation *",o.schemaXML).each((function(t,e){e.parentElement&&(e.parentElement.innerHTML=n.utilities.escapeHTMLString(e.parentElement.textContent))})),o.schemaJSON=n.utilities.xmlToJSON(u("grammar",o.schemaXML)[0]),null===o.schemaJSON&&console.warn("schemaManager.loadSchema: schema XML could not be converted to JSON"),o.navigator.setSchemaJSON(o.schemaJSON)};o.loadSchema=function(){var t=r(i().mark((function t(e,r,a){var s,l,c,p,f,g,v,y,b;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(s=o.schemas.find((function(t){return t.id===e})))){t.next=6;break}if(n.dialogManager.show("message",{title:"Error",msg:"Error loading schema. No entry found for: ".concat(e),type:"error"}),!a){t.next=5;break}return t.abrupt("return",a(!1));case 5:return t.abrupt("return",{success:!1});case 6:return n.event("loadingSchema").publish(),o.schemaId=e,l=s.schemaMappingsId,o.mapper.loadMappings(l),t.next=12,d(s.xmlUrl);case 12:if(c=t.sent){t.next=20;break}if(o.schemaId=null,n.dialogManager.getDialog("loadingindicator").hide(),n.dialogManager.show("message",{title:"Error",msg:"<p>Error loading schema from: ".concat(s.name,".</p>"),type:"error"}),!a){t.next=19;break}return t.abrupt("return",a(!1));case 19:return t.abrupt("return",{success:!1});case 20:for(o.schemaXML=c,(p=u("start element:first",o.schemaXML).attr("name"))||(f=u("start ref:first",o.schemaXML).attr("name"),p=u('define[name="'.concat(f,'"] element'),o.schemaXML).attr("name")),o._root=p,o._header=o.mapper.getHeaderTag(),o._idName=o.mapper.getIdAttributeName(),g=o.mapper.getBlockLevelElements(),v=n.editor.schema.getBlockElements(),y=0;y<g.length;y++)v[g[y]]={};if(1!=(b=u("include:first",o.schemaXML)).length){t.next=33;break}return t.next=33,h(s,b);case 33:if(!0===r&&o.loadSchemaCSS(s.cssUrl),m(),n.event("schemaLoaded").publish(),!a){t.next=38;break}return t.abrupt("return",a(!0));case 38:return t.abrupt("return",{success:!0});case 39:case"end":return t.stop()}}),t)})));return function(e,n,i){return t.apply(this,arguments)}}();var v=function(){var t=r(i().mark((function t(e){var n,r,a,l,c,d;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=s(e),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=17;break}return l=a.value,c=o.proxyCssEndpoint?"".concat(o.proxyCssEndpoint).concat(encodeURIComponent(l)):l,t.next=8,fetch(c).catch((function(t){console.log(t)}));case 8:if(!(d=t.sent)||200!==d.status){t.next=15;break}return t.next=12,d.text();case 12:return n=t.sent,o._cssUrl=l,t.abrupt("break",17);case 15:t.next=3;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(1),r.e(t.t0);case 22:return t.prev=22,r.f(),t.finish(22);case 25:return t.abrupt("return",n);case 26:case"end":return t.stop()}}),t,null,[[1,19,22,25]])})));return function(e){return t.apply(this,arguments)}}();return o.loadSchemaCSS=function(){var t=r(i().mark((function t(e){var o,r,a,s,l,c,d,p,g,h,m,y,b,w;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u("#schemaRules",n.editor.dom.doc).remove(),u("#schemaRules",document).remove(),t.next=4,v(e);case 4:if(o=t.sent){t.next=8;break}return n.dialogManager.show("message",{title:"Error",msg:"No CSS could be loaded to this schema.",type:"error"}),t.abrupt("return",null);case 8:for(r=f.parse(o),a={stylesheet:{rules:[]}},s=r.stylesheet.rules,l=0;l<s.length;l++)if(c=s[l],d=Object.assign({},c),"rule"===c.type){for(p=[],g=[],h=0;h<c.selectors.length;h++)m=c.selectors[h],y=m.replace(/(^|,|\s)(#?\w+)/g,(function(t,e,n,i,o){return e+'*[_tag="'+n+'"]'})),g.push(".cwrc .popup "+y),p.push(y);c.selectors=p,d.selectors=g,a.stylesheet.rules.push(d)}b=f.stringify(r),w=f.stringify(a),u("head",n.editor.dom.doc).append('<style id="schemaRules" type="text/css" />'),u("#schemaRules",n.editor.dom.doc).text(b),u("head",document).append('<style id="schemaRules" type="text/css" />'),u("#schemaRules",document).text(w);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n.event("schemaChanged").subscribe(function(){var t=r(i().mark((function t(e){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.loadSchema(e,!0);case 2:t.sent.success&&(o.setCurrentDocumentSchemaUrl(o.getXMLUrl()),o.setCurrentDocumentCSSUrl(o.getCSSUrl()));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o}},function(t,e,n){n(3),n(22);t.exports={namespace:"",id:"",responsibility:"",rdfParentSelector:"",root:[],header:"",blockElements:[],urlAttributes:[],popupAttributes:[],listeners:{},entities:{rs:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},person:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},org:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},place:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},title:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},correction:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},link:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},date:{parentTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},note:{parentTag:"",textTag:"",isNote:!0,mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},citation:{parentTag:"",textTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}},keyword:{parentTag:"",textTag:"",mappingFunction:function(t){},mapping:{},annotation:function(t,e){}}}}},function(t,e,n){var i=n(3),o=n(22),r=function(t){var e=t.attr("url");if(void 0!==e){t.css("backgroundImage","url(".concat(e,")")),t.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var e=i(this).height(),o=i(this).width();t.width(o),t.height(e),n.remove()})),i("body").append(n),n.attr("src",e)}},a={namespace:"http://www.tei-c.org/ns/1.0",id:"xml:id",responsibility:"resp",rdfParentSelector:"/TEI/teiHeader/fileDesc/following-sibling::xenoData",root:["TEI","teiCorpus"],header:"teiHeader",blockElements:["argument","back","bibl","biblFull","biblScope","body","byline","category","change","cit","classCode","elementSpec","macroSpec","classSpec","closer","creation","date","distributor","div","div1","div2","div3","div4","div5","div6","div7","docAuthor","edition","editionStmt","editor","eg","epigraph","extent","figure","front","funder","group","head","dateline","idno","item","keywords","l","label","langUsage","lb","lg","list","listBibl","note","noteStmt","opener","p","principal","publicationStmt","publisher","pubPlace","q","rendition","resp","respStmt","salute","samplingDecl","seriesStmt","signed","sp","sponsor","tagUsage","taxonomy","textClass","titlePage","titlePart","trailer","TEI","teiHeader","text","authority","availability","fileDesc","sourceDesc","revisionDesc","catDesc","encodingDesc","profileDesc","projectDesc","docDate","docEdition","docImprint","docTitle"],urlAttributes:["ref","target"],popupAttributes:[],listeners:{tagAdded:function(t){var e=i(t);"graphic"===e.attr("_tag")&&r(e)},tagEdited:function(t){var e=i(t);"graphic"===e.attr("_tag")&&r(e)},documentLoaded:function(t,e){i(e).find('*[_tag="graphic"]').each((function(t,e){r(i(e))}))}},entities:{rs:{parentTag:"rs",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){var n=e.getAttribute("type");return void 0!==n&&""!==n||(n="owl:Thing"),n=n.replace("http://sparql.cwrc.ca/ontology/cwrc#","cwrc:"),t.commonAnnotation(e,n)}},person:{parentTag:"persName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){var n="";switch(e.getAttribute("type")){case"real":n="cwrc:NaturalPerson";break;case"fictional":n=["schema:Person","cwrc:FictionalPerson"];break;case"both":n=["cwrc:NaturalPerson","schema:Person","cwrc:FictionalPerson"];break;default:n="cwrc:NaturalPerson"}return t.commonAnnotation(e,n)}},org:{parentTag:"orgName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){return t.commonAnnotation(e,"org:Organization")}},place:{parentTag:"placeName",mappingFunction:function(t){var e=o.getTagAndDefaultAttributes(t),n="",i=t.getCustomValue("precision");void 0!==i&&(n+='<precision match="@ref" precision="'.concat(i,'" />'));var r=t.getTag();return[e,n+="</".concat(r,">")]},mapping:{uri:"@ref",lemma:"@key",certainty:"@cert",customValues:{precision:"precision/@precision"}},annotation:function(t,e){var n=t.commonAnnotation(e,"cwrc:RealPlace"),i=e.getCustomValue("precision");return i&&(n["cwrc:hasPrecision"]="cwrc:".concat(i,"Certainty")),n}},title:{parentTag:"title",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){return t.commonAnnotation(e,"bf:Title")}},correction:{xpathSelector:"self::choice|self::corr",parentTag:["choice","corr"],textTag:"sic",requiresSelection:!1,mappingFunction:function(t){var e,n,i=t.getCustomValue("corrText"),r=t.getCustomValue("sicText"),a="<".concat(e=r?"choice":"corr").concat(o.getAttributeString(t.getAttributes()),">");return r?(a+="<sic>",n="</sic><corr>".concat(i,"</corr></choice>")):n="</".concat(e,">"),[a,n]},mapping:{customValues:{sicText:"sic/text()",corrText:"corr/text()"}},annotation:function(t,e){var n=t.commonAnnotation(e,"fabio:Correction","oa:editing");return n["oa:hasBody"]={"@type":"fabio:Correction","dc:format":"text/xml","rdf:value":e.getCustomValue("corrText")},n}},link:{parentTag:"ref",annotation:function(t,e){var n=t.commonAnnotation(e,"cnt:ContentAsText","oa:linking");return n["oa:hasBody"]={"@id":e.getAttribute("target"),"@type":"cnt:ContentAsText"},n}},date:{parentTag:"date",annotation:function(t,e){var n,i=t.commonAnnotation(e,"xsd:date");return n=void 0!==e.getAttribute("when")?e.getAttribute("when"):"".concat(e.getAttribute("from"),"/").concat(e.getAttribute("to")),i["oa:hasBody"]["rdf:value"]=n,i}},note:{parentTag:"note",xpathSelector:'self::note[not(@type="citation")]',isNote:!0,requiresSelection:!1,mapping:{noteContent:"."},annotation:function(t,e){var n="";switch(e.getAttribute("type")){case"researchNote":n="cwrc:NoteInternal";break;case"scholarNote":n="cwrc:NoteScholarly";break;case"annotation":n="oa:TextualBody";break;default:n="cwrc:Note"}return t.commonAnnotation(e,n,"oa:describing")}},citation:{parentTag:"note",xpathSelector:'self::note[@type="citation"]/bibl',textTag:"bibl",isNote:!0,requiresSelection:!1,mappingFunction:function(t){var e="".concat(o.getTagAndDefaultAttributes(t),"<bibl>"),n=t.getURI();n&&(e+='<ref target="'.concat(n,'"/>'));return[e,"</bibl></note>"]},mapping:{uri:"bibl/ref/@target",certainty:"@cert",noteContent:"bibl/text()"},annotation:function(t,e){var n=t.commonAnnotation(e,"cito:Citation","cwrc:citing");return e.getURI()&&(n["oa:hasBody"]=[n["oa:hasBody"],{"@id":"".concat(n["@id"],"#Cites"),"@type":"cito:Citation","cito:hasCitingEntity":n["@id"],"cito:hasCitedEntity":e.getURI(),"cito:hasCitationEvent":"cito:cites"}],n["@context"].cito="http://purl.org/spar/cito/"),n}},keyword:{parentTag:"seg",xpathSelector:"self::seg/term",textTag:"term",isNote:!0,requiresSelection:!1,mappingFunction:function(t){return["".concat(o.getTagAndDefaultAttributes(t),"<term>"),"</term></seg>"]},mapping:{noteContent:"term/text()"},annotation:function(t,e){var n="",i="",o=e.getAttribute("ana"),r=void 0!==o,a=r&&0===o.indexOf("http");a?(n="fabio:ControlledVocabulary",i="oa:classifying"):(n="fabio:UncontrolledVocabulary",i="oa:tagging");var s=t.commonAnnotation(e,n,i);return a?(s["oa:hasBody"]=[{"@type":"fabio:ControlledVocabulary","rdf:value":o},{"dc:format":"text/xml","skos:altLabel":e.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):r?(s["oa:hasBody"]=[{"@type":"fabio:UncontrolledVocabulary","rdf:value":o},{"dc:format":"text/xml","skos:altLabel":e.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):s["oa:hasBody"]={"@type":"fabio:UncontrolledVocabulary","dc:format":"text/xml","rdf:value":e.getContent()},s}}}};t.exports=a},function(t,e,n){var i=n(3),o=n(22),r=function(t){var e=t.attr("url");if(void 0!==e){t.css("backgroundImage","url(".concat(e,")")),t.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var e=i(this).height(),o=i(this).width();t.width(o),t.height(e),n.remove()})),i("body").append(n),n.attr("src",e)}},a={namespace:"http://www.tei-c.org/ns/1.0",responsibility:"resp",rdfParentSelector:"/TEI/teiHeader/fileDesc/following-sibling::xenoData",root:["TEI","teiCorpus"],header:"teiHeader",blockElements:["argument","back","bibl","biblFull","biblScope","body","byline","category","change","cit","classCode","elementSpec","macroSpec","classSpec","closer","creation","date","distributor","div","div1","div2","div3","div4","div5","div6","div7","docAuthor","edition","editionStmt","editor","eg","epigraph","extent","figure","front","funder","group","head","dateline","idno","item","keywords","l","label","langUsage","lb","lg","list","listBibl","note","noteStmt","opener","p","principal","publicationStmt","publisher","pubPlace","q","rendition","resp","respStmt","salute","samplingDecl","seriesStmt","signed","sp","sponsor","tagUsage","taxonomy","textClass","titlePage","titlePart","trailer","TEI","teiHeader","text","authority","availability","fileDesc","sourceDesc","revisionDesc","catDesc","encodingDesc","profileDesc","projectDesc","docDate","docEdition","docImprint","docTitle"],urlAttributes:["ref","target"],popupAttributes:[],listeners:{tagAdded:function(t){var e=i(t);"graphic"===e.attr("_tag")&&r(e)},tagEdited:function(t){var e=i(t);"graphic"===e.attr("_tag")&&r(e)},documentLoaded:function(t,e){i(e).find('*[_tag="graphic"]').each((function(t,e){r(i(e))}))}},entities:{rs:{parentTag:"rs",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){var n=e.getAttribute("type");return void 0!==n&&""!==n||(n="owl:Thing"),n=n.replace("http://sparql.cwrc.ca/ontology/cwrc#","cwrc:"),t.commonAnnotation(e,n)}},person:{parentTag:"persName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){return t.commonAnnotation(e,"cwrc:PersonalName")}},org:{parentTag:"orgName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){return t.commonAnnotation(e,"org:FormalOrganization")}},place:{parentTag:"placeName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){return t.commonAnnotation(e,"cwrc:Place")}},title:{parentTag:"title",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(t,e){return t.commonAnnotation(e,"bf:Title")}},correction:{xpathSelector:"self::choice|self::corr",parentTag:["choice","corr"],textTag:"sic",requiresSelection:!1,mappingFunction:function(t){var e,n,i=t.getCustomValue("corrText"),r=t.getCustomValue("sicText"),a="<".concat(e=r?"choice":"corr").concat(o.getAttributeString(t.getAttributes()),">");return r?(a+="<sic>",n="</sic><corr>".concat(i,"</corr></choice>")):n="</".concat(e,">"),[a,n]},mapping:{customValues:{sicText:"sic/text()",corrText:"corr/text()"}},annotation:function(t,e){var n=t.commonAnnotation(e,"fabio:Correction","oa:editing");return n["oa:hasBody"]={"@type":"fabio:Correction","dc:format":"text/xml","rdf:value":e.getCustomValue("corrText")},n}},link:{parentTag:"ref",annotation:function(t,e){var n=t.commonAnnotation(e,"cnt:ContentAsText","oa:linking");return n["oa:hasBody"]={"@id":e.getAttribute("target"),"@type":"cnt:ContentAsText"},n}},date:{parentTag:"date",annotation:function(t,e){var n,i=t.commonAnnotation(e,"xsd:date");return n=void 0!==e.getAttribute("when")?e.getAttribute("when"):"".concat(e.getAttribute("from"),"/").concat(e.getAttribute("to")),i["oa:hasBody"]["rdf:value"]=n,i}},note:{parentTag:"note",xpathSelector:'self::note[not(@type="citation")]',isNote:!0,requiresSelection:!1,annotation:function(t,e){var n="";switch(e.getAttribute("type")){case"researchNote":n="cwrc:NoteInternal";break;case"scholarNote":n="cwrc:NoteScholarly";break;case"annotation":n="oa:TextualBody";break;default:n="cwrc:Note"}return t.commonAnnotation(e,n,"oa:describing")}},citation:{parentTag:"note",xpathSelector:'self::note[@type="citation"]/bibl',textTag:"bibl",isNote:!0,requiresSelection:!1,mappingFunction:function(t){var e="".concat(o.getTagAndDefaultAttributes(t),"<bibl>"),n=t.getURI();n&&(e+='<ref target="'.concat(n,'"/>'));return[e,"</bibl></note>"]},mapping:{uri:"bibl/ref/@target",certainty:"@cert",noteContent:"bibl/text()"},annotation:function(t,e){var n=t.commonAnnotation(e,"cito:Citation","cwrc:citing");return e.getURI()&&(n["oa:hasBody"]=[n["oa:hasBody"],{"@id":"".concat(n["@id"],"#Cites"),"@type":"cito:Citation","cito:hasCitingEntity":n["@id"],"cito:hasCitedEntity":e.getURI(),"cito:hasCitationEvent":"cito:cites"}],n["@context"].cito="http://purl.org/spar/cito/"),n}},keyword:{parentTag:"seg",xpathSelector:"self::seg/term",textTag:"term",isNote:!0,requiresSelection:!1,mappingFunction:function(t){return["".concat(o.getTagAndDefaultAttributes(t),"<term>"),"</term></seg>"]},mapping:{noteContent:"term/text()"},annotation:function(t,e){var n="",i="",o=e.getAttribute("ana"),r=void 0!==o,a=r&&0===o.indexOf("http");a?(n="fabio:ControlledVocabulary",i="oa:classifying"):(n="fabio:UncontrolledVocabulary",i="oa:tagging");var s=t.commonAnnotation(e,n,i);return a?(s["oa:hasBody"]=[{"@type":"fabio:ControlledVocabulary","rdf:value":o},{"dc:format":"text/xml","skos:altLabel":e.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):r?(s["oa:hasBody"]=[{"@type":"fabio:UncontrolledVocabulary","rdf:value":o},{"dc:format":"text/xml","skos:altLabel":e.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):s["oa:hasBody"]={"@type":"fabio:UncontrolledVocabulary","dc:format":"text/xml","rdf:value":e.getContent()},s}}}};t.exports=a},function(t,e,n){var i=n(3),o=n(22),r=function(t){var e=t.attr("url");if(void 0!==e){t.css("backgroundImage","url(".concat(e,")")),t.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var e=i(this).height(),o=i(this).width();t.width(o),t.height(e),n.remove()})),i("body").append(n),n.attr("src",e)}},a={id:"xml:id",responsibility:"RESP",rdfParentSelector:"/*/ORLANDOHEADER/FILEDESC/following-sibling::XENODATA",root:["ENTRY","EVENT","BIOGRAPHY","WRITING"],header:"ORLANDOHEADER",blockElements:["DIV0","DIV1","EVENT","ORLANDOHEADER","DOCAUTHOR","DOCEDITOR","DOCEXTENT","PUBLICATIONSTMT","TITLESTMT","PUBPLACE","L","P","HEADING","CHRONEVENT","CHRONSTRUCT"],urlAttributes:["URL","REF"],popupAttributes:["PLACEHOLDER"],popupElements:["RESEARCHNOTE","SCHOLARNOTE"],listeners:{tagAdded:function(t){var e=i(t);"GRAPHIC"===e.attr("_tag")&&r(e)},tagEdited:function(t){var e=i(t);"GRAPHIC"===e.attr("_tag")&&r(e)},documentLoaded:function(t,e){i(e).find('*[_tag="GRAPHIC"]').each((function(t,e){r(i(e))}))}},entities:{person:{parentTag:"NAME",mapping:{uri:"@REF",lemma:"@STANDARD"},annotation:function(t,e,n){return t.commonAnnotation(e,"foaf:Person")}},org:{parentTag:"ORGNAME",mapping:{uri:"@REF",lemma:"@STANDARD"},annotation:function(t,e,n){return t.commonAnnotation(e,"foaf:Organization")}},place:{parentTag:"PLACE",textTag:["ADDRESS","AREA","GEOG","PLACENAME","REGION","SETTLEMENT"],mappingFunction:function(t){var e=t.getCustomValue("placeType")||"ADDRESS",n=o.getTagAndDefaultAttributes(t);return[n+="<".concat(e,">"),"</".concat(e,"></").concat(t.getTag(),">")]},mapping:{uri:"@REF",lemma:"@REG",customValues:{placeType:"local-name(./*)"}},annotation:function(t,e,n){return t.commonAnnotation(e,"geo:SpatialThing")}},title:{parentTag:"TITLE",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(t,e,n){var o=t.commonAnnotation(e,["dcterms:BibliographicResource","dcterms:title"],"oa:identifying");if("xml"===n){var r=i.parseXML('<cw:pubType xmlns:cw="http://cwrc.ca/ns/cw#">'.concat(e.getAttribute("TITLETYPE"),"</cw:pubType>"));i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),o).prepend(r.firstChild)}else o["oa:hasBody"].pubType=e.getAttribute("TITLETYPE");return o}},date:{xpathSelector:"self::orlando:DATE|self::orlando:DATERANGE|self::orlando:DATESTRUCT",parentTag:["DATE","DATERANGE","DATESTRUCT"],mapping:{tag:"local-name(.)"},annotation:function(t,e,n){var o=[];void 0!==e.getAttribute("FROM")?o.push("time:Interval"):o.push("time:Instant"),o.push("time:TemporalEntity");var r,a=t.commonAnnotation(e,o);"xml"===n?(r=void 0!==e.getAttribute("VALUE")?i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'.concat(e.getAttribute("VALUE"),"</xsd:date>")):i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'.concat(e.getAttribute("FROM"),"/").concat(e.getAttribute("TO"),"</xsd:date>")),i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),a).prepend(r.firstChild)):void 0!==e.getAttribute("VALUE")?a["oa:hasBody"]["xsd:date"]=e.getAttribute("VALUE"):a["oa:hasBody"]["xsd:date"]="".concat(e.getAttribute("FROM"),"/").concat(e.getAttribute("TO"));return a}},note:{parentTag:["RESEARCHNOTE","SCHOLARNOTE"],xpathSelector:"self::orlando:RESEARCHNOTE|self::orlando:SCHOLARNOTE",isNote:!0,mapping:{tag:"local-name(.)",noteContent:"."},annotation:function(t,e){return t.commonAnnotation(e,"bibo:Note","oa:commenting")}},citation:{parentTag:"BIBCIT",isNote:!0,mapping:{uri:"@REF",noteContent:"."},annotation:function(t,e,n){return t.commonAnnotation(e,"dcterms:BibliographicResource","cw:citing")}},correction:{parentTag:"SIC",annotation:function(t,e,n){var o=t.commonAnnotation(e,"cnt:ContentAsText","oa:editing");if("xml"===n){var r=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'.concat(e.getAttribute("CORR"),"</cnt:chars>"));i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),o).prepend(r.firstChild)}else o["oa:hasBody"]["cnt:chars"]=e.getAttribute("CORR");return o}},keyword:{parentTag:"KEYWORDCLASS",isNote:!0,annotation:function(t,e,n){var o=t.commonAnnotation(e,["oa:Tag","cnt:ContentAsText","skos:Concept"],"oa:classifying"),r=e.getAttribute("KEYWORDTYPE");if("xml"===n){var a=i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),o),s=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'.concat(r,"</cnt:chars>"));a.prepend(s.firstChild)}else o["oa:hasBody"]["cnt:chars"]=r;return o}},link:{parentTag:"XREF",annotation:function(t,e,n){return t.commonAnnotation(e,"cnt:ContentAsText","oa:linking")}}}};t.exports=a},function(t,e,n){var i=n(3),o=function(t){var e=t.attr("url");if(void 0!==e){t.css("backgroundImage","url(".concat(e,")")),t.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var e=i(this).height(),o=i(this).width();t.width(o),t.height(e),n.remove()})),i("body").append(n),n.attr("src",e)}},r={id:"xml:id",responsibility:"RESP",rdfParentSelector:"/CWRC/CWRCHEADER",root:["CWRC"],header:"CWRCHEADER",blockElements:[],urlAttributes:["URL","REF"],popupAttributes:[],popupElements:[],listeners:{tagAdded:function(t){var e=i(t);"GRAPHIC"===e.attr("_tag")&&o(e)},tagEdited:function(t){var e=i(t);"GRAPHIC"===e.attr("_tag")&&o(e)},documentLoaded:function(t,e){i(e).find('*[_tag="GRAPHIC"]').each((function(t,e){o(i(e))}))}},entities:{person:{parentTag:"NAME",mapping:{uri:"@REF",lemma:"@STANDARD"},annotation:function(t,e,n){return t.commonAnnotation(e,"foaf:Person")}},org:{parentTag:"ORGNAME",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(t,e,n){return t.commonAnnotation(e,"foaf:Organization")}},place:{parentTag:"PLACE",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(t,e,n){return t.commonAnnotation(e,"geo:SpatialThing")}},title:{parentTag:"TITLE",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(t,e,n){var o=t.commonAnnotation(e,["dcterms:BibliographicResource","dcterms:title"],"oa:identifying");if("xml"===n){var r=i.parseXML('<cw:pubType xmlns:cw="http://cwrc.ca/ns/cw#">'.concat(e.getAttribute("TITLETYPE"),"</cw:pubType>"));i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),o).prepend(r.firstChild)}else o["oa:hasBody"].pubType=e.getAttribute("TITLETYPE");return o}},date:{xpathSelector:"self::cwrcEntry:DATE|self::cwrcEntry:DATERANGE",parentTag:["DATE","DATERANGE"],mapping:{tag:"local-name(.)"},annotation:function(t,e,n){var o=[];void 0!==e.getAttribute("FROM")?o.push("time:Interval"):o.push("time:Instant"),o.push("time:TemporalEntity");var r,a=t.commonAnnotation(e,o);"xml"===n?(r=void 0!==e.getAttribute("VALUE")?i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'.concat(e.getAttribute("VALUE"),"</xsd:date>")):i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'.concat(e.getAttribute("FROM"),"/").concat(e.getAttribute("TO"),"</xsd:date>")),i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),a).prepend(r.firstChild)):void 0!==e.getAttribute("VALUE")?a["oa:hasBody"]["xsd:date"]=e.getAttribute("VALUE"):a["oa:hasBody"]["xsd:date"]="".concat(e.getAttribute("FROM"),"/").concat(e.getAttribute("TO"));return a}},note:{parentTag:["RESEARCHNOTE","SCHOLARNOTE"],xpathSelector:"self::cwrcEntry:RESEARCHNOTE|self::cwrcEntry:SCHOLARNOTE",isNote:!0,mapping:{tag:"local-name(.)",noteContent:"."},annotation:function(t,e){return t.commonAnnotation(e,"bibo:Note","oa:commenting")}},citation:{parentTag:"BIBCIT",isNote:!0,mapping:{uri:"@REF",noteContent:"."},annotation:function(t,e,n){return t.commonAnnotation(e,"dcterms:BibliographicResource","cw:citing")}},correction:{parentTag:"SIC",annotation:function(t,e,n){var o=t.commonAnnotation(e,"cnt:ContentAsText","oa:editing");if("xml"===n){var r=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'.concat(e.getAttribute("CORR"),"</cnt:chars>"));i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),o).prepend(r.firstChild)}else o["oa:hasBody"]["cnt:chars"]=e.getAttribute("CORR");return o}},keyword:{parentTag:"KEYWORDCLASS",isNote:!0,annotation:function(t,e,n){var o=t.commonAnnotation(e,["oa:Tag","cnt:ContentAsText","skos:Concept"],"oa:classifying"),r=e.getAttribute("KEYWORDTYPE");if("xml"===n){var a=i('[rdf\\:about="'.concat(e.getUris().entityId,'"]'),o),s=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'.concat(r,"</cnt:chars>"));a.prepend(s.firstChild)}else o["oa:hasBody"]["cnt:chars"]=r;return o}},link:{parentTag:"XREF",annotation:function(t,e,n){return t.commonAnnotation(e,"cnt:ContentAsText","oa:linking")}}}};t.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n(3);t.exports=function(){var t,e,n={};function o(e){var n=[];return p(t.grammar,(function(t){"element"===t.$key&&t["@name"]===e&&n.push(t)})),n}function r(e){for(var n=t.grammar,i=null,o=e.split("/"),r=0;r<o.length;r++){var a=o[r];""!==a&&(a=a.replace(/\[\d+\]$/,""),p(n,(function(t){if(t["@name"]&&t["@name"]===a){if(n=t,r===o.length-1){if("element"===t.$key)return i=t,!1;n=t}return!0}}),!0))}return i}function a(t){for(var e=[],n=t.$parent;void 0!==n&&"define"!==n.$key&&"element"!==n.$key;)n=n.$parent;return"define"===n.$key?c(n["@name"],{},0,e):"element"===n.$key&&e.push({name:n["@name"],level:0}),e}function s(t,n){var o=[];if(d(t,{},0,n,o),-1!=o.indexOf("anyName"))for(o=[],i=0;i<e.length;i++){var r=e[i];o.push({name:r})}return o}function l(t){t.sort((function(t,e){return t.name>e.name?1:t.name<e.name?-1:0}))}function c(e,n,i,o){var r=t.grammar,a=[];p(r,(function(t){"ref"===t.$key&&t["@name"]===e&&a.push(t)}));for(var s=0;s<a.length;s++){for(var l=a[s].$parent;void 0!==l&&"element"!==l.$key&&"define"!==l.$key;)l=l.$parent;if("element"===l.$key){var d=null;p(l,(function(t){if(t["a:documentation"])return d=t["a:documentation"],!1})),null!=d&&void 0!==d["#text"]?d=d["#text"]:null==d&&(d="");var u=g(d);o.push({name:l["@name"],fullName:u,level:i,documentation:d})}else n[l["@name"]]||(n[l["@name"]]=!0,c(l["@name"],n,i+1,o))}}function d(t,e,n,i,o,r){var a=[];p(t,(function(e){if("element"===e.$key&&e!==t)return!1;null!=e[i]&&(a=a.concat(e[i]))}));for(var s=0;s<a.length;s++){var l=a[s],c=null;p(l,(function(t){if(t["a:documentation"])return c=t["a:documentation"],!1})),null!=c&&void 0!==c["#text"]?c=c["#text"]:null==c&&(c="");var h=g(c);if(l.anyName)return void o.push("anyName");var m=!1;if(o.every((function(t,e,n){return t.name!==l["@name"]||(m=!0,!1)})),!m){var v={name:l["@name"],fullName:h,level:n+0,documentation:c};if("element"==i)r&&null!=r.optional?v.required=!r.optional:"element"===l.$parent.$key||"oneOrMore"===l.$parent.$key?v.required=!0:v.required=!1;else if("attribute"==i){r&&null!=r.optional?v.required=!r.optional:(v.required=!0,u(l.$parent,(function(t){if(t.optional)return v.required=!1,!1})));var y=null;p(l,(function(t){if(t["@a:defaultValue"])return y=t["@a:defaultValue"],!1})),v.defaultValue=y||"";var b=null,w=null;if(p(l,(function(t){if(t.choice&&(b=t.choice),t.list&&(w=t.list),null!==b&&null!==w)return!1})),null!=b){var _=[],x=[];p(b,(function(t){t.value&&(x=t.value),Array.isArray(x)||(x=[x])}));for(var C=0;C<x.length;C++){var k=x[C];k["#text"]&&(k=k["#text"]),_.push(k)}v.choices=_}}o.push(v)}}a=[],p(t,(function(e){if("element"===e.$key&&e!==t)return!1;e.ref&&(a=a.concat(e.ref))}));for(s=0;s<a.length;s++){var T=a[s],E=T["@name"],S=null;if(u(T,(function(t){if(t.$parent&&t.$parent.$key){var e=t.$parent.$key;if("choice"===e||"optional"===e||"zeroOrMore"===e)return S=!0,!1;if("oneOrMore"===e)return S=!1,!1}return!1})),!e[E]){e[E]=!0;var D=f(E);null!==D&&d(D,e,n+1,i,o,{optional:S})}}}function u(t,e){for(var n=!0;n&&null!=t;)null==(n=e.call(this,t))&&(n=!0),t=t.$parent}function p(t,e,n){var i=!0,o={};function r(t){return"[object Array]"===toString.apply(t)}!function t(a){var s;if(i)for(var l in null==(i=e.call(this,a))&&(i=!0),a)if("$parent"!=l&&"$key"!=l&&0!=l.search("@")){var c=a[l];if(!0===n&&"ref"===l){var d;d=r(c)?c:[c];for(var u=0;u<d.length;u++){var p=d[u]["@name"];if(void 0===o[p]){o[p]=!0;var g=f(p);null!==g&&t(g)}}}else if(r(c))for(var h=0;h<c.length;h++)t(c[h]);else(s=c)&&"[object Object]"===Object.prototype.toString.call(s)&&t(c)}}(t)}function f(e){for(var n=t.grammar.define,i=0,o=n.length;i<o;i++){var r=n[i];if(r["@name"]==e)return r}return console.warn("schemaNavigator: no definition found for",e),null}function g(t){var e=/^\((.*?)\)/.exec(t);return null!==e?e[1]:""}return n.setSchemaJSON=function(e){t=e},n.setSchemaElements=function(t){e=t},n.getParentsForTag=function(t){var e=o(t);if(0==e.length)return console.warn("schemaNavigator: cannot find element for "+t),[];for(var n=[],i=0;i<e.length;i++)n=n.concat(a(e[i]));return l(n),n},n.getParentsForPath=function(t){var e=r(t);if(null===e)return console.warn("schemaNavigator: cannot find element for "+t),[];var n=a(e);return l(n),n},n.getChildrenForTag=function(t){var e=o(t);if(0==e.length)return console.warn("schemaNavigator: cannot find element for "+t),[];for(var n=[],i=0;i<e.length;i++)n=n.concat(s(e[i],"element"));return l(n),n},n.getChildrenForPath=function(t){var e=r(t);if(null===e)return console.warn("schemaNavigator: cannot find element for "+t),[];var n=s(e,"element");return l(n),n},n.getAttributesForTag=function(t){var e=o(t);if(0===e.length)return[];var n=e.flatMap((function(t){return s(t,"attribute")}));return l(n),n},n.getAttributesForPath=function(t){var e=r(t);if(null===e)return console.warn("schemaNavigator: cannot find element for "+t),[];var n=s(e,"attribute");return l(n),n},n}},,,,,,,,,,function(t,e,n){"use strict";var i=n(3);t.exports=function(t,e){var n=t,o=i('<div><div><label>Schema Name</label><input type="text" name="name" value=""/></div><div style="margin-top: 10px;"><label>Schema URL</label><input type="text" name="xmlUrl" value=""/></div><div style="margin-top: 10px;"><label>Schema CSS URL</label><input type="text" name="cssUrl" value=""/></div></div>').appendTo(e);return o.dialog({modal:!0,resizable:!1,closeOnEscape:!1,open:function(t,e){o.parent().find(".ui-dialog-titlebar-close").hide()},title:"Add Schema",height:300,width:250,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:{Add:function(){var t={};i("input",o).each((function(e,n){t[n.getAttribute("name")]=i(n).val()}));n.schemaManager.addSchema(t);o.dialog("close")},Cancel:function(){o.dialog("close")}}}),{show:function(t){i("input",o).val(""),o.dialog("open")},destroy:function(){o.dialog("destroy")}}}},function(t,e,n){"use strict";var i=n(3);n(32),n(351),t.exports=function(t,e){var n=t,o=i('<div class="loadingIndicatorDialog"><div class="progressBar"><div class="progressLabel"></div></div></div>').appendTo(e);o.dialog({title:"CWRC-Writer",modal:!0,resizable:!1,closeOnEscape:!1,height:160,width:300,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},buttons:{},autoOpen:!1,open:function(t,e){i(".ui-dialog-titlebar-close",e.dialog).hide()}});var r=o.find(".progressBar");r.progressbar({value:0});var a=o.find(".progressLabel");return n.event("loadingDocument").subscribe((function(){n.dialogManager.show("loadingindicator"),a.text("Loading Document"),r.progressbar("value",!1)})),n.event("loadingSchema").subscribe((function(){n.dialogManager.show("loadingindicator"),a.text("Loading Schema"),r.progressbar("value",!1)})),n.event("documentLoaded").subscribe((function(t,e){r.progressbar("value",100),o.dialog("close")})),n.event("schemaLoaded").subscribe((function(){a.text("Schema Loaded"),o.dialog("close")})),n.event("savingDocument").subscribe((function(){n.dialogManager.show("loadingindicator"),a.text("Saving Document"),r.progressbar("value",5)})),n.event("documentSaved").subscribe((function(t){r.progressbar("value",100),!0!==t?(a.text("Error Saving Document"),o.dialog("option","buttons",{Ok:function(){o.dialog("close")}})):o.dialog("close")})),{setText:function(t){a.text(t)},setValue:function(t){r.progressbar("value",t)},show:function(t){o.dialog("open")},hide:function(){o.dialog("close")},destroy:function(){r.progressbar("destroy"),o.dialog("destroy")}}}},,function(t,e,n){"use strict";var i=n(3);n(32),t.exports=function(t,e){var n=t,o=i('<div class="editHeader">Edit Header</div>').appendTo(n.layoutManager.getHeaderButtonsParent()),r=i('<div class="headerDialog"><div><textarea style="height: 98%; width: 98%; font-family: monospace;" spellcheck="false"></textarea></div></div>').appendTo(e);function a(){var t="";i('[_tag="'+n.schemaManager.getHeader()+'"]',n.editor.getBody()).children().each((function(e,o){t+=n.converter.buildXMLString(i(o))})),r.find("textarea").val(t),r.dialog("open")}return r.dialog({title:"Edit Header",modal:!0,resizable:!0,height:380,width:400,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Ok",role:"ok",click:function(){var t,e="<head>"+r.find("textarea").val()+"</head>";try{t=i.parseXML(e)}catch(t){return n.dialogManager.show("message",{title:"Invalid XML",msg:"There was an error parsing the XML.",type:"error"}),!1}var o="";i(t).find("head").children().each((function(t,e){o+=n.converter.buildEditorString(e)})),i('[_tag="'+n.schemaManager.getHeader()+'"]',n.editor.getBody()).html(o),r.dialog("close")}},{text:"Cancel",role:"cancel",click:function(){r.dialog("close")}}]}),o.click((function(){a()})),{show:function(t){a()},destroy:function(){r.dialog("destroy")}}}},function(t,e,n){"use strict";var i=n(3);n(32),t.exports=function(t,e){var n=t,o=i('<div><textarea style="height: 98%; width: 98%; font-family: monospace;" spellcheck="false"></textarea></div>').appendTo(e);return o.dialog({title:"Edit Source",modal:!0,resizable:!0,closeOnEscape:!0,height:480,width:640,autoOpen:!1,buttons:[{text:"Ok",role:"ok",click:function(){var t=i("textarea",o).val();o.dialog("close"),setTimeout((function(){n.loadDocumentXML(t,!1)}),0)}},{text:"Cancel",role:"cancel",click:function(){o.dialog("close")}}],open:function(t){console.time("set focus");var e=i(this).find("textarea");e.focus(),e[0].setSelectionRange(0,0),e.scrollTop(0),console.timeEnd("set focus")},close:function(t){i("textarea",o).val("")}}),{show:function(t){n.dialogManager.confirm({title:"Edit Raw XML",msg:"Editing the XML directly is only recommended for advanced users who know what they're doing.<br/><br/>Are you sure you wish to continue?",showConfirmKey:"confirm-edit-source",type:"info",callback:function(t){t&&n.converter.getDocumentContent(!0,(function(t){console.time("dialog open"),o.dialog("open"),console.timeEnd("dialog open"),console.time("set doc text"),i("textarea",o).val(t),console.timeEnd("set doc text")}))}})},destroy:function(){o.dialog("destroy")}}}},function(t,e,n){"use strict";var i=n(3);n(100),n(15),t.exports=function(t,e){var n=t,o={person:["is a child of","is a parent of","is related to","was born on","died on"],place:["is located within","contains"]},r=i('<div class="triplesDialog"><div class="columns"><div class="column"><h2>Subject</h2><ul class="entitiesList"></ul><div class="customEntry"><input type="text" name="customSubject" value="" /></div></div><div class="column predicate"><h2>Predicate</h2><ul></ul><div class="customEntry"><input type="text" name="customPredicate" value="" /></div></div><div class="column"><h2>Object</h2><ul class="entitiesList"></ul><div class="customEntry"><input type="text" name="customObject" value="" /></div></div></div><div class="currentRelation"><p></p><button type="button">Add Relation</button></div></div>').appendTo(e);r.dialog({title:"Add Relation",modal:!0,resizable:!0,closeOnEscape:!0,height:450,width:600,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:{Close:function(){r.dialog("close")}}});var a=i(".column:eq(0)",r),s=i(".column:eq(1)",r),l=i(".column:eq(2)",r);i("input",a).watermark("Custom Subject"),i("input",s).watermark("Custom Predicate"),i("input",l).watermark("Custom Object"),i("input",r).keyup((function(){i(this).parents(".column").find("li").removeClass("selected"),u()})),i(".currentRelation button",r).button({disabled:!0}).click((function(){var t=d(),e=t[0],i=t[1],o=t[2];n.triples.push({subject:e,predicate:{text:i.text,name:c(i.text),external:i.external},object:o}),n.relations.update()}));var c=function(t){for(var e=t.split(/\s/),n="",i=0;i<e.length;i++)n+=0==i?e[i].toLowerCase():e[i].replace(/^./,(function(t){return t.toUpperCase()}));return n},d=function(){var t=[null,null,null];return i("ul",r).each((function(e,o){var r=i(this).find(".selected");if(1==r.length){var a="",s=r.attr("name");null!=s&&(a=n.entitiesManager.getEntity(s).getUris().annotationId),t[e]={text:n.utilities.escapeHTMLString(r.text()),uri:a,external:!1}}})),i("input",r).each((function(e,o){var r=i(this).val();""!=r&&(t[e]={text:n.utilities.escapeHTMLString(r),uri:n.utilities.escapeHTMLString(r),external:!0})})),t},u=function(){for(var t="",e=d(),n=!0,o=0;o<e.length;o++){var a=e[o];null==a?n=!1:(t+=a.text,t+=o<2?" ":".")}i(".currentRelation p",r).html(t),n?i(".currentRelation button",r).button("enable"):i(".currentRelation button",r).button("disable")};return{show:function(t){i(".column > ul",r).empty(),i(".currentRelation p",r).html("");var e="";n.entitiesManager.eachEntity((function(t,n){e+=function(t){return'<li class="'+t.getType()+'" name="'+t.getId()+'"><span class="box"/><span class="entityTitle">'+t.getContent()+"</span></li>"}(n)})),i("ul",a).html(e),i("ul",l).html(e),i(".entitiesList > li",r).hover((function(){i(this).hasClass("selected")||i(this).addClass("over")}),(function(){i(this).hasClass("selected")||i(this).removeClass("over")})).click((function(t){(i(this).siblings("li").removeClass("selected"),i(this).removeClass("over").toggleClass("selected"),i(this).parents(".column").find("input").val(""),a.find(this).length>0)&&(i(this).hasClass("selected")?function(t){i(".predicate > ul",r).empty();for(var e=o[t]||["is associated with"],n="",a=0;a<e.length;a++)n+="<li>"+e[a]+"</li>";i(".predicate > ul",r).html(n),i(".predicate > ul li",r).click((function(){i(this).siblings("li").removeClass("selected"),i(this).toggleClass("selected"),i(this).parents(".column").find("input").val(""),u()}))}(n.entitiesManager.getEntity(i(this).attr("name")).getType()):i("ul",s).empty());u()})),r.dialog("open")},destroy:function(){r.dialog("destroy")}}}},function(t,e,n){"use strict";var i=n(3),o=n(49);t.exports=function(t,e){var n=t,r=null,a=i('<div class="annotationDialog"><div class="entityWarning" style="display: none;">Warning: you are creating a tag but <em>not</em> a corresponding entity/linked data annotation. Use the button on the tool bar to create a tag and an entity simultaneously.</div><div class="attributeWidget" /></div>').appendTo(e),s=null;a.dialog({modal:!0,resizable:!0,dialogClass:"splitButtons",closeOnEscape:!1,height:460,width:550,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},minHeight:400,minWidth:510,autoOpen:!1,open:function(t,e){s=t.timeStamp,a.parent().find(".ui-dialog-titlebar-close").hide()},beforeClose:function(t,e){if(t.timeStamp-s<150)return!1},buttons:[{text:"Cancel",role:"cancel",click:function(){d()}},{text:"Ok",role:"ok",click:function(){c()}}]});var l=new o({writer:n,$parent:a,$el:a.find(".attributeWidget"),showSchemaHelp:!0}),c=function(){var t=l.getData();if(void 0===t&&(t={}),a.dialog("close"),a.is(":hidden")){try{i("ins",a).tooltip("destroy")}catch(t){console&&console.log("error destroying tooltip")}r.call(n,t),r=null}},d=function(){if(a.dialog("close"),a.is(":hidden")){n.editor.selection.moveToBookmark(n.editor.currentBookmark);try{i("ins",a).tooltip("destroy")}catch(t){console&&console.log("error destroying tooltip")}r.call(n,null),r=null}};return{show:function(t,e,s,c){r=c,function(t,e,r){var s;n.editor.getBody().blur(),a.find(".entityWarning").hide(),n.mode!==n.XML&&null!==n.schemaManager.mapper.getEntityTypeForTag(t)&&a.find(".entityWarning").show(),i.isEmptyObject(r)?l.mode=o.ADD:l.mode=o.EDIT,s=void 0!==e?n.schemaManager.getAttributesForPath(e):n.schemaManager.getAttributesForTag(t),l.buildWidget(s,r,t),a.dialog("option","title",t),a.dialog("open"),i("button[role=ok]",a.parent()).focus()}(t,e,s)},destroy:function(){l.destroy(),a.dialog("destroy")}}}},function(t,e,n){"use strict";var i=n(3);t.exports=function(t,e){var n=t,o=!0,r=!0,a=!1,s=i('<div><div class="content"></div></div>').appendTo(e);s.dialog({title:"Copy & Paste Help",modal:!0,resizable:!0,closeOnEscape:!0,height:250,width:350,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,dialogClass:"splitButtons",buttons:[{text:"Ok",click:function(){s.dialog("close")}}]}),n.event("contentCopied").subscribe((function(){a=!0,o&&(o=!1,l.show({type:"copy"}))})),n.event("contentPasted").subscribe((function(){r&&!a&&(r=!1,l.show({type:"paste"})),a=!1}));var l={show:function(t){var e,n=t.type,i=void 0!==t.modal&&t.modal;s.dialog("option","modal",i),"copy"==n?e='It looks like you\'re trying to copy content.<br/>Consider having a look at the <a href="https://cwrc.ca/CWRC-Writer_Documentation/#CWRCWriter_Copy_Splash.html" target="_blank">Copy & Paste Documentation</a>':"paste"==n&&(e='It looks like you\'re trying to paste from outside CWRC-Writer. Be aware that <b>all tags will be removed</b> and only plain text will remain.<br/>Consider having a look at the <a href="https://cwrc.ca/CWRC-Writer_Documentation/#CWRCWriter_Copy_Splash.html" target="_blank">Copy & Paste Documentation</a>'),s.find(".content").html(e),s.dialog("open")},destroy:function(){s.dialog("destroy")}};return l}},function(t,e,n){"use strict";var i=n(3);n(99),t.exports=function(t,e){var n,o,r=t,a="",s="",l=".noteWrapper.hide",c=".noteWrapper",d=r.getUniqueId("popupDialog"),u=i('<div id="'+d+'"></div>').appendTo(e);u.popup({autoOpen:!1,resizable:!1,draggable:!1,minHeight:30,minWidth:40,open:function(t,e){u.parent().find(".ui-dialog-titlebar-close").hide()},position:{my:"center",at:"center",of:o,using:function(t,e){var n=e.element.element,a=i(r.editor.getDoc().documentElement),s=i(document.documentElement),l=o.offset(),c=i(r.editor.iframeElement).offset(),d=a.scrollTop(),u=a.scrollLeft(),p=s.scrollTop(),f=s.scrollLeft();t.top=c.top+l.top+o.height()-d-p,t.left=c.left+l.left-u-f;var g=r.utilities.constrain(t.left,s.width(),n.outerWidth()),h=r.utilities.constrain(t.top,s.height(),n.outerHeight());n.css({left:g+"px",top:h+"px"})}}});var p=function(t){0==(o=i("#"+t,r.editor.getBody())).length&&(o=i('[name="'+t+'"]',r.editor.getBody()).first())},f=function(){clearTimeout(n)},g=function(){n=setTimeout(x,500)},h=function(){var t=u.text();window.open(t)},m=function(t,e){var i;if(u.parent().off("mouseover",f),u.parent().off("mouseout",g),u.off("click",h),u.popup("option","dialogClass","popup "+e),u.html(t),u.popup("open"),"note"===e)i=350;else{u.popup("option","width","auto");var r=u.width();i="link"===e?r+30:Math.min(200,r)+30}u.popup("option","width",i),clearTimeout(n),o.one("mouseout",(function(){n=setTimeout(x,1e3)})),u.parent().on("mouseover",f),u.parent().on("mouseout",g)},v=function(t){var e=this.getAttribute("id")||this.getAttribute("name");p(e);for(var n=null,i=r.schemaManager.mapper.getPopupAttributes(),a=0;a<i.length;a++){var s=o.attr(i[a]);if(void 0!==s){n=s;break}}null!=n&&m(n,"tag")},y=function(t){var e=this.getAttribute("id")||this.getAttribute("name");p(e);for(var n=null,i=r.schemaManager.mapper.getUrlAttributes(),a=0;a<i.length;a++){var s=o.attr(i[a]);if(void 0!==s){n=s;break}}b(n)},b=function(t){t&&(0===t.indexOf("http")?(m(t,"link"),u.on("click",h)):m(t,"tag"))},w=function(t){o=i(this);var e=i(this).children("[_entity]").attr("id"),n=r.entitiesManager.getEntity(e);if(null!==this.textContent.match(/\S+/)){var a=n.getNoteContent();void 0===a&&(a=n.getContent()),void 0!==a&&m(a,"note")}else"citation"===n.getType()&&b(n.getURI())},_=function(t){x()},x=function(){u.popup("close")},C=function(){var t=i(r.editor.getBody());t.off("mouseover",a,v),t.off("mouseover",s,y),t.off("mouseover",l,w),t.off("click",c,_),t.off("contextmenu",x)};return r.event("schemaLoaded").subscribe((function(){C();var t=i(r.editor.getBody()),e=r.schemaManager.mapper.getPopupAttributes();a="",i.map(e,(function(t,n){a+="["+t+"]",n<e.length-1&&(a+=",")})),""!=a&&t.on("mouseover",a,v);var n=r.schemaManager.mapper.getUrlAttributes();s="",i.map(n,(function(t,e){s+="["+t+"]",e<n.length-1&&(s+=",")})),""!=s&&t.on("mouseover",s,y),t.on("mouseover",l,w),t.on("click",c,_),t.on("contextmenu",x)})),{show:function(t){console.warn("dialogManager.popup: shouldn't call show directly")},destroy:function(){C()}}}},function(t,e,n){"use strict";n(3);var i=n(36);t.exports=function(t){return new i(t,{label:"Person",localDialog:"person",cwrcType:"person"})}},function(t,e,n){"use strict";n(3);var i=n(36);t.exports=function(t){return new i(t,{label:"Place",localDialog:"place",cwrcType:"place"})}},function(t,e,n){"use strict";n(3);var i=n(36);t.exports=function(t){return new i(t,{label:"Organization",localDialog:"org",cwrcType:"organization"})}},function(t,e,n){"use strict";n(3);var i=n(36);t.exports=function(t){return new i(t,{label:"Title",localDialog:"title",cwrcType:"title"})}},function(t,e,n){"use strict";n(3);var i=n(36);t.exports=function(t){return new i(t,{label:"Citation",localDialog:"citation",cwrcType:"title"})}},function(t,e,n){"use strict";n(3);var i=n(36);t.exports=function(t){return new i(t,{label:"RS",localDialog:"rs",cwrcType:"rs"})}},function(t,e,n){var i=n(365),o=n(366),r=n(367),a=n(369),s=n(370),l=n(60),c=n(371),d=n(372),u=n(373),p=n(374),f=n(375);t.exports={citation:i,correction:o,date:r,keyword:a,link:s,note:l,org:c,person:d,place:u,title:p,rs:f}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("citationForm_"),a=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+r+'_noteContent">Citation text</label><textarea id="'+r+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="citation" /></div>').appendTo(e),s=new o({writer:n,$el:a,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(t,e,n){n.mode===o.EDIT?(n.$el.find("label[for="+r+"_noteContent]").hide(),n.$el.find("#"+r+"_noteContent").hide()):(n.$el.find("label[for="+r+"_noteContent]").show(),n.$el.find("#"+r+"_noteContent").show())})),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("corrForm_"),a=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="custom.corrText"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:385,height:400,type:"correction",title:"Tag Correction"});return s.$el.on("beforeShow",(function(t,e,i){var r;i.mode===o.ADD?r=n.editor.currentBookmark.rng.toString():void 0===(r=e.entry.getCustomValue("sicText"))&&a.find("textarea").val(e.entry.getContent()),void 0!==r&&""!==r&&(i.currentData.customValues.sicText=r)})),s.$el.on("beforeSave",(function(t,e){var r=e.currentData.customValues.sicText,a=e.currentData.customValues.corrText;if(e.mode===o.EDIT){if(null==r){var s=n.entitiesManager.getCurrentEntity();i("#"+s,n.editor.getBody()).text(a),n.entitiesManager.getEntity(s).setContent(a)}}else if(void 0===r){var l=n.getUniqueId("temp"),c=i('<span id="'+l+'"/>',n.editor.getDoc()),d=n.editor.selection.getRng(!0);d.surroundContents(c[0]),c.html(a);var u=c[0].firstChild;i(u).unwrap(),d.selectNodeContents(u),n.editor.currentBookmark=n.editor.selection.getBookmark(1)}})),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(1);o.suppressDeprecationWarnings=!0;var r=n(7);n(59),n(15),t.exports=function(t,e){var n=t,a=(new Date).getFullYear()+10,s=n.getUniqueId("dateForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset"><p>Date type:</p><input type="radio" name="dateType" value="date" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="range" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="when" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="from" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="to" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+s+'_high" name="'+s+'_id_certainty" value="high" data-default="true" /><label for="'+s+'_high">High</label><input type="radio" id="'+s+'_medium" name="'+s+'_id_certainty" value="medium" /><label for="'+s+'_medium">Medium</label><input type="radio" id="'+s+'_low" name="'+s+'_id_certainty" value="low" /><label for="'+s+'_low">Low</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="unknown" /><label for="'+s+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),c=new r({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){g(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(e);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var f=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(t){var e=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),o=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,t,n.settings);f.not(this).datepicker("option",e,o)}}),g=function(t){d.val(""),u.val(""),p.val(""),"date"==t?(i("#"+s+"_date").show(),i("#"+s+"_range").hide()):(i("#"+s+"_date").hide(),i("#"+s+"_range").show())};return c.$el.on("beforeShow",(function(t,e){if(f.datepicker("option","minDate",new Date(1800,0,1)),f.datepicker("option","maxDate",new Date(a,11,31)),c.mode===r.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=o(h);if(m.isValid()){var v=m.toDate(),y=v.getFullYear();if(h.length>4){var b=v.getMonth();++b<10&&(b="0"+b);var w=v.getDate();w<10&&(w="0"+w),l=y+"-"+b+"-"+w}else l=++y}}g("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(l),u.val(""),p.val("")}else{var _=e.entry.getAttributes();void 0!==_.when?(g("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(_.when),u.val(""),p.val("")):(g("range"),i("#"+s+"_type_range").prop("checked",!0),d.val(""),u.val(_.from),p.val(_.to))}i("#"+s+"_type input").button("refresh"),d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(t,e){var n=!1;if("date"===i("#"+s+"_type input:checked").val()){var r=d.val();o(r).isValid()?e.currentData.attributes.when=r:(d.css({borderBottom:"1px solid red"}),n=!0)}else{var a=u.val(),l=p.val(),c=o(a),f=o(l);c.isValid()?e.currentData.attributes.from=a:(u.css({borderBottom:"1px solid red"}),n=!0),f.isValid()?e.currentData.attributes.to=l:(p.css({borderBottom:"1px solid red"}),n=!0),c.isAfter(f)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}e.isValid=!n})),{show:function(t){c.show(t)},destroy:function(){d.datepicker("destroy"),f.datepicker("destroy"),c.destroy()}}}},function(t,e,n){var i={"./af":101,"./af.js":101,"./ar":102,"./ar-dz":103,"./ar-dz.js":103,"./ar-kw":104,"./ar-kw.js":104,"./ar-ly":105,"./ar-ly.js":105,"./ar-ma":106,"./ar-ma.js":106,"./ar-sa":107,"./ar-sa.js":107,"./ar-tn":108,"./ar-tn.js":108,"./ar.js":102,"./az":109,"./az.js":109,"./be":110,"./be.js":110,"./bg":111,"./bg.js":111,"./bm":112,"./bm.js":112,"./bn":113,"./bn-bd":114,"./bn-bd.js":114,"./bn.js":113,"./bo":115,"./bo.js":115,"./br":116,"./br.js":116,"./bs":117,"./bs.js":117,"./ca":118,"./ca.js":118,"./cs":119,"./cs.js":119,"./cv":120,"./cv.js":120,"./cy":121,"./cy.js":121,"./da":122,"./da.js":122,"./de":123,"./de-at":124,"./de-at.js":124,"./de-ch":125,"./de-ch.js":125,"./de.js":123,"./dv":126,"./dv.js":126,"./el":127,"./el.js":127,"./en-au":128,"./en-au.js":128,"./en-ca":129,"./en-ca.js":129,"./en-gb":130,"./en-gb.js":130,"./en-ie":131,"./en-ie.js":131,"./en-il":132,"./en-il.js":132,"./en-in":133,"./en-in.js":133,"./en-nz":134,"./en-nz.js":134,"./en-sg":135,"./en-sg.js":135,"./eo":136,"./eo.js":136,"./es":137,"./es-do":138,"./es-do.js":138,"./es-mx":139,"./es-mx.js":139,"./es-us":140,"./es-us.js":140,"./es.js":137,"./et":141,"./et.js":141,"./eu":142,"./eu.js":142,"./fa":143,"./fa.js":143,"./fi":144,"./fi.js":144,"./fil":145,"./fil.js":145,"./fo":146,"./fo.js":146,"./fr":147,"./fr-ca":148,"./fr-ca.js":148,"./fr-ch":149,"./fr-ch.js":149,"./fr.js":147,"./fy":150,"./fy.js":150,"./ga":151,"./ga.js":151,"./gd":152,"./gd.js":152,"./gl":153,"./gl.js":153,"./gom-deva":154,"./gom-deva.js":154,"./gom-latn":155,"./gom-latn.js":155,"./gu":156,"./gu.js":156,"./he":157,"./he.js":157,"./hi":158,"./hi.js":158,"./hr":159,"./hr.js":159,"./hu":160,"./hu.js":160,"./hy-am":161,"./hy-am.js":161,"./id":162,"./id.js":162,"./is":163,"./is.js":163,"./it":164,"./it-ch":165,"./it-ch.js":165,"./it.js":164,"./ja":166,"./ja.js":166,"./jv":167,"./jv.js":167,"./ka":168,"./ka.js":168,"./kk":169,"./kk.js":169,"./km":170,"./km.js":170,"./kn":171,"./kn.js":171,"./ko":172,"./ko.js":172,"./ku":173,"./ku.js":173,"./ky":174,"./ky.js":174,"./lb":175,"./lb.js":175,"./lo":176,"./lo.js":176,"./lt":177,"./lt.js":177,"./lv":178,"./lv.js":178,"./me":179,"./me.js":179,"./mi":180,"./mi.js":180,"./mk":181,"./mk.js":181,"./ml":182,"./ml.js":182,"./mn":183,"./mn.js":183,"./mr":184,"./mr.js":184,"./ms":185,"./ms-my":186,"./ms-my.js":186,"./ms.js":185,"./mt":187,"./mt.js":187,"./my":188,"./my.js":188,"./nb":189,"./nb.js":189,"./ne":190,"./ne.js":190,"./nl":191,"./nl-be":192,"./nl-be.js":192,"./nl.js":191,"./nn":193,"./nn.js":193,"./oc-lnc":194,"./oc-lnc.js":194,"./pa-in":195,"./pa-in.js":195,"./pl":196,"./pl.js":196,"./pt":197,"./pt-br":198,"./pt-br.js":198,"./pt.js":197,"./ro":199,"./ro.js":199,"./ru":200,"./ru.js":200,"./sd":201,"./sd.js":201,"./se":202,"./se.js":202,"./si":203,"./si.js":203,"./sk":204,"./sk.js":204,"./sl":205,"./sl.js":205,"./sq":206,"./sq.js":206,"./sr":207,"./sr-cyrl":208,"./sr-cyrl.js":208,"./sr.js":207,"./ss":209,"./ss.js":209,"./sv":210,"./sv.js":210,"./sw":211,"./sw.js":211,"./ta":212,"./ta.js":212,"./te":213,"./te.js":213,"./tet":214,"./tet.js":214,"./tg":215,"./tg.js":215,"./th":216,"./th.js":216,"./tk":217,"./tk.js":217,"./tl-ph":218,"./tl-ph.js":218,"./tlh":219,"./tlh.js":219,"./tr":220,"./tr.js":220,"./tzl":221,"./tzl.js":221,"./tzm":222,"./tzm-latn":223,"./tzm-latn.js":223,"./tzm.js":222,"./ug-cn":224,"./ug-cn.js":224,"./uk":225,"./uk.js":225,"./ur":226,"./ur.js":226,"./uz":227,"./uz-latn":228,"./uz-latn.js":228,"./uz.js":227,"./vi":229,"./vi.js":229,"./x-pseudo":230,"./x-pseudo.js":230,"./yo":231,"./yo.js":231,"./zh-cn":232,"./zh-cn.js":232,"./zh-hk":233,"./zh-hk.js":233,"./zh-mo":234,"./zh-mo.js":234,"./zh-tw":235,"./zh-tw.js":235};function o(t){var e=r(t);return n(e)}function r(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}o.keys=function(){return Object.keys(i)},o.resolve=r,t.exports=o,o.id=368},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=!1,a=n.getUniqueId("keywordForm_"),s=i('<div class="annotationDialog"><div><label for="'+a+'_noteContent">Keyword</label><input type="text" id="'+a+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="margin-right: 10px;"/><p>You will be able to edit the keyword in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+a+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="keyword" /></div>').appendTo(e),l=new o({writer:n,$el:s,type:"keyword",title:"Tag Keyword",height:420,width:420});return l.$el.on("beforeSave",(function(t,e){r||void 0!==e.currentData.attributes.ana?e.isValid=!0:(e.isValid=!1,n.dialogManager.confirm({title:"Warning",msg:'<p>A human-readable keyword is preferably linked, using the "ana" attribute, to a controlled vocabulary.</p><p>Click "Add Link" to add a URL for your term or "Skip Link" to save as is.</p>',yesText:"Skip Link",noText:"Add Link",showConfirmKey:"confirm-tei-keyword",type:"info",callback:function(t){setTimeout((function(){t&&(r=!0,e.save())}))}}))})),l.$el.on("beforeShow",(function(t,e){l.isValid=!0,r=!1,l.mode===o.ADD?(l.attributesWidget.setData({ana:""}),l.attributesWidget.expand(),l.$el.find("label[for="+a+"_noteContent]").show(),l.$el.find("#"+a+"_noteContent").show()):(l.$el.find("label[for="+a+"_noteContent]").hide(),l.$el.find("#"+a+"_noteContent").hide())})),{show:function(t){l.show(t)},destroy:function(){l.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);n(15),t.exports=function(t,e){var n=t,r=n.getUniqueId("linkForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="target" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:350,height:350,type:"link",title:"Tag Link"});return i("button",a).button().click((function(){var t=i("#"+r+"_input").val();if(""!=t){null==t.match(/^https?:\/\//)&&(t="http://"+t);try{window.open(t,"linkTestWindow")}catch(t){alert(t)}}})),{show:function(t){s.show(t)},destroy:function(){i("button",a).button("destroy"),s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("orgForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,height:550,type:"org",title:"Tag Organization"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){for(var n=t,r=n.getUniqueId("personForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div id="'+r+'_type" data-transform="buttonset" data-type="radio" data-mapping="type"><p>Person type:</p><input type="radio" id="'+r+'_real" name="'+r+'_type_certainty" value="real" data-default="true" /><label for="'+r+'_real">Real</label><input type="radio" id="'+r+'_fictional" name="'+r+'_type_certainty" value="fictional" /><label for="'+r+'_fictional">Fictional</label><input type="radio" id="'+r+'_both" name="'+r+'_type_certainty" value="both" /><label for="'+r+'_both">Both</label></div><div id="'+r+'_role" data-transform="accordion"><h3>Add role (optional)</h3><div><select data-type="select" data-mapping="role"></select></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"person",title:"Tag Person"}),l=[{code:"",title:"(none)"},{code:"abr",title:"Abridger"},{code:"acp",title:"Art copyist"},{code:"act",title:"Actor"},{code:"adi",title:"Art director"},{code:"adp",title:"Adapter"},{code:"aft",title:"Author of afterword, colophon, etc."},{code:"anl",title:"Analyst"},{code:"anm",title:"Animator"},{code:"ann",title:"Annotator"},{code:"ant",title:"Bibliographic antecedent"},{code:"ape",title:"Appellee"},{code:"apl",title:"Appellant"},{code:"app",title:"Applicant"},{code:"aqt",title:"Author in quotations or text abstracts"},{code:"arc",title:"Architect"},{code:"ard",title:"Artistic director"},{code:"arr",title:"Arranger"},{code:"art",title:"Artist"},{code:"asg",title:"Assignee"},{code:"asn",title:"Associated name"},{code:"ato",title:"Autographer"},{code:"att",title:"Attributed name"},{code:"auc",title:"Auctioneer"},{code:"aud",title:"Author of dialog"},{code:"aui",title:"Author of introduction, etc."},{code:"aus",title:"Screenwriter"},{code:"aut",title:"Author"},{code:"bdd",title:"Binding designer"},{code:"bjd",title:"Bookjacket designer"},{code:"bkd",title:"Book designer"},{code:"bkp",title:"Book producer"},{code:"blw",title:"Blurb writer"},{code:"bnd",title:"Binder"},{code:"bpd",title:"Bookplate designer"},{code:"brd",title:"Broadcaster"},{code:"brl",title:"Braille embosser"},{code:"bsl",title:"Bookseller"},{code:"cas",title:"Caster"},{code:"ccp",title:"Conceptor"},{code:"chr",title:"Choreographer"},{code:"cli",title:"Client"},{code:"cll",title:"Calligrapher"},{code:"clr",title:"Colorist"},{code:"clt",title:"Collotyper"},{code:"cmm",title:"Commentator"},{code:"cmp",title:"Composer"},{code:"cmt",title:"Compositor"},{code:"cnd",title:"Conductor"},{code:"cng",title:"Cinematographer"},{code:"cns",title:"Censor"},{code:"coe",title:"Contestant-appellee"},{code:"col",title:"Collector"},{code:"com",title:"Compiler"},{code:"con",title:"Conservator"},{code:"cor",title:"Collection registrar"},{code:"cos",title:"Contestant"},{code:"cot",title:"Contestant-appellant"},{code:"cou",title:"Court governed"},{code:"cov",title:"Cover designer"},{code:"cpc",title:"Copyright claimant"},{code:"cpe",title:"Complainant-appellee"},{code:"cph",title:"Copyright holder"},{code:"cpl",title:"Complainant"},{code:"cpt",title:"Complainant-appellant"},{code:"cre",title:"Creator"},{code:"crp",title:"Correspondent"},{code:"crr",title:"Corrector"},{code:"crt",title:"Court reporter"},{code:"csl",title:"Consultant"},{code:"csp",title:"Consultant to a project"},{code:"cst",title:"Costume designer"},{code:"ctb",title:"Contributor"},{code:"cte",title:"Contestee-appellee"},{code:"ctg",title:"Cartographer"},{code:"ctr",title:"Contractor"},{code:"cts",title:"Contestee"},{code:"ctt",title:"Contestee-appellant"},{code:"cur",title:"Curator"},{code:"cwt",title:"Commentator for written text"},{code:"dbp",title:"Distribution place"},{code:"dfd",title:"Defendant"},{code:"dfe",title:"Defendant-appellee"},{code:"dft",title:"Defendant-appellant"},{code:"dgg",title:"Degree granting institution"},{code:"dis",title:"Dissertant"},{code:"dln",title:"Delineator"},{code:"dnc",title:"Dancer"},{code:"dnr",title:"Donor"},{code:"dpc",title:"Depicted"},{code:"dpt",title:"Depositor"},{code:"drm",title:"Draftsman"},{code:"drt",title:"Director"},{code:"dsr",title:"Designer"},{code:"dst",title:"Distributor"},{code:"dtc",title:"Data contributor"},{code:"dte",title:"Dedicatee"},{code:"dtm",title:"Data manager"},{code:"dto",title:"Dedicator"},{code:"dub",title:"Dubious author"},{code:"edc",title:"Editor of compilation"},{code:"edm",title:"Editor of moving image work"},{code:"edt",title:"Editor"},{code:"egr",title:"Engraver"},{code:"elg",title:"Electrician"},{code:"elt",title:"Electrotyper"},{code:"eng",title:"Engineer"},{code:"enj",title:"Enacting jurisdiction"},{code:"etr",title:"Etcher"},{code:"evp",title:"Event place"},{code:"exp",title:"Expert"},{code:"fac",title:"Facsimilist"},{code:"fds",title:"Film distributor"},{code:"fld",title:"Field director"},{code:"flm",title:"Film editor"},{code:"fmd",title:"Film director"},{code:"fmk",title:"Filmmaker"},{code:"fmo",title:"Former owner"},{code:"fmp",title:"Film producer"},{code:"fnd",title:"Funder"},{code:"fpy",title:"First party"},{code:"frg",title:"Forger"},{code:"gis",title:"Geographic information specialist"},{code:"his",title:"Host institution"},{code:"hnr",title:"Honoree"},{code:"hst",title:"Host"},{code:"ill",title:"Illustrator"},{code:"ilu",title:"Illuminator"},{code:"ins",title:"Inscriber"},{code:"itr",title:"Instrumentalist"},{code:"ive",title:"Interviewee"},{code:"ivr",title:"Interviewer"},{code:"inv",title:"Inventor"},{code:"isb",title:"Issuing body"},{code:"jud",title:"Judge"},{code:"jug",title:"Jurisdiction governed"},{code:"lbr",title:"Laboratory"},{code:"lbt",title:"Librettist"},{code:"ldr",title:"Laboratory director"},{code:"led",title:"Lead"},{code:"lee",title:"Libelee-appellee"},{code:"lel",title:"Libelee"},{code:"len",title:"Lender"},{code:"let",title:"Libelee-appellant"},{code:"lgd",title:"Lighting designer"},{code:"lie",title:"Libelant-appellee"},{code:"lil",title:"Libelant"},{code:"lit",title:"Libelant-appellant"},{code:"lsa",title:"Landscape architect"},{code:"lse",title:"Licensee"},{code:"lso",title:"Licensor"},{code:"ltg",title:"Lithographer"},{code:"lyr",title:"Lyricist"},{code:"mcp",title:"Music copyist"},{code:"mdc",title:"Metadata contact"},{code:"mfp",title:"Manufacture place"},{code:"mfr",title:"Manufacturer"},{code:"mod",title:"Moderator"},{code:"mon",title:"Monitor"},{code:"mrb",title:"Marbler"},{code:"mrk",title:"Markup editor"},{code:"msd",title:"Musical director"},{code:"mte",title:"Metal-engraver"},{code:"mus",title:"Musician"},{code:"nrt",title:"Narrator"},{code:"opn",title:"Opponent"},{code:"org",title:"Originator"},{code:"orm",title:"Organizer of meeting"},{code:"osp",title:"Onscreen presenter"},{code:"oth",title:"Other"},{code:"own",title:"Owner"},{code:"pan",title:"Panelist"},{code:"pat",title:"Patron"},{code:"pbd",title:"Publishing director"},{code:"pbl",title:"Publisher"},{code:"pdr",title:"Project director"},{code:"pfr",title:"Proofreader"},{code:"pht",title:"Photographer"},{code:"plt",title:"Platemaker"},{code:"pma",title:"Permitting agency"},{code:"pmn",title:"Production manager"},{code:"pop",title:"Printer of plates"},{code:"ppm",title:"Papermaker"},{code:"ppt",title:"Puppeteer"},{code:"pra",title:"Praeses"},{code:"prc",title:"Process contact"},{code:"prd",title:"Production personnel"},{code:"pre",title:"Presenter"},{code:"prf",title:"Performer"},{code:"prg",title:"Programmer"},{code:"prm",title:"Printmaker"},{code:"prn",title:"Production company"},{code:"pro",title:"Producer"},{code:"prp",title:"Production place"},{code:"prs",title:"Production designer"},{code:"prt",title:"Printer"},{code:"prv",title:"Provider"},{code:"pta",title:"Patent applicant"},{code:"pte",title:"Plaintiff-appellee"},{code:"ptf",title:"Plaintiff"},{code:"pth",title:"Patent holder"},{code:"ptt",title:"Plaintiff-appellant"},{code:"pup",title:"Publication place"},{code:"rbr",title:"Rubricator"},{code:"rce",title:"Recording engineer"},{code:"rcd",title:"Recordist"},{code:"rcp",title:"Addressee"},{code:"rdd",title:"Radio director"},{code:"red",title:"Redaktor"},{code:"ren",title:"Renderer"},{code:"res",title:"Researcher"},{code:"rev",title:"Reviewer"},{code:"rpc",title:"Radio producer"},{code:"rps",title:"Repository"},{code:"rpt",title:"Reporter"},{code:"rpy",title:"Responsible party"},{code:"rse",title:"Respondent-appellee"},{code:"rsg",title:"Restager"},{code:"rsp",title:"Respondent"},{code:"rsr",title:"Restorationist"},{code:"rst",title:"Respondent-appellant"},{code:"rth",title:"Research team head"},{code:"rtm",title:"Research team member"},{code:"sad",title:"Scientific advisor"},{code:"sce",title:"Scenarist"},{code:"scl",title:"Sculptor"},{code:"scr",title:"Scribe"},{code:"sds",title:"Sound designer"},{code:"sec",title:"Secretary"},{code:"sgd",title:"Stage director"},{code:"sgn",title:"Signer"},{code:"sht",title:"Supporting host"},{code:"sll",title:"Seller"},{code:"sng",title:"Singer"},{code:"spk",title:"Speaker"},{code:"spn",title:"Sponsor"},{code:"spy",title:"Second party"},{code:"std",title:"Set designer"},{code:"stg",title:"Setting"},{code:"stl",title:"Storyteller"},{code:"stm",title:"Stage manager"},{code:"stn",title:"Standards body"},{code:"str",title:"Stereotyper"},{code:"srv",title:"Surveyor"},{code:"tcd",title:"Technical director"},{code:"tch",title:"Teacher"},{code:"ths",title:"Thesis advisor"},{code:"tld",title:"Television director"},{code:"tlp",title:"Television producer"},{code:"trc",title:"Transcriber"},{code:"trl",title:"Translator"},{code:"tyd",title:"Type designer"},{code:"tyg",title:"Typographer"},{code:"uvp",title:"University place"},{code:"vdg",title:"Videographer"},{code:"wac",title:"Writer of added commentary"},{code:"wal",title:"Writer of added lyrics"},{code:"wam",title:"Writer of accompanying material"},{code:"wat",title:"Writer of added text"},{code:"wdc",title:"Woodcutter"},{code:"wde",title:"Wood engraver"},{code:"wit",title:"Witness"}],c="",d=0;d<l.length;d++){var u=l[d];c+='<option value="'+u.code+'">'+u.title+"</option>"}return i("#"+r+"_role select").html(c),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("placeForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div><p>Precision of location of place name:</p><div id="'+r+'_precision" data-transform="buttonset" data-type="radio" data-mapping="custom.precision"><input type="radio" id="'+r+'_p_high" name="'+r+'_detail_radio" value="high" /><label for="'+r+'_p_high">High</label><input type="radio" id="'+r+'_p_medium" name="'+r+'_detail_radio" value="medium" /><label for="'+r+'_p_medium">Medium</label><input type="radio" id="'+r+'_p_low" name="'+r+'_detail_radio" value="low" /><label for="'+r+'_p_low">Low</label><input type="radio" id="'+r+'_p_unknown" name="'+r+'_detail_radio" value="unknown" /><label for="'+r+'_p_unknown">Unknown</label></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"place",title:"Tag Place"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("titleForm_"),a=i('<div id="'+r+'Dialog" class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_level" data-type="radio" data-mapping="level"><p>This title is:</p><input type="radio" value="a" name="level" id="'+r+'_level_a"/><label for="'+r+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="m" name="level" id="'+r+'_level_m" data-default="true" /><label for="'+r+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="j" name="level" id="'+r+'_level_j"/><label for="'+r+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="s" name="level" id="'+r+'_level_s"/><label for="'+r+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="u" name="level" id="'+r+'_level_u"/><label for="'+r+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:630,height:660,type:"title",title:"Tag Title"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);n(47),t.exports=function(t,e){var n=t,r="$$$$OTHER$$$$",a=n.getUniqueId("rsForm_"),s=i('<div class="annotationDialog"><div id="'+a+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+a+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+a+'_high" name="'+a+'_id_certainty" value="high" data-default="true" /><label for="'+a+'_high">High</label><input type="radio" id="'+a+'_medium" name="'+a+'_id_certainty" value="medium" /><label for="'+a+'_medium">Medium</label><input type="radio" id="'+a+'_low" name="'+a+'_id_certainty" value="low" /><label for="'+a+'_low">Low</label><input type="radio" id="'+a+'_unknown" name="'+a+'_id_certainty" value="unknown" /><label for="'+a+'_unknown">Unknown</label></div><div><div class="type"><label>Type (optional):</label><select name="type" data-mapping="type" data-type="select" data-transform="selectmenu"></select></div><div style="margin-top: 5px;"><label>Other type:</label><input name="otherType" type="text" data-mapping="type" data-type="textbox" /></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+a+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),l=new o({writer:n,$el:s,type:"rs",title:"Tag Referencing String"}),c=["Award","BirthPosition","Certainty","Credential","EducationalAward","Ethnicity","Gender","GeographicHeritage","NationalHeritage","NationalIdentity","NaturalPerson","Occupation","PoliticalAffiliation","Precision","RaceColour","Religion","ReproductiveHistory","Role","Sexuality","SocialClass","TextLabels"],d="";return d+='<option value="">(none)</option>',d+='<option value="$$$$OTHER$$$$">Other (specify)</option>',c.forEach((function(t){d+='<option value="http://sparql.cwrc.ca/ontology/cwrc#'+t+'">'+t+"</option>"})),s.find("select[name=type]").html(d).selectmenu("refresh").on("selectmenuselect",(function(t,e){e.item.value===r?s.find("input[name=otherType]").parent().show():(s.find("input[name=otherType]").val(e.item.value).parent().hide(),i(this).trigger("change",{target:this}))})),s.find("select[name=type]").selectmenu("menuWidget").addClass("overflow").height("300px"),l.$el.on("beforeShow",(function(t,e){var n=e.entry,i="",o=!1;void 0!==n&&void 0!==n.getAttribute("type")&&(i=n.getAttribute("type"),o=-1===c.indexOf(i)),o?(s.find("select[name=type]").val(r).selectmenu("refresh"),s.find("input[name=otherType]").val(i).parent().show()):(s.find("select[name=type]").val(i),s.find("input[name=otherType]").val(i).parent().hide())})),l.$el.on("beforeSave",(function(t,e){""===l.currentData.attributes.type&&delete l.currentData.attributes.type})),{show:function(t){l.show(t)},destroy:function(){s.find("select[name=type]").selectmenu("destroy"),l.destroy()}}}},function(t,e,n){var i=n(377),o=n(378),r=n(379),a=n(380),s=n(381),l=n(60),c=n(382),d=n(383),u=n(384),p=n(385),f=n(386);t.exports={citation:i,correction:o,date:r,keyword:a,link:s,note:l,org:c,person:d,place:u,title:p,rs:f}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("citationForm_"),a=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+r+'_noteContent">Citation text</label><textarea id="'+r+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="citation" /></div>').appendTo(e),s=new o({writer:n,$el:a,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(t,e,n){n.mode===o.EDIT?(n.$el.find("label[for="+r+"_noteContent]").hide(),n.$el.find("#"+r+"_noteContent").hide()):(n.$el.find("label[for="+r+"_noteContent]").show(),n.$el.find("#"+r+"_noteContent").show())})),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("corrForm_"),a=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="custom.corrText"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:385,height:400,type:"correction",title:"Tag Correction"});return s.$el.on("beforeShow",(function(t,e,i){var r;i.mode===o.ADD?r=n.editor.currentBookmark.rng.toString():void 0===(r=e.entry.getCustomValue("sicText"))&&a.find("textarea").val(e.entry.getContent()),void 0!==r&&""!==r&&(i.currentData.customValues.sicText=r)})),s.$el.on("beforeSave",(function(t,e){var r=e.currentData.customValues.sicText,a=e.currentData.customValues.corrText;if(e.mode===o.EDIT){if(null==r){var s=n.entitiesManager.getCurrentEntity();i("#"+s,n.editor.getBody()).text(a),n.entitiesManager.getEntity(s).setContent(a)}}else if(void 0===r){var l=n.getUniqueId("temp"),c=i('<span id="'+l+'"/>',n.editor.getDoc()),d=n.editor.selection.getRng(!0);d.surroundContents(c[0]),c.html(a);var u=c[0].firstChild;i(u).unwrap(),d.selectNodeContents(u),n.editor.currentBookmark=n.editor.selection.getBookmark(1)}})),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(1);o.suppressDeprecationWarnings=!0;var r=n(7);n(59),n(15),t.exports=function(t,e){var n=t,a=(new Date).getFullYear()+10,s=n.getUniqueId("dateForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset"><p>Date type:</p><input type="radio" name="dateType" value="date" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="range" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="when" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="from" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="to" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+s+'_high" name="'+s+'_id_certainty" value="high" data-default="true" /><label for="'+s+'_high">High</label><input type="radio" id="'+s+'_medium" name="'+s+'_id_certainty" value="medium" /><label for="'+s+'_medium">Medium</label><input type="radio" id="'+s+'_low" name="'+s+'_id_certainty" value="low" /><label for="'+s+'_low">Low</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="unknown" /><label for="'+s+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),c=new r({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){g(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(e);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var f=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(t){var e=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),o=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,t,n.settings);f.not(this).datepicker("option",e,o)}}),g=function(t){d.val(""),u.val(""),p.val(""),"date"==t?(i("#"+s+"_date").show(),i("#"+s+"_range").hide()):(i("#"+s+"_date").hide(),i("#"+s+"_range").show())};return c.$el.on("beforeShow",(function(t,e){if(f.datepicker("option","minDate",new Date(1800,0,1)),f.datepicker("option","maxDate",new Date(a,11,31)),c.mode===r.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=o(h);if(m.isValid()){var v=m.toDate(),y=v.getFullYear();if(h.length>4){var b=v.getMonth();++b<10&&(b="0"+b);var w=v.getDate();w<10&&(w="0"+w),l=y+"-"+b+"-"+w}else l=++y}}g("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(l),u.val(""),p.val("")}else{var _=e.entry.getAttributes();void 0!==_.when?(g("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(_.when),u.val(""),p.val("")):(g("range"),i("#"+s+"_type_range").prop("checked",!0),d.val(""),u.val(_.from),p.val(_.to))}i("#"+s+"_type input").button("refresh"),d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(t,e){var n=!1;if("date"===i("#"+s+"_type input:checked").val()){var r=d.val();o(r).isValid()?e.currentData.attributes.when=r:(d.css({borderBottom:"1px solid red"}),n=!0)}else{var a=u.val(),l=p.val(),c=o(a),f=o(l);c.isValid()?e.currentData.attributes.from=a:(u.css({borderBottom:"1px solid red"}),n=!0),f.isValid()?e.currentData.attributes.to=l:(p.css({borderBottom:"1px solid red"}),n=!0),c.isAfter(f)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}e.isValid=!n})),{show:function(t){c.show(t)},destroy:function(){d.datepicker("destroy"),f.datepicker("destroy"),c.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=!1,a=n.getUniqueId("keywordForm_"),s=i('<div class="annotationDialog"><div><label for="'+a+'_noteContent">Keyword</label><input type="text" id="'+a+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="margin-right: 10px;"/><p>You will be able to edit the keyword in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+a+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="keyword" /></div>').appendTo(e),l=new o({writer:n,$el:s,type:"keyword",title:"Tag Keyword",height:420,width:420});return l.$el.on("beforeSave",(function(t,e){r||void 0!==e.currentData.attributes.ana?e.isValid=!0:(e.isValid=!1,n.dialogManager.confirm({title:"Warning",msg:'<p>A human-readable keyword is preferably linked, using the "ana" attribute, to a controlled vocabulary.</p><p>Click "Add Link" to add a URL for your term or "Skip Link" to save as is.</p>',yesText:"Skip Link",noText:"Add Link",showConfirmKey:"confirm-tei-keyword",type:"info",callback:function(t){setTimeout((function(){t&&(r=!0,e.save())}))}}))})),l.$el.on("beforeShow",(function(t,e){l.isValid=!0,r=!1,l.mode===o.ADD?(l.attributesWidget.setData({ana:""}),l.attributesWidget.expand(),l.$el.find("label[for="+a+"_noteContent]").show(),l.$el.find("#"+a+"_noteContent").show()):(l.$el.find("label[for="+a+"_noteContent]").hide(),l.$el.find("#"+a+"_noteContent").hide())})),{show:function(t){l.show(t)},destroy:function(){l.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);n(15),t.exports=function(t,e){var n=t,r=n.getUniqueId("linkForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="target" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:350,height:350,type:"link",title:"Tag Link"});return i("button",a).button().click((function(){var t=i("#"+r+"_input").val();if(""!=t){null==t.match(/^https?:\/\//)&&(t="http://"+t);try{window.open(t,"linkTestWindow")}catch(t){alert(t)}}})),{show:function(t){s.show(t)},destroy:function(){i("button",a).button("destroy"),s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("orgForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,height:550,type:"org",title:"Tag Organization"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){for(var n=t,r=n.getUniqueId("personForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div id="'+r+'_role" data-transform="accordion"><h3>Add role (optional)</h3><div><select data-type="select" data-mapping="role"></select></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"person",title:"Tag Person"}),l=[{code:"",title:"(none)"},{code:"abr",title:"Abridger"},{code:"acp",title:"Art copyist"},{code:"act",title:"Actor"},{code:"adi",title:"Art director"},{code:"adp",title:"Adapter"},{code:"aft",title:"Author of afterword, colophon, etc."},{code:"anl",title:"Analyst"},{code:"anm",title:"Animator"},{code:"ann",title:"Annotator"},{code:"ant",title:"Bibliographic antecedent"},{code:"ape",title:"Appellee"},{code:"apl",title:"Appellant"},{code:"app",title:"Applicant"},{code:"aqt",title:"Author in quotations or text abstracts"},{code:"arc",title:"Architect"},{code:"ard",title:"Artistic director"},{code:"arr",title:"Arranger"},{code:"art",title:"Artist"},{code:"asg",title:"Assignee"},{code:"asn",title:"Associated name"},{code:"ato",title:"Autographer"},{code:"att",title:"Attributed name"},{code:"auc",title:"Auctioneer"},{code:"aud",title:"Author of dialog"},{code:"aui",title:"Author of introduction, etc."},{code:"aus",title:"Screenwriter"},{code:"aut",title:"Author"},{code:"bdd",title:"Binding designer"},{code:"bjd",title:"Bookjacket designer"},{code:"bkd",title:"Book designer"},{code:"bkp",title:"Book producer"},{code:"blw",title:"Blurb writer"},{code:"bnd",title:"Binder"},{code:"bpd",title:"Bookplate designer"},{code:"brd",title:"Broadcaster"},{code:"brl",title:"Braille embosser"},{code:"bsl",title:"Bookseller"},{code:"cas",title:"Caster"},{code:"ccp",title:"Conceptor"},{code:"chr",title:"Choreographer"},{code:"cli",title:"Client"},{code:"cll",title:"Calligrapher"},{code:"clr",title:"Colorist"},{code:"clt",title:"Collotyper"},{code:"cmm",title:"Commentator"},{code:"cmp",title:"Composer"},{code:"cmt",title:"Compositor"},{code:"cnd",title:"Conductor"},{code:"cng",title:"Cinematographer"},{code:"cns",title:"Censor"},{code:"coe",title:"Contestant-appellee"},{code:"col",title:"Collector"},{code:"com",title:"Compiler"},{code:"con",title:"Conservator"},{code:"cor",title:"Collection registrar"},{code:"cos",title:"Contestant"},{code:"cot",title:"Contestant-appellant"},{code:"cou",title:"Court governed"},{code:"cov",title:"Cover designer"},{code:"cpc",title:"Copyright claimant"},{code:"cpe",title:"Complainant-appellee"},{code:"cph",title:"Copyright holder"},{code:"cpl",title:"Complainant"},{code:"cpt",title:"Complainant-appellant"},{code:"cre",title:"Creator"},{code:"crp",title:"Correspondent"},{code:"crr",title:"Corrector"},{code:"crt",title:"Court reporter"},{code:"csl",title:"Consultant"},{code:"csp",title:"Consultant to a project"},{code:"cst",title:"Costume designer"},{code:"ctb",title:"Contributor"},{code:"cte",title:"Contestee-appellee"},{code:"ctg",title:"Cartographer"},{code:"ctr",title:"Contractor"},{code:"cts",title:"Contestee"},{code:"ctt",title:"Contestee-appellant"},{code:"cur",title:"Curator"},{code:"cwt",title:"Commentator for written text"},{code:"dbp",title:"Distribution place"},{code:"dfd",title:"Defendant"},{code:"dfe",title:"Defendant-appellee"},{code:"dft",title:"Defendant-appellant"},{code:"dgg",title:"Degree granting institution"},{code:"dis",title:"Dissertant"},{code:"dln",title:"Delineator"},{code:"dnc",title:"Dancer"},{code:"dnr",title:"Donor"},{code:"dpc",title:"Depicted"},{code:"dpt",title:"Depositor"},{code:"drm",title:"Draftsman"},{code:"drt",title:"Director"},{code:"dsr",title:"Designer"},{code:"dst",title:"Distributor"},{code:"dtc",title:"Data contributor"},{code:"dte",title:"Dedicatee"},{code:"dtm",title:"Data manager"},{code:"dto",title:"Dedicator"},{code:"dub",title:"Dubious author"},{code:"edc",title:"Editor of compilation"},{code:"edm",title:"Editor of moving image work"},{code:"edt",title:"Editor"},{code:"egr",title:"Engraver"},{code:"elg",title:"Electrician"},{code:"elt",title:"Electrotyper"},{code:"eng",title:"Engineer"},{code:"enj",title:"Enacting jurisdiction"},{code:"etr",title:"Etcher"},{code:"evp",title:"Event place"},{code:"exp",title:"Expert"},{code:"fac",title:"Facsimilist"},{code:"fds",title:"Film distributor"},{code:"fld",title:"Field director"},{code:"flm",title:"Film editor"},{code:"fmd",title:"Film director"},{code:"fmk",title:"Filmmaker"},{code:"fmo",title:"Former owner"},{code:"fmp",title:"Film producer"},{code:"fnd",title:"Funder"},{code:"fpy",title:"First party"},{code:"frg",title:"Forger"},{code:"gis",title:"Geographic information specialist"},{code:"his",title:"Host institution"},{code:"hnr",title:"Honoree"},{code:"hst",title:"Host"},{code:"ill",title:"Illustrator"},{code:"ilu",title:"Illuminator"},{code:"ins",title:"Inscriber"},{code:"itr",title:"Instrumentalist"},{code:"ive",title:"Interviewee"},{code:"ivr",title:"Interviewer"},{code:"inv",title:"Inventor"},{code:"isb",title:"Issuing body"},{code:"jud",title:"Judge"},{code:"jug",title:"Jurisdiction governed"},{code:"lbr",title:"Laboratory"},{code:"lbt",title:"Librettist"},{code:"ldr",title:"Laboratory director"},{code:"led",title:"Lead"},{code:"lee",title:"Libelee-appellee"},{code:"lel",title:"Libelee"},{code:"len",title:"Lender"},{code:"let",title:"Libelee-appellant"},{code:"lgd",title:"Lighting designer"},{code:"lie",title:"Libelant-appellee"},{code:"lil",title:"Libelant"},{code:"lit",title:"Libelant-appellant"},{code:"lsa",title:"Landscape architect"},{code:"lse",title:"Licensee"},{code:"lso",title:"Licensor"},{code:"ltg",title:"Lithographer"},{code:"lyr",title:"Lyricist"},{code:"mcp",title:"Music copyist"},{code:"mdc",title:"Metadata contact"},{code:"mfp",title:"Manufacture place"},{code:"mfr",title:"Manufacturer"},{code:"mod",title:"Moderator"},{code:"mon",title:"Monitor"},{code:"mrb",title:"Marbler"},{code:"mrk",title:"Markup editor"},{code:"msd",title:"Musical director"},{code:"mte",title:"Metal-engraver"},{code:"mus",title:"Musician"},{code:"nrt",title:"Narrator"},{code:"opn",title:"Opponent"},{code:"org",title:"Originator"},{code:"orm",title:"Organizer of meeting"},{code:"osp",title:"Onscreen presenter"},{code:"oth",title:"Other"},{code:"own",title:"Owner"},{code:"pan",title:"Panelist"},{code:"pat",title:"Patron"},{code:"pbd",title:"Publishing director"},{code:"pbl",title:"Publisher"},{code:"pdr",title:"Project director"},{code:"pfr",title:"Proofreader"},{code:"pht",title:"Photographer"},{code:"plt",title:"Platemaker"},{code:"pma",title:"Permitting agency"},{code:"pmn",title:"Production manager"},{code:"pop",title:"Printer of plates"},{code:"ppm",title:"Papermaker"},{code:"ppt",title:"Puppeteer"},{code:"pra",title:"Praeses"},{code:"prc",title:"Process contact"},{code:"prd",title:"Production personnel"},{code:"pre",title:"Presenter"},{code:"prf",title:"Performer"},{code:"prg",title:"Programmer"},{code:"prm",title:"Printmaker"},{code:"prn",title:"Production company"},{code:"pro",title:"Producer"},{code:"prp",title:"Production place"},{code:"prs",title:"Production designer"},{code:"prt",title:"Printer"},{code:"prv",title:"Provider"},{code:"pta",title:"Patent applicant"},{code:"pte",title:"Plaintiff-appellee"},{code:"ptf",title:"Plaintiff"},{code:"pth",title:"Patent holder"},{code:"ptt",title:"Plaintiff-appellant"},{code:"pup",title:"Publication place"},{code:"rbr",title:"Rubricator"},{code:"rce",title:"Recording engineer"},{code:"rcd",title:"Recordist"},{code:"rcp",title:"Addressee"},{code:"rdd",title:"Radio director"},{code:"red",title:"Redaktor"},{code:"ren",title:"Renderer"},{code:"res",title:"Researcher"},{code:"rev",title:"Reviewer"},{code:"rpc",title:"Radio producer"},{code:"rps",title:"Repository"},{code:"rpt",title:"Reporter"},{code:"rpy",title:"Responsible party"},{code:"rse",title:"Respondent-appellee"},{code:"rsg",title:"Restager"},{code:"rsp",title:"Respondent"},{code:"rsr",title:"Restorationist"},{code:"rst",title:"Respondent-appellant"},{code:"rth",title:"Research team head"},{code:"rtm",title:"Research team member"},{code:"sad",title:"Scientific advisor"},{code:"sce",title:"Scenarist"},{code:"scl",title:"Sculptor"},{code:"scr",title:"Scribe"},{code:"sds",title:"Sound designer"},{code:"sec",title:"Secretary"},{code:"sgd",title:"Stage director"},{code:"sgn",title:"Signer"},{code:"sht",title:"Supporting host"},{code:"sll",title:"Seller"},{code:"sng",title:"Singer"},{code:"spk",title:"Speaker"},{code:"spn",title:"Sponsor"},{code:"spy",title:"Second party"},{code:"std",title:"Set designer"},{code:"stg",title:"Setting"},{code:"stl",title:"Storyteller"},{code:"stm",title:"Stage manager"},{code:"stn",title:"Standards body"},{code:"str",title:"Stereotyper"},{code:"srv",title:"Surveyor"},{code:"tcd",title:"Technical director"},{code:"tch",title:"Teacher"},{code:"ths",title:"Thesis advisor"},{code:"tld",title:"Television director"},{code:"tlp",title:"Television producer"},{code:"trc",title:"Transcriber"},{code:"trl",title:"Translator"},{code:"tyd",title:"Type designer"},{code:"tyg",title:"Typographer"},{code:"uvp",title:"University place"},{code:"vdg",title:"Videographer"},{code:"wac",title:"Writer of added commentary"},{code:"wal",title:"Writer of added lyrics"},{code:"wam",title:"Writer of accompanying material"},{code:"wat",title:"Writer of added text"},{code:"wdc",title:"Woodcutter"},{code:"wde",title:"Wood engraver"},{code:"wit",title:"Witness"}],c="",d=0;d<l.length;d++){var u=l[d];c+='<option value="'+u.code+'">'+u.title+"</option>"}return i("#"+r+"_role select").html(c),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("placeForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"place",title:"Tag Place"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("titleForm_"),a=i('<div id="'+r+'Dialog" class="annotationDialog"><div id="'+r+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+r+'_level" data-type="radio" data-mapping="level"><p>This title is:</p><input type="radio" value="a" name="level" id="'+r+'_level_a"/><label for="'+r+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="m" name="level" id="'+r+'_level_m" data-default="true" /><label for="'+r+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="j" name="level" id="'+r+'_level_j"/><label for="'+r+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="s" name="level" id="'+r+'_level_s"/><label for="'+r+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="u" name="level" id="'+r+'_level_u"/><label for="'+r+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+r+'_high" name="'+r+'_id_certainty" value="high" data-default="true" /><label for="'+r+'_high">High</label><input type="radio" id="'+r+'_medium" name="'+r+'_id_certainty" value="medium" /><label for="'+r+'_medium">Medium</label><input type="radio" id="'+r+'_low" name="'+r+'_id_certainty" value="low" /><label for="'+r+'_low">Low</label><input type="radio" id="'+r+'_unknown" name="'+r+'_id_certainty" value="unknown" /><label for="'+r+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:630,height:660,type:"title",title:"Tag Title"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);n(47),t.exports=function(t,e){var n=t,r="$$$$OTHER$$$$",a=n.getUniqueId("rsForm_"),s=i('<div class="annotationDialog"><div id="'+a+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+a+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+a+'_high" name="'+a+'_id_certainty" value="high" data-default="true" /><label for="'+a+'_high">High</label><input type="radio" id="'+a+'_medium" name="'+a+'_id_certainty" value="medium" /><label for="'+a+'_medium">Medium</label><input type="radio" id="'+a+'_low" name="'+a+'_id_certainty" value="low" /><label for="'+a+'_low">Low</label><input type="radio" id="'+a+'_unknown" name="'+a+'_id_certainty" value="unknown" /><label for="'+a+'_unknown">Unknown</label></div><div><div class="type"><label>Type (optional):</label><select name="type" data-mapping="type" data-type="select" data-transform="selectmenu"></select></div><div style="margin-top: 5px;"><label>Other type:</label><input name="otherType" type="text" data-mapping="type" data-type="textbox" /></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+a+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),l=new o({writer:n,$el:s,type:"rs",title:"Tag Referencing String"}),c=["Award","BirthPosition","Certainty","Credential","EducationalAward","Ethnicity","Gender","GeographicHeritage","NationalHeritage","NationalIdentity","NaturalPerson","Occupation","PoliticalAffiliation","Precision","RaceColour","Religion","ReproductiveHistory","Role","Sexuality","SocialClass","TextLabels"],d="";return d+='<option value="">(none)</option>',d+='<option value="$$$$OTHER$$$$">Other (specify)</option>',c.forEach((function(t){d+='<option value="http://sparql.cwrc.ca/ontology/cwrc#'+t+'">'+t+"</option>"})),s.find("select[name=type]").html(d).selectmenu("refresh").on("selectmenuselect",(function(t,e){e.item.value===r?s.find("input[name=otherType]").parent().show():(s.find("input[name=otherType]").val(e.item.value).parent().hide(),i(this).trigger("change",{target:this}))})),s.find("select[name=type]").selectmenu("menuWidget").addClass("overflow").height("300px"),l.$el.on("beforeShow",(function(t,e){var n=e.entry,i="",o=!1;void 0!==n&&void 0!==n.getAttribute("type")&&(i=n.getAttribute("type"),o=-1===c.indexOf(i)),o?(s.find("select[name=type]").val(r).selectmenu("refresh"),s.find("input[name=otherType]").val(i).parent().show()):(s.find("select[name=type]").val(i),s.find("input[name=otherType]").val(i).parent().hide())})),l.$el.on("beforeSave",(function(t,e){""===l.currentData.attributes.type&&delete l.currentData.attributes.type})),{show:function(t){l.show(t)},destroy:function(){s.find("select[name=type]").selectmenu("destroy"),l.destroy()}}}},function(t,e,n){var i=n(388),o=n(389),r=n(390),a=n(391),s=n(392),l=n(60),c=n(393),d=n(394),u=n(395),p=n(396);t.exports={citation:i,correction:o,date:r,keyword:a,link:s,note:l,org:c,person:d,place:u,title:p}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("citationForm_"),a=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+r+'_noteContent">Citation text</label><textarea id="'+r+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(t,e,n){i("#"+r+"_type").val("citation"),n.mode===o.EDIT?(n.$el.find("label[for="+r+"_noteContent]").hide(),n.$el.find("#"+r+"_noteContent").hide()):(n.$el.find("label[for="+r+"_noteContent]").show(),n.$el.find("#"+r+"_noteContent").show())})),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("corrForm_"),a=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="CORR"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:385,height:400,type:"correction",title:"Tag Correction"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(1),r=n(7);n(15),n(59),t.exports=function(t,e){var n=t,a=(new Date).getFullYear()+10,s=n.getUniqueId("dateForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset" data-type="radio" data-mapping="prop.tag"><p>Date type:</p><input type="radio" name="dateType" value="DATE" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="DATERANGE" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label><input type="radio" name="dateType" value="DATESTRUCT" id="'+s+'_type_season"/><label for="'+s+'_type_season">Season/Occasion</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="VALUE" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="FROM" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="TO" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="CERTAINTY"><p>Certainty:</p><input type="radio" id="'+s+'_cert" name="'+s+'_id_certainty" value="CERT" data-default="true" /><label for="'+s+'_cert">Certain</label><input type="radio" id="'+s+'_c" name="'+s+'_id_certainty" value="C" /><label for="'+s+'_c">Circa</label><input type="radio" id="'+s+'_by" name="'+s+'_id_certainty" value="BY" /><label for="'+s+'_by">By this date</label><input type="radio" id="'+s+'_after" name="'+s+'_id_certainty" value="AFTER" /><label for="'+s+'_after">After this date</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="UNKNOWN" /><label for="'+s+'_unknown">Unknown date</label><input type="radio" id="'+s+'_rough" name="'+s+'_id_certainty" value="ROUGHLYDATED" /><label for="'+s+'_rough">Rough certainty</label></div><div id="'+s+'_calendar" data-transform="buttonset" data-type="radio" data-mapping="CALENDAR"><p>Calendar type:</p><input type="radio" name="calendarType" value="NEWSTYLE" id="'+s+'_calendar_new" checked="checked"/><label for="'+s+'_calendar_new">New style</label><input type="radio" name="calendarType" value="BC" id="'+s+'_calendar_old"/><label for="'+s+'_calendar_old">BC</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),c=new r({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){g(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(e);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var f=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(t){var e=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),o=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,t,n.settings);f.not(this).datepicker("option",e,o),i(this).change()}}),g=function(t){i("#"+s+"_date").hide(),i("#"+s+"_range").hide(),d.val(""),u.val(""),p.val(""),"DATERANGE"===t?i("#"+s+"_range").show():i("#"+s+"_date").show();var e=n.schemaManager.getAttributesForTag(t);c.attributesWidget.buildWidget(e),c.attWidgetInit=!0,c.attributesWidget.reset()};return c.$el.on("beforeShow",(function(t,e){if(f.datepicker("option","minDate",new Date(1800,0,1)),f.datepicker("option","maxDate",new Date(a,11,31)),c.mode===r.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=o(h).toDate(),v=m.getFullYear();if(!isNaN(v))if(h.length>4){var y=m.getMonth();++y<10&&(y="0"+y);var b=m.getDate();b<10&&(b="0"+b),l=v+"-"+y+"-"+b}else l=++v}g("DATE"),i("#"+s+"_type_date").prop("checked",!0).button("refresh"),d.val(l),u.val(""),p.val("")}else{var w=e.entry.getAttributes(),_=e.entry.getTag();g(_),"DATERANGE"===_?(d.val(""),u.val(w.FROM),p.val(w.TO)):(d.val(w.VALUE),u.val(""),p.val(""))}d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(t,e){var n=!1;if("DATERANGE"===i("#"+s+"_type input:checked").val()){var r=u.val(),a=p.val(),l=o(r),c=o(a);l.isValid()?e.currentData.attributes.FROM=r:(u.css({borderBottom:"1px solid red"}),n=!0),c.isValid()?e.currentData.attributes.TO=a:(p.css({borderBottom:"1px solid red"}),n=!0),l.isAfter(c)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}else{var f=d.val();o(f).isValid()?e.currentData.attributes.VALUE=f:(d.css({borderBottom:"1px solid red"}),n=!0)}e.isValid=!n})),{show:function(t){c.show(t)},destroy:function(){d.datepicker("destroy"),f.datepicker("destroy"),c.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("keywordForm_"),a=i('<div class="annotationDialog"><div><input type="text" data-type="textbox" data-mapping="KEYWORDTYPE" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"keyword",title:"Tag Keyword",height:350,width:350});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);n(15),t.exports=function(t,e){var n=t,r=n.getUniqueId("linkForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="URL" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:350,height:350,type:"link",title:"Tag Link"});return i("button",a).button().click((function(){var t=i("#"+r+"_input").val();if(""!=t){null==t.match(/^https?:\/\//)&&(t="http://"+t);try{window.open(t,"linkTestWindow")}catch(t){alert(t)}}})),{show:function(t){s.show(t)},destroy:function(){i("button",a).button("destroy"),s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("orgForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Standard name</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,height:450,type:"org",title:"Tag Organization"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("noteForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Standard name</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"person",title:"Tag Person",height:400});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("placeForm_"),a=i('<div class="annotationDialog"><div id="'+r+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="custom.placeType"><p>Type of place:</p><input type="radio" id="'+r+'_address" name="'+r+'_type_place" value="ADDRESS" data-default="true" /><label for="'+r+'_address">Address</label><input type="radio" id="'+r+'_area" name="'+r+'_type_place" value="AREA" /><label for="'+r+'_area">Area</label><input type="radio" id="'+r+'_geog" name="'+r+'_type_place" value="GEOG" /><label for="'+r+'_geog">Geog</label><input type="radio" id="'+r+'_placename" name="'+r+'_type_place" value="PLACENAME" /><label for="'+r+'_placename">Placename</label><input type="radio" id="'+r+'_region" name="'+r+'_type_place" value="REGION" /><label for="'+r+'_region">Region</label><input type="radio" id="'+r+'_settlement" name="'+r+'_type_place" value="SETTLEMENT" /><label for="'+r+'_settlement">Settlement</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"place",title:"Tag Place",width:650,height:450});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("noteForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Standard name</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div id="'+r+'_level" data-type="radio" data-mapping="TITLETYPE"><p>This title is:</p><input type="radio" value="ANALYTIC" name="'+r+'_level" id="'+r+'_level_a"/><label for="'+r+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="MONOGRAPHIC" name="'+r+'_level" id="'+r+'_level_m" data-default="true" /><label for="'+r+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="JOURNAL" name="'+r+'_level" id="'+r+'_level_j"/><label for="'+r+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="SERIES" name="'+r+'_level" id="'+r+'_level_s"/><label for="'+r+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="UNPUBLISHED" name="'+r+'_level" id="'+r+'_level_u"/><label for="'+r+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:430,height:490,type:"title",title:"Tag Title"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(398),o=n(399),r=n(400),a=n(401),s=n(402),l=n(60),c=n(403),d=n(404),u=n(405),p=n(406);t.exports={citation:i,correction:o,date:r,keyword:a,link:s,note:l,org:c,person:d,place:u,title:p}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("citationForm_"),a=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+r+'_noteContent">Citation text</label><textarea id="'+r+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(t,e,n){i("#"+r+"_type").val("citation"),n.mode===o.EDIT?(n.$el.find("label[for="+r+"_noteContent]").hide(),n.$el.find("#"+r+"_noteContent").hide()):(n.$el.find("label[for="+r+"_noteContent]").show(),n.$el.find("#"+r+"_noteContent").show())})),{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("corrForm_"),a=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="CORR"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:385,height:400,type:"correction",title:"Tag Correction"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(1),r=n(7);n(15),n(59),t.exports=function(t,e){var n=t,a=(new Date).getFullYear()+10,s=n.getUniqueId("citationForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset" data-type="radio" data-mapping="prop.tag"><p>Date type:</p><input type="radio" name="dateType" value="DATE" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="DATERANGE" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="VALUE" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="FROM" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="TO" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="CERTAINTY"><p>Certainty:</p><input type="radio" id="'+s+'_cert" name="'+s+'_id_certainty" value="CERT" data-default="true" /><label for="'+s+'_cert">Certain</label><input type="radio" id="'+s+'_c" name="'+s+'_id_certainty" value="C" /><label for="'+s+'_c">Circa</label><input type="radio" id="'+s+'_by" name="'+s+'_id_certainty" value="BY" /><label for="'+s+'_by">By this date</label><input type="radio" id="'+s+'_after" name="'+s+'_id_certainty" value="AFTER" /><label for="'+s+'_after">After this date</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="UNKNOWN" /><label for="'+s+'_unknown">Unknown date</label><input type="radio" id="'+s+'_rough" name="'+s+'_id_certainty" value="ROUGHLYDATED" /><label for="'+s+'_rough">Rough certainty</label></div><div id="'+s+'_calendar" data-transform="buttonset" data-type="radio" data-mapping="CALENDAR"><p>Calendar type:</p><input type="radio" name="calendarType" value="NEWSTYLE" id="'+s+'_calendar_new" checked="checked"/><label for="'+s+'_calendar_new">New style</label><input type="radio" name="calendarType" value="BC" id="'+s+'_calendar_old"/><label for="'+s+'_calendar_old">BC</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),c=new r({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){g(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(e);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var f=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(a,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(t){var e=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),o=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,t,n.settings);f.not(this).datepicker("option",e,o),i(this).change()}}),g=function(t){i("#"+s+"_date").hide(),i("#"+s+"_range").hide(),d.val(""),u.val(""),p.val(""),"DATERANGE"===t?i("#"+s+"_range").show():i("#"+s+"_date").show();var e=n.schemaManager.getAttributesForTag(t);c.attributesWidget.buildWidget(e),c.attWidgetInit=!0,c.attributesWidget.reset()};return c.$el.on("beforeShow",(function(t,e){if(f.datepicker("option","minDate",new Date(1800,0,1)),f.datepicker("option","maxDate",new Date(a,11,31)),c.mode===r.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=o(h).toDate(),v=m.getFullYear();if(!isNaN(v))if(h.length>4){var y=m.getMonth();++y<10&&(y="0"+y);var b=m.getDate();b<10&&(b="0"+b),l=v+"-"+y+"-"+b}else l=++v}g("DATE"),i("#"+s+"_type_date").prop("checked",!0).button("refresh"),d.val(l),u.val(""),p.val("")}else{var w=e.entry.getAttributes(),_=e.entry.getTag();g(_),"DATERANGE"===_?(d.val(""),u.val(w.FROM),p.val(w.TO)):(d.val(w.VALUE),u.val(""),p.val(""))}d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(t,e){var n=!1;if("DATERANGE"===i("#"+s+"_type input:checked").val()){var r=u.val(),a=p.val(),l=o(r),c=o(a);l.isValid()?e.currentData.attributes.FROM=r:(u.css({borderBottom:"1px solid red"}),n=!0),c.isValid()?e.currentData.attributes.TO=a:(p.css({borderBottom:"1px solid red"}),n=!0),l.isAfter(c)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}else{var f=d.val();o(f).isValid()?e.currentData.attributes.VALUE=f:(d.css({borderBottom:"1px solid red"}),n=!0)}e.isValid=!n})),{show:function(t){c.show(t)},destroy:function(){d.datepicker("destroy"),f.datepicker("destroy"),c.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("citationForm_"),a=i('<div class="annotationDialog"><div><input type="text" data-type="textbox" data-mapping="KEYWORDTYPE" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"keyword",title:"Tag Keyword",height:350,width:350});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);n(15),t.exports=function(t,e){var n=t,r=n.getUniqueId("citationForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="URL" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:350,height:350,type:"link",title:"Tag Link"});return i("button",a).button().click((function(){var t=i("#"+r+"_input").val();if(""!=t){null==t.match(/^https?:\/\//)&&(t="http://"+t);try{window.open(t,"linkTestWindow")}catch(t){alert(t)}}})),{show:function(t){s.show(t)},destroy:function(){i("button",a).button("destroy"),s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("orgForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Standard name</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div><p>Organization type:</p><select data-type="select" data-mapping="ORGTYPE"><option value=""></option><option value="labour">labour</option><option value="club or society">club or society</option><option value="political">political</option><option value="academic">academic</option><option value="research">research</option><option value="corporate">corporate</option><option value="activist">activist</option><option value="governmental">governmental</option><option value="military">military</option><option value="law-enforcement">law-enforcement</option><option value="professional">professional</option><option value="sporting">sporting</option><option value="medical">medical</option><option value="altruistic">altruistic</option><option value="non-profit">non-profit</option><option value="artistic">artistic</option><option value="dramatic">dramatic</option><option value="ethnic">ethnic</option><option value="literary">literary</option><option value="musical">musical</option><option value="religious">religious</option><option value="publishing">publishing</option><option value="school">school</option></select></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,height:500,type:"org",title:"Tag Organization"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("noteForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Standard name</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"person",title:"Tag Person"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("noteForm_"),a=i('<div class="annotationDialog"><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,type:"place",title:"Tag Place"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){var i=n(3),o=n(7);t.exports=function(t,e){var n=t,r=n.getUniqueId("noteForm_"),a=i('<div class="annotationDialog"><div><label for="'+r+'_input">Standard name</label><input type="text" id="'+r+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div id="'+r+'_level" data-type="radio" data-mapping="LEVEL"><p>This title is:</p><input type="radio" value="ANALYTIC" name="'+r+'_level" id="'+r+'_level_a"/><label for="'+r+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="MONOGRAPHIC" name="'+r+'_level" id="'+r+'_level_m" data-default="true" /><label for="'+r+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="JOURNAL" name="'+r+'_level" id="'+r+'_level_j"/><label for="'+r+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="SERIES" name="'+r+'_level" id="'+r+'_level_s"/><label for="'+r+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="UNPUBLISHED" name="'+r+'_level" id="'+r+'_level_u"/><label for="'+r+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(e),s=new o({writer:n,$el:a,width:430,height:500,type:"title",title:"Tag Title"});return{show:function(t){s.show(t)},destroy:function(){s.destroy()}}}},function(t,e,n){"use strict";var i=n(3),o=n(45);function r(t){this.w=t,this.reset(),this.w.event("processingDocument").subscribe(function(){this.reset()}.bind(this)),this.w.event("entityAdded").subscribe(function(t){}.bind(this)),this.w.event("entityEdited").subscribe(function(t){}.bind(this)),this.w.event("entityRemoved").subscribe(function(t){this.highlightEntity()}.bind(this)),this.w.event("entityPasted").subscribe(function(t){this.highlightEntity(t)}.bind(this))}r.prototype={constructor:r,addEntity:function(t,e){var n;"Entity"===t.constructor.name?n=t:(void 0===t.id&&(t.id=this.w.getUniqueId("dom_")),void 0===t.tag&&(t.tag=this.w.schemaManager.mapper.getParentTag(t.type)),n=new o(t));var i=this.w.schemaManager.mapper.getRequiredAttributes(t.type);for(var r in i)n.setAttribute(r,i[r]);return this.w.schemaManager.mapper.updatePropertiesFromAttributes(n),void 0!==e&&this.w.tagger.addEntityTag(n,e),void 0===n.getContent()&&n.setContent(this.getTextContentForEntity(n.id)),this.entities[n.id]=n,this.w.event("entityAdded").publish(n.id),n},editEntity:function(t,e){if(e.properties&&e.properties.type&&e.properties.type!==t.getType()){var n=this.w.schemaManager.mapper.getRequiredAttributes(t.getType());for(var i in n)t.removeAttribute(i)}if(t.setAttributes(e.attributes),void 0!==e.properties)for(var o in e.properties)t.setProperty(o,e.properties[o]);this.w.schemaManager.mapper.updatePropertiesFromAttributes(t);n=this.w.schemaManager.mapper.getRequiredAttributes(t.getType());for(var i in n)t.setAttribute(i,n[i]);for(var o in e.customValues)t.setCustomValue(o,e.customValues[o]);return t.setDateModified(),t.setDidUpdate(!0),t},removeEntity:function(t){void 0!==this.entities[t]&&(delete this.entities[t],this.w.event("entityRemoved").publish(t))},getEntity:function(t){return this.entities[t]},setEntity:function(t,e){e instanceof o?this.entities[t]=e:console.warn("entitiesManager: trying to set a non-Entity object.")},cloneEntity:function(t){var e=this.entities[t].clone();return e.id=this.w.getUniqueId("dom_"),e},getEntities:function(){return this.entities},getEntitiesArray:function(t){var e=[];if("cat"===(t=void 0===t?"seq":t)){var n=Object.values(this.entities),o={};for(var r in n.forEach((function(t){var e=t.getType();void 0===o[e]&&(o[e]=[]),o[e].push(t)})),o)for(var a=o[r],s=0;s<a.length;s++){var l=a[s];e.push(l)}}else if("alpha"===t)e=Object.values(this.entities).sort((function(t,e){var n=t.getTitle().charAt(0).toLowerCase(),i=e.getTitle().charAt(0).toLowerCase();return n<i?-1:n>i?1:0}));else{i("[_entity][class~=start]",this.w.editor.getBody()).each(function(t,n){var o=this.getEntity(i(n).attr("name"));void 0!==o&&e.push(o)}.bind(this))}return e},eachEntity:function(t){i.each(this.entities,t)},getCurrentEntity:function(){return this.currentEntity},setCurrentEntity:function(t){this.currentEntity=t},getTextContentForEntity:function(t){var e="";return i("[name="+t+"]",this.w.editor.getBody()).each((function(t,n){e+=n.textContent})),e},setURIForEntity:function(t,e){var n=this.getEntity(t);n.setURI(e);var i=this.w.schemaManager.mapper.getAttributeForProperty(n.getType(),"uri");i&&n.setAttribute(i,e)},setLemmaForEntity:function(t,e){var n=this.getEntity(t);n.setLemma(e);var i=this.w.schemaManager.mapper.getAttributeForProperty(n.getType(),"lemma");i&&n.setAttribute(i,e)},setCertaintyForEntity:function(t,e){var n=this.getEntity(t);n.setCertainty(e);var i=this.w.schemaManager.mapper.getAttributeForProperty(n.getType(),"certainty");i&&n.setAttribute(i,e)},removeHighlights:function(){var t=i(".entityHighlight",this.w.editor.getBody());0!==t.length&&t.each((function(t,e){var n=i(e);if(n.hasClass("noteWrapper"))n.removeClass("entityHighlight");else{var o=n.parent()[0];0!==n.contents().length?n.contents().unwrap():n.remove(),o.normalize()}})),null!==this.currentEntity&&this.w.event("entityUnfocused").publish(this.currentEntity)},highlightEntity:function(t,e,n){if(this.removeHighlights(),this.currentEntity=null,t){this.currentEntity=t;var o=i('[name="'+t+'"]',this.w.editor.getBody());if(o.length>0){var r=this.getEntity(t),a=r.getType(),s=this.w.editor.dom.createRng();if(this.w.editor.selection.setRng(s),r.isNote()?o.parent(".noteWrapper").removeClass("hide").addClass("entityHighlight"):(o.wrap('<span class="entityHighlight '+a+'"/>'),o.parents(".noteWrapper").removeClass("hide")),e?this.w.editor.selection.moveToBookmark(e):((s=this.w.editor.dom.createRng()).setStart(o[0],0),s.collapse(!0),this.w.editor.selection.setRng(s)),n){var l=o.offset().top;i(this.w.editor.getDoc().documentElement).scrollTop(l)}this.w.event("entityFocused").publish(t)}}},doEntitiesOverlap:function(){this.highlightEntity();var t=!1;return this.eachEntity(function(e,n){var i=this.w.editor.dom.select('[name="'+e+'"]');if(i.length>1){var o=i[0],r=i[i.length-1];if(o.parentNode!==r.parentNode)return t=!0,!1}}.bind(this)),t},removeOverlappingEntities:function(){this.highlightEntity(),this.eachEntity(function(t,e){var n=this.w.editor.dom.select('[name="'+t+'"]');if(n.length>1){var i=n[0],o=n[n.length-1];i.parentNode!==o.parentNode&&this.w.tagger.removeEntity(t)}}.bind(this))},convertBoundaryEntitiesToTags:function(){this.eachEntity(function(t,e){var n=this.w.editor.dom.select('[name="'+t+'"]');if(n.length>1){for(var o=!0,r=n[0].parentNode,a=0;a<n.length;a++)if(n[a].parentNode!==r){o=!1;break}if(o){var s=i(this.w.editor.dom.create("span",{},"")),l=n[0].attributes;for(a=0;a<l.length;a++){var c=l[a];s.attr(c.name,c.value)}s.addClass("end"),s.attr("id",s.attr("name")),s.attr("_tag",e.getTag()),i(n).wrapAll(s),i(n).contents().unwrap()}}}.bind(this))},reset:function(){this.currentEntity=null,this.entities={}}},t.exports=r},function(t,e,n){"use strict";var i=n(3),o=(n(45),n(22));t.exports=function(t){var e=t,n={ADD:"add",BEFORE:"before",AFTER:"after",AROUND:"around",INSIDE:"inside",NO_SELECTION:"no_selection",NO_COMMON_PARENT:"no_common_parent",OVERLAP:"overlap",VALID:"valid",getCurrentTag:function(t){if(null!=t){var n=i("#"+t,e.editor.getBody());return 0===n.length&&(n=i('[name="'+t+'"]',e.editor.getBody())),n}return i(e.editor.selection.getNode())},getAttributesForTag:function(t){var e=t.getAttribute("_attributes");if(null!==e){var n=e.replace(/&quot;/g,'"');return JSON.parse(n)}return{}},setAttributesForTag:function(t,e){for(var n=t.attributes,i=n.length-1;i>=0;i--){var r=n[i];!0!==o.reservedAttributes[r.name]&&t.removeAttribute(r.name)}for(var a in e)!0!==o.reservedAttributes[a]&&t.setAttribute(a,e[a]);var s=JSON.stringify(e).replace(/"/g,"&quot;");t.setAttribute("_attributes",s)},addAttributesToTag:function(t,e){var i=n.getAttributesForTag(t);for(var r in e)if(!0!==o.reservedAttributes[r]){var a=e[r];t.setAttribute(r,a),i[r]=a}var s=JSON.stringify(i).replace(/"/g,"&quot;");t.setAttribute("_attributes",s)},removeAttributeFromTag:function(t,e){t.removeAttribute(e);var i=n.getAttributesForTag(t);delete i[e];var o=JSON.stringify(i).replace(/"/g,"&quot;");t.setAttribute("_attributes",o)},addTagDialog:function(t,o,r){if(t!==e.schemaManager.getHeader()){if(null==e.editor.currentBookmark.tagId){e.editor.selection.moveToBookmark(e.editor.currentBookmark);var a=o===n.ADD;if(d(!0,a)!==n.VALID)return void e.dialogManager.show("message",{title:"Error",msg:"Please ensure that the beginning and end of your selection have a common parent.<br/>For example, your selection cannot begin in one paragraph and end in another, or begin in bolded text and end outside of that text.",type:"error"});e.editor.currentBookmark=e.editor.selection.getBookmark(1)}var s=void 0;if(Array.isArray(r));else if(o===n.ADD||o===n.INSIDE){var l;if(void 0===r){var c=e.editor.currentBookmark.rng.commonAncestorContainer;l=c.nodeType===Node.TEXT_NODE?i(c).parent():i(c)}else l=i("#"+r,e.editor.getBody());s=e.utilities.getElementXPath(l[0]),s+="/"+t}e.dialogManager.getDialog("attributesEditor").show(t,s,{},(function(i){null!==i&&n.addStructureTag(t,i,e.editor.currentBookmark,o),delete e.editor.currentBookmark.tagId}))}else e.dialogManager.show("header")},editTagDialog:function(t){var i=n.getCurrentTag(t);if(i.attr("_entity")){e.editor.currentBookmark=e.editor.selection.getBookmark(1);var o=e.entitiesManager.getEntity(i.attr("id"));o?e.dialogManager.show(o.getType(),{entry:o}):console.warn("tagger.editTag: no entry for entity",i)}else{var r=i.attr("_tag");if(r===e.schemaManager.getHeader())e.dialogManager.show("header");else{var a=e.utilities.getElementXPath(i[0]),s=n.getAttributesForTag(i[0]);e.dialogManager.getDialog("attributesEditor").show(r,a,s,(function(t){null!==t&&n.editStructureTag(i,t)}))}}},changeTagDialog:function(t,o){var r=n.getCurrentTag(o);if(r.attr("_entity"))e.dialogManager.confirm({title:"Remove Entity?",msg:"Changing this tag will remove the associated annotation. Do you want to proceed?",showConfirmKey:"confirm-change-tag-remove-entity",type:"info",callback:function(r){if(r){var a=n.removeEntity(o),s=e.utilities.getElementXPath(a.parentElement);s+="/"+t;var l=n.getAttributesForTag(a);e.dialogManager.getDialog("attributesEditor").show(t,s,l,(function(e){null!==e&&n.editStructureTag(i(a),e,t)}))}}});else{var a=e.utilities.getElementXPath(r.parent()[0]);a+="/"+t;var s=n.getAttributesForTag(r[0]);e.dialogManager.getDialog("attributesEditor").show(t,a,s,(function(e){null!==e&&n.editStructureTag(r,e,t)}))}},addEntityDialog:function(t,i){var o;if((o=!e.schemaManager.mapper.doesEntityRequireSelection(t)&&e.editor.selection.isCollapsed()?n.VALID:d(!1,!0))===n.NO_SELECTION)e.dialogManager.show("message",{title:"Error",msg:"Please select some text before adding an entity.",type:"error"});else if(e.editor.currentBookmark=e.editor.selection.getBookmark(1),o===n.VALID){var r;r=void 0!==i?i:e.schemaManager.mapper.getParentTag(t);for(var a=e.editor.currentBookmark.rng.commonAncestorContainer;a.nodeType!==Node.ELEMENT_NODE;)a=a.parentNode;var s=a.getAttribute("_tag");e.schemaManager.isTagValidChildOfParent(r,s)?e.dialogManager.show(t):e.dialogManager.show("message",{title:"Invalid XML",msg:"You cannot add a "+t+" entity in this location because its element <b>"+r+"</b> is not a valid child of <b>"+s+"</b>.",type:"error"})}else o===n.OVERLAP&&(!0===e.allowOverlap?e.dialogManager.show(t):e.dialogManager.confirm({title:"Warning",msg:"<p>You are attempting to create overlapping entities or to create an entity across sibling XML tags, which is not allowed in this editor mode.</p><p>If you wish to continue, the editor mode will be switched to <b>XML and RDF (Overlapping Entities)</b> and only RDF will be created for the entity you intend to add.</p><p>Do you wish to continue?</p>",showConfirmKey:"confirm-overlapping-entities",type:"info",height:350,callback:function(n){n&&(e.allowOverlap=!0,e.mode=e.XMLRDF,e.dialogManager.show(t))}}))},removeTag:function(t){n.getCurrentTag(t).attr("_entity")?n.removeEntity(t):n.removeStructureTag(t)},copyTag:function(t){var i=n.getCurrentTag(t);if(i.attr("_entity")){o=i.attr("_note")?i.parent(".noteWrapper").clone(!0):i.clone(),e.editor.copiedEntity=o[0]}else{var o=i.clone();e.editor.copiedElement.element=o[0],e.editor.copiedElement.selectionType=0}},pasteTag:function(){r(e.editor.copiedElement.element),e.editor.copiedElement={selectionType:null,element:null}},splitTag:function(){var t=e.editor.selection.getRng(!0);if(t.startContainer.nodeType===Node.TEXT_NODE){var n=t.startContainer,o=n.parentNode;if("true"!=o.getAttribute("_entity")){for(var r,a="<"+o.nodeName.toLowerCase(),s=0;s<o.attributes.length;s++){var l=o.attributes[s];"id"!==l.name&&(a+=" "+l.name+'="'+l.value+'"')}a+="></"+o.nodeName.toLowerCase()+">",o.normalize(),n.splitText(t.startOffset);for(s=0;s<o.childNodes.length;s++){var c=o.childNodes[s];c.nodeType===Node.TEXT_NODE&&(r=i(c).wrap(a))}i(o).contents().each((function(t,n){n.setAttribute("id",e.getUniqueId("dom_"))})).unwrap(),e.editor.selection.setCursorLocation(r[0]),e.editor.undoManager.add(),e.event("contentChanged").publish()}else console.warn("tagger.splitTag: cannot split an entity!")}else console.warn("tagger.splitTag: no text selection!")},mergeTags:function(t){for(var n="",o=[],r=0;r<t.length;r++){var a=i(t[r]);n+=a.html(),r>0&&o.push("#"+a.attr("id"))}i(t[0]).html(n),i(o.join(","),e.editor.getBody()).remove(),e.editor.undoManager.add(),e.event("contentChanged").publish()}},r=function(t){if(null!=t){e.editor.selection.moveToBookmark(e.editor.currentBookmark);var i=e.editor.selection;i.collapse(),i.getRng(!0).insertNode(t),n.processNewContent(t),e.editor.undoManager.add(),e.event("contentChanged").publish()}};n.processNewContent=function(t){var n=function t(n,i){if(n.nodeType===Node.ELEMENT_NODE&&n.hasAttribute("_tag")){var o=n.getAttribute("id");if(null!==o)if(1===n.ownerDocument.querySelectorAll("#"+o).length)return;var r=e.getUniqueId("dom_");if(n.setAttribute("id",r),n.hasAttribute("_entity")){n.setAttribute("name",r);var a=e.entitiesManager.getEntity(o);if(void 0!==a){var s=a.clone();s.setId(r),e.entitiesManager.setEntity(r,s)}else console.warn("processNewContent: copied entity tag had no Entity to clone for",o),e.entitiesManager.addEntity({id:r,tag:n.getAttribute("_tag"),type:n.getAttribute("_type")})}}if("up"===i)n.parentElement&&t(n.parentElement,i);else for(var l=0;l<n.childNodes.length;l++)t(n.childNodes[l],i)};n(t,"up"),n(t,"down")};var a=function(t,n){for(var o in t){var r=t[o];if(i.isArray(r))for(var a=0;a<r.length;a++)t[o][a]=e.utilities.convertTextForExport(r[a],n);else if(i.isPlainObject(r))for(var s in r)t[o][s]=e.utilities.convertTextForExport(r[s],n);else t[o]=e.utilities.convertTextForExport(r,n)}};n.finalizeEntity=function(t,o){var r=e.schemaManager.mapper.isNamedEntity(t),s=e.schemaManager.mapper.getParentTag(t);if("note"===t&&delete o.attributes.otherType,a(o.attributes,!0),a(o.customValues,!1),!r||r&&o.properties.uri){var l={id:e.getUniqueId("dom_"),type:t,isNote:e.schemaManager.mapper.isEntityTypeNote(t),isNamedEntity:r,tag:s,attributes:o.attributes,customValues:o.customValues};o.properties&&o.properties.noteContent&&(void 0!==o.properties.content&&""!==o.properties.content||(o.properties.content=o.properties.noteContent)),i.extend(l,o.properties),e.editor.selection.moveToBookmark(e.editor.currentBookmark);var c=e.editor.selection.getRng(!0);e.entitiesManager.addEntity(l,c)}else n.addStructureTag(s,o.attributes,e.editor.currentBookmark,n.ADD);e.editor.currentBookmark=null,e.editor.focus()},n.editEntity=function(t,o){a(o.attributes,!0),a(o.customValues,!1);var r=e.entitiesManager.getEntity(t),s=i("[name="+t+"]",e.editor.getBody()),l=o.properties.type||r.getType();l!==r.getType()&&console.log("tagger.editEntity: changing entity type");var c=e.schemaManager.mapper.isNamedEntity(l),d=e.schemaManager.mapper.getAttributeForProperty(l,"uri");c&&void 0===o.attributes[d]?(n.setAttributesForTag(s[0],o.attributes),n.removeEntity(t)):(e.entitiesManager.editEntity(r,o),n.setAttributesForTag(s[0],r.getAttributes()),s.attr("_tag",r.getTag()),s.attr("_type",r.getType()),s.attr("class","entity start end "+r.getType()),e.event("entityEdited").publish(t))},n.pasteEntity=function(){r(e.editor.copiedEntity),e.editor.copiedEntity=null},n.removeEntity=function(t){t=t||e.entitiesManager.getCurrentEntity();var o=e.entitiesManager.getEntity(t),r=i("#"+t,e.editor.getBody()),a=r.attr("_tag"),s=n.getAttributesForTag(r[0]),l=!1===e.editor.selection.getRng(!0).collapsed;o.isNote()&&n.removeNoteWrapper(r),r.wrapInner('<span id="tempSelection"/>');var d=i("#tempSelection",e.editor.getBody());d.unwrap(),e.entitiesManager.removeEntity(t),e.editor.selection.getRng(!0).selectNodeContents(d[0]),e.editor.currentBookmark=e.editor.selection.getBookmark(1);var u=n.addStructureTag(a,s,e.editor.currentBookmark,n.ADD),p=d.contents();return p.unwrap(),l&&c(p),u},n.addEntityTag=function(t,r){var a=t.getId(),l=t.getType(),c=t.getTag();void 0===c&&(c=e.schemaManager.mapper.getParentTag(l));var d={};for(var u in t.attributes)!0!==o.reservedAttributes[u]&&(d[u]=t.attributes[u]);var p=JSON.stringify(d);if(p=p.replace(/"/g,"&quot;"),t.isNote()){var f=e.utilities.convertTextForExport(t.getNoteContent()),g=e.editor.dom.create("span",i.extend(d,{_entity:!0,_note:!0,_tag:c,_type:l,class:"entity "+l+" start end",name:a,id:a,_attributes:p}),f),h=e.editor.selection;h.setRng(r),tinymce.isWebKit&&h.setRng(r),h.collapse(!1),(r=h.getRng(!0)).insertNode(g),n.addNoteWrapper(g,l)}else if(r.startContainer.parentNode!=r.endContainer.parentNode){var m=s(r.startContainer,r.endContainer,NodeFilter.SHOW_TEXT),v=r.cloneRange();v.setEnd(r.startContainer,r.startContainer.length);var y=e.editor.dom.create("span",{_entity:!0,_type:l,class:"entity "+l+" start",name:a,_attributes:p},"");v.surroundContents(y),i.each(m,(function(t,e){i(e).wrap('<span _entity="true" _type="'+l+'" class="entity '+l+'" name="'+a+'" />')}));var b=r.cloneRange();b.setStart(r.endContainer,0);var w=e.editor.dom.create("span",{_entity:!0,_type:l,class:"entity "+l+" end",name:a},"");b.surroundContents(w)}else{y=e.editor.dom.create("span",i.extend(d,{_entity:!0,_tag:c,_type:l,class:"entity "+l+" start end",name:a,id:a,_attributes:p}),"");r.surroundContents(y)}e.editor.undoManager.add()};var s=function(t,e,n){n=null==n?NodeFilter.SHOW_ALL:n;var i=[],o=t.ownerDocument.createTreeWalker(t.ownerDocument,n,null,!1);for(o.currentNode=t;o.nextNode()&&o.currentNode!==e;)i.push(o.currentNode);return i};n.addNoteWrapper=function(t,e){i(t).filter(":visible").wrap('<span class="noteWrapper '.concat(e,' hide" />')).parent().on("click",(function(t){var e=t.target,n=i(e);n.hasClass("noteWrapper")&&n.toggleClass("hide")}))},n.addNoteWrappersForEntities=function(){e.entitiesManager.eachEntity((function(t,o){if(o.isNote()){var r=i("#"+t,e.editor.getBody());n.addNoteWrapper(r,o.getType())}}))},n.removeNoteWrapper=function(t){i(t).unwrap(".noteWrapper")},n.removeNoteWrappersForEntities=function(){e.entitiesManager.eachEntity((function(t,o){o.isNote()&&n.removeNoteWrapper(i("#"+t,e.editor.getBody()))}))},n.addStructureTag=function(t,r,s,l){a(r,!0);var c,d=e.getUniqueId("dom_");if(s.tagId)c=i.isArray(s.tagId)?i("#"+s.tagId.join(",#"),e.editor.getBody()):i("#"+s.tagId,e.editor.getBody());else{for(var u=s.rng.commonAncestorContainer;u.nodeType==Node.TEXT_NODE||u.nodeType==Node.ELEMENT_NODE&&!u.hasAttribute("_tag");)u=u.parentNode;c=i(u)}var p=null,f=e.schemaManager.mapper.getEntityTypeForTag(c.attr("_tag"));null!==f&&e.schemaManager.mapper.isEntityTypeNote(f)&&(p=c.parent(".noteWrapper"));var g=e.schemaManager.getTagForEditor(t),h="<"+g+' id="'+d+'" _tag="'+t+'"',m={};for(var v in r)!0!==o.reservedAttributes[v]&&(h+=" "+v+'="'+r[v]+'"'),m[v]=r[v];var y=JSON.stringify(m),b="</"+g+">",w="\ufeff",_=(h+=' _attributes="'+(y=y.replace(/"/g,"&quot;"))+'">')+w+b;switch(l){case n.BEFORE:null!==p?p.before(_):c.before(_);break;case n.AFTER:null!==p?p.after(_):c.after(_);break;case n.AROUND:c.length>1?c.wrapAll(_):null!==p?p.wrap(_):c.wrap(_);break;case n.INSIDE:c.wrapInner(_);break;default:e.editor.selection.moveToBookmark(s),""==(w=e.editor.selection.getContent())&&(w="\ufeff"),_=h+w+b;var x=e.editor.selection.getRng(!0),C=i('<span data-mce-bogus="1">',e.editor.getDoc());x.surroundContents(C[0]),C.replaceWith(_)}var k=i("#"+d,e.editor.getBody());if(e.event("tagAdded").publish(k[0]),e.editor.undoManager.add(),"\ufeff"==w)e.utilities.selectElementById(d,!0);else if(null==l){var T=e.editor.selection.getRng(!0);T.selectNodeContents(i("#"+d,e.editor.getBody())[0]),T.collapse(!1),e.editor.selection.setRng(T)}return k[0]},n.editStructureTag=function(t,o,r){a(o,!0);var s,l=t.attr("id");void 0!==r&&r!==t.attr("_tag")&&(s=t.parent().is("span")?"span":e.schemaManager.getTagForEditor(r),t.contents().unwrap().wrapAll("<"+s+' id="'+l+'" _tag="'+r+'"/>'),t=i("#"+l,e.editor.getBody()));n.setAttributesForTag(t[0],o),e.event("tagEdited").publish(t[0])},n.removeStructureTag=function(t,i){null==i&&(i=!!(e.tree&&e.tree.currentlySelectedNodes.length>0&&null!=e.tree.selectionType));var o=function(){if(i)a&&a.isNote()?(n.processRemovedContent(r.parent(".noteWrapper")[0]),r.parent(".noteWrapper").remove()):(n.processRemovedContent(r[0]),r.remove());else{n.processRemovedContent(r[0],!1);var o=!1===e.editor.selection.getRng(!0).collapsed,s=r.parent(),l=r.contents();l.length>0?l.unwrap():r.remove(),a&&a.isNote()&&(n.processRemovedContent(s[0],!1),(l=s.contents()).length>0?l.unwrap():s.remove()),o&&c(l),s[0].normalize()}e.editor.undoManager.add(),e.event("tagRemoved").publish(t)},r=n.getCurrentTag(t),a=e.entitiesManager.getEntity(t);t=r.attr("id"),e.schemaManager.wouldDeleteInvalidate(r[0],!0,i)?l(r[0],!1,(function(t){t&&o()})):o()},n.removeStructureTagContents=function(t){var i=n.getCurrentTag(t),o=function(){i.contents().each((function(t,e){return n.processRemovedContent(e)})).remove(),i[0].textContent="\ufeff",e.editor.undoManager.add(),e.event("tagContentsRemoved").publish(t)};e.schemaManager.wouldDeleteInvalidate(i[0],!1,!0)?l(i[0],!0,(function(t){t&&o()})):o()},n.processRemovedContent=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=function t(o){if(o.nodeType===Node.ELEMENT_NODE&&o.hasAttribute("_tag")&&o.hasAttribute("_entity")){var r=o.getAttribute("name");console.log("entity will be removed",r),e.entitiesManager.removeEntity(r)}else{var a=i(o).parents("[_type=citation],[_type=note]");a.length>0&&setTimeout((function(){a.each((function(t,n){var o=i(n),r=o.attr("id"),a=e.entitiesManager.getEntity(r);a&&(a.setNoteContent(o.html()),a.setContent(o.text()),e.event("entityEdited").publish(r))}))}),0)}if(n)for(var s=0;s<o.childNodes.length;s++)t(o.childNodes[s])};if(void 0!==t.commonAncestorContainer){n=!1;var r=s(t.startContainer,t.endContainer);r.forEach((function(t){return o(t)}))}else o(t)};var l=function(t,n,i){var o="<p>Deleting the ".concat(n?"contents of the":"",' "').concat(t.getAttribute("_tag"),'" element will make the document invalid. Do you wish to continue?</p>');e.dialogManager.confirm({title:"Warning",msg:o,showConfirmKey:"confirm-delete-tag-invalidating",type:"info",callback:i})},c=function(t){var n=e.editor.selection.getRng(!0);(t=t.toArray().filter((function(t){return null!==t.parentNode}))).length>0&&1===t.length&&n.selectNodeContents(t[0])},d=function(t,o){var r=e.editor.selection;if(!t&&r.isCollapsed())return n.NO_SELECTION;var a=r.getRng(!0);if("body"===a.commonAncestorContainer.nodeName.toLowerCase()){var s=e.editor.dom.select("body > *")[0];a.setStartBefore(s.firstChild),a.setEndAfter(s.lastChild)}function l(t,e){return function t(e,n,i){return i>20||null==(o="back"==n?e.lastChild||e.previousSibling||e.parentNode.previousSibling:e.firstChild||e.nextSibling||e.parentNode.nextSibling)?null:o.nodeType==Node.TEXT_NODE?o:t(o,n,i++);var o}(t,e,0)}if(a.startContainer.nodeType===Node.ELEMENT_NODE){var c=a.endContainer;if(c.nodeType!=Node.TEXT_NODE||0===a.endOffset){if(null==(c=l(a.endContainer,"back")))return n.NO_COMMON_PARENT;a.setEnd(c,c.length)}var d=l(a.startContainer,"forward");if(null==d)return n.NO_COMMON_PARENT;a.setStart(d,0)}if(a.endContainer.nodeType===Node.ELEMENT_NODE&&a.setEnd(a.startContainer,a.startContainer.length),o&&function(t){var e=t.toString(),n=e.match(/^\s+/),i=0,o=0;null!=n&&(i=n[0].length),null!=(n=e.match(/\s+$/))&&(o=n[0].length),function t(e,n,i){if(n>0&&i<20){if(e.startOffset<e.startContainer.length&&(e.setStart(e.startContainer,e.startOffset+1),n--),e.startOffset==e.startContainer.length){var o=l(e.startContainer,"forward");null!=o&&e.setStart(o,0)}t(e,n,i++)}}(t,i,0),function t(e,n,i){if(n>0&&i<20){if(e.endOffset>0&&(e.setEnd(e.endContainer,e.endOffset-1),n--),0==e.endOffset){var o=l(e.endContainer,"back");null!=o&&e.setEnd(o,o.length)}t(e,n,i++)}}(t,o,0),r.setRng(t)}(a),a.startContainer.parentNode!=a.endContainer.parentNode){if(0!==a.endOffset||a.endContainer.previousSibling!==a.startContainer.parentNode)return t?n.NO_COMMON_PARENT:n.OVERLAP;a.setEnd(a.startContainer,a.startContainer.length)}if(t||!1===e.allowOverlap){for(var u,p=a.startContainer,f={};p!=a.endContainer;)p=p.nextSibling,null!=(u=i(p)).attr("_entity")&&null!=u.attr("_tag")&&(f[u.attr("name")]?delete f[u.attr("name")]:f[u.attr("name")]=!0);var g=0;for(var h in f)g++;if(0!=g)return n.OVERLAP}return n.VALID};return n}},function(t,e,n){"use strict";var i=n(3),o=n(410),r=n(411);t.exports=function(t){var e=t,n=new r(e),a=new o(e),s={processDocument:n.processDocument,buildEditorString:n.buildEditorString,getDocumentContent:a.getDocumentContent,buildXMLString:a.buildXMLString,loadDocumentURL:function(t){e.currentDocId=t,e.event("loadingDocument").publish(),i.ajax({url:t,type:"GET",success:function(t,e,n){s.processDocument(t)},error:function(n,i,o){e.currentDocId=null,e.dialogManager.show("message",{title:"Error",msg:"An error occurred and "+t+" was not loaded.",type:"error"}),e.event("documentLoaded").publish(!1,null)},dataType:"xml"})},loadDocumentXML:function(t){if(e.event("loadingDocument").publish(),"string"==typeof t&&null===(t=e.utilities.stringToXML(t)))return e.event("documentLoaded").publish(!1,null),e.dialogManager.show("message",{title:"Error",msg:'The document you are trying to upload is not well-formed. Check that it has the xml extension and that it follows <a href="https://www.w3resource.com/xml/well-formed.php" target="_blank" rel="noopener noreferrer">propper xml grammar</a>.',type:"error"}),!1;s.processDocument(t)},getDocument:function(t,n){var i=this;s.getDocumentContent(!0,(function(o){if(!0===t)n.call(i,o);else{var r=null;try{r=(new DOMParser).parseFromString(o,"application/xml")}catch(t){e.dialogManager.show("message",{title:"Error",msg:"There was an error getting the document:"+t,type:"error"})}n.call(i,r)}}))},setDocument:function(t){"string"==typeof t&&0===t.indexOf("http")?s.loadDocumentURL(t):s.loadDocumentXML(t)}};return s}},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var p={};function f(){}function g(){}function h(){}var m={};c(m,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,a)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(r,a,s,l){var c=u(t[r],t,a);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==i(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,s,l)}),(function(t){o("throw",t,s,l)})):e.resolve(p).then((function(t){d.value=t,s(d)}),(function(t){return o("throw",t,s,l)}))}l(c.arg)}var r;this._invoke=function(t,n){function i(){return new e((function(e,i){o(t,n,e,i)}))}return r=r?r.then(i,i):i()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,c(b,"constructor",h),c(h,"constructor",g),g.displayName=c(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(d(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,l,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function r(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}var a=n(3);n(45);t.exports=function(t){var e=t,n={};function i(t){!function t(n){a(n).contents().each((function(n,i){i.nodeType==Node.TEXT_NODE?i.nodeValue=e.utilities.convertTextForExport(i.nodeValue):i.nodeType==Node.ELEMENT_NODE&&t(i)}))}(t);var n=a('[_entity][class~="start"]',t).not("[_tag]").not("[_note]"),i=a.map(n,(function(t,e){return a(t).attr("name")}));a(i).each((function(n,i){e.entitiesManager.getEntity(i).setRange(function(t){var n={};function i(t,e,n){var i=0;function o(e){var r=!0;return e.contents().each((function(e,s){var l,c,d,u=a(this);if(u.attr("name")===t){if(l=u.hasClass("start"),c=u.hasClass("end"),d=l&&!n||c&&n,n&&(i+=u.text().length),d)return r=!1}else{if(this.nodeType!==Node.TEXT_NODE||" "===this.data)return r=o(u);i+=this.length}})),r}return o(e),i}function o(n,o){var r=n.parents("[_tag]").first();return{xpath:e.utilities.getElementXPath(r[0]),offset:i(t,r,o)}}var r=a('[name="'+t+'"]',e.editor.getBody()),s=r.first(),l=r.last(),c=o(s,!1);n.startXPath=c.xpath,n.startOffset=c.offset;var d=o(l,!0);return n.endXPath=d.xpath,n.endOffset=d.offset,n}(i)),a('[name="'+i+'"]',t).each((function(t,e){a(e).contents().unwrap()}))}))}function s(t){e.entitiesManager.eachEntity((function(n,i){var o=a('[cwrcTempId="'+n+'"]',t);1===o.length&&i.setRange({startXPath:e.utilities.getElementXPath(o[0])})}))}return n.getDocumentContent=function(){var t,l=(t=o().mark((function t(r,l){var c,d,u,p,f,g,h,m,v,y,b,w,_,x,C,k,T,E,S,D,P,M,L,A,R;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(f in r&&e.mode===e.XML&&(r=!1),e.entitiesManager.highlightEntity(),i(c=a(e.editor.getBody()).clone(!1)),d=e.schemaManager.getRoot(),0==(u=c.children("[_tag="+d+"]")).length&&(console.warn("converter: no root found for",d),u=c.find("[_tag]:eq(0)")),p=e.tagger.getAttributesForTag(u[0]))0===f.indexOf("xmlns")&&delete p[f];if(void 0!==(g=e.schemaManager.mapper.getNamespace())&&(p.xmlns=g),r&&(p["xmlns:rdf"]="http://www.w3.org/1999/02/22-rdf-syntax-ns#"),e.tagger.setAttributesForTag(u[0],p),h='<?xml version="1.0" encoding="UTF-8"?>\n',h+='<?xml-model href="'+e.schemaManager.getCurrentDocumentSchemaUrl()+'" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>\n',h+='<?xml-stylesheet type="text/css" href="'+e.schemaManager.getCurrentDocumentCSSUrl()+'"?>\n',console.time("buildXMLString"),h+=n.buildXMLString(u,r),console.timeEnd("buildXMLString"),h=h.replace(/&(?!amp;)/g,"&amp;"),!r){t.next=87;break}if(console.time("stringToXML"),m=e.utilities.stringToXML(h),console.timeEnd("stringToXML"),null!==m){t.next=28;break}t.next=85;break;case 28:return console.time("setEntityRanges"),s(m),console.timeEnd("setEntityRanges"),console.time("cleanUp"),a("[cwrcTempId]",m).each((function(t,e){a(e).removeAttr("cwrcTempId")})),console.timeEnd("cleanUp"),v=e.annotationMode===e.XML?"xml":"json",y=[],e.entitiesManager.eachEntity((function(t,e){y.push(e)})),t.next=39,e.annotationsManager.getAnnotations(y,v);case 39:b=t.sent,w=a(m.documentElement),_=e.schemaManager.mapper.getRdfParentSelector(),x=_.split("/"),C=w,k=0;case 45:if(!(k<x.length)){t.next=79;break}if(""===(T=x[k])){t.next=76;break}if(-1!==T.indexOf("::")){t.next=57;break}if(C[0].nodeName!==T){t.next=53;break}return t.abrupt("continue",76);case 53:1===(E=C.children(T).first()).length?C=E:(S=C[0].namespaceURI,D=m.createElementNS(S,T),P=C[0].firstElementChild,C=a(null!==P?C[0].insertBefore(D,P):C[0].appendChild(D)));case 55:t.next=76;break;case 57:M=T.split("::"),L=M[0],T=M[1],t.t0=L,t.next="preceding-sibling"===t.t0?63:"following-sibling"===t.t0?68:74;break;case 63:return A=C[0].parentNode,S=A.namespaceURI,D=m.createElementNS(S,T),C=a(A.insertBefore(D,C[0])),t.abrupt("break",76);case 68:return A=C[0].parentNode,S=A.namespaceURI,D=m.createElementNS(S,T),R=C[0].nextElementSibling,C=a(null!==R?A.insertBefore(D,R):A.appendChild(D)),t.abrupt("break",76);case 74:return console.warn("cwrc2xml: axis",L,"not supported"),t.abrupt("break",76);case 76:k++,t.next=45;break;case 79:C!==w?C.append(b):console.warn("cwrc2xml: couldn't find rdfParent for",_),console.time("xmlToString"),h=e.utilities.xmlToString(m),console.timeEnd("xmlToString"),h=h.replace(/\uFEFF/g,""),l.call(this,h);case 85:t.next=89;break;case 87:h=h.replace(/\uFEFF/g,""),l.call(this,h);case 89:case"end":return t.stop()}}),t,this)})),function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,l,"next",t)}function l(t){r(a,i,o,s,l,"throw",t)}s(void 0)}))});return function(t,e){return l.apply(this,arguments)}}(),n.buildXMLString=function(t,n){n=void 0!==n&&n;var i="";return function t(o){var r=function(t){var i=t.attr("_tag");if(void 0===i)return["",""];var o=[],r=t.attr("id");if("true"===t.attr("_entity")){var a=e.entitiesManager.getEntity(r);a?(o=e.schemaManager.mapper.getMapping(a),n&&(""!==o[0]?o[0]=o[0].replace(/([\s>])/,' cwrcTempId="'.concat(r,'"$&')):o[1]=o[1].replace(/([\s>])/,' cwrcTempId="'.concat(r,'"$&')))):(console.warn("cwrc2xml.buildXMLString: no entity entry for",r),o=["",""])}else{var s="<".concat(i),l=e.tagger.getAttributesForTag(t[0]);for(var c in l){var d=l[c];s+=" ".concat(c,'="').concat(d,'"')}0===t[0].childNodes.length||1===t[0].childNodes.length&&3===t[0].childNodes[0].nodeType&&"\ufeff"===t[0].childNodes[0].textContent?(s+="/>",o.push(s)):(s+=">",o.push(s),o.push("</".concat(i,">")))}return o}(o);i+=r[0],r.length>1&&(o.contents().each((function(e,n){n.nodeType===Node.ELEMENT_NODE?t(a(n)):n.nodeType===Node.TEXT_NODE?i+=n.data:n.nodeType===Node.COMMENT_NODE&&(i+="\x3c!--".concat(n.data,"--\x3e"))})),i+=r[1])}(a(t)),i},n.getEntityOffsets=function(){for(var t=function(t){var n=0,i=[];function o(t){t.contents().each((function(t,r){var s=a(this);if(this.nodeType==Node.TEXT_NODE&&" "!=this.data)n+=this.length;else if(s.attr("_tag")){var l=s.attr("id");i.push({id:l,offset:n,length:s.text().length,entity:void 0!==s.attr("_entity")}),o(s)}else if(s.attr("_entity")&&s.hasClass("start")){l=s.attr("name");i.push({id:l,offset:n,length:e.entitiesManager.getEntity(l).getContent().length,entity:!0})}}))}return o(t),i}(a(e.editor.getBody())),n=[],i=0;i<t.length;i++){var o=t[i];o.entity&&n.push(o)}return n},n}},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(){s=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var p={};function f(){}function g(){}function h(){}var m={};c(m,r,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,r)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(r,a,s,l){var c=u(t[r],t,a);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==i(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,s,l)}),(function(t){o("throw",t,s,l)})):e.resolve(p).then((function(t){d.value=t,s(d)}),(function(t){return o("throw",t,s,l)}))}l(c.arg)}var r;this._invoke=function(t,n){function i(){return new e((function(e,i){o(t,n,e,i)}))}return r=r?r.then(i,i):i()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,c(b,"constructor",h),c(h,"constructor",g),g.displayName=c(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,a,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(d(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,l,"Generator"),c(b,r,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function l(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){l(r,i,o,a,s,"next",t)}function s(t){l(r,i,o,a,s,"throw",t)}a(void 0)}))}}var d=n(3),u=n(22);t.exports=function(t){var e=t,n={};function i(t){for(var e,n,i=/href=('|")([^('|")]*)('|")/,o=0;o<t.childNodes.length;o++){var r=t.childNodes[o];if("xml-model"===r.nodeName)e=(e=r.data.match(i))[2];else if("xml-stylesheet"===r.nodeName){n=(n=r.data.match(i))[2]}}return{xmlUrl:e,cssUrl:n}}function o(t){e.event("processingDocument").publish(),d(t).find("rdf\\:RDF, RDF").remove();var i=t.documentElement,o=n.buildEditorString(i,!e.isReadOnly);e.editor.setContent(o,{format:"raw"}),e.event("documentLoaded").publish(!1,e.editor.getBody())}function a(t){e.event("processingDocument").publish(),n.isLegacyDocument=function(t){var n=d(t).find("rdf\\:RDF, RDF").length>0,i=d(t).find("*[annotationId], *[offsetId]").length>0,o=null===e.utilities.evaluateXPath(t,e.schemaManager.mapper.getRdfParentSelector());return n&&(i||o)}(t);!function(t){var i=d(t).find("rdf\\:RDF, RDF");if(i.length){i.children().each((function(i,o){var a=e.annotationsManager.getEntityConfigFromAnnotation(o);if(null!=a){var s=void 0!==a.range.endXPath;if(!s){if(null===(c=e.utilities.evaluateXPath(t,a.range.startXPath)))return void console.warn("xml2cwrc.processRDF: no matching entity element for",a);var l=e.schemaManager.mapper.getReverseMapping(c,!0);l.type!==a.type&&console.warn("xml2cwrc.processRDF: entity type mismatch. RDF =",a.type+". Element =",l.type+"."),a=r(r({},a),l)}if(n.isLegacyDocument){a.attributes&&(delete a.attributes.annotationId,delete a.attributes.offsetId);var c=e.utilities.evaluateXPath(t,a.range.startXPath);if(a.range.startXPath=e.utilities.getElementXPath(c),s){var d=e.utilities.evaluateXPath(t,a.range.endXPath);a.range.endXPath=e.utilities.getElementXPath(d)}}e.entitiesManager.addEntity(a)}})),i.remove();var o=d(e.utilities.evaluateXPath(t,e.schemaManager.mapper.getRdfParentSelector()));if(1===o.length)for(var a=o[0].nodeName;a!==e.schemaManager.getHeader()&&a!==e.schemaManager.getRoot();){if(0===(o=o.parent()).length){console.warn("xml2cwrc: went beyond doc root");break}o.children(a).remove(),a=o[0].nodeName}else console.warn("xml2cwrc: couldn't find the rdfParent");return!0}}(t);(function(t){var n=new d.Deferred;return function(t){var n=new d.Deferred,i=e.dialogManager.getDialog("loadingindicator");i.show(),i.setText("Building Document");var o="",r=[],a=function(t){var e=[];function n(t,i){e.push({node:t,depth:i});for(var o=0;o<t.childNodes.length;o++)n(t.childNodes[o],i+1)}return n(t,0),e}(t),s=function(t,e){var n=t.node,i=t.depth,a=l(n),s=a[0],c={string:a[1],depth:i};if(i<=e)for(var d=r.pop();null!=d&&d.depth<=e&&d.depth>=i;)if(o+=d.string,r.length>0){var u=r[r.length-1].depth;d=u<=e&&u>=i?r.pop():null}else d=null;return o+=s,r.push(c),i},c=a.length,u=(new Date).getTime(),p=250,f=0;return function t(){while(a.length>0){var e=a.shift();f=s(e,f);var l=(new Date).getTime();if(l-u>p){break}}var d=Math.abs(a.length-c)/c*100;i.setValue(d);if(a.length>0){u=(new Date).getTime();setTimeout(t,10)}else{while(r.length>0){var g=r.pop();o+=g.string}n.resolve(o)}}(),n.promise()}(t.documentElement).then((function(t){return e.editor.setContent(t,{format:"raw"}),function(){var t=e.entitiesManager.getEntities(),n=Object.keys(t).map((function(e){return t[e]}));if(n.length>0){e.dialogManager.getDialog("loadingindicator").setText("Inserting Entities"),e.editor.focus();var i=d('[_tag="'+e.schemaManager.getRoot()+'"]',e.editor.getBody())[0],o=function(t){var n=null,o=null,r=0,a=0,s=t.getRange();if(s.endXPath){var l=e.utilities.evaluateXPath(i,s.startXPath),c=p(l,s.startOffset);n=c.textNode,r=c.offset,o=(c=p(l=e.utilities.evaluateXPath(i,s.endXPath),s.endOffset)).textNode,a=c.offset;try{var u=e.editor.selection.getRng(!0);u.setStart(n,r),u.setEnd(o,a),e.tagger.addEntityTag(t,u),void 0===t.getContent()&&(e.entitiesManager.highlightEntity(),e.entitiesManager.highlightEntity(t.getId()),content=d(".entityHighlight",i).text(),e.entitiesManager.highlightEntity())}catch(t){console.warn("xml2cwrc: error adding overlapping entity",t)}}else if(s.startXPath){var f=e.utilities.evaluateXPath(i,s.startXPath);if(null!==f){var g=t.getType();d(f).attr({_entity:!0,_type:g,class:"entity start end "+g,name:t.getId(),id:t.getId()}),void 0!==t.getContent()&&""!==t.getContent()||t.setContent(d(f).text()),!t.isNote()||void 0!==t.getNoteContent()&&""!==t.getNoteContent()||t.setNoteContent(d(f).html())}else console.warn("xml2cwrc.insertEntities: cannot find entity tag for",s.startXPath)}};return e.utilities.processArray(n,o)}var r=new d.Deferred;return r.resolve(),r.promise()}()})).then((function(){e.tagger.addNoteWrappersForEntities(),e.entitiesManager.doEntitiesOverlap()?e.allowOverlap=!0:e.allowOverlap=!1,n.resolve()})),n.promise()})(t).then((function(){e.event("documentLoaded").publish(!0,e.editor.getBody()),function(t){if(!0!==e.isReadOnly){var n,i=t.documentElement;i.nodeName.toLowerCase()!==e.schemaManager.getRoot().toLowerCase()&&e.dialogManager.show("message",{title:"Schema Mismatch",msg:"The wrong schema is specified.<br/>Schema root: "+e.schemaManager.getRoot()+"<br/>Document root: "+i.nodeName+"<br/><br/>Go to <b>Settings</b> to change the schema association.",type:"error"}),n=e.mode===e.XML?"<b>XML only</b><br/>Only XML tags and no RDF/Semantic Web annotations will be created.":e.allowOverlap?"<b>XML and RDF (overlap)</b><br/>XML tags and RDF/Semantic Web annotations equivalent to the XML tags will be created, to the extent that the hierarchy of the XML schema allows. Annotations that overlap will be created in RDF only, with no equivalent XML tags.":"<b>XML and RDF (no overlap)</b><br/>XML tags and RDF/Semantic Web annotations equivalent to the XML tags will be created, consistent with the hierarchy of the XML schema, so annotations will not be allowed to overlap.",e.dialogManager.show("message",{title:"CWRC-Writer Mode",msg:n,type:"info"})}}(t)}))}function l(t){var i="",o="";if(t.nodeType===Node.ELEMENT_NODE){var r,a=t.nodeName;if(r=null===t.parentElement?e.schemaManager.getBlockTag():e.schemaManager.getTagForEditor(a),t.hasAttribute("id")&&(console.warn("xml2cwrc.buildEditorString: node already had an ID!",t.getAttribute("id")),t.removeAttribute("id")),i="<"+r+' _tag="'+a+'" id="'+e.getUniqueId("dom_")+'" _textallowed="'+e.schemaManager.canTagContainText(a)+'"',t.hasAttributes()){for(var s={},l=t.attributes,c=0;c<l.length;c++){var d=l[c].name,p=l[c].value;n.isLegacyDocument&&"annotationId"===d||"offsetId"===d||(s[d]=p,!0!==u.reservedAttributes[d]&&(i+=" "+d+'="'+p+'"'))}var f=JSON.stringify(s);i+=' _attributes="'+(f=f.replace(/"/g,"&quot;"))+'"'}0===t.childNodes.length?(i+=">",o="\ufeff</"+r+">"):(i+=">",o="</"+r+">")}else if(t.nodeType===Node.TEXT_NODE){i=t.data.replace(/</g,"&lt;").replace(/>/g,"&gt;")}else t.nodeType===Node.COMMENT_NODE?(i+="\x3c!--"+t.data,o="--\x3e"):console.warn("xml2cwrc.buildEditorString: unsupported node type:",t.nodeType);return[i,o]}function p(t,e){var n=0,i=null;return function t(o){var r=!0;return d(o).contents().each((function(o,a){return a.nodeType!==Node.TEXT_NODE||" "===a.data?r=t(a):(n+=a.length)>=e?(n=e-(n-a.length),i=a,r=!1):void 0})),r}(t),{textNode:i,offset:n}}return n.isLegacyDocument=void 0,n.processDocument=function(t,n){d(e.editor.getBody()).empty(),setTimeout(c(s().mark((function r(){var l,d,u,p,f,g;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=i(t),p=u.xmlUrl,f=u.cssUrl,e.schemaManager.setCurrentDocumentSchemaUrl(p),e.schemaManager.setCurrentDocumentCSSUrl(f),void 0!==n?(l=n,d=!0):(l=e.schemaManager.getSchemaIdFromUrl(p),d=void 0===f),void 0!==p||void 0!==l){r.next=8;break}e.dialogManager.confirm({title:"Missing Schema",msg:"<p>There is no schema associated with your document. Should CWRC-Writer try to determine the schema by examining the document root?</p>",type:"error",callback:function(n){if(n){var i=t.firstElementChild.nodeName;void 0===(l=e.schemaManager.getSchemaIdFromRoot(i))?e.dialogManager.show("message",{title:"Warning",msg:"<p>CWRC-Writer could not determine the schema for: "+i+"</p>",type:"error",callback:function(){e.event("documentLoaded").publish(!1,null),e.showLoadDialog()}}):e.dialogManager.show("message",{title:"Schema",msg:"<p>CWRC-Writer determined the schema to be: "+l+"</p>",type:"info",callback:(r=c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l===e.schemaManager.schemaId){n.next=7;break}return n.next=3,e.schemaManager.loadSchema(l,!0);case 3:n.sent.success?a(t):o(t),n.next=8;break;case 7:a(t);case 8:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})})}else e.event("documentLoaded").publish(!1,null),e.showLoadDialog();var r}}),r.next=29;break;case 8:if(void 0!==l){r.next=12;break}e.dialogManager.confirm({title:"Warning",msg:"<p>The document you are loading is not fully supported by CWRC-Writer. You may not be able to use the ribbon to tag named entities.</p><p>Load document anyways?</p>",type:"error",callback:function(){var n=c(s().mark((function n(i){var r,u;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!i){n.next=15;break}if(void 0===f){n.next=4;break}return n.next=4,e.schemaManager.loadSchemaCSS([f]);case 4:if(void 0===p){n.next=12;break}return r=e.schemaManager.addSchema({name:"Custom Schema",xmlUrl:[p],cssUrl:[f]}),n.next=8,e.schemaManager.loadSchema(r,d);case 8:n.sent.success?a(t):((u=e.dialogManager.getDialog("message").getOpenDialogs().pop())&&u.dialog("close"),e.dialogManager.confirm({title:"Error Loading Schema",msg:"<p>The schema associated with your document could not be loaded. Should CWRC-Writer try to determine the schema by examining the document root?</p>",type:"error",callback:function(n){if(n){var i=t.firstElementChild.nodeName;void 0===(l=e.schemaManager.getSchemaIdFromRoot(i))?e.dialogManager.show("message",{title:"Warning",msg:"<p>CWRC-Writer could not determine the schema for: "+i+"</p>",type:"error",callback:function(){e.event("documentLoaded").publish(!1,null),e.showLoadDialog()}}):e.dialogManager.show("message",{title:"Schema",msg:"<p>CWRC-Writer determined the schema to be: "+l+"</p>",type:"info",callback:(r=c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l===e.schemaManager.schemaId){n.next=7;break}return n.next=3,e.schemaManager.loadSchema(l,!0);case 3:n.sent.success?a(t):o(t),n.next=8;break;case 7:a(t);case 8:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})})}else e.event("documentLoaded").publish(!1,null),e.showLoadDialog();var r}})),n.next=13;break;case 12:o(t);case 13:n.next=17;break;case 15:e.event("documentLoaded").publish(!1,null),e.showLoadDialog();case 17:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()}),r.next=29;break;case 12:if(l===e.schemaManager.schemaId){r.next=22;break}if(void 0===f){r.next=16;break}return r.next=16,e.schemaManager.loadSchemaCSS([f]);case 16:return r.next=18,e.schemaManager.loadSchema(l,d);case 18:r.sent.success?a(t):o(t),r.next=29;break;case 22:if(void 0===f||f===e.schemaManager.getCSSUrl()){r.next=28;break}if(g=e.schemaManager.getCurrentSchema(),null!==g.cssUrl.find((function(t){return t===f}))){r.next=28;break}return r.next=28,e.schemaManager.loadSchemaCSS([f]);case 28:a(t);case 29:case"end":return r.stop()}}),r)}))),0)},n.buildEditorString=function(t,e){var n="";return function t(e){var i=l(e);n+=i[0];for(var o=0;o<e.childNodes.length;o++)t(e.childNodes[o]);n+=i[1]}(t),n},n}},function(t,e,n){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){"use strict";o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var p={};function f(){}function g(){}function h(){}var m={};c(m,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,a)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(r,a,s,l){var c=u(t[r],t,a);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==i(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,s,l)}),(function(t){o("throw",t,s,l)})):e.resolve(p).then((function(t){d.value=t,s(d)}),(function(t){return o("throw",t,s,l)}))}l(c.arg)}var r;this._invoke=function(t,n){function i(){return new e((function(e,i){o(t,n,e,i)}))}return r=r?r.then(i,i):i()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,c(b,"constructor",h),c(h,"constructor",g),g.displayName=c(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(d(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,l,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function r(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,l,"next",t)}function l(t){r(a,i,o,s,l,"throw",t)}s(void 0)}))}}function s(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var c,d,u=n(3),p=n(413),f=n(1),g=n(236).version;n(45);function h(t){this.w=t}f.suppressDeprecationWarnings=!0,h.prefixMap={bibo:"http://purl.org/ontology/bibo/",cnt:"http://www.w3.org/2011/content#",cw:"http://cwrc.ca/ns/cw#",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",oa:"http://www.w3.org/ns/oa#",owl:"http://www.w3.org/2002/07/owl#",prov:"http://www.w3.org/ns/prov#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",skos:"http://www.w3.org/2004/02/skos/core#",time:"http://www.w3.org/2006/time#",xsd:"http://www.w3.org/2001/XMLSchema#"},h.namespaces={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",as:"http://www.w3.org/ns/activitystreams#",cwrc:"http://sparql.cwrc.ca/ontologies/cwrc#",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.geonames.org/ontology#",oa:"http://www.w3.org/ns/oa#",schema:"http://schema.org/",xsd:"http://www.w3.org/2001/XMLSchema#"},h.legacyTypes={person:"foaf:Person",org:"foaf:Organization",place:"geo:SpatialThing",title:"dcterms:title",date:"time:TemporalEntity",note:"bibo:Note",citation:"dcterms:BibliographicResource",correction:"oa:editing",keyword:"skos:Concept",link:"oa:linking"},h.prototype={constructor:h,getAnnotationURIForEntity:function(t){var e=f(t.getDateCreated()).format("YYYYMMDDHHmmssSSS"),n="".concat(t.getType(),"_annotation_").concat(e);return encodeURI(n)},commonAnnotation:function(t,e,n){var i=this,o=this.w.getDocumentURI(),r=t.originalData,a=function(){if(!r)return!0;if(t.didUpdate)return!0;var e=t.getRange();if(e.endXPath){if(e.startXPath!==r["oa:hasTarget"]["oa:hasSelector"]["oa:hasStartSelector"]["rdf:value"]||e.endXPath!==r["oa:hasTarget"]["oa:hasSelector"]["oa:hasEndSelector"]["rdf:value"]||e.startOffset!==r["oa:hasTarget"]["oa:hasSelector"]["oa:refinedBy"]["oa:start"]||e.endOffset!==r["oa:hasTarget"]["oa:hasSelector"]["oa:refinedBy"]["oa:end"])return!0}else if(e.startXPath!==r["oa:hasTarget"]["oa:hasSelector"]["rdf:value"])return!0;return r["@id"]!=="".concat(o,"?").concat(i.getAnnotationURIForEntity(t))}();if(r&&!a)return r;void 0===n&&(n="oa:identifying");var l,c=this.w.getUserInfo(),d=window.location.origin,p=t.getDateCreated(),f=t.getDateModified(),m=t.getType(),v=t.getCertainty(),y=t.getRange(),b=t.getURI(),w="".concat(o,"?").concat(this.getAnnotationURIForEntity(t)),_={"@context":{"dcterms:created":{"@type":"xsd:dateTime","@id":"dcterms:created"},"dcterms:issued":{"@type":"xsd:dateTime","@id":"dcterms:issued"},"oa:motivatedBy":{"@type":"oa:Motivation"},"@language":"en"},"@id":w,"@type":"oa:Annotation","dcterms:created":p,"dcterms:modified":f,"dcterms:creator":l=null!=t&&t.creator?t.creator:{"@id":c.id,"@type":["cwrc:NaturalPerson","schema:Person"],"cwrc:hasName":c.name,"foaf:nick":c.nick},"oa:motivatedBy":n,"oa:hasTarget":{"@id":"".concat(w,"#Target"),"@type":"oa:SpecificResource","oa:hasSource":{"@id":o,"@type":"dctypes:Text","dc:format":"text/xml"},"oa:renderedVia":{"@id":d,"@type":"as:Application","rdfs:label":"CWRC Writer","schema:softwareVersion":g}},"oa:hasBody":{"@type":e},"as:generator":{"@id":d,"@type":"as:Application","rdfs:label":"CWRC Writer","schema:url":"https://cwrc-writer.cwrc.ca","schema:softwareVersion":g}};if(t.didUpdate){var x,C,k=!1;if(null!=t&&null!==(x=t.creator)&&void 0!==x&&x["@id"])k=c.id===(null==t||null===(C=t.creator)||void 0===C?void 0:C["@id"]);else k=c.id===l["@id"];var T=!1;if(_["dcterms:contributor"]&&(T=_["dcterms:contributor"].find(contributor=contributor["@id"]===c.id)),!1===k&&!1===T){var E,S={"dcterms:contributor":{"@id":c.id,"@type":["cwrc:NaturalPerson","schema:Persosn"],"cwrc:hasName":c.name,"foaf:nick":c.nick}};null!=t&&null!==(E=t.originalData)&&void 0!==E&&E["dcterms:contributor"]?_["dcterms:contributor"]=[].concat(s(t.originalData["dcterms:contributor"]),[S]):_["dcterms:contributor"]=[S]}}for(var D in h.namespaces)_["@context"][D]=h.namespaces[D];if(b&&"citation"!==m)_["oa:hasBody"]["@id"]=b,_["oa:hasBody"]["dc:format"]="text/plain";else if(t.isNote()){var P=u("#"+t.getId(),this.w.editor.getBody())[0].textContent;_["oa:hasBody"]["dc:format"]="text/plain",_["oa:hasBody"]["rdf:value"]=P}return y.endXPath?_["oa:hasTarget"]["oa:hasSelector"]={"@id":w+"#Selector","@type":"oa:RangeSelector","oa:hasStartSelector":{"@type":"oa:XPathSelector","rdf:value":y.startXPath},"oa:hasEndSelector":{"@type":"oa:XPathSelector","rdf:value":y.endXPath},"oa:refinedBy":{"@type":"oa:TextPositionSelector","oa:start":y.startOffset,"oa:end":y.endOffset}}:_["oa:hasTarget"]["oa:hasSelector"]={"@id":"".concat(w,"#Selector"),"@type":"oa:XPathSelector","rdf:value":y.startXPath},void 0!==v&&(_["oa:hasCertainty"]="cwrc:".concat(v)),_},getAnnotations:(d=a(o().mark((function t(e,n){var i,r,a,s,l,c,d=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||"json",t.next=3,Promise.all(e.map((function(t){return d.getAnnotationString(t,n)})));case 3:for(i=t.sent,r=i.join(""),a=0;a<this.w.triples.length;a++)s=this.w.triples[a],r+='\n<rdf:Description rdf:about="'+s.subject.uri+'" cw:external="'+s.subject.external+'">\n\t<cw:'+s.predicate.name+' cw:text="'+s.predicate.text+'" cw:external="'+s.predicate.external+'">\n\t\t<rdf:Description rdf:about="'+s.object.uri+'" cw:external="'+s.object.external+'" />\n\t</cw:'+s.predicate.name+">\n</rdf:Description>";for(c in l="<rdf:RDF",h.namespaces)l+=" xmlns:"+c+'="'+h.namespaces[c]+'"';return r=(l+=">\n")+r+"</rdf:RDF>",t.abrupt("return",r);case 12:case"end":return t.stop()}}),t,this)}))),function(t,e){return d.apply(this,arguments)}),getAnnotation:function(t){var e=t.getType(),n=this.w.schemaManager.mapper.getMappings().entities[e];return n&&void 0!==n.annotation?n.annotation(this,t):void console.warn("annotationsManager.getAnnotation: no mapping found for",e)},getAnnotationString:(c=a(o().mark((function t(e,n){var i,r,a,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i="",void 0===(r=this.getAnnotation(e))){t.next=19;break}if("xml"!==n){t.next=18;break}return t.prev=4,t.next=7,this.convertJSONAnnotationToXML(r);case 7:a=t.sent,u("rdf\\:Description, Description",a).each(function(t,e){i+="\n",i+=this.w.utilities.xmlToString(e)}.bind(this)),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(4),console.warn("rdflib:",t.t0),s=this.w.utilities.convertTextForExport(t.t0.message),this.w.dialogManager.show("message",{title:"CWRC-Writer Export",msg:"There was an error exporting your document: "+s,type:"error"});case 16:t.next=19;break;case 18:"json"===n&&(i+='\n<rdf:Description rdf:datatype="http://www.w3.org/TR/json-ld/"><![CDATA[\n',i+=JSON.stringify(r,null,"\t"),i+="\n]]></rdf:Description>");case 19:return t.abrupt("return",i);case 20:case"end":return t.stop()}}),t,this,[[4,11]])}))),function(t,e){return c.apply(this,arguments)}),convertJSONAnnotationToXML:function(t){var e=this,n=this.w.getDocumentURI(),i=p.sym(n),o=p.graph();return new Promise((function(n,r){try{p.parse(JSON.stringify(t),o,i.uri,"application/ld+json",(function(t,o){try{var a=p.serialize(i,o,i.uri,"application/rdf+xml");if(void 0!==a){var s=e.w.utilities.stringToXML(a);n(s)}else r(t)}catch(t){r(t)}}))}catch(t){r(t)}}))},getEntityConfigFromAnnotation:function(t){var e=null;return t.parentElement.hasAttribute("xmlns:cw")?("http://www.w3.org/TR/json-ld/"===t.getAttribute("rdf:datatype")?e=this._getEntityConfigFromJsonAnnotationLegacy(t):null!==t.getAttribute("rdf:about")&&(e=this._getEntityConfigFromXmlAnnotationLegacy(t)),e):this.getEntityConfigFromJsonAnnotation(t)},getEntityConfigFromJsonAnnotation:function(t){var e=null,n=u(t),i=JSON.parse(n.text());if(null!=i){(e={}).originalData=i,e.type="",e.range={};var o=i["oa:hasTarget"]["oa:hasSelector"];o["oa:refinedBy"]?(e.range.startXPath=o["oa:hasStartSelector"]["rdf:value"],e.range.startOffset=o["oa:refinedBy"]["oa:start"],e.range.endXPath=o["oa:hasEndSelector"]["rdf:value"],e.range.endOffset=o["oa:refinedBy"]["oa:end"]):e.range.startXPath=o["rdf:value"]}return e},_getEntityConfigFromJsonAnnotationLegacy:function(t){var e=null,n=u(t),i=JSON.parse(n.text());if(null!=i){e={};var o,r=null,a=i.hasBody["@type"];-1!==a.indexOf("cnt:ContentAsText")&&(a=a.concat(i.motivatedBy));for(var s=0;s<a.length;s++){var l=a[s];if(null!=(r=this._getEntityTypeForAnnotationLegacy(l)))break}e.type=r;var c=i.hasTarget.hasSelector;if("oa:TextPositionSelector"==c["@type"]){var d=c["oa:start"],p=c["oa:end"];o=this._getRangeObject(d,p)}else if("oa:FragmentSelector"==c["@type"]){var f=c["rdf:value"];o=this._getRangeObject(f)}e.range=o,i.cwrcInfo&&(e.uri=i.cwrcInfo.uri,e.lemma=i.cwrcInfo.name);var g=i.hasCertainty;void 0!==g&&("reasonable"===(g=g.split(":")[1])&&(g="reasonably certain"),e.certainty=g),e.dateCreated=i.annotatedAt}return e},_getEntityConfigFromXmlAnnotationLegacy:function(t){var e=null,n=u(t);if(-1!==n.attr("rdf:about").indexOf("id.cwrc.ca/annotation")){var i=n.parent("rdf\\:RDF, RDF"),o=n.find("oa\\:hasBody, hasBody").attr("rdf:resource"),r=i.find('[rdf\\:about="'+o+'"]'),a=n.find("oa\\:hasTarget, hasTarget").attr("rdf:resource"),s=i.find('[rdf\\:about="'+a+'"]'),l=r.children().last().attr("rdf:resource");if(null!=l&&-1===l.indexOf("ContentAsText")||(l=n.find("oa\\:motivatedBy, motivatedBy").last().attr("rdf:resource")),null==l)console.warn("can't determine type for",t);else{e={type:this._getEntityTypeForAnnotationLegacy(l)};var c={},d=s.find("oa\\:hasSelector, hasSelector").attr("rdf:resource"),p=i.find('[rdf\\:about="'+d+'"]');if(-1!==p.find("rdf\\:type, type").attr("rdf:resource").indexOf("FragmentSelector")){var f=p.find("rdf\\:value, value").text();c=this._getRangeObject(f)}else{var g=p.find("oa\\:start, start").text(),h=p.find("oa\\:end, end").text();c=this._getRangeObject(g,h)}e.range=c;var m=n.find("cw\\:hasCertainty, hasCertainty").attr("rdf:resource");m&&""!=m&&("reasonable"===(m=m.split("#")[1])&&(m="reasonably certain"),e.certainty=m);var v=n.find("cw\\:cwrcInfo, cwrcInfo").text();""!=v&&(v=JSON.parse(v),e.uri=v.uri,e.lemma=v.name),e.dateCreated=n.find("cw\\:annotatedAt, annotatedAt").text()}}return e},_getEntityTypeForAnnotationLegacy:function(t){if(-1!==t.indexOf("http://"))for(var e in h.prefixMap){var n=h.prefixMap[e];if(0===t.indexOf(n)){t=t.replace(n,e+":");break}}for(var i in h.legacyTypes)if(h.legacyTypes[i]===t)return i;return null},_getRangeObject:function(t,e){function n(t){var e,n=null;if(-1===t.indexOf("string-range")){e=new RegExp(/xpointer\((.*)?\)$/).exec(t)[1]}else{var i=new RegExp(/xpointer\((?:string-range\()?([^\)]*)\)+/).exec(t)[1].split(",");e=i[0],i[2]&&(n=parseInt(i[2]))}return{xpath:e,offset:n}}var i={},o=n(t);if(void 0!==e){var r=n(e);i={startXPath:o.xpath,startOffset:o.offset,endXPath:r.xpath,endOffset:r.offset}}else i={startXPath:o.xpath};return i}},t.exports=h},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE__413__},,,,,,,,,function(module,exports,__webpack_require__){function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var jQuery=__webpack_require__(3);(function($){var min=Math.min,max=Math.max,round=Math.floor,isStr=function(t){return"string"===$.type(t)},runPluginCallbacks=function runPluginCallbacks(Instance,a_fn){if($.isArray(a_fn))for(var i=0,c=a_fn.length;i<c;i++){var fn=a_fn[i];try{isStr(fn)&&(fn=eval(fn)),$.isFunction(fn)&&g(fn)(Instance)}catch(t){}}function g(t){return t}},u,m,b,v,ie,cm,$s,bs,bm,lb;$.layout={version:"1.6.0",revision:1.0601,browser:{},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(t){var e=$(t),n=e.data("layout")||e.data("parentLayout");if(n){var i=n.container;if(i.data("layoutPane"))return i;var o=i.closest("."+$.layout.defaults.panes.paneClass);if(o.data("layoutPane"))return o}return null},getParentPaneInstance:function(t){var e=$.layout.getParentPaneElem(t);return e?e.data("layoutPane"):null},getParentLayoutInstance:function(t){var e=$.layout.getParentPaneElem(t);return e?e.data("parentLayout"):null},getEventObject:function(t){return"object"===_typeof(t)&&t.stopPropagation?t:null},parsePaneName:function(t){var e=$.layout.getEventObject(t),n=t;return e&&(e.stopPropagation(),n=$(this).data("layoutEdge")),n&&!/^(west|east|north|south|center)$/.test(n)&&($.layout.msg('LAYOUT ERROR - Invalid pane-name: "'+n+'"'),n="error"),n},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&($.effects.slide||$.effects.effect&&$.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize("height")},getScrollbarSize:function(t){var e=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; border: 0; overflow: scroll;"></div>').appendTo("body"),n={width:e.outerWidth-e[0].clientWidth,height:100-e[0].clientHeight};return e.remove(),window.scrollbarWidth=n.width,window.scrollbarHeight=n.height,t.match(/^(width|height)$/)?n[t]:n},disableTextSelection:function(){var t=$(document),e="textSelectionDisabled",n="textSelectionInitialized";$.fn.disableSelection&&(t.data(n)||t.on("mouseup",$.layout.enableTextSelection).data(n,!0),t.data(e)||t.disableSelection().data(e,!0))},enableTextSelection:function(){var t=$(document),e="textSelectionDisabled";$.fn.enableSelection&&t.data(e)&&t.enableSelection().data(e,!1)},showInvisibly:function(t,e){if(t&&t.length&&(e||"none"===t.css("display"))){var n=t[0].style,i={display:n.display||"",visibility:n.visibility||""};return t.css({display:"block",visibility:"hidden"}),i}return{}},getElementDimensions:function(t,e){var n,i,o,r={css:{},inset:{}},a=r.css,s={bottom:0},l=$.layout.cssNum,c=Math.round,d=t.offset();return r.offsetLeft=d.left,r.offsetTop=d.top,e||(e={}),$.each("Left,Right,Top,Bottom".split(","),(function(l,c){n=a["border"+c]=$.layout.borderWidth(t,c),i=a["padding"+c]=$.layout.cssNum(t,"padding"+c),o=c.toLowerCase(),r.inset[o]=e[o]>=0?e[o]:i,s[o]=r.inset[o]+n})),a.width=c(t.width()),a.height=c(t.height()),a.top=l(t,"top",!0),a.bottom=l(t,"bottom",!0),a.left=l(t,"left",!0),a.right=l(t,"right",!0),r.outerWidth=c(t.outerWidth()),r.outerHeight=c(t.outerHeight()),r.innerWidth=max(0,r.outerWidth-s.left-s.right),r.innerHeight=max(0,r.outerHeight-s.top-s.bottom),r.layoutWidth=c(t.innerWidth()),r.layoutHeight=c(t.innerHeight()),r},getElementStyles:function(t,e){var n,i,o,r,a,s,l={},c=t[0].style,d=e.split(","),u="Top,Bottom,Left,Right".split(","),p="Color,Style,Width".split(",");for(r=0;r<d.length;r++)if((n=d[r]).match(/(border|padding|margin)$/))for(a=0;a<4;a++)if(i=u[a],"border"===n)for(s=0;s<3;s++)l[n+i+(o=p[s])]=c[n+i+o];else l[n+i]=c[n+i];else l[n]=c[n];return l},cssWidth:function(t,e){if(e<=0)return 0;var n=$.layout.browser,i=n.boxModel?n.boxSizing?t.css("boxSizing"):"content-box":"border-box",o=$.layout.borderWidth,r=$.layout.cssNum,a=e;return"border-box"!==i&&(a-=o(t,"Left")+o(t,"Right")),"content-box"===i&&(a-=r(t,"paddingLeft")+r(t,"paddingRight")),max(0,a)},cssHeight:function(t,e){if(e<=0)return 0;var n=$.layout.browser,i=n.boxModel?n.boxSizing?t.css("boxSizing"):"content-box":"border-box",o=$.layout.borderWidth,r=$.layout.cssNum,a=e;return"border-box"!==i&&(a-=o(t,"Top")+o(t,"Bottom")),"content-box"===i&&(a-=r(t,"paddingTop")+r(t,"paddingBottom")),max(0,a)},cssNum:function(t,e,n){t.jquery||(t=$(t));var i=$.layout.showInvisibly(t),o=$.css(t[0],e,!0),r=n&&"auto"==o?o:Math.round(parseFloat(o)||0);return t.css(i),r},borderWidth:function(t,e){t.jquery&&(t=t[0]);var n="border"+e.substr(0,1).toUpperCase()+e.substr(1);return"none"===$.css(t,n+"Style",!0)?0:Math.round(parseFloat($.css(t,n+"Width",!0))||0)},isMouseOverElem:function(t,e){var n=$(e||this),i=n.offset(),o=i.top,r=i.left,a=r+n.outerWidth(),s=o+n.outerHeight(),l=t.pageX,c=t.pageY;return $.layout.browser.msie&&l<0&&c<0||l>=r&&l<=a&&c>=o&&c<=s},msg:function(t,e,n,i){if($.isPlainObject(t)&&window.debugData){"string"==typeof e?(i=n,n=e):"object"===_typeof(n)&&(i=n,n=null);var o=n||"log( <object> )",r=$.extend({sort:!1,returnHTML:!1,display:!1},i);!0===e||r.display?debugData(t,o,r):window.console&&console.log(debugData(t,o,r))}else if(e)alert(t);else if(window.console)console.log(t);else{var a=$("#layoutLogger");a.length||(a=function(){var t=$.support.fixedPosition?"fixed":"absolute",e=$('<div id="layoutLogger" style="position: '+t+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);"><div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;"><span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div><ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul></div>').appendTo("body");e.css("left",$(window).width()-e.outerWidth()-5),$.ui.draggable&&e.draggable({handle:":first-child"});return e}()),a.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</li>")}}},u=navigator.userAgent.toLowerCase(),m=/(chrome)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+)/.exec(u)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(u)||/(msie) ([\w.]+)/.exec(u)||u.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(u)||[],b=m[1]||"",v=m[2]||0,ie="msie"===b,cm=document.compatMode,$s=$.support,bs=void 0!==$s.boxSizing?$s.boxSizing:$s.boxSizingReliable,bm=!ie||!cm||"CSS1Compat"===cm||$s.boxModel||!1,lb=$.layout.browser={version:v,safari:"webkit"===b,webkit:"chrome"===b,msie:ie,isIE6:ie&&6==v,boxModel:bm,boxSizing:!!("function"==typeof bs?bs():bs)},b&&(lb[b]=!0),bm||cm||$((function(){lb.boxModel=$s.boxModel})),$.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:!0,resizeWithWindow:!0,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:!1,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:!0,showErrorMessages:!0,showDebugMessages:!1,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button\nInvalid ",containerMissing:"UI Layout Initialization Error\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\nThe center-pane element does not exist.\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\nThe layout-container \"CONTAINER\" has no height.\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:!1,responsive:{enabled:!1,when:"xl",sizes:{xl:1140,lg:992,md:768,sm:576,xs:0}},closable:!0,resizable:!0,slidable:!0,initClosed:!1,initHidden:!1,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:!1,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:!0,autoResize:!0,autoReopen:!0,resizerDragOpacity:1,maskContents:!1,maskObjects:!1,maskZindex:null,resizingGrid:!1,livePaneResizing:!1,liveContentResizing:!1,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:!1,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:!1,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:!1,enableCursorHotkey:!0,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:!0,animatePaneSizing:!1,children:null,containerSelector:"",initChildren:!0,destroyChildren:!0,resizeChildren:!0,triggerEventsOnLoad:!1,triggerEventsDuringLiveResize:!0,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:function(){},onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}},$.layout.optionsMap={layout:"name,instanceKey,stateManagement,effects,inset,zIndexes,errors,zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,onresizeall,onresizeall_start,onresizeall_end,onload,onload_start,onload_end,onunload,onunload_start,onunload_end".split(","),center:"paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,showOverflowOnHover,maskContents,maskObjects,liveContentResizing,containerSelector,children,initChildren,resizeChildren,destroyChildren,onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end".split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")},$.layout.transformData=function(t,e){var n,i,o,r,a,s,l,c=e?{panes:{},center:{}}:{};if("object"!==_typeof(t))return c;for(i in t)for(n=c,a=t[i],l=(o=i.split("__")).length-1,s=0;s<=l;s++)r=o[s],s===l?$.isPlainObject(a)?n[r]=$.layout.transformData(a):n[r]=a:(n[r]||(n[r]={}),n=n[r]);return c},$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(t){var e,n,i,o=$.layout.backwardCompatibility.map;for(var r in o)void 0!==(i=(e=a(r)).branch[e.key])&&((n=a(o[r],!0)).branch[n.key]=i,delete e.branch[e.key]);function a(e,n){for(var i,o=e.split("."),r=o.length-1,a={branch:t,key:o[r]},s=0;s<r;s++)i=o[s],void 0===a.branch[i]?a.branch=n?a.branch[i]={}:{}:a.branch=a.branch[i];return a}},renameAllOptions:function(t){var e=$.layout.backwardCompatibility.renameOptions;return e(t),t.defaults&&("object"!==_typeof(t.panes)&&(t.panes={}),$.extend(!0,t.panes,t.defaults),delete t.defaults),t.panes&&e(t.panes),$.each($.layout.config.allPanes,(function(n,i){t[i]&&e(t[i])})),t}},$.fn.layout=function(opts){var browser=$.layout.browser,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,styles=$.layout.getElementStyles,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(!0,{},$.layout.defaults),effects=options.effects=$.extend(!0,{},$.layout.effects),state={id:"layout"+$.now(),initialized:!1,paneResizing:!1,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(t,e,n){timer.clear(t),timer.data[t]=setTimeout(e,n)},clear:function(t){var e=timer.data;e[t]&&(clearTimeout(e[t]),delete e[t])}},_log=function(t,e,n){var i=options;return(i.showErrorMessages&&!n||n&&i.showDebugMessages)&&$.layout.msg(i.name+" / "+t,!1!==e),!1},_runCallbacks=function _runCallbacks(evtName,pane,skipBoundEvents){var hasPane=pane&&isStr(pane),s=hasPane?state[pane]:state,o=hasPane?options[pane]:options,lName=options.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P=hasPane?$Ps[pane]:0;if(hasPane&&!$P)return retVal;if(hasPane||"boolean"!==$.type(pane)||(skipBoundEvents=pane,pane=""),fn)try{isStr(fn)&&(fn.match(/,/)?(args=fn.split(","),fn=eval(args[0])):fn=eval(fn)),$.isFunction(fn)&&(retVal=args.length?g(fn)(args[1]):hasPane?g(fn)(pane,$Ps[pane],s,o,lName):g(fn)(Instance,s,o,lName))}catch(t){_log(options.errors.callbackError.replace(/EVENT/,$.trim((pane||"")+" "+lng)),!1),"string"===$.type(t)&&string.length&&_log("Exception:  "+t,!1)}return skipBoundEvents||!1===retVal||(hasPane?(o=options[pane],s=state[pane],$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]),shrt&&$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])):($N.triggerHandler("layout"+lng,[Instance,s,o,lName]),shrt&&$N.triggerHandler("layout"+shrt,[Instance,s,o,lName]))),hasPane&&"onresize_end"===evtName&&resizeChildren(pane+"",!0),retVal;function g(t){return t}},_fixIframe=function(t){if(!browser.mozilla){var e=$Ps[t];"IFRAME"===state[t].tagName?e.css(_c.hidden).css(_c.visible):e.find("IFRAME").css(_c.hidden).css(_c.visible)}},cssSize=function(t,e){return("horz"==_c[t].dir?cssH:cssW)($Ps[t],e)},cssMinDims=function(t){var e=$Ps[t],n=_c[t].dir,i={minWidth:1001-cssW(e,1e3),minHeight:1001-cssH(e,1e3)};return"horz"===n&&(i.minSize=i.minHeight),"vert"===n&&(i.minSize=i.minWidth),i},setOuterWidth=function(t,e,n){var i,o=t;isStr(t)?o=$Ps[t]:t.jquery||(o=$(t)),i=cssW(o,e),o.css({width:i}),i>0?n&&o.data("autoHidden")&&o.innerHeight()>0&&(o.show().data("autoHidden",!1),browser.mozilla||o.css(_c.hidden).css(_c.visible)):n&&!o.data("autoHidden")&&o.hide().data("autoHidden",!0)},setOuterHeight=function(t,e,n){var i,o=t;isStr(t)?o=$Ps[t]:t.jquery||(o=$(t)),i=cssH(o,e),o.css({height:i,visibility:"visible"}),i>0&&o.innerWidth()>0?n&&o.data("autoHidden")&&(o.show().data("autoHidden",!1),browser.mozilla||o.css(_c.hidden).css(_c.visible)):n&&!o.data("autoHidden")&&o.hide().data("autoHidden",!0)},_parseSize=function(t,e,n){if(n||(n=_c[t].dir),isStr(e)&&e.match(/%/)&&(e="100%"===e?-1:parseInt(e,10)/100),0===e)return 0;if(e>=1)return parseInt(e,10);var i=options,o=0;if("horz"==n?o=sC.innerHeight-($Ps.north?i.north.spacing_open:0)-($Ps.south?i.south.spacing_open:0):"vert"==n&&(o=sC.innerWidth-($Ps.west?i.west.spacing_open:0)-($Ps.east?i.east.spacing_open:0)),-1===e)return o;if(e>0)return round(o*e);if("center"==t)return 0;var r="horz"===n?"height":"width",a=$Ps[t],s="height"===r&&$Cs[t],l=$.layout.showInvisibly(a),c=a.css(r),d=s?s.css(r):0;return a.css(r,"auto"),s&&s.css(r,"auto"),e="height"===r?a.outerHeight():a.outerWidth(),a.css(r,c).css(l),s&&s.css(r,d),e},getPaneSize=function(t,e){var n=$Ps[t],i=options[t],o=state[t],r=e?i.spacing_open:0,a=e?i.spacing_closed:0;return!n||o.isHidden?0:o.isClosed||o.isSliding&&e?a:"horz"===_c[t].dir?n.outerHeight()+r:n.outerWidth()+r},setSizeLimits=function(t,e){if(isInitialized()){var n=options[t],i=state[t],o=_c[t],r=o.dir,a=(o.sizeType.toLowerCase(),null!=e?e:i.isSliding),s=($Ps[t],n.spacing_open),l=_c.oppositeEdge[t],c=state[l],d=$Ps[l],u=!d||!1===c.isVisible||c.isSliding?0:"horz"==r?d.outerHeight():d.outerWidth(),p=(!d||c.isHidden?0:options[l][!1!==c.isClosed?"spacing_closed":"spacing_open"])||0,f="horz"==r?sC.innerHeight:sC.innerWidth,g=cssMinDims("center"),h="horz"==r?max(options.center.minHeight,g.minHeight):max(options.center.minWidth,g.minWidth),m=f-s-(a?0:_parseSize("center",h,r)+u+p),v=i.minSize=max(_parseSize(t,n.minSize),cssMinDims(t).minSize),y=i.maxSize=min(n.maxSize?_parseSize(t,n.maxSize):1e5,m),b=i.resizerPosition={},w=sC.inset.top,_=sC.inset.left,x=sC.innerWidth,C=sC.innerHeight,k=n.spacing_open;switch(t){case"north":b.min=w+v,b.max=w+y;break;case"west":b.min=_+v,b.max=_+y;break;case"south":b.min=w+C-y-k,b.max=w+C-v-k;break;case"east":b.min=_+x-y-k,b.max=_+x-v-k}}},calcNewCenterPaneDims=function(){var t={top:getPaneSize("north",!0),bottom:getPaneSize("south",!0),left:getPaneSize("west",!0),right:getPaneSize("east",!0),width:0,height:0};return t.width=sC.innerWidth-t.left-t.right,t.height=sC.innerHeight-t.bottom-t.top,t.top+=sC.inset.top,t.bottom+=sC.inset.bottom,t.left+=sC.inset.left,t.right+=sC.inset.right,t},getHoverClasses=function(t,e){var n=$(t),i=n.data("layoutRole"),o=n.data("layoutEdge"),r=options[o][i+"Class"],a="-"+o,s="-open",l="-closed",c="-sliding",d="-hover ",u=n.hasClass(r+l)?l:s,p=u===l?s:l,f=r+d+(r+a+d)+(r+u+d)+(r+a+u+d);return e&&(f+=r+p+d+(r+a+p+d)),"resizer"==i&&n.hasClass(r+c)&&(f+=r+c+d+(r+a+c+d)),$.trim(f)},addHover=function(t,e){var n=$(e||this);t&&"toggler"===n.data("layoutRole")&&t.stopPropagation(),n.addClass(getHoverClasses(n))},removeHover=function(t,e){var n=$(e||this);n.removeClass(getHoverClasses(n,!0))},onResizerEnter=function(t){var e=$(this).data("layoutEdge"),n=state[e];$(document);n.isResizing||state.paneResizing||options.maskPanesEarly&&showMasks(e,{resizing:!0})},onResizerLeave=function t(e,n){var i=n||this,o=$(i).data("layoutEdge"),r=o+"ResizerLeave";$(document);timer.clear(o+"_openSlider"),timer.clear(r),n?options.maskPanesEarly&&!state.paneResizing&&hideMasks():timer.set(r,(function(){t(e,i)}),200)},_create=function(){initOptions();var t=options,e=state;return e.creatingLayout=!0,runPluginCallbacks(Instance,$.layout.onCreate),!1===_runCallbacks("onload_start")?"cancel":(_initContainer(),initHotkeys(),$(window).on("unload."+sID,unload),runPluginCallbacks(Instance,$.layout.onLoad),t.initPanes&&_initLayoutElements(),delete e.creatingLayout,resizeAll(),$.each(["south","north","east","west"],(function(n,i){if($Ps[i]){t=options[i],e=state[i];$Ps[i];t.initHidden?hide(i):t.initClosed&&close(i)}})),state.initialized)},isInitialized=function(){return!(!state.initialized&&!state.creatingLayout)||_initLayoutElements()},_initLayoutElements=function t(e){var n=options;if(!$N.is(":visible"))return!e&&browser.webkit&&"BODY"===$N[0].tagName&&setTimeout((function(){t(!0)}),50),!1;if(!getPane("center").length)return _log(n.errors.centerPaneMissing);if(state.creatingLayout=!0,$.extend(sC,elDims($N,n.inset)),initPanes(),n.scrollToBookmarkOnLoad){var i=self.location;i.hash&&i.replace(i.hash)}return Instance.hasParentLayout?n.resizeWithWindow=!1:n.resizeWithWindow&&$(window).on("resize."+sID,windowResize),delete state.creatingLayout,state.initialized=!0,runPluginCallbacks(Instance,$.layout.onReady),_runCallbacks("onload_end"),!0},createChildren=function(t,e){var n=evtPane.call(this,t),i=$Ps[n];if(i){var o=$Cs[n],r=state[n],a=options[n],s=options.stateManagement||{},l=e?a.children=e:a.children;if($.isPlainObject(l))l=[l];else if(!l||!$.isArray(l))return;$.each(l,(function(t,e){$.isPlainObject(e)&&(e.containerSelector?i.find(e.containerSelector):o||i).each((function(){var t=$(this),i=t.data("layout");if(!i){if(setInstanceKey({container:t,options:e},r),s.includeChildren&&state.stateData[n]){var o=(state.stateData[n].children||{})[e.instanceKey],a=e.stateManagement||(e.stateManagement={autoLoad:!0});!0===a.autoLoad&&o&&(a.autoSave=!1,a.includeChildren=!0,a.autoLoad=$.extend(!0,{},o))}(i=t.layout(e))&&refreshChildren(n,i)}}))}))}},setInstanceKey=function(t,e){var n=t.container,i=t.options,o=i.stateManagement,r=i.instanceKey||n.data("layoutInstanceKey");return r||(r=(o&&o.cookie?o.cookie.name:"")||i.name),r=r?r.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_"):"layout"+ ++e.childIdx,i.instanceKey=r,n.data("layoutInstanceKey",r),r},refreshChildren=function(t,e){var n,i=$Ps[t],o=children[t],r=state[t];$.isPlainObject(o)&&($.each(o,(function(t,e){e.destroyed&&delete o[t]})),$.isEmptyObject(o)&&(o=children[t]=null)),e||o||(e=i.data("layout")),e&&(e.hasParentLayout=!0,n=e.options,setInstanceKey(e,r),o||(o=children[t]={}),o[n.instanceKey]=e.container.data("layout")),Instance[t].children=children[t],e||createChildren(t)},windowResize=function(){var t=options,e=Number(t.resizeWithWindowDelay);e<10&&(e=100),timer.clear("winResize"),timer.set("winResize",(function(){timer.clear("winResize"),timer.clear("winResizeRepeater");var e=elDims($N,t.inset);e.innerWidth===sC.innerWidth&&e.innerHeight===sC.innerHeight||resizeAll()}),e),timer.data.winResizeRepeater||setWindowResizeRepeater()},setWindowResizeRepeater=function t(){var e=Number(options.resizeWithWindowMaxDelay);e>0&&timer.set("winResizeRepeater",(function(){t(),resizeAll()}),e)},unload=function(){_runCallbacks("onunload_start"),runPluginCallbacks(Instance,$.layout.onUnload),_runCallbacks("onunload_end")},_initContainer=function(){var t,e,n=$N[0],i=$("html"),o=sC.tagName=n.tagName,r=sC.id=n.id,a=sC.className=n.className,s=options,l=s.name,c="position,margin,padding,border",d="layoutCSS",u={},p="hidden",f=$N.data("parentLayout"),g=$N.data("layoutEdge"),h=f&&g,m=$.layout.cssNum;sC.ref=(s.name?s.name+" layout / ":"")+o+(r?"#"+r:a?".["+a+"]":""),sC.isBody="BODY"===o,h||sC.isBody||(f=(t=$N.closest("."+$.layout.defaults.panes.paneClass)).data("parentLayout"),g=t.data("layoutEdge"),h=f&&g),$N.data({layout:Instance,layoutContainer:sID}).addClass(s.containerClass);var v={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(l in v)$N.on("layout"+l.toLowerCase()+"."+sID,Instance[v[l]||l]);h&&(Instance.hasParentLayout=!0,f.refreshChildren(g,Instance)),$N.data(d)||(sC.isBody?($N.data(d,$.extend(styles($N,c),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")})),i.data(d,$.extend(styles(i,"padding"),{height:"auto",overflow:i.css("overflow"),overflowX:i.css("overflowX"),overflowY:i.css("overflowY")}))):$N.data(d,styles($N,c+",top,bottom,left,right,width,height,overflow,overflowX,overflowY")));try{if(u={overflow:p,overflowX:p,overflowY:p},$N.css(u),s.inset&&!$.isPlainObject(s.inset)&&(e=parseInt(s.inset,10)||0,s.inset={top:e,bottom:e,left:e,right:e}),sC.isBody)s.outset?$.isPlainObject(s.outset)||(e=parseInt(s.outset,10)||0,s.outset={top:e,bottom:e,left:e,right:e}):s.outset={top:m(i,"paddingTop"),bottom:m(i,"paddingBottom"),left:m(i,"paddingLeft"),right:m(i,"paddingRight")},i.css(u).css({height:"100%",border:"none",padding:0,margin:0}),browser.isIE6?($N.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"}),s.inset||(s.inset=elDims($N).inset)):($N.css({width:"auto",height:"auto",margin:0,position:"absolute"}),$N.css(s.outset)),$.extend(sC,elDims($N,s.inset));else{var y=$N.css("position");y&&y.match(/(fixed|absolute|relative)/)||$N.css("position","relative"),$N.is(":visible")&&($.extend(sC,elDims($N,s.inset)),sC.innerHeight<1&&_log(s.errors.noContainerHeight.replace(/CONTAINER/,sC.ref)))}m($N,"minWidth")&&$N.parent().css("overflowX","auto"),m($N,"minHeight")&&$N.parent().css("overflowY","auto")}catch(t){}},initHotkeys=function(t){t=t?t.split(","):_c.borderPanes,$.each(t,(function(t,e){var n=options[e];if(n.enableCursorHotkey||n.customHotkey)return $(document).on("keydown."+sID,keyDown),!1}))},initOptions=function(){var t,e,n,i,o,r,a;if(opts=$.layout.transformData(opts,!0),opts=$.layout.backwardCompatibility.renameAllOptions(opts),!$.isEmptyObject(opts.panes)){for(t=$.layout.optionsMap.noDefault,o=0,r=t.length;o<r;o++)n=t[o],delete opts.panes[n];for(t=$.layout.optionsMap.layout,o=0,r=t.length;o<r;o++)n=t[o],delete opts.panes[n]}t=$.layout.optionsMap.layout;var s=$.layout.config.optionRootKeys;for(n in opts)i=opts[n],$.inArray(n,s)<0&&$.inArray(n,t)<0&&(opts.panes[n]||(opts.panes[n]=$.isPlainObject(i)?$.extend(!0,{},i):i),delete opts[n]);$.extend(!0,options,opts),$.each(_c.allPanes,(function(i,o){if(_c[o]=$.extend(!0,{},_c.panes,_c[o]),e=options.panes,a=options[o],"center"===o)for(t=$.layout.optionsMap.center,i=0,r=t.length;i<r;i++)n=t[i],opts.center[n]||!opts.panes[n]&&a[n]||(a[n]=e[n]);else a=options[o]=$.extend(!0,{},e,a),function(t){var e=options[t],n=options.panes;e.fxSettings||(e.fxSettings={});n.fxSettings||(n.fxSettings={});$.each(["_open","_close","_size"],(function(i,o){var r="fxName"+o,a="fxSpeed"+o,s="fxSettings"+o,l=e[r]=e[r]||n[r]||e.fxName||n.fxName||"none",c=$.effects&&($.effects[l]||$.effects.effect&&$.effects.effect[l]);"none"!==l&&options.effects[l]&&c||(l=e[r]="none");var d=options.effects[l]||{},u=d.all||null,p=d[t]||null;e[a]=e[a]||n[a]||e.fxSpeed||n.fxSpeed||null,e[s]=$.extend(!0,{},u,p,n.fxSettings,e.fxSettings,n[s],e[s])})),delete e.fxName,delete e.fxSpeed,delete e.fxSettings}(o),a.resizerClass||(a.resizerClass="ui-layout-resizer"),a.togglerClass||(a.togglerClass="ui-layout-toggler");a.paneClass||(a.paneClass="ui-layout-pane")}));var l=opts.zIndex,c=options.zIndexes;l>0&&(c.pane_normal=l,c.content_mask=max(l+1,c.content_mask),c.resizer_normal=max(l+2,c.resizer_normal)),delete options.panes},getPane=function(t){var e=options[t].paneSelector;if("#"===e.substr(0,1))return $N.find(e).eq(0);var n=$N.children(e).eq(0);return n.length?n:$N.children("form:first").children(e).eq(0)},initPanes=function(t){evtPane(t),$.each(_c.allPanes,(function(t,e){addPane(e,!0)})),initHandles(),$.each(_c.borderPanes,(function(t,e){$Ps[e]&&state[e].isVisible&&(setSizeLimits(e),makePaneFit(e))})),sizeMidPanes("center"),$.each(_c.allPanes,(function(t,e){afterInitPane(e)}))},addPane=function(t,e){if(e||isInitialized()){var n,i,o,r=options[t],a=state[t],s=_c[t],l=s.dir,c=(a.fx,r.spacing_open,"center"===t),d={},u=$Ps[t];if(u?removePane(t,!1,!0,!1):$Cs[t]=!1,(u=$Ps[t]=getPane(t)).length){if(!u.data("layoutCSS")){u.data("layoutCSS",styles(u,"position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border"))}Instance[t]={name:t,pane:$Ps[t],content:$Cs[t],options:options[t],state:state[t],children:children[t]},u.data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"pane"}).css(s.cssReq).css("zIndex",options.zIndexes.pane_normal).css(r.applyDemoStyles?s.cssDemo:{}).addClass(r.paneClass+" "+r.paneClass+"-"+t).on("mouseenter."+sID,addHover).on("mouseleave."+sID,removeHover);var p,f={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"};for(p in f)u.on("layoutpane"+p.toLowerCase()+"."+sID,Instance[f[p]||p]);initContent(t,!1),c||(n=a.size=_parseSize(t,r.size),i=_parseSize(t,r.minSize)||1,o=_parseSize(t,r.maxSize)||1e5,n>0&&(n=max(min(n,o),i)),a.autoResize=r.autoResize,a.isClosed=!1,a.isSliding=!1,a.isResizing=!1,a.isHidden=!1,a.pins||(a.pins=[])),a.tagName=u[0].tagName,a.edge=t,a.noRoom=!1,a.isVisible=!0,setPanePosition(t),"horz"===l?d.height=cssH(u,n):"vert"===l&&(d.width=cssW(u,n)),u.css(d),"horz"!=l&&sizeMidPanes(t,!0),state.initialized&&(initHandles(t),initHotkeys(t)),r.initClosed&&r.closable&&!r.initHidden?close(t,!0,!0):r.initHidden||r.initClosed?hide(t):a.noRoom||u.css("display","block"),u.css("visibility","visible"),r.showOverflowOnHover&&u.hover(allowOverflow,resetOverflow),state.initialized&&afterInitPane(t)}else $Ps[t]=!1}},afterInitPane=function(t){var e=$Ps[t],n=state[t],i=options[t];e&&(e.data("layout")&&refreshChildren(t,e.data("layout")),n.isVisible&&(state.initialized?resizeAll():sizeContent(t),i.triggerEventsOnLoad?_runCallbacks("onresize_end",t):resizeChildren(t,!0)),i.initChildren&&i.children&&createChildren(t))},setPanePosition=function(t){t=t?t.split(","):_c.borderPanes,$.each(t,(function(t,e){var n=$Ps[e],i=$Rs[e],o=(options[e],state[e]),r=_c[e].side,a={};if(n){switch(e){case"north":a.top=sC.inset.top,a.left=sC.inset.left,a.right=sC.inset.right;break;case"south":a.bottom=sC.inset.bottom,a.left=sC.inset.left,a.right=sC.inset.right;break;case"west":a.left=sC.inset.left;break;case"east":a.right=sC.inset.right}n.css(a),i&&o.isClosed?i.css(r,sC.inset[r]):i&&!o.isHidden&&i.css(r,sC.inset[r]+getPaneSize(e))}}))},initHandles=function(t){t=t?t.split(","):_c.borderPanes,$.each(t,(function(t,e){var n=$Ps[e];if($Rs[e]=!1,$Ts[e]=!1,n){var i=options[e],o=state[e],r=(_c[e],"#"===i.paneSelector.substr(0,1)?i.paneSelector.substr(1):""),a=i.resizerClass,s=i.togglerClass,l=(o.isVisible?i.spacing_open:i.spacing_closed,"-"+e),c=(o.isVisible,Instance[e]),d=c.resizer=$Rs[e]=$("<div></div>"),u=c.toggler=!!i.closable&&($Ts[e]=$("<div></div>"));if(!o.isVisible&&i.slidable&&d.attr("title",i.tips.Slide).css("cursor",i.sliderCursor),d.attr("id",r?r+"-resizer":"").data({parentLayout:Instance,layoutPane:Instance[e],layoutEdge:e,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(i.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(a+" "+a+l).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).mousedown($.layout.disableTextSelection).mouseup($.layout.enableTextSelection).appendTo($N),$.fn.disableSelection&&d.disableSelection(),i.resizerDblClickToggle&&d.on("dblclick."+sID,toggle),u){var p;if(u.attr("id",r?r+"-toggler":"").data({parentLayout:Instance,layoutPane:Instance[e],layoutEdge:e,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(i.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(s+" "+s+l).hover(addHover,removeHover).on("mouseenter",onResizerEnter).appendTo(d),i.togglerContent_open)(p=$(i.togglerContent_open))?p.data({layoutEdge:e,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",e).addClass("content content-open").css("display","none").appendTo(u):(p=$.parseHTML(i.togglerContent_open),toglElem?p.data({layoutEdge:e,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",e).addClass("content content-open").css("display","none").appendTo(u):$("<span>"+i.togglerContent_open+"</span>").data({layoutEdge:e,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",e).addClass("content content-open").css("display","none").appendTo(u));if(i.togglerContent_closed)(p=$(i.togglerContent_closed))||(p=$.parseHTML(i.togglerContent_closed))?p.data({layoutEdge:e,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(u):$("<span>"+i.togglerContent_closed+"</span>").data({layoutEdge:e,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(u);enableClosable(e)}initResizable(e),o.isVisible?setAsOpen(e):(setAsClosed(e),bindStartSlidingEvents(e,!0))}})),sizeHandles()},initContent=function(t,e){if(isInitialized()){var n,i=options[t],o=i.contentSelector,r=Instance[t],a=$Ps[t];o&&(n=r.content=$Cs[t]=i.findNestedContent?a.find(o).eq(0):a.children(o).eq(0)),n&&n.length?(n.data("layoutRole","content"),n.data("layoutCSS")||n.data("layoutCSS",styles(n,"height")),n.css(_c.content.cssReq),i.applyDemoStyles&&(n.css(_c.content.cssDemo),a.css(_c.content.cssDemoPane)),a.css("overflowX").match(/(scroll|auto)/)&&a.css("overflow","hidden"),state[t].content={},!1!==e&&sizeContent(t)):r.content=$Cs[t]=!1}},initResizable=function(t){var e=$.layout.plugins.draggable;t=t?t.split(","):_c.borderPanes,$.each(t,(function(t,i){var o=options[i];if(!e||!$Ps[i]||!o.resizable)return o.resizable=!1,!0;var r,a,s=state[i],l=options.zIndexes,c=_c[i],d="horz"==c.dir?"top":"left",u=($Ps[i],$Rs[i]),p=o.resizerClass,f=0,g=p+"-drag",h=p+"-"+i+"-drag",m=p+"-dragging",v=p+"-"+i+"-dragging",y=p+"-dragging-limit",b=p+"-"+i+"-dragging-limit",w=!1;s.isClosed||u.attr("title",o.tips.Resize).css("cursor",o.resizerCursor),u.draggable({containment:$N[0],axis:"horz"==c.dir?"y":"x",delay:0,distance:1,grid:o.resizingGrid,helper:"clone",opacity:o.resizerDragOpacity,addClasses:!1,zIndex:l.resizer_drag,start:function(t,e){if(o=options[i],s=state[i],a=o.livePaneResizing,!1===_runCallbacks("ondrag_start",i))return!1;s.isResizing=!0,state.paneResizing=i,timer.clear(i+"_closeSlider"),setSizeLimits(i),r=s.resizerPosition,f=e.position[d],u.addClass(g+" "+h),w=!1,showMasks(i,{resizing:!0})},drag:function(t,e){w||(e.helper.addClass(m+" "+v).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden"),w=!0,s.isSliding&&$Ps[i].css("zIndex",l.pane_sliding));var c=0;e.position[d]<r.min?(e.position[d]=r.min,c=-1):e.position[d]>r.max&&(e.position[d]=r.max,c=1),c?(e.helper.addClass(y+" "+b),window.defaultStatus=c>0&&i.match(/(north|west)/)||c<0&&i.match(/(south|east)/)?o.tips.maxSizeWarning:o.tips.minSizeWarning):(e.helper.removeClass(y+" "+b),window.defaultStatus=""),a&&Math.abs(e.position[d]-f)>=o.liveResizingTolerance&&(f=e.position[d],n(t,e,i))},stop:function(t,e){$("body").enableSelection(),window.defaultStatus="",u.removeClass(g+" "+h),s.isResizing=!1,state.paneResizing=!1,n(t,e,i,!0)}})}));var n=function(t,e,n,i){var o,r=e.position,a=_c[n],s=options[n],l=state[n];switch(n){case"north":o=r.top;break;case"west":o=r.left;break;case"south":o=sC.layoutHeight-r.top-s.spacing_open;break;case"east":o=sC.layoutWidth-r.left-s.spacing_open}var c=o-sC.inset[a.side];if(i)!1!==_runCallbacks("ondrag_end",n)&&manualSizePane(n,c,!1,!0),hideMasks(!0),l.isSliding&&showMasks(n,{resizing:!0});else{if(Math.abs(c-l.size)<s.liveResizingTolerance)return;manualSizePane(n,c,!1,!0),sizeMasks()}}},sizeMask=function(){var t=$(this),e=t.data("layoutMask"),n=state[e];"IFRAME"==n.tagName&&n.isVisible&&t.css({top:n.offsetTop,left:n.offsetLeft,width:n.outerWidth,height:n.outerHeight})},sizeMasks=function(){$Ms.each(sizeMask)},showMasks=function(t,e){var n,i,o=_c[t],r=["center"],a=options.zIndexes,s=$.extend({objectsOnly:!1,animation:!1,resizing:!0,sliding:state[t].isSliding},e);s.resizing&&r.push(t),s.sliding&&r.push(_c.oppositeEdge[t]),"horz"===o.dir&&(r.push("west"),r.push("east")),$.each(r,(function(t,e){i=state[e],n=options[e],i.isVisible&&(n.maskObjects||!s.objectsOnly&&n.maskContents)&&getMasks(e).each((function(){sizeMask.call(this),this.style.zIndex=i.isSliding?a.pane_sliding+1:a.pane_normal+1,this.style.display="block"}))}))},hideMasks=function(t){if(t||!state.paneResizing)$Ms.hide();else if(!t&&!$.isEmptyObject(state.panesSliding))for(var e,n,i=$Ms.length-1;i>=0;i--)e=(n=$Ms.eq(i)).data("layoutMask"),options[e].maskObjects||n.hide()},getMasks=function(t){for(var e,n=$([]),i=0,o=$Ms.length;i<o;i++)(e=$Ms.eq(i)).data("layoutMask")===t&&(n=n.add(e));return n.length?n:createMasks(t)},createMasks=function(t){var e,n,i,o,r,a=$Ps[t],s=state[t],l=options[t],c=options.zIndexes;if(!l.maskContents&&!l.maskObjects)return $([]);for(r=0;r<(l.maskObjects?2:1);r++)e=l.maskObjects&&0==r,n=document.createElement(e?"iframe":"div"),i=$(n).data("layoutMask",t),n.className="ui-layout-mask ui-layout-mask-"+t,(o=n.style).background="#FFF",o.position="absolute",o.display="block",e?(n.src="about:blank",n.frameborder=0,o.border=0,o.opacity=0,o.filter="Alpha(Opacity='0')"):(o.opacity=.001,o.filter="Alpha(Opacity='1')"),"IFRAME"==s.tagName?(o.zIndex=c.pane_normal+1,$N.append(n)):(i.addClass("ui-layout-mask-inside-pane"),o.zIndex=l.maskZindex||c.content_mask,o.top=0,o.left=0,o.width="100%",o.height="100%",a.append(n)),$Ms=$Ms.add(n);return $Ms},destroy=function(t,e){$(window).unbind("."+sID),$(document).unbind("."+sID),"object"===_typeof(t)?evtPane(t):e=t,$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID),$Ms.remove(),$.each(_c.allPanes,(function(t,n){removePane(n,!1,!0,e)}));var n="layoutCSS";for(var i in $N.data(n)&&!$N.data("layoutRole")&&$N.css($N.data(n)).removeData(n),"BODY"===sC.tagName&&($N=$("html")).data(n)&&$N.css($N.data(n)).removeData(n),runPluginCallbacks(Instance,$.layout.onDestroy),unload(),Instance)i.match(/^(container|options)$/)||delete Instance[i];return Instance.destroyed=!0,Instance},removePane=function(t,e,n,i){if(isInitialized()){var o=evtPane.call(this,t),r=$Ps[o],a=$Cs[o],s=$Rs[o],l=$Ts[o];r&&$.isEmptyObject(r.data())&&(r=!1),a&&$.isEmptyObject(a.data())&&(a=!1),s&&$.isEmptyObject(s.data())&&(s=!1),l&&$.isEmptyObject(l.data())&&(l=!1),r&&r.stop(!0,!0);var c=options[o],d=(state[o],"layoutCSS"),u=children[o],p=$.isPlainObject(u)&&!$.isEmptyObject(u),f=void 0!==i?i:c.destroyChildren;if(p&&f&&($.each(u,(function(t,e){e.destroyed||e.destroy(!0),e.destroyed&&delete u[t]})),$.isEmptyObject(u)&&(u=children[o]=null,p=!1)),r&&e&&!p)r.remove();else if(r&&r[0]){var g=c.paneClass,h=g+"-"+o,m="-open",v="-sliding",y="-closed",b=[g,g+m,g+y,g+v,h,h+m,h+y,h+v];$.merge(b,getHoverClasses(r,!0)),r.removeClass(b.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID),p&&a?(a.width(a.width()),$.each(u,(function(t,e){e.resizeAll()}))):a&&a.css(a.data(d)).removeData(d).removeData("layoutRole"),r.data("layout")||r.css(r.data(d)).removeData(d)}l&&l.remove(),s&&s.remove(),Instance[o]=$Ps[o]=$Cs[o]=$Rs[o]=$Ts[o]=!1,{removed:!0},n||resizeAll()}},_hidePane=function(t){var e=$Ps[t],n=options[t],i=e[0].style;n.useOffscreenClose?(e.data(_c.offscreenReset)||e.data(_c.offscreenReset,{left:i.left,right:i.right}),e.css(_c.offscreenCSS)):e.hide().removeData(_c.offscreenReset)},_showPane=function(t){var e=$Ps[t],n=options[t],i=_c.offscreenCSS,o=e.data(_c.offscreenReset),r=e[0].style;e.show().removeData(_c.offscreenReset),n.useOffscreenClose&&o&&(r.left==i.left&&(r.left=o.left),r.right==i.right&&(r.right=o.right))},hide=function(t,e){if(isInitialized()){var n=evtPane.call(this,t),i=options[n],o=state[n],r=$Ps[n],a=$Rs[n];"center"!==n&&r&&!o.isHidden&&(state.initialized&&!1===_runCallbacks("onhide_start",n)||(o.isSliding=!1,delete state.panesSliding[n],a&&a.hide(),!state.initialized||o.isClosed?(o.isClosed=!0,o.isHidden=!0,o.isVisible=!1,state.initialized||_hidePane(n),sizeMidPanes("horz"===_c[n].dir?"":"center"),(state.initialized||i.triggerEventsOnLoad)&&_runCallbacks("onhide_end",n)):(o.isHiding=!0,close(n,!1,e))))}},show=function(t,e,n,i){if(isInitialized()){var o=evtPane.call(this,t),r=(options[o],state[o]),a=$Ps[o];$Rs[o];"center"!==o&&a&&r.isHidden&&!1!==_runCallbacks("onshow_start",o)&&(r.isShowing=!0,r.isSliding=!1,delete state.panesSliding[o],!1===e?close(o,!0):open(o,!1,n,i))}},toggle=function(t,e){if(isInitialized()){var n=evtObj(t),i=evtPane.call(this,t),o=state[i];n&&n.stopImmediatePropagation(),o.isHidden?show(i):o.isClosed?open(i,!!e):close(i)}},_closePane=function(t,e){$Ps[t];var n=state[t];_hidePane(t),n.isClosed=!0,n.isVisible=!1,e&&setAsClosed(t)},close=function(t,e,n,i){var o=evtPane.call(this,t);if("center"!==o)if(state.initialized||!$Ps[o]){if(isInitialized()){var r,a,s,l=$Ps[o],c=($Rs[o],$Ts[o],options[o]),d=state[o];_c[o];$N.queue((function(t){if(!l||!c.closable&&!d.isShowing&&!d.isHiding||!e&&d.isClosed&&!d.isShowing)return t();var i=!d.isShowing&&!1===_runCallbacks("onclose_start",o);if(a=d.isShowing,s=d.isHiding,d.isSliding,delete d.isShowing,delete d.isHiding,i)return t();r=!n&&!d.isClosed&&"none"!=c.fxName_close,d.isMoving=!0,d.isClosed=!0,d.isVisible=!1,s?d.isHidden=!0:a&&(d.isHidden=!1),d.isSliding?bindStopSlidingEvents(o,!1):sizeMidPanes("horz"===_c[o].dir?"":"center",!1),setAsClosed(o),r?(lockPaneForFX(o,!0),l.hide(c.fxName_close,c.fxSettings_close,c.fxSpeed_close,(function(){lockPaneForFX(o,!1),d.isClosed&&u(),t()}))):(_hidePane(o),u(),t())}))}}else _closePane(o,!0);function u(){d.isMoving=!1,bindStartSlidingEvents(o,!0);var t=_c.oppositeEdge[o];state[t].noRoom&&(setSizeLimits(t),makePaneFit(t)),i||!state.initialized&&!c.triggerEventsOnLoad||(a||_runCallbacks("onclose_end",o),a&&_runCallbacks("onshow_end",o),s&&_runCallbacks("onhide_end",o))}},setAsClosed=function(t){if($Rs[t]){$Ps[t];var e=$Rs[t],n=$Ts[t],i=options[t],o=state[t],r=_c[t].side,a=i.resizerClass,s=i.togglerClass,l="-"+t,c="-open",d="-sliding",u="-closed";e.css(r,sC.inset[r]).removeClass(a+c+" "+a+l+c).removeClass(a+d+" "+a+l+d).addClass(a+u+" "+a+l+u),o.isHidden&&e.hide(),i.resizable&&$.layout.plugins.draggable&&e.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title",""),n&&(n.removeClass(s+c+" "+s+l+c).addClass(s+u+" "+s+l+u).attr("title",i.tips.Open),n.children(".content-open").hide(),n.children(".content-closed").css("display","block")),syncPinBtns(t,!1),state.initialized&&sizeHandles()}},open=function(t,e,n,i){if(isInitialized()){var o,r,a=evtPane.call(this,t),s=$Ps[a],l=($Rs[a],$Ts[a],options[a]),c=state[a];_c[a];"center"!==a&&$N.queue((function(t){if(!s||!l.resizable&&!l.closable&&!c.isShowing||c.isVisible&&!c.isSliding)return t();if(c.isHidden&&!c.isShowing)return t(),void show(a,!0);c.autoResize&&c.size!=l.size?sizePane(a,l.size,!0,!0,!0):setSizeLimits(a,e);var u=_runCallbacks("onopen_start",a);return"abort"===u?t():("NC"!==u&&setSizeLimits(a,e),c.minSize>c.maxSize?(syncPinBtns(a,!1),!i&&l.tips.noRoomToOpen&&alert(l.tips.noRoomToOpen),t()):(e?bindStopSlidingEvents(a,!0):c.isSliding?bindStopSlidingEvents(a,!1):l.slidable&&bindStartSlidingEvents(a,!1),c.noRoom=!1,makePaneFit(a),r=c.isShowing,delete c.isShowing,o=!n&&c.isClosed&&"none"!=l.fxName_open,c.isMoving=!0,c.isVisible=!0,c.isClosed=!1,r&&(c.isHidden=!1),void(o?(lockPaneForFX(a,!0),s.show(l.fxName_open,l.fxSettings_open,l.fxSpeed_open,(function(){lockPaneForFX(a,!1),c.isVisible&&d(),t()}))):(_showPane(a),d(),t()))))}))}function d(){c.isMoving=!1,_fixIframe(a),c.isSliding||sizeMidPanes("vert"==_c[a].dir?"center":"",!1),setAsOpen(a)}},setAsOpen=function(t,e){var n=$Ps[t],i=$Rs[t],o=$Ts[t],r=options[t],a=state[t],s=_c[t].side,l=r.resizerClass,c=r.togglerClass,d="-"+t,u="-open",p="-closed",f="-sliding";i.css(s,sC.inset[s]+getPaneSize(t)).removeClass(l+p+" "+l+d+p).addClass(l+u+" "+l+d+u),a.isSliding?i.addClass(l+f+" "+l+d+f):i.removeClass(l+f+" "+l+d+f),removeHover(0,i),r.resizable&&$.layout.plugins.draggable?i.draggable("enable").css("cursor",r.resizerCursor).attr("title",r.tips.Resize):a.isSliding||i.css("cursor","default"),o&&(o.removeClass(c+p+" "+c+d+p).addClass(c+u+" "+c+d+u).attr("title",r.tips.Close),removeHover(0,o),o.children(".content-closed").hide(),o.children(".content-open").css("display","block")),syncPinBtns(t,!a.isSliding),$.extend(a,elDims(n)),state.initialized&&(sizeHandles(),sizeContent(t,!0)),!e&&(state.initialized||r.triggerEventsOnLoad)&&n.is(":visible")&&(_runCallbacks("onopen_end",t),a.isShowing&&_runCallbacks("onshow_end",t),state.initialized&&_runCallbacks("onresize_end",t))},slideOpen=function(t){if(isInitialized()){var e=evtObj(t),n=evtPane.call(this,t),i=state[n],o=options[n].slideDelay_open;"center"!==n&&(e&&e.stopImmediatePropagation(),i.isClosed&&e&&"mouseenter"===e.type&&o>0?timer.set(n+"_openSlider",r,o):r())}function r(){i.isClosed?i.isMoving||open(n,!0):bindStopSlidingEvents(n,!0)}},slideClose=function(t){if(isInitialized()){var e=evtObj(t),n=evtPane.call(this,t),i=options[n],o=state[n],r=o.isMoving?1e3:300;if("center"!==n&&!o.isClosed&&!o.isResizing)if("click"===i.slideTrigger_close)a();else{if(i.preventQuickSlideClose&&o.isMoving)return;if(i.preventPrematureSlideClose&&e&&$.layout.isMouseOverElem(e,$Ps[n]))return;e?timer.set(n+"_closeSlider",a,max(i.slideDelay_close,r)):a()}}function a(){o.isClosed?bindStopSlidingEvents(n,!1):o.isMoving||close(n)}},slideToggle=function(t){var e=evtPane.call(this,t);toggle(e,!0)},lockPaneForFX=function(t,e){var n=$Ps[t],i=state[t],o=options[t],r=options.zIndexes;e?(showMasks(t,{animation:!0,objectsOnly:!0}),n.css({zIndex:r.pane_animate}),"south"==t?n.css({top:sC.inset.top+sC.innerHeight-n.outerHeight()}):"east"==t&&n.css({left:sC.inset.left+sC.innerWidth-n.outerWidth()})):(hideMasks(),n.css({zIndex:i.isSliding?r.pane_sliding:r.pane_normal}),"south"==t?n.css({top:"auto"}):"east"!=t||n.css("left").match(/\-99999/)||n.css({left:"auto"}),browser.msie&&o.fxOpacityFix&&"slide"!=o.fxName_open&&n.css("filter")&&1==n.css("opacity")&&n[0].style.removeAttribute("filter"))},bindStartSlidingEvents=function(t,e){var n=options[t],i=($Ps[t],$Rs[t]),o=n.slideTrigger_open.toLowerCase();!i||e&&!n.slidable||(o.match(/mouseover/)?o=n.slideTrigger_open="mouseenter":o.match(/(click|dblclick|mouseenter)/)||(o=n.slideTrigger_open="click"),n.resizerDblClickToggle&&o.match(/click/)&&i[e?"unbind":"bind"]("dblclick."+sID,toggle),i[e?"bind":"unbind"](o+"."+sID,slideOpen).css("cursor",e?n.sliderCursor:"default").attr("title",e?n.tips.Slide:""))},bindStopSlidingEvents=function(t,e){var n=options[t],i=state[t],o=(_c[t],options.zIndexes),r=n.slideTrigger_close.toLowerCase(),a=e?"bind":"unbind",s=$Ps[t],l=$Rs[t];function c(e){timer.clear(t+"_closeSlider"),e.stopPropagation()}timer.clear(t+"_closeSlider"),e?(i.isSliding=!0,state.panesSliding[t]=!0,bindStartSlidingEvents(t,!1)):(i.isSliding=!1,delete state.panesSliding[t]),s.css("zIndex",e?o.pane_sliding:o.pane_normal),l.css("zIndex",e?o.pane_sliding+2:o.resizer_normal),r.match(/(click|mouseleave)/)||(r=n.slideTrigger_close="mouseleave"),l[a](r,slideClose),"mouseleave"===r&&(s[a]("mouseleave."+sID,slideClose),l[a]("mouseenter."+sID,c),s[a]("mouseenter."+sID,c)),e?"click"!==r||n.resizable||(l.css("cursor",e?n.sliderCursor:"default"),l.attr("title",e?n.tips.Close:"")):timer.clear(t+"_closeSlider")},makePaneFit=function(t,e,n,i){var o=options[t],r=state[t],a=_c[t],s=$Ps[t],l=$Rs[t],c="vert"===a.dir,d=!1;if(("center"===t||c&&r.noVerticalRoom)&&((d=r.maxHeight>=0)&&r.noRoom?(_showPane(t),l&&l.show(),r.isVisible=!0,r.noRoom=!1,c&&(r.noVerticalRoom=!1),_fixIframe(t)):d||r.noRoom||(_hidePane(t),l&&l.hide(),r.isVisible=!1,r.noRoom=!0)),"center"===t);else if(r.minSize<=r.maxSize){if(d=!0,r.size>r.maxSize)sizePane(t,r.maxSize,n,!0,i);else if(r.size<r.minSize)sizePane(t,r.minSize,n,!0,i);else if(l&&r.isVisible&&s.is(":visible")){var u=r.size+sC.inset[a.side];$.layout.cssNum(l,a.side)!=u&&l.css(a.side,u)}r.noRoom&&(r.wasOpen&&o.closable?o.autoReopen?open(t,!1,!0,!0):r.noRoom=!1:show(t,r.wasOpen,!0,!0))}else r.noRoom||(r.noRoom=!0,r.wasOpen=!r.isClosed&&!r.isSliding,r.isClosed||(o.closable?close(t,!0,!0):hide(t,!0)))},manualSizePane=function(t,e,n,i,o){if(isInitialized()){var r=evtPane.call(this,t),a=options[r],s=state[r],l=o||a.livePaneResizing&&!s.isResizing;"center"!==r&&(s.autoResize=!1,sizePane(r,e,n,i,l))}},sizePane=function(t,e,n,i,o){if(isInitialized()){var r,a,s=evtPane.call(this,t),l=options[s],c=state[s],d=$Ps[s],u=$Rs[s],p=_c[s].side,f=_c[s].sizeType.toLowerCase(),g=c.isResizing&&!l.triggerEventsDuringLiveResize,h=!0!==i&&l.animatePaneSizing;"center"!==s&&$N.queue((function(t){if(setSizeLimits(s),r=c.size,e=_parseSize(s,e),e=max(e,_parseSize(s,l.minSize)),(e=min(e,c.maxSize))<c.minSize)return t(),void makePaneFit(s,!1,n);if(!o&&e===r)return t();if(c.newSize=e,!n&&state.initialized&&c.isVisible&&_runCallbacks("onresize_start",s),a=cssSize(s,e),h&&d.is(":visible")){var i=$.layout.effects.size[s]||$.layout.effects.size.all,u=l.fxSettings_size.easing||i.easing,p=options.zIndexes,g={};g[f]=a+"px",c.isMoving=!0,d.css({zIndex:p.pane_animate}).show().animate(g,l.fxSpeed_size,u,(function(){d.css({zIndex:c.isSliding?p.pane_sliding:p.pane_normal}),c.isMoving=!1,delete c.newSize,m(),t()}))}else d.css(f,a),delete c.newSize,d.is(":visible")?m():c.size=e,t()}))}function m(){for(var t="width"===f?d.outerWidth():d.outerHeight(),i=[{pane:s,count:1,target:e,actual:t,correct:e===t,attempt:e,cssSize:a}],l=i[0],h={},m="Inaccurate size after resizing the "+s+"-pane.";!(l.correct||(h={pane:s,count:l.count+1,target:e},l.actual>e?h.attempt=max(0,l.attempt-(l.actual-e)):h.attempt=max(0,l.attempt+(e-l.actual)),h.cssSize=cssSize(s,h.attempt),d.css(f,h.cssSize),h.actual="width"==f?d.outerWidth():d.outerHeight(),h.correct=e===h.actual,1===i.length&&(_log(m,!1,!0),_log(l,!1,!0)),_log(h,!1,!0),i.length>3));)i.push(h),l=i[i.length-1];c.size=e,$.extend(c,elDims(d)),c.isVisible&&d.is(":visible")&&(u&&u.css(p,e+sC.inset[p]),sizeContent(s)),!n&&!g&&state.initialized&&c.isVisible&&_runCallbacks("onresize_end",s),n||(c.isSliding||sizeMidPanes("horz"==_c[s].dir?"":"center",g,o),sizeHandles());var v=_c.oppositeEdge[s];e<r&&state[v].noRoom&&(setSizeLimits(v),makePaneFit(v,!1,n)),i.length>1&&_log(m+"\nSee the Error Console for details.",!0,!0)}},sizeMidPanes=function t(e,n,i){e=(e||"east,west,center").split(","),$.each(e,(function(e,o){if($Ps[o]){var r=options[o],a=state[o],s=$Ps[o],l=($Rs[o],!0),c={},d=$.layout.showInvisibly(s),u=calcNewCenterPaneDims();if($.extend(a,elDims(s)),"center"===o){if(!i&&a.isVisible&&u.width===a.outerWidth&&u.height===a.outerHeight)return s.css(d),!0;if($.extend(a,cssMinDims(o),{maxWidth:u.width,maxHeight:u.height}),c=u,a.newWidth=c.width,a.newHeight=c.height,c.width=cssW(s,c.width),c.height=cssH(s,c.height),l=c.width>=0&&c.height>=0,!state.initialized&&r.minWidth>u.width){var p=r.minWidth-a.outerWidth,f=options.east.minSize||0,g=options.west.minSize||0,h=state.east.size,m=state.west.size,v=h,y=m;if(p>0&&state.east.isVisible&&h>f&&(p-=h-(v=max(h-f,h-p))),p>0&&state.west.isVisible&&m>g&&(p-=m-(y=max(m-g,m-p))),0===p)return h&&h!=f&&sizePane("east",v,!0,!0,i),m&&m!=g&&sizePane("west",y,!0,!0,i),t("center",n,i),void s.css(d)}}else{if(a.isVisible&&!a.noVerticalRoom&&$.extend(a,elDims(s),cssMinDims(o)),!i&&!a.noVerticalRoom&&u.height===a.outerHeight)return s.css(d),!0;c.top=u.top,c.bottom=u.bottom,a.newSize=u.height,c.height=cssH(s,u.height),a.maxHeight=c.height,(l=a.maxHeight>=0)||(a.noVerticalRoom=!0)}if(l?(!n&&state.initialized&&_runCallbacks("onresize_start",o),s.css(c),"center"!==o&&sizeHandles(o),!a.noRoom||a.isClosed||a.isHidden||makePaneFit(o),a.isVisible&&($.extend(a,elDims(s)),state.initialized&&sizeContent(o))):!a.noRoom&&a.isVisible&&makePaneFit(o),s.css(d),delete a.newSize,delete a.newWidth,delete a.newHeight,!a.isVisible)return!0;if("center"===o){var b=browser.isIE6||!browser.boxModel;$Ps.north&&(b||"IFRAME"==state.north.tagName)&&$Ps.north.css("width",cssW($Ps.north,sC.innerWidth)),$Ps.south&&(b||"IFRAME"==state.south.tagName)&&$Ps.south.css("width",cssW($Ps.south,sC.innerWidth))}!n&&state.initialized&&_runCallbacks("onresize_end",o)}}))},resizeAll=function(t){var e=sC.innerWidth,n=sC.innerHeight;if(evtPane(t),$N.is(":visible"))if(state.initialized){if(!0===t&&$.isPlainObject(options.outset)&&$N.css(options.outset),$.extend(sC,elDims($N,options.inset)),sC.outerHeight){if(!0===t&&setPanePosition(),!1===_runCallbacks("onresizeall_start"))return!1;var i,o;sC.innerHeight,sC.innerWidth;$.each(["south","north","east","west"],(function(t,e){if($Ps[e]){i=options[e],o=state[e];var n=!1,r=$(window).width();null!==i&&"undefined"!==i&&i.responsive.enabled&&(r>=i.responsiveSizes.lg&&(n="lg"!==i.responsive.when&&"md"!==i.responsive.when&&"sm"!==i.responsive.when&&"xs"!==i.responsive.when),r>=i.responsive.sizes.md&&r<i.responsive.sizes.lg&&(n="md"!==i.responsive.when&&"sm"!==i.responsive.when&&"xs"!==i.responsive.when),r>=i.responsive.sizes.sm&&r<i.responsive.sizes.md&&(n="sm"!==i.responsive.when&&"xs"!==i.responsive.when),r>=i.responsive.sizes.xs&&r<i.responsive.sizes.sm&&(n="xs"!==i.responsive.when)),o.autoResize&&o.size!==i.size?(n&&o.isVisible?(i.closable?close(e,!0,!i.responsiveAnimate):hide(e,!i.responsiveAnimate),o.responded=!0):o.responded&&(i.closable?open(e,!1,!i.responsiveAnimate):show(e,!0,!i.responsiveAnimate),o.responded=!1),sizePane(e,i.size,!0,!0,!0)):(setSizeLimits(e),n?(i.closable?close(e,!0,!i.responsiveAnimate):hide(e,!i.responsiveAnimate),o.responded=!0):o.responded&&(i.closable?open(e,!1,!i.responsiveAnimate):show(e,!0,!i.responsiveAnimate),o.responded=!1),makePaneFit(e,!1,!0,!0))}})),sizeMidPanes("",!0,!0),sizeHandles(),$.each(_c.allPanes,(function(t,e){$Ps[e]&&state[e].isVisible&&_runCallbacks("onresize_end",e)})),_runCallbacks("onresizeall_end")}}else _initLayoutElements()},resizeChildren=function(t,e){var n=evtPane.call(this,t);if(options[n].resizeChildren){e||refreshChildren(n);var i=children[n];$.isPlainObject(i)&&$.each(i,(function(t,e){e.destroyed||e.resizeAll()}))}},sizeContent=function(t,e){if(isInitialized()){var n=evtPane.call(this,t);n=n?n.split(","):_c.allPanes,$.each(n,(function(t,n){var i=$Ps[n],o=$Cs[n],r=options[n],a=state[n],s=a.content;if(!i||!o||!i.is(":visible"))return!0;if((o.length||(initContent(n,!1),o))&&!1!==_runCallbacks("onsizecontent_start",n)){(!a.isMoving&&!a.isResizing||r.liveContentResizing||e||null==s.top)&&(d(),s.hiddenFooters>0&&"hidden"===i.css("overflow")&&(i.css("overflow","visible"),d(),i.css("overflow","hidden")));var l=a.innerHeight-(s.spaceAbove-a.css.paddingTop)-(s.spaceBelow-a.css.paddingBottom);o.is(":visible")&&s.height==l||(setOuterHeight(o,l,!0),s.height=l),state.initialized&&_runCallbacks("onsizecontent_end",n)}function c(t){return max(a.css.paddingBottom,parseInt(t.css("marginBottom"),10)||0)}function d(){var t=options[n].contentIgnoreSelector,e=o.nextAll().not(".ui-layout-mask").not(t||":lt(0)"),i=e.filter(":visible"),r=i.filter(":last");(s={top:o[0].offsetTop,height:o.outerHeight(),numFooters:e.length,hiddenFooters:e.length-i.length,spaceBelow:0}).spaceAbove=s.top,s.bottom=s.top+s.height,r.length?s.spaceBelow=r[0].offsetTop+r.outerHeight()-s.bottom+c(r):s.spaceBelow=c(o)}}))}},sizeHandles=function(t){var e=evtPane.call(this,t);e=e?e.split(","):_c.borderPanes,$.each(e,(function(t,e){var n,i=options[e],o=state[e],r=$Ps[e],a=$Rs[e],s=$Ts[e];if(r&&a){var l,c,d,u=_c[e].dir,p=o.isClosed?"_closed":"_open",f=i["spacing"+p],g=i["togglerAlign"+p],h=i["togglerLength"+p];if(0!==f){if(o.noRoom||o.isHidden||a.show(),"horz"===u?(l=sC.innerWidth,o.resizerLength=l,c=$.layout.cssNum(r,"left"),a.css({width:cssW(a,l),height:cssH(a,f),left:c>-9999?c:sC.inset.left})):(l=r.outerHeight(),o.resizerLength=l,a.css({height:cssH(a,l),width:cssW(a,f),top:sC.inset.top+getPaneSize("north",!0)})),removeHover(i,a),s){if(0===h||o.isSliding&&i.hideTogglerOnSlide)return void s.hide();if(s.show(),!(h>0)||"100%"===h||h>l)h=l,d=0;else if(isStr(g))switch(g){case"top":case"left":d=0;break;case"bottom":case"right":d=l-h;break;case"middle":case"center":default:d=round((l-h)/2)}else{var m=parseInt(g,10);d=g>=0?m:l-h+m}if("horz"===u){var v=cssW(s,h);s.css({width:v,height:cssH(s,f),left:d,top:0}),s.children(".content").each((function(){(n=$(this)).css("marginLeft",round((v-n.outerWidth())/2))}))}else{var y=cssH(s,h);s.css({height:y,width:cssW(s,f),top:d,left:0}),s.children(".content").each((function(){(n=$(this)).css("marginTop",round((y-n.outerHeight())/2))}))}removeHover(0,s)}state.initialized||!i.initHidden&&!o.isHidden||(a.hide(),s&&s.hide())}else a.hide()}}))},enableClosable=function(t){if(isInitialized()){var e=evtPane.call(this,t),n=$Ts[e],i=options[e];n&&(i.closable=!0,n.on("click."+sID,(function(t){t.stopPropagation(),toggle(e)})).css("visibility","visible").css("cursor","pointer").attr("title",state[e].isClosed?i.tips.Open:i.tips.Close).show())}},disableClosable=function(t,e){if(isInitialized()){var n=evtPane.call(this,t),i=$Ts[n];i&&(options[n].closable=!1,state[n].isClosed&&open(n,!1,!0),i.unbind("."+sID).css("visibility",e?"hidden":"visible").css("cursor","default").attr("title",""))}},enableSlidable=function(t){if(isInitialized()){var e=evtPane.call(this,t),n=$Rs[e];n&&n.data("draggable")&&(options[e].slidable=!0,state[e].isClosed&&bindStartSlidingEvents(e,!0))}},disableSlidable=function(t){if(isInitialized()){var e=evtPane.call(this,t),n=$Rs[e];n&&(options[e].slidable=!1,state[e].isSliding?close(e,!1,!0):(bindStartSlidingEvents(e,!1),n.css("cursor","default").attr("title",""),removeHover(null,n[0])))}},enableResizable=function(t){if(isInitialized()){var e=evtPane.call(this,t),n=$Rs[e],i=options[e];n&&n.data("draggable")&&(i.resizable=!0,n.draggable("enable"),state[e].isClosed||n.css("cursor",i.resizerCursor).attr("title",i.tips.Resize))}},disableResizable=function(t){if(isInitialized()){var e=evtPane.call(this,t),n=$Rs[e];n&&n.data("draggable")&&(options[e].resizable=!1,n.draggable("disable").css("cursor","default").attr("title",""),removeHover(null,n[0]))}},swapPanes=function(t,e){if(isInitialized()){var n=evtPane.call(this,t);if(state[n].edge=e,state[e].edge=n,!1===_runCallbacks("onswap_start",n)||!1===_runCallbacks("onswap_start",e))return state[n].edge=n,void(state[e].edge=e);var i=a(n),o=a(e),r={};return r[n]=i?i.state.size:0,r[e]=o?o.state.size:0,$Ps[n]=!1,$Ps[e]=!1,state[n]={},state[e]={},$Ts[n]&&$Ts[n].remove(),$Ts[e]&&$Ts[e].remove(),$Rs[n]&&$Rs[n].remove(),$Rs[e]&&$Rs[e].remove(),$Rs[n]=$Rs[e]=$Ts[n]=$Ts[e]=!1,s(i,e),s(o,n),i=o=r=null,$Ps[n]&&$Ps[n].css(_c.visible),$Ps[e]&&$Ps[e].css(_c.visible),resizeAll(),_runCallbacks("onswap_end",n),void _runCallbacks("onswap_end",e)}function a(t){var e=$Ps[t],n=$Cs[t];return!!e&&{pane:t,P:!!e&&e[0],C:!!n&&n[0],state:$.extend(!0,{},state[t]),options:$.extend(!0,{},options[t])}}function s(t,e){if(t){var n,i,o=t.P,a=t.C,s=t.pane,l=_c[e],c=$.extend(!0,{},state[e]),d=options[e],u={resizerCursor:d.resizerCursor};$.each("fxName,fxSpeed,fxSettings".split(","),(function(t,e){u[e+"_open"]=d[e+"_open"],u[e+"_close"]=d[e+"_close"],u[e+"_size"]=d[e+"_size"]})),$Ps[e]=$(o).data({layoutPane:Instance[e],layoutEdge:e}).css(_c.hidden).css(l.cssReq),$Cs[e]=!!a&&$(a),options[e]=$.extend(!0,{},t.options,u),state[e]=$.extend(!0,{},t.state),n=new RegExp(d.paneClass+"-"+s,"g"),o.className=o.className.replace(n,d.paneClass+"-"+e),initHandles(e),l.dir!=_c[s].dir?(i=r[e]||0,setSizeLimits(e),i=max(i,state[e].minSize),manualSizePane(e,i,!0,!0)):$Rs[e].css(l.side,sC.inset[l.side]+(state[e].isVisible?getPaneSize(e):0)),t.state.isVisible&&!c.isVisible?setAsOpen(e,!0):(setAsClosed(e),bindStartSlidingEvents(e,!0)),t=null}}},syncPinBtns=function(t,e){$.layout.plugins.buttons&&$.each(state[t].pins,(function(n,i){$.layout.buttons.setPinState(Instance,$(i),t,e)}))};function keyDown(t){if(!t)return!0;var e=t.keyCode;if(e<33)return!0;var n,i,o,r,a={38:"north",40:"south",37:"west",39:"east"},s=(t.altKey,t.shiftKey),l=t.ctrlKey;return l&&e>=37&&e<=40&&options[a[e]].enableCursorHotkey?r=a[e]:(l||s)&&$.each(_c.borderPanes,(function(t,a){if(n=options[a],i=n.customHotkey,o=n.customHotkeyModifier,(s&&"SHIFT"==o||l&&"CTRL"==o||l&&s)&&i&&e===(isNaN(i)||i<=9?i.toUpperCase().charCodeAt(0):i))return r=a,!1})),!(r&&$Ps[r]&&options[r].closable&&!state[r].isHidden)||(toggle(r),t.stopPropagation(),t.returnValue=!1,!1)}function allowOverflow(t){var e;if(isInitialized()&&(this&&this.tagName&&(t=this),isStr(t)?e=$Ps[t]:$(t).data("layoutRole")?e=$(t):$(t).parents().each((function(){if($(this).data("layoutRole"))return e=$(this),!1})),e&&e.length)){var n=e.data("layoutEdge"),i=state[n];if(i.cssSaved&&resetOverflow(n),i.isSliding||i.isResizing||i.isClosed)i.cssSaved=!1;else{var o={zIndex:options.zIndexes.resizer_normal+1},r={},a=e.css("overflow"),s=e.css("overflowX"),l=e.css("overflowY");"visible"!=a&&(r.overflow=a,o.overflow="visible"),s&&!s.match(/(visible|auto)/)&&(r.overflowX=s,o.overflowX="visible"),l&&!l.match(/(visible|auto)/)&&(r.overflowY=s,o.overflowY="visible"),i.cssSaved=r,e.css(o),$.each(_c.allPanes,(function(t,e){e!=n&&resetOverflow(e)}))}}}function resetOverflow(t){var e;if(isInitialized()&&(this&&this.tagName&&(t=this),isStr(t)?e=$Ps[t]:$(t).data("layoutRole")?e=$(t):$(t).parents().each((function(){if($(this).data("layoutRole"))return e=$(this),!1})),e&&e.length)){var n=e.data("layoutEdge"),i=state[n],o=i.cssSaved||{};i.isSliding||i.isResizing||e.css("zIndex",options.zIndexes.pane_normal),e.css(o),i.cssSaved=!1}}var $N=$(this).eq(0);if(!$N.length)return _log(options.errors.containerMissing);if($N.data("layoutContainer")&&$N.data("layout"))return $N.data("layout");var $Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id,Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,showMasks:showMasks,hideMasks:hideMasks,initContent:initContent,addPane:addPane,removePane:removePane,createChildren:createChildren,refreshChildren:refreshChildren,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:!1,children:children,north:!1,south:!1,west:!1,east:!1,center:!1};return"cancel"===_create()?null:Instance}})(jQuery),jQuery.cookie=function(t,e,n){if(void 0===e){var i=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),r=0;r<o.length;r++){var a=jQuery.trim(o[r]);if(a.substring(0,t.length+1)==t+"="){i=decodeURIComponent(a.substring(t.length+1));break}}return i}n=n||{},null===e&&(e="",n.expires=-1);var s,l="";n.expires&&("number"==typeof n.expires||n.expires.toUTCString)&&("number"==typeof n.expires?(s=new Date).setTime(s.getTime()+24*n.expires*60*60*1e3):s=n.expires,l="; expires="+s.toUTCString());var c=n.path?"; path="+n.path:"",d=n.domain?"; domain="+n.domain:"",u=n.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),l,c,d,u].join("")},function(t){t.layout&&(t.ui||(t.ui={}),t.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(e){var n,i,o,r=document.cookie,a=r?r.split(";"):[];for(o=0;n=a[o];o++)if((i=t.trim(n).split("="))[0]==e)return decodeURIComponent(i[1]);return null},write:function(e,n,i){var o="",r="",a=!1,s=i||{},l=s.expires||null,c=t.type(l);"date"===c?r=l:"string"===c&&l>0&&(l=parseInt(l,10),c="number"),"number"===c&&(r=new Date,l>0?r.setDate(r.getDate()+l):(r.setFullYear(1970),a=!0)),r&&(o+=";expires="+r.toUTCString()),s.path&&(o+=";path="+s.path),s.domain&&(o+=";domain="+s.domain),s.secure&&(o+=";secure"),document.cookie=e+"="+(a?"":encodeURIComponent(n))+o},clear:function(e){t.ui.cookie.write(e,"",{expires:-1})}},t.cookie||(t.cookie=function(e,n,i){var o=t.ui.cookie;if(null===n)o.clear(e);else{if(void 0===n)return o.read(e);o.write(e,n,i)}}),t.layout.plugins.stateManagement=!0,t.layout.defaults.stateManagement={enabled:!1,autoSave:!0,autoLoad:!0,animateLoad:!0,includeChildren:!0,stateKeys:"north.size,south.size,east.size,west.size,north.isClosed,south.isClosed,east.isClosed,west.isClosed,north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:!1}},t.layout.optionsMap.layout.push("stateManagement"),t.layout.config.optionRootKeys.push("stateManagement"),t.layout.state={saveCookie:function(e,n,i){var o=e.options,r=o.stateManagement,a=t.extend(!0,{},r.cookie,i||null),s=e.state.stateData=e.readState(n||r.stateKeys);return t.ui.cookie.write(a.name||o.name||"Layout",t.layout.state.encodeJSON(s),a),t.extend(!0,{},s)},deleteCookie:function(e){var n=e.options;t.ui.cookie.clear(n.stateManagement.cookie.name||n.name||"Layout")},readCookie:function(e){var n=e.options,i=t.ui.cookie.read(n.stateManagement.cookie.name||n.name||"Layout");return i?t.layout.state.decodeJSON(i):{}},loadCookie:function(e){var n=t.layout.state.readCookie(e);return n&&!t.isEmptyObject(n)&&(e.state.stateData=t.extend(!0,{},n),e.loadState(n)),n},loadState:function(e,n,i){if(t.isPlainObject(n)&&!t.isEmptyObject(n)){n=e.state.stateData=t.layout.transformData(n);var o=e.options.stateManagement;if(i=t.extend({animateLoad:!1,includeChildren:o.includeChildren},i),e.state.initialized){var r,a,s,l,c,d,u=!i.animateLoad;if(t.each(t.layout.config.borderPanes,(function(i,o){if(p=n[o],t.isPlainObject(p)){var c=p.size;r=p.initClosed,a=p.initHidden;var d=p.autoResize;s=e.state[o],l=s.isVisible,d&&(s.autoResize=d),l||e._sizePane(o,c,!1,!1,!1),!0===a?e.hide(o,u):!0===r?e.close(o,!1,u):!1===r?e.open(o,!1,u):!1===a&&e.show(o,!1,u),l&&e._sizePane(o,c,!1,!1,u)}})),i.includeChildren)t.each(e.children,(function(e,i){(c=n[e]?n[e].children:0)&&i&&t.each(i,(function(t,e){d=c[t],e&&d&&e.loadState(d)}))}))}else{var p=t.extend(!0,{},n);t.each(t.layout.config.allPanes,(function(t,e){p[e]&&delete p[e].children})),t.extend(!0,e.options,p)}}},readState:function(e,n){"string"===t.type(n)&&(n={keys:n}),n||(n={});var i,o,r,a,s,l,c,d=e.options.stateManagement,u=n.includeChildren,p=void 0!==u?u:d.includeChildren,f=n.stateKeys||d.stateKeys,g={isClosed:"initClosed",isHidden:"initHidden"},h=e.state,m=t.layout.config.allPanes,v={};t.isArray(f)&&(f=f.join(","));for(var y=0,b=(f=f.replace(/__/g,".").split(",")).length;y<b;y++)o=(i=f[y].split("."))[0],r=i[1],t.inArray(o,m)<0||null!=(a=h[o][r])&&("isClosed"==r&&h[o].isSliding&&(a=!0),(v[o]||(v[o]={}))[g[r]?g[r]:r]=a);return p&&t.each(m,(function(n,i){l=e.children[i],s=h.stateData[i],t.isPlainObject(l)&&!t.isEmptyObject(l)&&((c=v[i]||(v[i]={})).children||(c.children={}),t.each(l,(function(e,n){n.state.initialized?c.children[e]=t.layout.state.readState(n):s&&s.children&&s.children[e]&&(c.children[e]=t.extend(!0,{},s.children[e]))})))})),v},encodeJSON:function(e){return((window.JSON||{}).stringify||function(e){var n,i,o,r=[],a=0,s=t.isArray(e);for(n in e)i=e[n],"string"==(o=_typeof(i))?i='"'+i+'"':"object"==o&&(i=parse(i)),r[a++]=(s?"":'"'+n+'":')+i;return(s?"[":"{")+r.join(",")+(s?"]":"}")})(e)},decodeJSON:function(e){try{return t.parseJSON?t.parseJSON(e):window.eval("("+e+")")||{}}catch(t){return{}}},_create:function(e){var n=t.layout.state,i=e.options.stateManagement;if(t.extend(e,{readCookie:function(){return n.readCookie(e)},deleteCookie:function(){n.deleteCookie(e)},saveCookie:function(t,i){return n.saveCookie(e,t,i)},loadCookie:function(){return n.loadCookie(e)},loadState:function(t,i){n.loadState(e,t,i)},readState:function(t){return n.readState(e,t)},encodeJSON:n.encodeJSON,decodeJSON:n.decodeJSON}),e.state.stateData={},i.autoLoad)if(t.isPlainObject(i.autoLoad))t.isEmptyObject(i.autoLoad)||e.loadState(i.autoLoad);else if(i.enabled)if(t.isFunction(i.autoLoad)){var o={};try{o=i.autoLoad(e,e.state,e.options,e.options.name||"")}catch(t){}o&&t.isPlainObject(o)&&!t.isEmptyObject(o)&&e.loadState(o)}else e.loadCookie()},_unload:function(e){var n=e.options.stateManagement;if(n.enabled&&n.autoSave)if(t.isFunction(n.autoSave))try{n.autoSave(e,e.state,e.options,e.options.name||"")}catch(t){}else e.saveCookie()}},t.layout.onCreate.push(t.layout.state._create),t.layout.onUnload.push(t.layout.state._unload))}(jQuery),function(t){t.layout&&(t.layout.plugins.buttons=!0,t.layout.defaults.autoBindCustomButtons=!1,t.layout.optionsMap.layout.push("autoBindCustomButtons"),t.layout.buttons={config:{borderPanes:"north,south,west,east"},init:function(e){var n,i=e.options.name||"";t.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),(function(o,r){t.each(t.layout.buttons.config.borderPanes.split(","),(function(o,a){t(".ui-layout-button-"+r+"-"+a).each((function(){null!=(n=t(this).data("layoutName")||t(this).attr("layoutName"))&&n!==i||e.onButton(this,r,a)}))}))}))},get:function(e,n,i,o){var r=t(n),a=e.options;if(r.length&&t.layout.buttons.config.borderPanes.indexOf(i)>=0){var s=a[i].buttonClass+"-"+o;r.addClass(s+" "+s+"-"+i).data("layoutName",a.name)}return r},bind:function(e,n,i,o){var r=t.layout.buttons;switch(i.toLowerCase()){case"toggle":r.addToggle(e,n,o);break;case"open":r.addOpen(e,n,o);break;case"close":r.addClose(e,n,o);break;case"pin":r.addPin(e,n,o);break;case"toggle-slide":r.addToggle(e,n,o,!0);break;case"open-slide":r.addOpen(e,n,o,!0)}return e},addToggle:function(e,n,i,o){return t.layout.buttons.get(e,n,i,"toggle").click((function(t){e.toggle(i,!!o),t.stopPropagation()})),e},addOpen:function(e,n,i,o){return t.layout.buttons.get(e,n,i,"open").attr("title",e.options[i].tips.Open).click((function(t){e.open(i,!!o),t.stopPropagation()})),e},addClose:function(e,n,i){return t.layout.buttons.get(e,n,i,"close").attr("title",e.options[i].tips.Close).click((function(t){e.close(i),t.stopPropagation()})),e},addPin:function(e,n,i){var o=t.layout.buttons.get(e,n,i,"pin");if(o.length){var r=e.state[i];o.click((function(n){t.layout.buttons.setPinState(e,t(this),i,r.isSliding||r.isClosed),r.isSliding||r.isClosed?e.open(i):e.close(i),n.stopPropagation()})),t.layout.buttons.setPinState(e,o,i,!r.isClosed&&!r.isSliding),r.pins.push(n)}return e},setPinState:function(t,e,n,i){var o=e.attr("pin");if(!o||i!==("down"==o)){var r=t.options[n],a=r.tips,s=r.buttonClass+"-pin",l=s+"-"+n,c=s+"-up "+l+"-up",d=s+"-down "+l+"-down";e.attr("pin",i?"down":"up").attr("title",i?a.Unpin:a.Pin).removeClass(i?c:d).addClass(i?d:c)}},syncPinBtns:function(e,n,i){t.each(state[n].pins,(function(o,r){t.layout.buttons.setPinState(e,t(r),n,i)}))},_load:function(e){t.extend(e,{bindButton:function(n,i,o){return t.layout.buttons.on(e,n,i,o)},addToggleBtn:function(n,i,o){return t.layout.buttons.addToggle(e,n,i,o)},addOpenBtn:function(n,i,o){return t.layout.buttons.addOpen(e,n,i,o)},addCloseBtn:function(n,i){return t.layout.buttons.addClose(e,n,i)},addPinBtn:function(n,i){return t.layout.buttons.addPin(e,n,i)}});for(var n=0;n<4;n++){var i=t.layout.buttons.config.borderPanes[n];e.state[i].pins=[]}e.options.autoBindCustomButtons&&t.layout.buttons.init(e)},_unload:function(t){}},t.layout.onLoad.push(t.layout.buttons._load))}(jQuery),function(t){t.layout.plugins.browserZoom=!0,t.layout.defaults.browserZoomCheckInterval=1e3,t.layout.optionsMap.layout.push("browserZoomCheckInterval"),t.layout.browserZoom={_init:function(e){!1!==t.layout.browserZoom.ratio()&&t.layout.browserZoom._setTimer(e)},_setTimer:function(e){if(!e.destroyed){var n=e.options,i=e.state,o=e.hasParentLayout?5e3:Math.max(n.browserZoomCheckInterval,100);setTimeout((function(){if(!e.destroyed&&n.resizeWithWindow){var o=t.layout.browserZoom.ratio();o!==i.browserZoom&&(i.browserZoom=o,e.resizeAll()),t.layout.browserZoom._setTimer(e)}}),o)}},ratio:function(){var e,n,i,o=window,r=screen,a=document,s=a.documentElement||a.body,l=t.layout.browser,c=l.version;return!(!l.msie||c>8)&&(r.deviceXDPI&&r.systemXDPI?d(r.deviceXDPI,r.systemXDPI):l.webkit&&(e=a.body.getBoundingClientRect)?d(e.left-e.right,a.body.offsetWidth):l.webkit&&(n=o.outerWidth)?d(n,o.innerWidth):!(!(n=r.width)||!(i=s.clientWidth))&&d(n,i));function d(t,e){return(parseInt(t,10)/parseInt(e,10)*100).toFixed()}}},t.layout.onReady.push(t.layout.browserZoom._init)}(jQuery),function(t){t.effects&&(t.layout.defaults.panes.useOffscreenClose=!1,t.layout.plugins&&(t.layout.plugins.effects.slideOffscreen=!0),t.layout.effects.slideOffscreen=t.extend(!0,{},t.layout.effects.slide),t.effects.slideOffscreen=function(e){return this.queue((function(){var n=t.effects,i=e.options,o=t(this),r=o.data("layoutEdge"),a=o.data("parentLayout").state,s=a[r].size,l=this.style,c="show"==n.setMode(o,i.mode||"show"),d=i.direction||"left",u="up"==d||"down"==d?"top":"left",p="up"==d||"left"==d,f=t.layout.config.offscreenCSS||{},g=t.layout.config.offscreenReset,h="offscreenResetTop",m={};m[u]=(c?p?"+=":"-=":p?"-=":"+=")+s,c?(o.data(h,{top:l.top,bottom:l.bottom}),p?o.css(u,isNaN(s)?"-"+s:-s):"right"===d?o.css({left:a.container.layoutWidth,right:"auto"}):o.css({top:a.container.layoutHeight,bottom:"auto"}),"top"===u&&o.css(o.data(g)||{})):(o.data(h,{top:l.top,bottom:l.bottom}),o.data(g,{left:l.left,right:l.right})),o.show().animate(m,{queue:!1,duration:e.duration,easing:i.easing,complete:function(){o.data(h)&&o.css(o.data(h)).removeData(h),c?o.css(o.data(g)||{}).removeData(g):o.css(f),e.callback&&e.callback.apply(this,arguments),o.dequeue()}})}))})}(jQuery),function(t){var e=t.layout;e.callbacks||(e.callbacks={}),e.callbacks.resizePaneAccordions=function(e,n){(n.jquery?n:t(n.newPanel||n.panel)).find(".ui-accordion:visible").each((function(){var e=t(this);e.data("accordion")&&e.accordion("resize"),e.data("ui-accordion")&&e.accordion("refresh")}))}}(jQuery),function(t){t.layout.callbacks.resizeDataTables=function(e,n){var i=n.jquery?n[0]:n.panel;t(i).is(":visible")&&t(t.fn.dataTable.fnTables(!0)).each((function(e,n){t.contains(i,n)&&t(n).dataTable().fnAdjustColumnSizing()}))}}(jQuery),function(t){var e=t.layout;e.callbacks||(e.callbacks={}),e.callbacks.resizeTabLayout=function(e,n){(n.jquery?n:t(n.newPanel||n.panel)).filter(":visible").find(".ui-layout-container:visible").addBack().each((function(){var e=t(this).data("layout");e&&(e.options.resizeWithWindow=!1,e.resizeAll())}))}}(jQuery)},,,,function(t,e,n){"use strict";var i=n(3);window.tinymce=n(48),n(427),n(428),n(430),n(431),n(432),n(433);var o=["schematags","|","addperson","addplace","addorg","addtitle","adddate","addcitation","addnote","addcorrection","addkeyword","addlink","addrs","addtranslation","|","editTag","removeTag","|","toggletags","viewmarkup","editsource","|","validate","savebutton","loadbutton","logoutbutton","|","fullscreen"];function r(){}r.init=function(t){var e=t.writer,n=t.editorId,r=t.layoutContainerId,a=void 0===t.iconType?"img":t.iconType;function s(t){var n=[];e.editor.dom.getParent(t,(function(t){if("BODY"==t.nodeName)return!0;n.push(t)})),e.editor.fire("NodeChange",{element:t,parents:n})}function l(t){m(e.editor),e.event("selectionChanged").publish()}function c(t){console.log("undoHandler",t),e.event("contentChanged").publish()}function d(t){console.log("redoHandler",t),e.event("contentChanged").publish()}function u(t){if(e.editor.lastKeyPress=t.which,e.isReadOnly){if((tinymce.isMac?t.metaKey:t.ctrlKey)&&70==t.which)return;t.preventDefault()}else e.event("writerKeydown").publish(t)}function p(t){(t.which>=33||t.which<=40||8==t.which)&&m(e.editor);var n=e.entitiesManager.getCurrentEntity();if(null!==n){var o=i(".entityHighlight",e.editor.getBody()).text(),r=e.entitiesManager.getEntity(n);r.isNote()&&r.setNoteContent(i("#"+n,e.editor.getBody()).html()),r.setContent(o),e.event("entityEdited").publish(n)}if(e.editor.currentNode){if(null===e.editor.currentNode.parentNode){var a=(u=e.editor.selection.getRng(!0)).commonAncestorContainer.parentNode;if(null!=a.getAttribute("data-mce-bogus")){var l=i(a),c=!0,d=l.nextAll("[_tag]")[0];null==d&&null==(d=l.parent().nextAll("[_tag]")[0])&&(c=!1,d=l.prevAll("[_tag]")[0]),null!=d&&(u.selectNodeContents(d),u.collapse(c),e.editor.selection.setRng(u),window.setTimeout((function(){s(d)}),0))}}if("false"===e.editor.currentNode.getAttribute("_textallowed"))if(tinymce.isMac?t.metaKey:t.ctrlKey){var u,p=i('[_textallowed="true"]',e.editor.getBody()).first();(u=e.editor.selection.getRng(!0)).selectNodeContents(p[0]),u.collapse(!0),e.editor.selection.setRng(u)}else"true"!==e.editor.currentNode.getAttribute("_entity")&&e.dialogManager.show("message",{title:"No Text Allowed",msg:"Text is not allowed in the current tag: "+e.editor.currentNode.getAttribute("_tag")+".",type:"error"})}if(13==t.which)if(null==(p=e.editor.currentNode))console.warn("tinymceWrapper: user pressed enter but no new node found");else if(t.shiftKey)p.normalize();else{var f=i(p);""==f.text()&&f.text("\ufeff"),e.tagger.processNewContent(p),e.editor.undoManager.add(),e.event("contentChanged").publish()}e.event("writerKeyup").publish(t)}function f(t){i("br",e.editor.getBody()).remove()}function g(t){var n=t.element;if(1!=n.nodeType)e.editor.currentNode=e.utilities.getRootTag()[0];else{if("mcepastebin"==n.getAttribute("id"))return;if(null==n.getAttribute("_tag")&&0==n.classList.contains("entityHighlight")){if(null!=n.getAttribute("data-mce-bogus")){var o,r=e.editor.selection.getRng(!0);if(r.collapsed){var a=!0;36==e.editor.lastKeyPress||37==e.editor.lastKeyPress||38==e.editor.lastKeyPress?(o=i(n).prevAll("[_tag]")[0],a=!1):null==(o=i(n).nextAll("[_tag]")[0])&&(o=i(n).parent().nextAll("[_tag]")[0]),null!=o&&(r.selectNodeContents(o),r.collapse(a),e.editor.selection.setRng(r))}else o=i(n).next("[_tag]")[0];n=null!=o?o:n.parentNode}else{if(n==e.editor.getBody())return;n=n.parentNode}window.setTimeout((function(){s(n)}),0)}else e.editor.currentNode=n}e.editor.currentBookmark=e.editor.selection.getBookmark(1),e.event("nodeChanged").publish(e.editor.currentNode)}function h(t){null!=e.editor.copiedElement.element&&(i(e.editor.copiedElement.element).remove(),e.editor.copiedElement.element=null),e.event("contentCopied").publish()}function m(t){var n=e.editor.selection.getRng(!0),o=n.commonAncestorContainer;if(o.nodeType===Node.ELEMENT_NODE&&o.hasAttribute("_entity")){if(e.entitiesManager.highlightEntity(),e.editor.dom.hasClass(o,"start")&&37==t.which||e.editor.dom.hasClass(o,"end")&&39!=t.which){var r=e.utilities.getPreviousTextNode(o);n.setStart(r,r.length),n.setEnd(r,r.length)}else{var a=e.utilities.getNextTextNode(o);n.setStart(a,0),n.setEnd(a,0)}e.editor.selection.setRng(n),n=e.editor.selection.getRng(!0)}var s,l=i(n.startContainer).parents("[_entity]")[0];if(null!=l)(s=l.getAttribute("name"))!==e.entitiesManager.getCurrentEntity()&&e.entitiesManager.highlightEntity(s,e.editor.selection.getBookmark());else{e.entitiesManager.highlightEntity();var c=i(e.editor.selection.getNode());c.attr("_tag")&&(s=c.attr("id"))}}tinymce.baseURL=e.cwrcRootUrl+"/js",tinymce.init({selector:"#"+n,ui_container:"#"+r,skin_url:e.cwrcRootUrl+"css/tinymce",content_css:e.cwrcRootUrl+"css/editor.css",doctype:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',element_format:"xhtml",forced_root_block:e.schemaManager.getBlockTag(),keep_styles:!1,paste_postprocess:function(t,n){e.tagger.processNewContent(n.node),window.setTimeout((function(){e.event("contentPasted").publish()}),0)},valid_elements:"*[*]",plugins:"schematags,cwrcpath,preventdelete,paste",toolbar1:null==t.buttons1?o.join(","):t.buttons1,toolbar2:null==t.buttons2?"cwrcpath":t.buttons2,toolbar3:null==t.buttons3?"":t.buttons3,menubar:!1,elementpath:!1,statusbar:!1,branding:!1,formats:{bold:{},italic:{},underline:{}},setup:function(t){function n(t,n){n.onmouseenter=function(t){var n=this.tooltip(),o=i(this.$el[0]),r=e.utilities.getOffsetPosition(o);r.left+=-.5*i(n.$el[0]).outerWidth()+.5*o.outerWidth(),r.top+=o.outerHeight(),n.moveTo(r.left,r.top)},e.editor.addButton(t,n)}e.editor=t,t.writer=e,t.currentBookmark=null,t.currentNode=null,t.copiedElement={selectionType:null,element:null},t.copiedEntity=null,t.lastKeyPress=null,t.on("init",(function(n){!0===e.isReadOnly&&(e.layoutManager.hideToolbar(),t.setMode("readonly")),t.dom.isBlock=function(e){if(!e)return!1;var n=e.nodeType;if(n&&1===n){var i=e.getAttribute("_tag")||e.nodeName;return!!t.schema.getBlockElements()[i]}return!!t.schema.getBlockElements()[e]};var o=e.settings.getSettings(),r=i(t.getBody());o.showEntities&&r.addClass("showEntities"),o.showTags&&r.addClass("showTags"),r.on("keydown",u).on("keyup",p),i(t.iframeElement.contentDocument).on("mouseup",l),e.event("tinymceInitialized").publish(e)})),t.on("Change",f),t.on("Undo",c),t.on("Redo",d),t.on("BeforeAddUndo",(function(t){})),t.on("NodeChange",g),t.on("copy",h),t.on("contextmenu",(function(n){if(n.preventDefault(),n.stopImmediatePropagation(),!e.isReadOnly){var o=e.utilities.getOffsetPosition(t.getContentAreaContainer(),window.document.documentElement),r=i(t.getDoc().documentElement),a=r.scrollTop(),s=r.scrollLeft(),l=o.left-s,c=o.top-a;n.pageX+=l,n.pageY+=c,e.tagMenu.show(n,void 0,!0)}})),n("addperson",{title:"Tag Person",icon:" ".concat(a," person"),entityButton:!0,entityType:"person",onclick:function(){return e.tagger.addEntityDialog("person")}}),n("addplace",{title:"Tag Place",icon:" ".concat(a," place"),entityButton:!0,entityType:"place",onclick:function(){return e.tagger.addEntityDialog("place")}}),n("adddate",{title:"Tag Date",icon:" ".concat(a," date"),entityButton:!0,entityType:"date",onclick:function(){return e.tagger.addEntityDialog("date")}}),n("addorg",{title:"Tag Organization",icon:" ".concat(a," org"),entityButton:!0,entityType:"org",onclick:function(){return e.tagger.addEntityDialog("org")}}),n("addcitation",{title:"Tag Citation",icon:" ".concat(a," citation"),entityButton:!0,entityType:"citation",onclick:function(){return e.tagger.addEntityDialog("citation")}}),n("addnote",{title:"Tag Note",icon:" ".concat(a," note"),entityButton:!0,entityType:"note",onclick:function(){return e.tagger.addEntityDialog("note")}}),n("addcorrection",{title:"Tag Correction",icon:" ".concat(a," correction"),entityButton:!0,entityType:"correction",onclick:function(){return e.tagger.addEntityDialog("correction")}}),n("addkeyword",{title:"Tag Keyword",icon:" ".concat(a," keyword"),entityButton:!0,entityType:"keyword",onclick:function(){return e.tagger.addEntityDialog("keyword")}}),n("addlink",{title:"Tag Link",icon:" ".concat(a," link"),entityButton:!0,entityType:"link",onclick:function(){return e.tagger.addEntityDialog("link")}}),n("addtitle",{title:"Tag Text/Title",icon:" ".concat(a," title"),entityButton:!0,entityType:"title",onclick:function(){return e.tagger.addEntityDialog("title")}}),n("addrs",{title:"Tag Referencing String",icon:" ".concat(a," rs"),entityButton:!0,entityType:"rs",onclick:function(){return e.tagger.addEntityDialog("rs")}}),n("editTag",{title:"Edit Tag/Entity",icon:" ".concat(a," tag-edit"),onclick:function(){return e.tagger.editTagDialog()}}),n("removeTag",{title:"Remove Tag",icon:" ".concat(a," tag-delete"),onclick:function(){return e.tagger.removeTag()}}),n("newbutton",{title:"New",image:"".concat(e.cwrcRootUrl,"img/page_white_text.png"),onclick:function(){return e.showSaveDialog()}}),n("savebutton",{title:"Save",icon:" ".concat(a," save"),onclick:function(){return e.showSaveDialog()}}),n("saveasbutton",{title:"Save As",image:"".concat(e.cwrcRootUrl,"img/save_as.png"),onclick:function(){return e.showSaveAsDialog()}}),n("saveexitbutton",{title:"Save & Exit",image:"".concat(e.cwrcRootUrl,"img/save_exit.png"),onclick:function(){return e.saveAndExit()}}),n("logoutbutton",{title:"Log out",icon:" ".concat(a," exit"),onclick:function(){return e.exit()}}),n("loadbutton",{title:"Load",icon:" ".concat(a," load"),onclick:function(){return e.showLoadDialog()}}),n("viewmarkup",{title:"Show Raw XML",icon:" ".concat(a," view-markup"),onclick:function(){return e.selection.showSelection()}}),n("toggletags",{title:"Toggle Tags",icon:" ".concat(a," toggle-tags"),onclick:function(){i("body",e.editor.getDoc()).toggleClass("showTags"),this.active(i("body",e.editor.getDoc()).hasClass("showTags"))}}),n("editsource",{title:"Edit Raw XML",icon:" ".concat(a," edit-source"),onclick:function(){return e.dialogManager.show("editSource")}}),n("validate",{title:"Validate",icon:" ".concat(a," validate"),onclick:function(){return e.validate()}}),n("addtriple",{title:"Add Relation",icon:" ".concat(a," add-triple"),onclick:function(){i("#westTabs").tabs("option","active",2),e.dialogManager.show("triple")}}),n("addtranslation",{title:"Add Translation",icon:" ".concat(a," translation"),onclick:function(){return e.dialogManager.show("translation")}}),n("fullscreen",{name:"fullscreen",title:"Toggle Fullscreen",icon:" ".concat(a," fullscreen-activate"),onclick:function(){return e.layoutManager.toggleFullScreen()}})}}),e.event("contentChanged").subscribe((function(){console.log("contentChanged")})),e.event("documentLoaded").subscribe((function(){e.editor.undoManager.clear(),e.editor.isNotDirty=!0,e.editor.getBody().focus()})),e.event("documentSaved").subscribe((function(){e.editor.isNotDirty=!0})),e.event("entityAdded").subscribe((function(){e.editor.isNotDirty=!1})),e.event("entityRemoved").subscribe((function(){e.editor.isNotDirty=!1})),e.event("entityEdited").subscribe((function(){e.editor.isNotDirty=!1}))},t.exports=r},,,,function(t,e,n){"use strict";var i=n(48);i.PluginManager.add("cwrcpath",(function(t){i.ui.CWRCPath=i.ui.Path.extend({postRender:function(){var e=this;function n(t){if(1===t.nodeType){if("BR"==t.nodeName||t.getAttribute("data-mce-bogus"))return!0;if("bookmark"===t.getAttribute("data-mce-type"))return!0}return!1}return t.writer.event("loadingDocument").subscribe((function(){e.row([])})),e.on("select",(function(e){var n=this.row()[e.index].element.getAttribute("id");t.writer.utilities.selectElementById(n,!1)})),t.on("nodeChange",(function(i){for(var o=[],r=i.parents,a=r.length;a--;){var s=r[a];if(1==s.nodeType&&!n(s)){var l=s.getAttribute("_tag"),c=s.getAttribute("id");if("entityHighlight"===c){var d=t.writer;c=d.entitiesManager.getCurrentEntity(),l=d.entitiesManager.getEntity(c).getTag()}null!=l&&o.push({name:l,element:s})}}e.row(o)})),e._super()}});new i.ui.CWRCPath(t)}))},function(t,e,n){"use strict";var i=n(3),o=n(48);n(100),o.PluginManager.add("schematags",(function(t){function e(e){e=void 0===e?"add":e;for(var n=[],i=t.writer.cwrcRootUrl+"img/",o=t.writer.schemaManager.schema.elements,r=0;r<o.length;r++){var a=o[r],s=a,l=t.writer.schemaManager.getFullNameForTag(a);""!==l&&(s+=" ("+l+")"),n.push({type:"menuitem",text:s,key:a,action:e,initialFilterState:null,image:i+"tag_blue.png",onclick:function(e){e.stopPropagation();var n=this.settings.key,i=this.settings.action;"add"==i?t.writer.tagger.addTagDialog(n,i):t.writer.tagger.changeTagDialog(n)}})}return n.push({type:"menuitem",text:"No tags available for current parent tag.",disabled:!0,hidden:!0,image:i+"cross.png",onclick:function(){}}),n}function n(t){var e=t.parent(),n=0;e.items().each((function(t){n+=i(t.getEl()).height()})),n=Math.min(n,400),e.layoutRect({h:n,minH:n}),e.repaint()}function r(o){i.extend(o,{layout:"stack",classes:"cwrc",onshow:function(e){if("menuitem"!=e.control.type){var o=e.control.items()[0],r=e.control.items()[1];o.value(""),"cwrcmenu"===r.type&&(!function(e){var n,o;if(null!=t.currentBookmark)for(n=t.currentBookmark.rng.commonAncestorContainer;3===n.nodeType;)n=n.parentNode;else n=t.currentNode;if(9===n.nodeType&&(n=i("body > [_tag]",n)[0]),null==(o=n.getAttribute("_tag"))){var r=n.getAttribute("id");if("entityHighlight"===r){var a=t.writer;r=a.entitiesManager.getCurrentEntity(),o=a.entitiesManager.getEntity(r).getTag()}else console.warn("schematags: in unknown tag",n)}var s=[];if(o!=t.writer.schemaManager.getHeader()){var l=t.writer.schemaManager.getChildrenForTag(o);s=l.map((function(t){return t.name}))}var c=0,d=0;if(e.items().each((function(t){c++,-1!=s.indexOf(t.settings.key)?(t.settings.initialFilterState=!1,t.disabled(!1),t.visible(!0)):(t.settings.initialFilterState=!0,t.disabled(!0),t.visible(!1),d++)})),c==d){var u=e.items().length;e.items()[u-1].disabled(!1),e.items()[u-1].visible(!0)}e.parent().reflow()}(r),r.show(),n(r),r.getEl().scrollTop=0)}},onPostRender:function(n){var o=n.control.items()[0],r=n.control.items()[1],a=this.settings.action,s=e(a);r.append(s),r.reflow(),i(o.getEl()).watermark("Filter"),i(o.getEl()).width(r.getEl().offsetWidth),t.writer.event("schemaLoaded").subscribe((function(){for(var t=r.items().toArray(),n=0;n<t.length;n++){var i=t[n];void 0!==i&&i.remove()}var o=e(a);r.append(o),r.reflow()}))},items:[{type:"textbox",onkeyup:function(t){var e=t.control.value(),i=t.control.parent().items()[1];i.items().each((function(t){""===e?(t.disabled(t.settings.initialFilterState),t.visible(!t.settings.initialFilterState)):!t.settings.initialFilterState&&t.settings.key&&-1!=t.settings.key.toLowerCase().indexOf(e.toLowerCase())?(t.disabled(!1),t.visible(!0)):(t.disabled(!0),t.visible(!1))})),n(i)}},{type:"cwrcmenu",autohide:!1,style:"position: relative !important;",items:[]}]})}o.ui.Factory.add("cwrcmenu",o.ui.FloatPanel.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"application",bodyRole:"menu",ariaRoot:!0},init:function(t){if(t.autohide=null==t.autohide||t.autohide,t.constrainToViewport=!0,t.itemDefaults)for(var e=t.items,n=e.length;n--;)e[n]=Tools.extend({},t.itemDefaults,e[n]);this._super(t),this.classes.add("menu")},repaint:function(){return this.classes.toggle("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){this.hideAll(),this.fire("select")},hideAll:function(){return this.find("menuitem").exec("hideMenu"),this._super()},preRender:function(){var t=this;return t.items().each((function(e){var n=e.settings;if(n.icon||n.image||n.selectable)return t._hasIcons=!0,!1})),t._super()}})),o.ui.Factory.add("cwrcpanelbutton",o.ui.PanelButton.extend({showPanel:function(){var e=this,n=e.settings;if(e.active(!0),e.panel)e.panel.show();else{var r=n.panel;r.type&&(r={layout:"grid",items:r}),r.role=r.role||"dialog",r.popover=!1,r.autohide=!0,r.ariaRoot=!0,e.panel=new o.ui.FloatPanel(r).on("hide",(function(){e.active(!1)})).on("cancel",(function(t){t.stopPropagation(),e.focus(),e.hidePanel()})).parent(e).renderTo(e.getContainerElm()),e.panel.fire("show"),e.panel.reflow()}var a=i(e.getEl()),s=t.writer.utilities.getOffsetPosition(a);s.top+=a.outerHeight(),e.panel.moveTo(s.left,s.top)},hideMenu:function(){this.hidePanel()}})),t.addCommand("getFilterMenu",r);var a={};r(a),t.addButton("schematags",{type:"cwrcpanelbutton",text:"Tags",icon:" img tag",popoverAlign:["bl-tl","bl-tc"],panel:a})}))},function(t,e,n){!function(){"use strict";var t=n(48),e=t.each,i={paste_auto_cleanup_on_paste:!0,paste_enable_default_filters:!0,paste_block_drop:!1,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:!1,paste_remove_styles:!1,paste_remove_styles_if_webkit:!0,paste_convert_middot_lists:!0,paste_convert_headers_to_strong:!1,paste_dialog_width:"450",paste_dialog_height:"400",paste_max_consecutive_linebreaks:2,paste_text_use_dialog:!1,paste_text_sticky:!1,paste_text_sticky_default:!1,paste_text_notifyalways:!1,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};function o(t,e){return t.getParam(e,i[e])}t.create("tinymce.plugins.TreePastePlugin",{init:function(n,i){var r=this;function a(e,i){var a,s=n.dom;r.onPreProcess.dispatch(r,e),e.node=s.create("div",0,e.content),t.isGecko&&(a=n.selection.getRng(!0)).startContainer==a.endContainer&&3==a.startContainer.nodeType&&1===e.node.childNodes.length&&/^(p|h[1-6]|pre)$/i.test(e.node.firstChild.nodeName)&&-1===e.content.indexOf("__MCE_ITEM__")&&s.remove(e.node.firstChild,!0),r.onPostProcess.dispatch(r,e),e.content=n.serializer.serialize(e.node,{getInner:1,forced_root_block:""}),!i&&n.pasteAsPlainText?(r._insertPlainText(e.content),o(n,"paste_text_sticky")||(n.pasteAsPlainText=!1,n.controlManager.setActive("pastetext",!1))):r._insert(e.content)}function s(i){var o,r,s,l,c,d,u=n.selection,p=n.dom,f=n.getBody();if((i.clipboardData||p.doc.dataTransfer)&&(d=(i.clipboardData||p.doc.dataTransfer).getData("Text"),n.pasteAsPlainText))return i.preventDefault(),void a({content:p.encode(d).replace(/\r?\n/g,"<br />")});if(!p.get("_mcePaste")){if(o=p.add(f,"div",{id:"_mcePaste",class:"mcePaste","data-mce-bogus":"1"},"\ufeff\ufeff"),c=f!=n.getDoc().body?p.getPos(n.selection.getStart(),f).y:f.scrollTop+p.getViewPort(n.getWin()).y,p.setStyles(o,{position:"absolute",left:t.isGecko?-40:0,top:c-25,width:1,height:1,overflow:"hidden"}),t.isIE)return l=u.getRng(),(s=p.doc.body.createTextRange()).moveToElementText(o),s.execCommand("Paste"),p.remove(o),"\ufeff\ufeff"===o.innerHTML?(n.execCommand("mcePasteWord"),void i.preventDefault()):(u.setRng(l),u.setContent(""),setTimeout((function(){a({content:o.innerHTML})}),0),t.dom.Event.cancel(i));var g=function(t){t.preventDefault()};p.bind(n.getDoc(),"mousedown",g),p.bind(n.getDoc(),"keydown",g),r=n.selection.getRng(),o=o.firstChild,(s=n.getDoc().createRange()).setStart(o,0),s.setEnd(o,2),u.setRng(s),window.setTimeout((function(){var t,i="";if(p.select("div.mcePaste > div.mcePaste").length?i="<p>"+p.encode(d).replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br />")+"</p>":(t=p.select("div.mcePaste"),e(t,(function(t){var n=t.firstChild;n&&"DIV"==n.nodeName&&n.style.marginTop&&n.style.backgroundColor&&p.remove(n,1),e(p.select("span.Apple-style-span",t),(function(t){p.remove(t,1)})),e(p.select("br[data-mce-bogus]",t),(function(t){p.remove(t)})),"mcePaste"!=t.parentNode.className&&(i+=t.innerHTML)}))),null!=n.copiedElement.element){var o='id="'+$("[id]",n.copiedElement.element).attr("id")+'"';if(-1!=i.search(o))if(0==n.copiedElement.selectionType)i=n.copiedElement.element.innerHTML;else{var s=$(n.writer.tagName,n.copiedElement.element).first()[0];s&&(i=s.innerHTML)}else n.copiedElement.element=null}e(p.select("div.mcePaste"),(function(t){p.remove(t)})),r&&u.setRng(r),a({content:i}),p.unbind(n.getDoc(),"mousedown",g),p.unbind(n.getDoc(),"keydown",g)}),0)}}r.editor=n,r.url=i,r.onPreProcess=new t.util.Dispatcher(r),r.onPostProcess=new t.util.Dispatcher(r),r.onPreProcess.add(r._preProcess),r.onPostProcess.add(r._postProcess),r.onPreProcess.add((function(t,e){n.execCallback("paste_preprocess",t,e)})),r.onPostProcess.add((function(t,e){n.execCallback("paste_postprocess",t,e)})),n.onKeyDown.addToTop((function(e,n){if((t.isMac?n.metaKey:n.ctrlKey)&&86==n.keyCode||n.shiftKey&&45==n.keyCode)return!1})),n.pasteAsPlainText=o(n,"paste_text_sticky_default"),n.addCommand("mceInsertClipboardContent",(function(t,e){a(e,!0)})),o(n,"paste_text_use_dialog")||n.addCommand("mcePasteText",(function(e,i){var r=t.util.Cookie;n.pasteAsPlainText=!n.pasteAsPlainText,n.controlManager.setActive("pastetext",n.pasteAsPlainText),n.pasteAsPlainText&&!r.get("tinymcePasteText")&&(o(n,"paste_text_sticky")?n.windowManager.alert(n.translate("paste.plaintext_mode_sticky")):n.windowManager.alert(n.translate("paste.plaintext_mode")),o(n,"paste_text_notifyalways")||r.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31)))})),n.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"}),n.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"}),o(n,"paste_auto_cleanup_on_paste")&&(t.isOpera||/Firefox\/2/.test(navigator.userAgent)?n.onKeyDown.addToTop((function(e,n){((t.isMac?n.metaKey:n.ctrlKey)&&86==n.keyCode||n.shiftKey&&45==n.keyCode)&&s(n)})):n.onPaste.addToTop((function(t,e){return s(e)}))),n.onInit.add((function(){n.controlManager.setActive("pastetext",n.pasteAsPlainText),o(n,"paste_block_drop")&&n.dom.bind(n.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],(function(t){return t.preventDefault(),t.stopPropagation(),!1}))}))},getInfo:function(){return{longname:"Tree paste",version:t.majorVersion+"."+t.minorVersion}},_preProcess:function(n,i){var r,a,s=this.editor,l=i.content,c=t.grep,d=t.explode,u=t.trim;function p(t){e(t,(function(t){l=t.constructor==RegExp?l.replace(t,""):l.replace(t[0],t[1])}))}if(0!=s.settings.paste_enable_default_filters){if(t.isIE&&document.documentMode>=9&&/<(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)/.test(i.content)&&(p([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]),p([[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])),/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(l)||i.wordContent){i.wordContent=!0,p([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]),o(s,"paste_convert_headers_to_strong")&&(l=l.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>")),o(s,"paste_convert_middot_lists")&&p([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]]),p([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,""]]);do{r=l.length,l=l.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1")}while(r!=l.length);0==o(s,"paste_retain_style_properties").replace(/^none$/i,"").length?l=l.replace(/<\/?span[^>]*>/gi,""):p([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(t,e){return e.length>0?e.replace(/./," ").slice(Math.floor(e.length/2)).split("").join(""):""}],[/(<[a-z][^>]*)\sstyle=('|")([^('|")]*)('|")/gi,function(t,n,i){var o=[],r=0,a=d(u(i).replace(/&quot;/gi,"'"),";");return e(a,(function(t){var e,n,i=d(t,":");function a(t){return t+("0"!==t&&/\d$/.test(t))?"px":""}if(2==i.length){switch(e=i[0].toLowerCase(),n=i[1].toLowerCase(),e){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":return void(o[r++]=e.replace(/^mso-|-alt$/g,"")+":"+a(n));case"horiz-align":return void(o[r++]="text-align:"+n);case"vert-align":return void(o[r++]="vertical-align:"+n);case"font-color":case"mso-foreground":return void(o[r++]="color:"+n);case"mso-background":case"mso-highlight":return void(o[r++]="background:"+n);case"mso-default-height":return void(o[r++]="min-height:"+a(n));case"mso-default-width":return void(o[r++]="min-width:"+a(n));case"mso-padding-between-alt":return void(o[r++]="border-collapse:separate;border-spacing:"+a(n));case"text-line-through":return void("single"!=n&&"double"!=n||(o[r++]="text-decoration:line-through"));case"mso-zero-height":return void("yes"==n&&(o[r++]="display:none"))}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(e))return;o[r++]=e+":"+i[1]}})),r>0?n+' style="'+o.join(";")+'"':n}]])}if(o(s,"paste_convert_headers_to_strong")&&p([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]),p([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]),"none"!==(a=o(s,"paste_strip_class_attributes"))){var f=function(t,e){if("all"===a)return"";var n=c(d(e.replace(/^(["'])(.*)\1$/,"$2")," "),(function(t){return/^(?!mso)/i.test(t)}));return n.length?' class="'+n.join(" ")+'"':""};l=(l=l.replace(/ class="([^"]+)"/gi,f)).replace(/ class=([\-\w]+)/gi,f)}o(s,"paste_remove_spans")&&(l=l.replace(/<\/?span[^>]*>/gi,"")),i.content=l}},_postProcess:function(n,i){var r,a=this.editor,s=a.dom;0!=a.settings.paste_enable_default_filters&&(i.wordContent&&(e(s.select("a",i.node),(function(t){t.href&&-1==t.href.indexOf("#_Toc")||s.remove(t,1)})),o(a,"paste_convert_middot_lists")&&this._convertLists(n,i),r=o(a,"paste_retain_style_properties"),t.is(r,"string")&&"all"!==r&&"*"!==r&&(r=t.explode(r.replace(/^none$/i,"")),e(s.select("*",i.node),(function(t){var e,n,i,o={},a=0;if(r)for(e=0;e<r.length;e++)n=r[e],(i=s.getStyle(t,n))&&(o[n]=i,a++);s.setAttrib(t,"style",""),r&&a>0?s.setStyles(t,o):"SPAN"!=t.nodeName||t.className||s.remove(t,!0)})))),o(a,"paste_remove_styles")||o(a,"paste_remove_styles_if_webkit")&&t.isWebKit?e(s.select("*[style]",i.node),(function(t){t.removeAttribute("style"),t.removeAttribute("data-mce-style")})):t.isWebKit&&e(s.select("*",i.node),(function(t){t.removeAttribute("data-mce-style")})))},_convertLists:function(n,i){var o,r,a,s,l,c=n.editor.dom,d=-1,u=[];e(c.select("p",i.node),(function(n){var i,l,p,f,g,h="";for(i=n.firstChild;i&&3==i.nodeType;i=i.nextSibling)h+=i.nodeValue;h=n.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,""),/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(h)&&(l="ul"),/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(h)&&(l="ol"),l?((a=parseFloat(n.style.marginLeft||0))>d&&u.push(a),o&&l==s?a>d?o=r.appendChild(c.create(l)):a<d&&(f=t.inArray(u,a),g=c.getParents(o.parentNode,l),o=g[g.length-1-f]||o):(o=c.create(l),c.insertAfter(o,n)),e(c.select("span",n),(function(t){var e=t.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");("ul"==l&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(e)||/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(e))&&c.remove(t)})),p=n.innerHTML,p="ul"==l?n.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,""):n.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,""),r=o.appendChild(c.create("li",0,p)),c.remove(n),d=a,s=l):o=d=0})),-1!=(l=i.node.innerHTML).indexOf("__MCE_ITEM__")&&(i.node.innerHTML=l.replace(/__MCE_ITEM__/g,""))},_insert:function(t,e){var n=this.editor,i=n.selection.getRng(),o=n.writer.tree;null!=o.selectionType?o.selectionType==o.CONTENTS_SELECTED?$("#"+o.currentlySelectedNodes[0],n.getBody()).html(t):$("#"+o.currentlySelectedNodes[0],n.getBody()).replaceWith(t):(n.selection.isCollapsed()||i.startContainer==i.endContainer||n.getDoc().execCommand("Delete",!1,null),n.execCommand("mceInsertContent",!1,t,{skip_undo:e}))},_insertPlainText:function(n){var i=this.editor,r=o(i,"paste_text_linebreaktype"),a=o(i,"paste_text_replacements"),s=t.is;function l(t){e(t,(function(t){n=t.constructor==RegExp?n.replace(t,""):n.replace(t[0],t[1])}))}if("string"==typeof n&&n.length>0){/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(n)?l([/[\n\r]+/g]):l([/\r+/g]),l([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"]]);var c=Number(o(i,"paste_max_consecutive_linebreaks"));if(c>-1){for(var d=new RegExp("\n{"+(c+1)+",}","g"),u="";u.length<c;)u+="\n";l([[d,u]])}n=i.dom.decode(t.html.Entities.encodeRaw(n)),s(a,"array")?l(a):s(a,"string")&&l(new RegExp(a,"gi")),l("none"==r?[[/\n+/g," "]]:"br"==r?[[/\n/g,"<br />"]]:"p"==r?[[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"]]:[[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]]),i.execCommand("mceInsertContent",!1,n)}}}),t.PluginManager.add("treepaste",t.plugins.TreePastePlugin)}()},function(t,e,n){"use strict";function i(t,e){return t.indexOf(e)>-1}function o(t,e,n){return t>=e&&t<=n}function r(t){return t.preventDefault(),t.stopPropagation(),!1}function a(t,e,n){var i;i="back"===n?e.commonAncestorContainer.previousElementSibling||e.commonAncestorContainer.parentElement:e.commonAncestorContainer.nextElementSibling||e.commonAncestorContainer.parentElement;var o=t.writer.schemaManager.wouldDeleteInvalidate(i,!0,!1),r='<p>Delete "'.concat(i.getAttribute("_tag"),'" element?</p>'),a="confirm-delete-tag";o&&(r='<p>Deleting the "'.concat(i.getAttribute("_tag"),'" element will make the document invalid. Do you wish to continue?</p>'),a="confirm-delete-tag-invalidating"),t.writer.dialogManager.confirm({title:"Warning",msg:r,showConfirmKey:a,type:"info",callback:function(o){var r;if(r="back"===n?t.writer.utilities.getPreviousTextNode(e.commonAncestorContainer,!0):t.writer.utilities.getNextTextNode(e.commonAncestorContainer,!0),o){var a="\ufeff"!==i.textContent;t.writer.tagger.removeStructureTag(i.getAttribute("id"),!a)}if(null!==r&&null!==r.parentNode){var s=t.selection.getRng();s.selectNode(r),s.collapse("back"!==n),t.selection.setRng(s)}t.focus()}})}function s(t,e,n,i){var o;if(null!==(o="back"===i?e.writer.utilities.getPreviousTextNode(n.commonAncestorContainer,!0):e.writer.utilities.getNextTextNode(n.commonAncestorContainer,!0))&&null!==o.parentNode){if(0===(l=o.parentElement).textContent.length||1===l.textContent.length&&65279===l.textContent.charCodeAt(0)){var s=e.selection.getRng();return"back"===i?(s.setStart(o,o.textContent.length),s.setEnd(o,o.textContent.length)):(s.setStart(o,0),s.setEnd(o,0)),a(e,s,i),r(t)}if("SPAN"===o.parentElement.nodeName){var l;if(1===o.parentElement.textContent.length)return(l=o.parentElement).textContent="\ufeff",(s=e.selection.getRng()).setStart(l.firstChild,1),s.setEnd(l.firstChild,1),e.selection.setRng(s),r(t)}else{s=e.selection.getRng();"back"===i?(s.setStart(o,o.textContent.length),s.setEnd(o,o.textContent.length)):(s.setStart(o,0),s.setEnd(o,0)),e.selection.setRng(s)}}}n(48).PluginManager.add("preventdelete",(function(t){t.on("keydown",(function(e){if(function(t){var e=t.keyCode;return t.ctrlKey?"x"==t.key||i([8,46],e):i([8,9,13,46],e)||o(e,48,57)||o(e,65,90)||o(e,96,111)||o(e,186,192)||o(e,219,222)}(e)){var n=t.selection.getRng();if(n.collapsed&&n.commonAncestorContainer.nodeType===Node.TEXT_NODE){var l=n.commonAncestorContainer;if(8===e.keyCode){if(0===n.startOffset)return 0===l.textContent.length?(a(t,n,"back"),r(e)):s(e,t,n,"back");if(1===n.startOffset&&1===l.textContent.length)return 65279===l.textContent.charCodeAt(0)?null===l.previousSibling?(a(t,n,"back"),r(e)):s(e,t,n,"back"):(l.textContent="\ufeff",n.setStart(l,1),t.selection.setRng(n),r(e));if(2===n.startOffset&&2===l.textContent.length&&65279===l.textContent.charCodeAt(0))return l.textContent="\ufeff",n.setStart(l,1),t.selection.setRng(n),r(e)}if(46===e.keyCode){if(n.startOffset===l.length)return 0===l.length?(a(t,n,"forward"),r(e)):s(e,t,n,"forward");if(n.startOffset===l.length-1&&1===l.length)return 65279===l.textContent.charCodeAt(0)?null===l.nextSibling?(a(t,n,"forward"),r(e)):s(e,t,n,"forward"):(l.textContent="\ufeff",n.setStart(l,0),t.selection.setRng(n),r(e))}}else{var c=!1,d=n.cloneContents();if(1===d.childNodes.length&&d.childNodes[0].nodeType===Node.ELEMENT_NODE)c=!0;else for(var u=0;u<d.childNodes.length;u++){if(d.childNodes[u].nodeType===Node.ELEMENT_NODE){var p=d.childNodes[u-1],f=d.childNodes[u+1];if(void 0!==p&&void 0!==f){c=!0;break}}}if(c)return t.writer.dialogManager.confirm({title:"Warning",msg:"<p>The text you are trying to delete contains XML elements, do you want to proceed?</p>",showConfirmKey:"confirm-delete-tags-selection",type:"info",callback:function(i){i&&(t.writer.tagger.processRemovedContent(n),t.focus(),8===e.keyCode||46===e.keyCode?t.getDoc().execCommand("insertText",!1,""):t.getDoc().execCommand("insertText",!1,e.key),t.writer.event("contentChanged").publish(),t.undoManager.add())}}),r(e)}}}))}))},function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=u(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var p={};function f(){}function g(){}function h(){}var m={};c(m,a,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,a)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(r,a,s,l){var c=u(t[r],t,a);if("throw"!==c.type){var d=c.arg,p=d.value;return p&&"object"==i(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,s,l)}),(function(t){o("throw",t,s,l)})):e.resolve(p).then((function(t){d.value=t,s(d)}),(function(t){return o("throw",t,s,l)}))}l(c.arg)}var r;this._invoke=function(t,n){function i(){return new e((function(e,i){o(t,n,e,i)}))}return r=r?r.then(i,i):i()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=u(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,c(b,"constructor",h),c(h,"constructor",g),g.displayName=c(h,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),c(_.prototype,s,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(d(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),c(b,l,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function r(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}n.r(e);var a=function(t,e){var n=encodeURIComponent(t);return"".concat("https://lookup.dbpedia.org/api/search/KeywordSearch","?QueryClass=").concat(e,"&MaxHits=").concat(5,"&QueryString=").concat(n,"&format=").concat("json")},s=function(){var t,e=(t=o().mark((function t(e,n){var i,r,s,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a(e,n),t.next=3,l(i).catch((function(t){return t}));case 3:if((r=t.sent).ok){t.next=6;break}throw new Error("Something wrong with the call to DBPedia, possibly a problem with the network or the server.\n      HTTP error: ".concat(r.status));case 6:return t.next=8,r.json();case 8:return s=t.sent,c=s.docs.map((function(t){var i,o=t.comment,r=void 0===o?"No description available":o,a=t.label,s=t.resource,l=null===(i=a[0])||void 0===i?void 0:i.replace(/(<([^>]+)>)/gi,""),c=s[0],d=r[0],u=c.replace("http://dbpedia.org","https://dbpedia.lookup.services.cwrc.ca");return{nameType:n,originalQueryString:e,repository:"dbpedia",id:c,uri:c,uriForDisplay:u,name:l,description:d}})),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,l,"next",t)}function l(t){r(a,i,o,s,l,"throw",t)}s(void 0)}))});return function(t,n){return e.apply(this,arguments)}}(),l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4,n=new Promise((function(t,n){var i=setTimeout((function(){clearTimeout(i),n("Call to DBPedia timed out")}),e)}));return Promise.race([fetch(t),n])},c={findPerson:function(t){return s(t,"person")},findPlace:function(t){return s(t,"place")},findOrganization:function(t){return s(t,"organisation")},findTitle:function(t){return s(t,"work")},findRS:function(t){return s(t,"thing")}},d={_username:"",set username(t){this._username=t},get username(){return this._username}};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(){p=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var o=e&&e.prototype instanceof f?e:f,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function f(){}function g(){}function h(){}var m={};s(m,o,(function(){return this}));var v=Object.getPrototypeOf,y=v&&v(v(E([])));y&&y!==e&&n.call(y,o)&&(m=y);var b=h.prototype=f.prototype=Object.create(m);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function i(o,r,a,s){var l=c(t[o],t,r);if("throw"!==l.type){var d=l.arg,p=d.value;return p&&"object"==u(p)&&n.call(p,"__await")?e.resolve(p.__await).then((function(t){i("next",t,a,s)}),(function(t){i("throw",t,a,s)})):e.resolve(p).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,s)}))}s(l.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=h,s(b,"constructor",h),s(h,"constructor",g),g.displayName=s(h,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(_.prototype),s(_.prototype,r,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(l(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),s(b,a,"Generator"),s(b,o,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function f(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function g(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){f(r,i,o,a,s,"next",t)}function s(t){f(r,i,o,a,s,"throw",t)}a(void 0)}))}}var h=function(t){var e=encodeURIComponent(t);return"https://secure.geonames.org/searchJSON?q=".concat(e,"&username=").concat(d.username,"&maxRows=10")},m=function(){var t=g(p().mark((function t(e,n){var i,o,r;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==d.username){t.next=2;break}throw new Error('You must provide a username to make requests to GeoNames. See instruction here: <a href=https://github.com/cwrc/CWRC-GitWriter target="blank" rel="noopener noreferrer">https://github.com/cwrc/CWRC-GitWriter</a>');case 2:return t.next=4,v(e).catch((function(t){return t}));case 4:if((i=t.sent).ok){t.next=7;break}throw new Error("Something wrong with the call to geonames, possibly a problem with the network or the server. HTTP error: ".concat(i.status));case 7:return t.next=9,i.json();case 9:return o=t.sent,r=o.geonames.map((function(t){var e=t.toponymName,i=t.adminName1,o=void 0===i?"":i,r=t.countryName,a=void 0===r?"":r,s=t.geonameId,l=t.fcodeName,c=void 0===l?"No description available":l,d="".concat(e," ").concat(o," ").concat(a),u="http://geonames.org/".concat(s);return{nameType:"place",id:u,uri:u,uriForDisplay:null,externalLink:u,name:d,repository:"geonames",originalQueryString:n,description:c}})),t.abrupt("return",r);case 12:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),v=function(){var t=g(p().mark((function t(e){var n,i,o,r=arguments;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{headers:{Accept:"application/json"}},i=r.length>2&&void 0!==r[2]?r[2]:3e3,o=new Promise((function(t,e){var n=setTimeout((function(){clearTimeout(n),e("Call to geonames timed out")}),i)})),t.abrupt("return",Promise.race([fetch(e,n),o]));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),y={findPlace:function(t){return m(h(t),t)},getPlaceLookupURI:h,credentials:d};function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(){w=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var o=e&&e.prototype instanceof u?e:u,r=Object.create(o.prototype),a=new T(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return S()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function p(){}function f(){}var g={};s(g,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(E([])));m&&m!==e&&n.call(m,o)&&(g=m);var v=f.prototype=u.prototype=Object.create(g);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function i(o,r,a,s){var l=c(t[o],t,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==b(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,s)}),(function(t){i("throw",t,a,s)})):e.resolve(u).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,s)}))}s(l.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function x(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function E(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=f,s(v,"constructor",f),s(f,"constructor",p),p.displayName=s(f,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(_.prototype),s(_.prototype,r,(function(){return this})),t.AsyncIterator=_,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new _(l(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(v),s(v,a,"Generator"),s(v,o,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function _(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}var x="ulan",C=function(t){return S(t,x)},k=function(t){return S(t,"tgn")},T=function(){var t,e=(t=w().mark((function t(e,n,i){var o,r,a;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E(e).catch((function(t){return t}));case 2:if((o=t.sent).ok){t.next=5;break}throw new Error("Something wrong with the call to Getty, possibly a problem with the network or the server. HTTP error: ".concat(o.status));case 5:return t.next=7,o.json();case 7:return r=t.sent,a=r.results.bindings.map((function(t){var e=t.Subject.value,o=t.Term.value,r=t.Descr,a=(r=void 0===r?"No description available":r).value,s=void 0===a?"No description available":a;return{nameType:i,id:e,uri:e,uriForDisplay:e.replace("http","https"),name:o,repository:"getty",originalQueryString:n,description:s}})),t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){_(r,i,o,a,s,"next",t)}function s(t){_(r,i,o,a,s,"throw",t)}a(void 0)}))});return function(t,n,i){return e.apply(this,arguments)}}(),E=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(t,e){var i=setTimeout((function(){clearTimeout(i),e("Call to Getty timed out")}),n)}));return Promise.race([fetch(t,e),i])},S=function(t,e){var n=encodeURIComponent('select ?Subject ?Term ?Parents ?Descr ?ScopeNote ?Type (coalesce(?Type1,?Type2) as ?ExtraType) {\n    ?Subject luc:term "'.concat(t,'"; a ?typ; skos:inScheme ').concat(e,":.\n    ?typ rdfs:subClassOf gvp:Subject; rdfs:label ?Type.\n    filter (?typ != gvp:Subject)\n    optional {?Subject gvp:placeTypePreferred [gvp:prefLabelGVP [xl:literalForm ?Type1]]}\n    optional {?Subject gvp:agentTypePreferred [gvp:prefLabelGVP [xl:literalForm ?Type2]]}\n    optional {?Subject gvp:prefLabelGVP [xl:literalForm ?Term]}\n    optional {?Subject gvp:parentStringAbbrev ?Parents}\n    optional {?Subject foaf:focus/gvp:biographyPreferred/schema:description ?Descr}\n    optional {?Subject skos:scopeNote [dct:language gvp_lang:en; rdf:value ?ScopeNote]}}\n    LIMIT 5"));return"".concat("https://vocab.getty.edu","/sparql.json?query=").concat(n)},D={findPerson:function(t){return T(C(t),t,x)},findPlace:function(t){return T(k(t),t,"tgn")},getPersonLookupURI:C,getPlaceLookupURI:k};function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function M(){M=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var o=e&&e.prototype instanceof u?e:u,r=Object.create(o.prototype),a=new C(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return T()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function p(){}function f(){}var g={};s(g,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(k([])));m&&m!==e&&n.call(m,o)&&(g=m);var v=f.prototype=u.prototype=Object.create(g);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function i(o,r,a,s){var l=c(t[o],t,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==P(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,s)}),(function(t){i("throw",t,a,s)})):e.resolve(u).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,s)}))}s(l.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=f,s(v,"constructor",f),s(f,"constructor",p),p.displayName=s(f,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(b.prototype),s(b.prototype,r,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new b(l(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(v),s(v,a,"Generator"),s(v,o,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=k,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:k(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function L(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}var A=function(t){return j(t,"local.personalNames")},R=function(t){return j(t,"local.geographicNames")},O=function(t){return j(t,"local.corporateNames")},N=function(t){return j(t,"local.uniformTitleWorks")},$=function(t){return j(t,"local.names")},I=function(){var t,e=(t=M().mark((function t(e,n){var i,o,r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z(e).catch((function(t){return t}));case 2:if((i=t.sent).ok){t.next=5;break}throw new Error("Something wrong with the call to VIAF, possibly a problem with the network or the server. HTTP error: ".concat(i.status));case 5:return t.next=7,i.json();case 7:return o=t.sent,r=o.searchRetrieveResponse.records?o.searchRetrieveResponse.records.map((function(t){var e=t.record.recordData,i=e.nameType,o=e.Document["@about"],r=e.mainHeadings.data;return{nameType:i,id:o,uri:o,uriForDisplay:null,externalLink:o,name:Array.isArray(r)?r[0].text:r.text,repository:"VIAF",originalQueryString:n}})):[],t.abrupt("return",r);case 10:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){L(r,i,o,a,s,"next",t)}function s(t){L(r,i,o,a,s,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}(),z=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(t,e){var i=setTimeout((function(){clearTimeout(i),e("Call to VIAF timed out")}),n)}));return Promise.race([fetch(t,e),i])},j=function(t,e){var n=encodeURIComponent(t);return"https://viaf.org/viaf/search?query=".concat(e,"+all+%22").concat(n,"%22&httpAccept=application/json&maximumRecords=5")},F={findPerson:function(t){return I(A(t),t)},findPlace:function(t){return I(R(t),t)},findOrganization:function(t){return I(O(t),t)},findTitle:function(t){return I(N(t),t)},findRS:function(t){return I($(t),t)},getPersonLookupURI:A,getPlaceLookupURI:R,getOrganizationLookupURI:O,getTitleLookupURI:N,getRSLookupURI:$,fetchWithTimeout:z},B=n(239),U=n.n(B);function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H(){H=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var o=e&&e.prototype instanceof u?e:u,r=Object.create(o.prototype),a=new C(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return T()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function p(){}function f(){}var g={};s(g,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(k([])));m&&m!==e&&n.call(m,o)&&(g=m);var v=f.prototype=u.prototype=Object.create(g);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function i(o,r,a,s){var l=c(t[o],t,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==W(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,s)}),(function(t){i("throw",t,a,s)})):e.resolve(u).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,s)}))}s(l.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=f,s(v,"constructor",f),s(f,"constructor",p),p.displayName=s(f,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(b.prototype),s(b.prototype,r,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new b(l(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(v),s(v,a,"Generator"),s(v,o,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=k,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:k(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function X(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}var V=function(t){return J(t)},q=function(t){return J(t)},G=function(t){return J(t)},Y=function(t){return J(t)},K=function(t){return J(t)},J=function(t){return U.a.searchEntities({search:t,format:"json",language:"en",limit:5})},Q=function(){var t,e=(t=H().mark((function t(e,n){var i,o,r;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Z(e).catch((function(t){return t}));case 2:if((i=t.sent).ok){t.next=5;break}throw new Error("Something wrong with the call to Wikidata, possibly a problem with the network or the server. HTTP error: ".concat(i.status));case 5:return t.next=7,i.json();case 7:return o=t.sent,r=o.search.map((function(t){var e=t.concepturi,i=t.label,o=t.description;return{nameType:"unknown",id:e,uriForDisplay:e.replace("http","https"),uri:e,name:i,repository:"wikidata",originalQueryString:n,description:o}})),t.abrupt("return",r);case 10:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){X(r,i,o,a,s,"next",t)}function s(t){X(r,i,o,a,s,"throw",t)}a(void 0)}))});return function(t,n){return e.apply(this,arguments)}}(),Z=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(t,e){var i=setTimeout((function(){clearTimeout(i),e("Call to Wikidata timed out")}),n)}));return Promise.race([fetch(t,e),i])},tt={findPerson:function(t){return Q(V(t),t)},findPlace:function(t){return Q(q(t),t)},findOrganization:function(t){return Q(G(t),t)},findTitle:function(t){return Q(Y(t),t)},findRS:function(t){return Q(K(t),t)},getPersonLookupURI:V,getPlaceLookupURI:q,getOrganizationLookupURI:G,getTitleLookupURI:Y,getRSLookupURI:K,fetchWithTimeout:Z};function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nt(){nt=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var o=e&&e.prototype instanceof u?e:u,r=Object.create(o.prototype),a=new C(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return T()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function p(){}function f(){}var g={};s(g,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(k([])));m&&m!==e&&n.call(m,o)&&(g=m);var v=f.prototype=u.prototype=Object.create(g);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function i(o,r,a,s){var l=c(t[o],t,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==et(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,s)}),(function(t){i("throw",t,a,s)})):e.resolve(u).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,s)}))}s(l.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=f,s(v,"constructor",f),s(f,"constructor",p),p.displayName=s(f,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(b.prototype),s(b.prototype,r,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new b(l(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(v),s(v,a,"Generator"),s(v,o,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=k,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:k(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function it(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function ot(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){it(r,i,o,a,s,"next",t)}function s(t){it(r,i,o,a,s,"throw",t)}a(void 0)}))}}var rt="",at="",st="",lt="",ct=function(t){return ft(t,"person")},dt=function(t){return ft(t,"place")},ut=function(t){return ft(t,"organization")},pt=function(t){return ft(t,"title")},ft=function(t,e){return"".concat(at,"/search/").concat(e,"?query=").concat(encodeURIComponent(t),"&limit=100&page=0")},gt=function(){var t=ot(nt().mark((function t(e,n,i){var o,r,a;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,yt(e,{credentials:"same-origin"}).catch((function(t){return t}));case 2:if((o=t.sent).ok){t.next=5;break}throw new Error("Something wrong with the call to CWRC, possibly a problem with the network or the server. HTTP error: ".concat(o.status));case 5:return t.next=7,o.json();case 7:if((r=t.sent).response.objects){t.next=10;break}return t.abrupt("return",[]);case 10:return a=r.response.objects.map((function(t){var e=t.PID,o=t.object_label,r="".concat(rt,"/").concat(e),a={id:e,uri:r,uriForDisplay:r,name:o,nameType:i,repository:"CWRC",originalQueryString:n},s=e.substring(0,e.indexOf(":")),l=ht[s];return void 0!==l&&(a.logo="".concat(st,"/").concat(l)),a})),t.abrupt("return",a);case 12:case"end":return t.stop()}}),t)})));return function(e,n,i){return t.apply(this,arguments)}}(),ht={},mt=function(){var t=ot(nt().mark((function t(e){var n,i;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,yt(e,{credentials:"same-origin"}).catch((function(t){return t}));case 2:if((n=t.sent).ok){t.next=5;break}throw new Error("Something wrong with the call to CWRC, possibly a problem with the network or the server. HTTP error: ".concat(n.status));case 5:return t.next=7,n.json();case 7:return i=t.sent,ht=vt(i),t.abrupt("return",ht);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),vt=function(t){var e={};for(var n in t){var i=t[n],o=void 0,r=i.field_logo;if(void 0!==r)for(var a in r){var s=r[a];s.length>0&&(o=s[0].filename)}var l=void 0,c=i.field_top_level_collection;if(void 0!==c&&void 0!==c.und){var d=c.und;if(d.length>0&&void 0!==d[0].pid){var u=d[0].pid,p=void 0;""!==(p=u===lt?"cwrc":u.substring(0,u.indexOf(":")))&&(l=p)}}void 0!==o&&void 0!==l&&void 0===e[l]&&(e[l]=o)}return e},yt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(t,e){var i=setTimeout((function(){clearTimeout(i),e("Call to CWRC timed out")}),n)}));return Promise.race([fetch(t,e),i])},bt={setEntityRoot:function(t){return rt=t},getEntityRoot:function(){return rt},setSearchRoot:function(t){return at=t},getSearchRoot:function(){return at},setProjectLookupConfig:function(t){return st=t.projectLogoRoot,lt=t.cwrcProjectId,mt(t.projectLookupUrl)},findPerson:function(t){return gt(ct(t),t,"person")},findPlace:function(t){return gt(dt(t),t,"place")},findOrganization:function(t){return gt(ut(t),t,"organization")},findTitle:function(t){return gt(pt(t),t,"title")},getPersonLookupURI:ct,getPlaceLookupURI:dt,getOrganizationLookupURI:ut,getTitleLookupURI:pt,fetchWithTimeout:yt},wt=n(24),_t=n.n(wt),xt=n(3),Ct=n.n(xt),kt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi;Ct.a.htmlPrefilter=function(t){return t.replace(kt,"<$1></$2>")};var Tt=n(39),Et=n.n(Tt);function St(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Pt=function(t,e){var n=[],i=function(i){var o=Ct()('\n        <div>\n            <p>\n                <span class="ui-state-highlight" style="border: none;"><span style="float: left; margin-right: 4px;" class="ui-icon ui-icon-info"></span></span>\n                <span class="ui-state-error" style="border: none;"><span style="float: left; margin-right: 4px;" class="ui-icon ui-icon-alert"></span></span>\n                <span class="message"></span>\n            </p>\n            <span id="confirmCheckboxParent" style="display: none;">\n                <input type="checkbox" id="showConfirmCheckbox" checked/>\n                <label for="showConfirmCheckbox">Show this warning next time</label>\n            </span>\n        </div>\n        ').appendTo(e),r=i.title,a=null==i.modal||i.modal,s=i.height||300,l=i.width||300;o.dialog({title:r,modal:a,height:s,width:l,resizable:!0,closeOnEscape:!0,position:{my:"center",at:"center",of:t.layoutManager.getContainer()},autoOpen:!1,close:function(t){n.splice(n.indexOf(o),1),o.dialog("destroy"),o.remove(),"message"===i.dialogType&&i.callback&&setTimeout(i.callback,0)}});var c=i.msg;o.find("p > span[class=message]").html(c);var d=i.type;return o.find("p > span[class^=ui-state]").hide(),"info"===d&&o.find("p > span[class=ui-state-highlight]").show(),"error"===d&&o.find("p > span[class=ui-state-error]").show(),n.push(o),o};return{show:function(t){t.dialogType="message";var e=i(t);e.dialog("option","buttons",[{text:"Ok",role:"ok",click:function(){return e.dialog("close")}}]),e.dialog("open")},confirm:function(e){if(e.showConfirmKey&&!1===t.dialogManager.getDialogPref(e.showConfirmKey))return void(e.callback&&e.callback(!0));e.dialogType="confirm";var n=i(e);e.showConfirmKey&&Ct()("#confirmCheckboxParent").show();var o=e.callback,r=e.yesText||"Yes",a=e.noText||"No";n.dialog("option","buttons",[{text:r,role:"yes",click:function(){if(e.showConfirmKey){var i=Ct()("#showConfirmCheckbox").prop("checked");t.dialogManager.setDialogPref(e.showConfirmKey,i)}n.dialog("close"),o&&setTimeout((function(){return o(!0)}),0)}},{text:a,role:"no",click:function(){if(e.showConfirmKey){var i=Ct()("#showConfirmCheckbox").prop("checked");t.dialogManager.setDialogPref(e.showConfirmKey,i)}n.dialog("close"),o&&setTimeout((function(){return o(!1)}),0)}}]),n.dialog("open")},destroy:function(){var t,e=St(n);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.dialog("destroy"),i.remove()}}catch(t){e.e(t)}finally{e.f()}n=[]},getOpenDialogs:function(){return n}}},Mt=n(463),Lt=(n(72),n(32),n(49)),At=n.n(Lt);var Rt=function(t,e){var n=t,i=n.getUniqueId("translation_"),o="div",r="xml:lang",a="resp",s=Ct()('\n    <div class="annotationDialog">\n        <div>\n            <label for="'.concat(i,'_lang">Language:</label>\n            <select id="').concat(i,'_lang"></select>\n        </div>\n        <div>\n            <label for="').concat(i,'_resp">Add Responsibility:</label>\n            <input id="').concat(i,'_resp" type="checkbox" />\n        </div>\n        <div>\n            <label for="').concat(i,'_trans">Translation text</label>\n            <textarea id="').concat(i,'_trans" style="width: 98%; height: 100px;" spellcheck="false"></textarea>\n            <p>You will be able to tag and edit the text in the main document.</p>\n        </div>\n        <div>\n            <h3>Markup options</h3>\n            <div id="').concat(i,'_atts" class="attributes" />\n        </div>\n    </div>')).appendTo(e);s.dialog({title:"Tag Translation",modal:!0,resizable:!0,closeOnEscape:!0,height:500,width:600,autoOpen:!1,buttons:[{text:"Ok",role:"ok",click:function(){u(),s.dialog("close")}},{text:"Cancel",role:"cancel",click:function(){s.dialog("close")}}],open:function(t){},close:function(t){}});var l=Mt.a.reduce((function(t,e){var n=e.iso6391,i=e.name;return void 0!==n&&t.push({name:i,value:n}),t}),[]);l.sort((function(t,e){return t.name>e.name?1:t.name<e.name?-1:0}));var c="";l.forEach((function(t){c+='<option value="'.concat(t.value,'">').concat(t.name,"</option>")})),Ct()("#"+i+"_lang").html(c),Ct()("#"+i+"_atts").parent().accordion({heightStyle:"content",animate:!1,collapsible:!0,active:!1});var d=new At.a({writer:n,$parent:s,$el:Ct()("#"+i+"_atts"),showSchemaHelp:!0});Ct()("#"+i+"_lang").on("change",(function(t){d.setAttribute(r,t.target.value)})),Ct()("#"+i+"_resp").on("change",(function(t){t.target.checked?d.setAttribute(a,n.getUserInfo().nick):d.setAttribute(a,void 0)}));var u=function(){var t=Ct()("#"+i+"_trans").val(),e=d.getData(),r=n.tagger.getCurrentTag().attr("id"),a=n.tagger.addStructureTag(o,e,{tagId:r},n.tagger.AFTER),s=n.tagger.addStructureTag("p",{},{tagId:a.id},n.tagger.INSIDE);Ct()(s).html(t)};return{show:function(t){if(n.tagger.getCurrentTag().attr("_tag")===o){var e=Ct()("#"+i+"_resp");n.schemaManager.isAttributeValidForTag(a,o)?e.parent().show():e.parent().hide(),e.prop("checked",!1);var r=Ct()("#"+i+"_lang > option:eq(0)").val();Ct()("#"+i+"_lang").val(r),Ct()("#"+i+"_trans").val(""),d.mode=At.a.ADD;var l=n.schemaManager.getAttributesForTag(o),c={type:"translation"};c["xml:lang"]=r,d.buildWidget(l,c,o),Ct()("#"+i+"_atts").parent().accordion("option","active",!1),s.dialog("open")}else n.dialogManager.show("message",{title:"Translation",msg:"Please select a ".concat(o," tag to translate."),type:"info"})},destroy:function(){Ct()("#"+i+"_atts").parent().accordion("destroy"),s.dialog("destroy")}}},Ot=n(3);n(32),n(58),n(99);var Nt,$t,It,zt,jt="cwrc-writer-base-dialog-preferences",Ft=(n(7),n(349)),Bt=n(350),Ut=n(352),Wt=n(353),Ht=n(354),Xt=n(355),Vt=n(356),qt=n(357),Gt=n(358),Yt=n(359),Kt=n(360),Jt=n(361),Qt=n(362),Zt=n(363),te={tei:n(364),teiLite:n(376),orlando:n(387),cwrcEntry:n(397)};function ee(t){if(t.is(":visible")&&0==t.parent(".ui-dialog").hasClass("popup")){var e=Ot(window).width(),n=Ot(window).height(),i=t.dialog("option","width"),o=t.dialog("option","height");i>e&&t.dialog("option","width",.8*e),o>n&&t.dialog("option","height",.8*n),t.dialog("option","position",{my:"center",at:"center",of:window})}}var ne=function(t){var e=t,n=Ot('<div class="cwrc cwrcDialogWrapper"></div>').appendTo(e.layoutManager.getContainer());!function(t){Nt=Ot.ui.dialog.prototype.options.appendTo,$t=Ot.ui.dialog.prototype.options.create,It=Ot.ui.tooltip.prototype.options.open,zt=Ot.custom.popup.prototype.options.create,Ot.extend(Ot.ui.dialog.prototype.options,{appendTo:t,create:function(t){Ot(t.target).on("dialogopen",(function(t){ee(Ot(t.target)),Ot(window).on("resize",Ot.proxy(ee,this,Ot(t.target)))})).on("dialogclose",(function(t){Ot(window).off("resize",Ot.proxy(ee,this,Ot(t.target)))}))}}),Ot.extend(Ot.ui.tooltip.prototype.options,{create:function(e,n){var i=Ot(this).tooltip("instance");i.liveRegion=i.liveRegion.appendTo(t)}}),Ot.extend(Ot.ui.tooltip.prototype,{_appendTo:function(e){var n=e.closest(".ui-front, dialog");return n.length||(n=t),n}}),Ot.extend(Ot.custom.popup.prototype.options,{appendTo:t,create:function(t){Ot(t.target).on("popupopen",(function(t){ee(Ot(t.target)),Ot(window).on("resize",Ot.proxy(ee,this,Ot(t.target)))})).on("popupclose",(function(t){Ot(window).off("resize",Ot.proxy(ee,this,Ot(t.target)))}))}})}(n);var i={},o={},r={addDialog:function(t,o){var r=o(e,n);return void 0===r.show&&console.warn(t+' doesn\'t have required method "show"!'),void 0===r.destroy&&console.warn(t+' doesn\'t have required method "destroy"!'),i[t]=r,r},getDialog:function(t){return i[t]},getDialogWrapper:function(){return n},show:function(t,n){var r;if(n=void 0===n?{}:n,0===t.indexOf("schema/")){var a=t.split("/");t=a[1],r=o[e.schemaManager.getCurrentSchema().schemaMappingsId][t]}else i[t]?r=i[t]:o[e.schemaManager.getCurrentSchema().schemaMappingsId][t]&&(r=o[e.schemaManager.getCurrentSchema().schemaMappingsId][t]);void 0!==r&&r.show(n)},confirm:function(t){i.message.confirm(t)}};r.destroy=function(){for(var t in o){var e=o[t];for(var n in e)e[n].destroy()}for(var n in i)void 0!==i[n].destroy?i[n].destroy():console.warn("dialogManager: cannot destroy",n);Ot.extend(Ot.ui.dialog.prototype.options,{appendTo:Nt,create:$t}),Ot.extend(Ot.ui.tooltip.prototype.options,{open:It}),Ot.extend(Ot.custom.popup.prototype.options,{appendTo:Nt,create:zt})},r.getDialogPref=function(t){var e=Et.a.get(jt);if(e){var n=JSON.parse(e);if(void 0!==n[t])return n[t]}},r.setDialogPref=function(t,e){var n=Et.a.get(jt),i=n?JSON.parse(n):{};i[t]=e,Et.a.set(jt,JSON.stringify(i),{expires:7,path:""})},r.clearDialogPrefs=function(){Et.a.remove(jt,{path:""})};var a={message:Pt,popup:qt,copyPaste:Vt,triple:Ht,translation:Rt,loadingindicator:Bt,addschema:Ft,person:Gt,org:Kt,title:Jt,citation:Qt,place:Yt,rs:Zt,attributesEditor:Xt};for(var s in!0!==e.isReadOnly&&!0!==e.isAnnotator&&(a.header=Ut,a.editSource=Wt),a)r.addDialog(s,a[s]);return e.event("schemaLoaded").subscribe((function(){var t=e.schemaManager.getCurrentSchema().schemaMappingsId;if(void 0===o[t])for(var i in o[t]={},te[t]){var r=te[t][i];o[t][i]=new r(e,n)}})),r},ie=n(0),oe=n.n(ie),re=n(12),ae=n.n(re),se=n(468),le=n(469),ce=n(472),de=n(465),ue=n(467);function pe(t){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ge(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function he(t,e){return(he=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=be(t);if(e){var o=be(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ve(this,n)}}function ve(t,e){if(e&&("object"===pe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ye(t)}function ye(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function be(t){return(be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function we(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _e=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&he(t,e)}(r,t);var e,n,i,o=me(r);function r(){var t,e;fe(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return we(ye(e=o.call.apply(o,[this].concat(i))),"helpLink",null!==(t=e.props.helpUrl)&&void 0!==t?t:"https://cwrc.ca/Documentation/CWRC-Writer"),we(ye(e),"openDialog",(function(){return e.props.dialog.dialog("open")})),e}return e=r,(n=[{key:"render",value:function(){return oe.a.createElement(ce.a,null,oe.a.createElement(de.a,{"aria-label":"settings",className:"settingsLink",onClick:this.openDialog,size:"small",style:{color:"#ffffff"}},oe.a.createElement(ue.a,{fontSize:"small"},"settings")),oe.a.createElement(de.a,{"aria-label":"help",className:"helpLink",href:this.helpLink,rel:"noopener noreferrer",size:"small",style:{marginLeft:"8px",color:"#ffffff"},target:"_blank"},oe.a.createElement(ue.a,{fontSize:"small"},"help")))}}])&&ge(e.prototype,n),i&&ge(e,i),Object.defineProperty(e,"prototype",{writable:!1}),r}(ie.Component),xe=n(470),Ce=n(473),ke=n(474),Te=n(475),Ee=function(t){var e=t.label,n=t.inputs;return oe.a.createElement("div",{id:"fontSizeContainer",style:{display:"flex",marginBottom:"10px"}},oe.a.createElement("div",{style:{flex:1,textAlignLast:"right",paddingRight:"10px",paddingTop:"7px"}},e),oe.a.createElement("div",{style:{flex:2}},n.length>0&&oe.a.createElement("div",{stlye:{display:"flex",flexDirection:"colunm"}},n.map((function(t,e){return oe.a.createElement("div",{key:e,style:{marginBottom:"5px"}},"select"===t.type&&(i=(n=t).id,o=n.disabled,r=n.value,a=n.options,s=n.onChange,oe.a.createElement(xe.a,{disabled:o,id:i,labelId:i,onChange:function(t){return s(t.target.value)},value:r},a.map((function(t){var e=t.disabled,n=t.value,i=t.label;return oe.a.createElement(Ce.a,{key:n,disabled:e,value:n},i)})))),"switch"===t.type&&function(t){var e=t.checked,n=t.label,i=t.onChange;return oe.a.createElement(ke.a,{control:oe.a.createElement(Te.a,{color:"primary",checked:e,inputProps:{"aria-label":n},name:n,onChange:i,size:"small"}),label:n})}(t),"button"===t.type&&function(t){var e=t.id,n=t.label,i=t.onClick;return oe.a.createElement(se.a,{name:e,onClick:i,size:"small",variant:"outlined"},n)}(t));var n,i,o,r,a,s})))))};function Se(t){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function De(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Pe(){Pe=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var o=e&&e.prototype instanceof u?e:u,r=Object.create(o.prototype),a=new C(i||[]);return r._invoke=function(t,e,n){var i="suspendedStart";return function(o,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===o)throw r;return T()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var l=c(t,e,n);if("normal"===l.type){if(i=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),r}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d={};function u(){}function p(){}function f(){}var g={};s(g,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(k([])));m&&m!==e&&n.call(m,o)&&(g=m);var v=f.prototype=u.prototype=Object.create(g);function y(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function i(o,r,a,s){var l=c(t[o],t,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==Se(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,a,s)}),(function(t){i("throw",t,a,s)})):e.resolve(u).then((function(t){d.value=t,a(d)}),(function(t){return i("throw",t,a,s)}))}s(l.arg)}var o;this._invoke=function(t,n){function r(){return new e((function(e,o){i(t,n,e,o)}))}return o=o?o.then(r,r):r()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=c(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=f,s(v,"constructor",f),s(f,"constructor",p),p.displayName=s(f,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,s(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},y(b.prototype),s(b.prototype,r,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var a=new b(l(e,n,i,o),r);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(v),s(v,a,"Generator"),s(v,o,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=k,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(n,i){return a.type="throw",a.arg=t,e.next=n,i&&(e.method="next",e.arg=void 0),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),l=n.call(r,"finallyLoc");if(s&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var o=i.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:k(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function Me(t,e,n,i,o,r,a){try{var s=t[r](a),l=s.value}catch(t){return void n(t)}s.done?e(l):Promise.resolve(l).then(i,o)}function Le(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function a(t){Me(r,i,o,a,s,"next",t)}function s(t){Me(r,i,o,a,s,"throw",t)}a(void 0)}))}}function Ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Oe(t,e){return(Oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ne(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=ze(t);if(e){var o=ze(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return $e(this,n)}}function $e(t,e){if(e&&("object"===Se(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ie(t)}function Ie(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ze(t){return(ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function je(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Fe=function(t,e){var n,i=t,o=Ct()('<div id="settingsDialogContainer"></div>').appendTo(i.dialogManager.getDialogWrapper());o.dialog({title:"Settings",modal:!0,resizable:!1,closeOnEscape:!0,width:450,position:{my:"center",at:"center",of:i.layoutManager.getContainer()},autoOpen:!1,open:function(t,e){Ct()(".ui-dialog-titlebar-close",e.dialog).show(),r()},close:function(){return o.dialog("close")}}),ae.a.render(oe.a.createElement(_e,{dialog:o,helpUrl:e.helpUrl}),i.layoutManager.getHeaderButtonsParent()[0]);var r=function(){n.setState((function(){return{schemaId:i.schemaManager.schemaId}}))},a=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Oe(t,e)}(l,t);var n,r,a,s=Ne(l);function l(){var t;Ae(this,l);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return je(Ie(t=s.call.apply(s,[this].concat(r))),"state",{isAdvanced:!0,fontSize:"11pt",showEntities:!0,showTags:!1,mode:"xmlrdfoverlap",annotationMode:i.JSON,allowOverlap:!1,schemaId:""}),je(Ie(t),"fontSizeOptions",[{value:"8pt",label:"8pt"},{value:"9pt",label:"9pt"},{value:"10pt",label:"10pt"},{value:"11pt",label:"11pt"},{value:"12pt",label:"12pt"},{value:"13pt",label:"13pt"},{value:"14pt",label:"14pt"},{value:"15pt",label:"15pt"},{value:"16pt",label:"16pt"},{value:"18pt",label:"18pt"}]),je(Ie(t),"editorModes",[{key:i.XML,value:"xml",label:"XML only (no overlap)"},{key:i.XMLRDF,value:"xmlrdf",label:"XML and RDF (no overlap)"},{key:i.XMLRDF,value:"xmlrdfoverlap",label:"XML and RDF (overlapping entities)"},{key:i.RDF,value:"rdf",label:"RDF only"}]),je(Ie(t),"annotationModes",[{value:i.XML,label:"RDF/XML",disabled:!0},{value:i.JSON,label:"JSON-LD"}]),je(Ie(t),"componentDidMount",(function(){i.isReadOnly&&t.toggleAdvanced(!1);var n=t.getEditorMode(i.mode);t.setState((function(){return{showEntities:e.showEntities,showTags:e.showTags,mode:n.value,annotationMode:i.annotationMode,allowOverlap:i.allowOverlap}}))})),je(Ie(t),"toggleAdvanced",(function(e){t.setState((function(){return{isAdvanced:e}}))})),je(Ie(t),"changeFontSize",(function(e){t.setState((function(){return{fontSize:e}}));var n={fontSize:e};i.editor.dom.setStyles(i.editor.dom.getRoot(),n)})),je(Ie(t),"toggleEntities",(function(){t.setState((function(t){return{showEntities:!t.showEntities}})),Ct()("body",i.editor.getDoc()).toggleClass("showEntities")})),je(Ie(t),"toggleTags",(function(){t.setState((function(t){return{showTags:!t.showTags}})),Ct()("body",i.editor.getDoc()).toggleClass("showTags")})),je(Ie(t),"getEditorMode",(function(e){var n;return"number"==typeof e?n=t.editorModes.find((function(t){if(t.key===e)return 0===t.key&&!0===i.allowOverlap||0===t.key&&i.allowOverlap,t})):"string"==typeof e&&(n=t.editorModes.find((function(t){return t.value===e}))),n})),je(Ie(t),"changeEditorMode",(function(e){var n=!1;if("xml"===e&&i.mode!==i.XML?n=!0:"xmlrdf"===e?i.mode===i.XMLRDF&&!0!==i.allowOverlap||(n=!0):"xmlrdfoverlap"===e?i.mode===i.XMLRDF&&!1!==i.allowOverlap||(n=!0):"rdf"===e&&(i.mode===i.RDF&&!1!==i.allowOverlap||(n=!0)),n){if(n){var o,r=i.entitiesManager.doEntitiesOverlap();if("xml"===e&&(o="If you select the XML only mode, no RDF will be created when tagging entities.<br/>\n                    Furthermore, the existing RDF annotations will be discarded.<br/><br/>\n                    Do you wish to continue?"),"xmlrdf"===e&&i.mode===i.XML&&(o="XML tags and RDF/Semantic Web annotations equivalent to the XML tags will be created, consistent with the hierarchy of the XML schema, so annotations will not be allowed to overlap.<br/><br/>\n                    Do you wish to continue?"),"xmlrdfoverlap"===e&&!1===i.allowOverlap&&(o="The editor mode will be switched to XML and RDF (Overlapping Entities) and only RDF will be created for entities that overlap existing XML structures.<br/><br/>\n                    Do you wish to continue?"),i.allowOverlap&&"xmlrdfoverlap"!==e&&r&&(o="You have overlapping entities and are attemping to switch to a mode which prohibits them.<br/>\n                        The overlapping entities will be discarded if you continue.<br/><br/>\n                        Do you wish to continue?"),void 0===o)return void t.applyChangeEditorMode(e);i.dialogManager.confirm({title:"Warning",msg:o,callback:function(n){n&&("xmlrdfoverlap"!==e&&(i.entitiesManager.removeOverlappingEntities(),i.entitiesManager.convertBoundaryEntitiesToTags()),t.applyChangeEditorMode(e))}})}}else t.setState((function(t){return{mode:t.mode}}))})),je(Ie(t),"applyChangeEditorMode",(function(e){void 0!==e&&("xml"===e?(i.mode=i.XML,i.allowOverlap=!1):"xmlrdf"===e?(i.mode=i.XMLRDF,i.allowOverlap=!1):"xmlrdfoverlap"===e?(i.mode=i.XMLRDF,i.allowOverlap=!0):"rdf"===e&&(i.mode=i.RDF,i.allowOverlap=!0)),t.setState((function(){return{mode:e}}))})),je(Ie(t),"getAnnotationMode",(function(e){var n;return"number"==typeof e?n=t.annotationModes.find((function(t){return t.key===e})):"string"==typeof e&&(n=t.annotationModes.find((function(t){return t.value===e}))),n})),je(Ie(t),"changeAnnotationMode",(function(e){i.annotationMode=e,t.setState((function(){return{annotationMode:e}}))})),je(Ie(t),"changeSchema",function(){var e=Le(Pe().mark((function e(n){var o,r;return Pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==t.state.schema){e.next=3;break}return t.setState((function(t){return{mode:t.schemaId}})),e.abrupt("return");case 3:return e.next=5,i.schemaManager.getRootForSchema(n).catch((function(){console.warn("getRootSchema failed")}));case 5:o=e.sent,r=i.utilities.getRootTag().attr("_tag"),null===o?(t.setState((function(t){return{schemaId:t.schemaId}})),i.dialogManager.show("message",{title:"Error",msg:"The root element of the schema could not be determined and so it will not be used.",type:"error"})):r!==o?i.dialogManager.confirm({title:"Warning",msg:"<p>The root element (".concat(o,") required by the selected schema is different from the root element (").concat(r,") of the current document.</p>\n                            <p>Applying this schema change will cause a document loading error.</p>\n                            <p>Continue?</p>"),type:"info",callback:function(e){e?(t.setState((function(){return{schemaId:n}})),i.event("schemaChanged").publish(n)):t.setState((function(t){return{schemaId:t.schemaId}}))}}):(t.setState((function(t){return{schemaId:n}})),i.event("schemaChanged").publish(n));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),je(Ie(t),"handleAddSchema",(function(){return i.dialogManager.show("addschema")})),je(Ie(t),"handleResetDialogPreferences",(function(){i.dialogManager.clearDialogPrefs(),i.dialogManager.show("message",{title:"Settings",msg:"Confirmation dialog preferences have been reset.",height:200})})),je(Ie(t),"handleRevertToDefault",(function(){"11pt"!==t.state.fontSize&&t.changeFontSize("11pt"),!1===t.state.showEntities&&t.toggleEntities(),!0===t.state.showTags&&t.toggleTags(),"xmlrdfoverlap"!==t.state.mode&&t.changeEditorMode("xmlrdf"),t.state.annotationMode!==i.JSON&&t.changeAnnotationMode(i.JSON)})),je(Ie(t),"handleClose",(function(){return o.dialog("close")})),t}return n=l,(r=[{key:"render",value:function(){return oe.a.createElement("div",{style:{marginTop:"10px"}},oe.a.createElement(Ee,{label:"Font Size",inputs:[{type:"select",value:this.state.fontSize,onChange:this.changeFontSize,options:this.fontSizeOptions}]}),oe.a.createElement(Ee,{label:"Show",inputs:[{type:"switch",label:"Entities",checked:this.state.showEntities,onChange:this.toggleEntities},{type:"switch",label:"Tags",checked:this.state.showTags,onChange:this.toggleTags}]}),this.state.isAdvanced&&oe.a.createElement("div",{className:"settingsDialogAdvanced"},oe.a.createElement(le.a,{style:{marginTop:"10px",marginBottom:"10px"}}),oe.a.createElement(Ee,{label:"Editor Mode",inputs:[{type:"select",id:"editorMode",value:this.state.mode,onChange:this.changeEditorMode,options:this.editorModes}]}),oe.a.createElement(Ee,{label:"Annotation Mode",inputs:[{disabled:!0,type:"select",id:"annotationMode",value:this.state.annotationMode,onChange:this.changeAnnotationMode,options:this.annotationModes}]}),oe.a.createElement(le.a,{style:{marginTop:"10px",marginBottom:"10px"}}),oe.a.createElement(Ee,{label:"Schema",inputs:[{type:"select",id:"schemaId",value:this.state.schemaId,onChange:this.changeSchema,options:i.schemaManager.schemas.map((function(t){return{value:t.id,label:t.name}}))},{type:"button",id:"addSchema",label:"Add",onClick:this.handleAddSchema}]}),oe.a.createElement(le.a,{style:{marginTop:"10px",marginBottom:"10px"}}),oe.a.createElement(Ee,{label:"Dialog Preferences",inputs:[{type:"button",id:"resetConfirmButton",label:"Reset Confirmations",onClick:this.handleResetDialogPreferences}]}),oe.a.createElement(Ee,{label:"Editor Preferences",inputs:[{type:"button",id:"revertToDefault",label:"Revert to Default",onClick:this.handleRevertToDefault}]}),oe.a.createElement(le.a,{style:{marginTop:"10px",marginBottom:"10px"}}),oe.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},oe.a.createElement(se.a,{variant:"outlined",size:"small",name:"closeButton",onClick:this.handleClose},"Close"))))}}])&&Re(n.prototype,r),a&&Re(n,a),Object.defineProperty(n,"prototype",{writable:!1}),l}(ie.Component);return ae.a.render(oe.a.createElement(a,{ref:function(t){n=t}}),document.getElementById("settingsDialogContainer")),{getSettings:function(){var t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?De(Object(n),!0).forEach((function(e){je(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},n.state);return t.mode=n.getEditorMode(t.mode).key,t},hideAdvanced:function(){return n.toggleAdvanced(!1)},showAdvanced:function(){return n.toggleAdvanced(!0)},destroy:function(){return o.dialog("destroy")}}},Be=n(21),Ue=(n(421),n(422),n(246)),We=n.n(Ue),He=n(247),Xe=n.n(He),Ve=n(248),qe=n.n(Ve),Ge=n(249),Ye=n.n(Ge),Ke=n(250),Je=n.n(Ke),Qe=n(251),Ze=n.n(Qe),tn=n(252),en=n.n(tn),nn=n(236),on=["nerve"];function rn(t,e){this.w=t}function an(t,e){return!t.isReadOnly||t.isReadOnly&&-1===on.indexOf(e.id)}function sn(t,e,n){var i="";if(void 0!==n)if(Array.isArray(n))i+='\n        <div class="cwrc tabs ui-layout-'.concat(e,'">\n            <ul>'),n.forEach((function(e){var n=e.title;void 0===n&&(n=e.id.charAt(0).toUpperCase()+e.id.substring(1)),i+='\n                <li><a href="#'.concat(t,"-").concat(e.id,'">').concat(n,"</a></li>")})),i+='\n            </ul>\n            <div class="ui-layout-content">',n.forEach((function(e){i+='\n                <div id="'.concat(t,"-").concat(e.id,'"></div>')})),i+="\n            </div>\n        </div>";else{var o=Array.isArray(n)?n[0]:n;i+='\n        <div id="'.concat(t,"-").concat(o.id,'" class="cwrc ui-layout-').concat(e,'"></div>')}return i}function ln(t,e,n){if(!1===an(e,n))return null;var i=n.config||{};switch(i.writer=e,i.parentId=t+"-"+n.id,n.id){case"structure":return new Ze.a(i);case"entities":return new We.a(i);case"relations":return new Ye.a(i);case"validation":return new en.a(i);case"selection":return new Je.a(i);case"imageViewer":return new Xe.a(i);case"nerve":return new qe.a(i)}return null}rn.prototype={constructor:rn,init:function(t){var e=this;this.modulesLayout=t.modules||{west:[{id:"structure"},{id:"entities"}],east:[{id:"selection"}]},this.modules=[],this.$containerid=this.w.getUniqueId("cwrc_"),this.$container=Ct()('<div id="'.concat(this.$containerid,'" class="cwrc cwrcWrapper"></div>')).appendTo(t.container);var n=nn.version,i="CWRC-Writer",o=t.editorId,r='<div class="cwrc cwrcLoadingMask" style="width: 100%; height: 100%; background-color: #DDD; position: absolute; z-index: 1000;"><div>Loading '.concat(i,"</div></div>");for(var a in this.$container.html(r),this.modulesLayout){var s=this.modulesLayout[a];Array.isArray(s)?this.modulesLayout[a]=s.filter((function(t){return an(e.w,t)})):this.modulesLayout[a]=an(this.w,s)?s:""}var l='\n        <div class="cwrc cwrcHeader ui-layout-north">\n            <div class="headerParent ui-widget">\n                <a class="titleLink" href="https://cwrc.ca" target="_blank">'.concat(i,'</a>\n                <div class="headerButtons"></div>\n            </div>\n        </div>');(l+=sn(o,"west",this.modulesLayout.west),l+='\n            <div class="cwrc ui-layout-center">\n                <div class="ui-layout-center ui-widget ui-widget-content">\n                    <textarea id="'.concat(o,'" name="editor" class="tinymce"></textarea>\n                </div>'),l+=sn(o,"south",this.modulesLayout.south),l+="\n            </div>",l+=sn(o,"east",this.modulesLayout.east),l+='\n        <div class="cwrc cwrcFooter ui-layout-south">\n            <a title="Powered by Tiny" target="_blank" href="https://www.tiny.cloud">Powered by Tiny</a>\n            <a title="GitHub Release Notes" target="_blank" href="https://github.com/cwrc/CWRC-WriterBase/releases/tag/v'.concat(n,'">CWRC-Writer version ').concat(n,"</a>\n        </div>\n        "),this.$container.append(l),this.$loadingMask=this.$container.find(".cwrcLoadingMask").first(),this.$headerButtons=this.$container.find(".headerButtons").first(),this.w.isReadOnly||this.w.isAnnotator)&&Ct()('<div class="fullscreenLink out">Fullscreen</div>').appendTo(this.$headerButtons).on("click",function(){this.toggleFullScreen()}.bind(this));Be.a.addEventListener("fullscreenchange",function(){var t=this.w.editor.theme.panel.find("button#fullscreen");if(1==t.length){var e=t[0].$el.find("i");null!==Be.a.fullscreenElement?e.removeClass("fullscreen-activate").addClass("fullscreen-deactivate"):e.removeClass("fullscreen-deactivate").addClass("fullscreen-activate")}if(this.w.isReadOnly||this.w.isAnnotator){var n=this.getHeaderButtonsParent().find(".fullscreenLink");1==n.length&&(null!==Be.a.fullscreenElement?(n.removeClass("out").addClass("in"),n.text("Exit Fullscreen")):(n.removeClass("in").addClass("out"),n.text("Fullscreen")))}}.bind(this)),this.resizeEditor=function(){if(this.w.editor){for(var t=Ct()(this.w.editor.getContainer().parentElement),e=t.height(),n=t[0].querySelectorAll(".mce-toolbar, .mce-statusbar, .mce-menubar"),i=n.length,o=0,r=0;r<i;r++){var a=n[r];if(!a.classList.contains("mce-sidebar-toolbar"))o+=Ct()(a).height()}var s=e-o-8;this.w.editor.theme.resizeTo("100%",s)}};var c={defaults:{enableCursorHotkey:!1,maskIframesOnResize:!0,closable:!0,resizable:!0,slidable:!1,fxName:"none"},north:{size:35,spacing_open:0,minSize:35,maxSize:60,closable:!1,resizable:!1},south:{size:15,minSize:15,maxSize:15,spacing_open:0,closable:!1,resizable:!1}};void 0!==this.modulesLayout.west&&(c.west={size:"auto",minSize:320}),null!=this.modulesLayout.east&&(c.east={size:"auto",minSize:320,initClosed:!0}),this.$outerLayout=this.$container.layout(c);var d={defaults:{enableCursorHotkey:!1,maskIframesOnResize:!0,closable:!0,resizable:!0,slidable:!1,fxName:"none"},center:{onresize_end:function(t,e,n,i){this.resizeEditor()}.bind(this)}};for(var a in void 0!==this.modulesLayout.south&&(d.south={size:250,resizable:!0,initClosed:!0,activate:function(t,e){Ct.a.layout.callbacks.resizeTabLayout(t,e)}}),this.$innerLayout=this.$container.find(".ui-layout-center").first().layout(d),this.modulesLayout){var u=this.modulesLayout[a];if(Array.isArray(u)){u.forEach(function(t){null!==(t=ln(o,this.w,t))&&this.modules.push(t)}.bind(this));var p=this.$container.find(".ui-layout-"+a+":not(.cwrcHeader):not(.cwrcFooter)");p.tabs({activate:function(t,e){Ct.a.layout.callbacks.resizeTabLayout(t,e)},create:function(t,e){p.parent().find(".ui-corner-all:not(button)").removeClass("ui-corner-all")}})}else{var f=ln(o,this.w,u);null!==f&&this.modules.push(f)}}var g=function(t){var e=this.w.editor.theme.panel.rootControl.controlIdLookup,n=this.w.schemaManager.mapper.getMappings();for(var i in e){var o=e[i];!0===o.settings.entityButton&&(t||void 0===n.entities[o.settings.entityType]?o.disabled(!0):o.disabled(!1))}}.bind(this);this.w.event("documentLoaded").subscribe(function(t){!t||this.w.schemaManager.isSchemaCustom()?g(!0):g()}.bind(this))},showModule:function(t){for(var e in this.modulesLayout){var n=this.modulesLayout[e];if(Array.isArray(n)){for(var i=0;i<n.length;i++)if(n[i].id===t)return void this.showRegion(e,i)}else if(n.id===t)return void this.showRegion(e)}},hideModule:function(t){for(var e in this.modulesLayout){var n=this.modulesLayout[e];if(Array.isArray(n)){for(var i=0;i<n.length;i++)if(n[i].id===t)return void this.hideRegion(e)}else if(n.id===t)return void this.hideRegion(e)}},showRegion:function(t,e){if("south"===t)this.$innerLayout.open("south"),void 0!==e&&this.$innerLayout.panes[t].tabs("option","active",e);else{if("west"===t)this.$outerLayout.open("west");else{if("east"!==t)return;this.$outerLayout.open("east")}void 0!==e&&this.$outerLayout.panes[t].tabs("option","active",e)}},hideRegion:function(t){if("south"===t)this.$innerLayout.close("south");else if("west"===t)this.$outerLayout.close("west");else{if("east"!==t)return;this.$outerLayout.close("east")}},showToolbar:function(){Ct()(".mce-toolbar-grp",this.w.editor.getContainer()).first().show()},hideToolbar:function(){Ct()(".mce-toolbar-grp",this.w.editor.getContainer()).first().hide()},getButtonByName:function(t){var e=this.w.editor.buttons,n=this.w.editor.theme.panel.find("toolbar *");if(void 0===e[t])return!1;var i=e[t],o=!1,r=0;return window.tinymce.each(i,(function(t,e){r++})),window.tinymce.each(n,(function(t,e){if("button"==t.type&&void 0!==t.settings){var n=0;if(window.tinymce.each(t.settings,(function(t,e){i[e]==t&&n++})),n==r)return o=t,!1}})),o},toggleFullScreen:function(){if(Be.a.fullscreenEnabled)if(null!==Be.a.fullscreenElement)Be.a.exitFullscreen();else{var t=this.getContainer()[0];Be.a.requestFullscreen(t)}},isFullScreen:function(){return!(!Be.a.fullscreenEnabled||null===Be.a.fullscreenElement)},resizeAll:function(){this.$outerLayout.resizeAll(),this.$innerLayout.resizeAll()},getContainer:function(){return this.$container},getHeaderButtonsParent:function(){return this.$headerButtons},destroy:function(){for(var t=0;t<this.modules.length;t++){var e=this.modules[t];void 0!==e.destroy?e.destroy():console.warn("layoutManager: no destroy method for",e)}this.$outerLayout.destroy(!0),this.$container.remove()}};var cn=rn;n(238);function dn(t){var e=this;this.w=t,this.container="#".concat(t.containerId),this.selector="#".concat(this.w.layoutManager.$containerid),this.tagId=null,this.isEntity=!1,this.isMultiple=!1,this.useSelection=!1,Ct.a.contextMenu({selector:this.selector,trigger:"none",build:function(t,n){return{appendTo:"#".concat(e.w.layoutManager.$containerid),className:"tagContextMenu cwrc",animation:{duration:0,show:"show",hide:"hide"},items:un.call(e),callback:function(t,n,i){var o=Ct()(i.target).closest("li.context-menu-item").data("action");if(void 0!==o)switch(e.w.editor.currentBookmark=e.w.editor.selection.getBookmark(1),o){case"change":e.w.tagger.changeTagDialog(t,e.tagId);break;default:e.w.editor.currentBookmark.tagId=e.tagId,e.w.tagger.addTagDialog(t,o,e.tagId)}}}}})}function un(){var t=this,e={};if(null==this.tagId)return console.warn("tagContextMenu: no tagId!"),{};if(this.w.isAnnotator)return pn.call(this,e),e;var n=Ct()("#"+this.tagId,this.w.editor.getBody())[0],i=!1===this.isMultiple,o=!1===this.isMultiple,r=!0===this.isMultiple||!1===this.useSelection,a={},s={},l={};if(i&&(a=fn.call(this,n)),o&&(s=gn.call(this,n)),r&&(l=hn.call(this,n)),this.isMultiple)return e.add_tag_around={name:"Insert Tag Around",icon:"tag_add",tagAction:"around",items:l},e.sep0="---",e.merge_tags={name:"Merge Tags",icon:"tag_merge",callback:function(){var e=Ct()("'#".concat(t.tagId.join(",#")),t.w.editor.getBody());t.w.tagger.mergeTags(e)}},e;if(this.useSelection&&(e.add_tag={name:"Insert Tag",icon:"tag_add",tagAction:"add",items:a},!1===this.w.schemaManager.isSchemaCustom()&&pn.call(this,e),e.sep0="---"),this.useSelection||(e.add_tag_before={name:"Insert Tag Before",icon:"tag_add",tagAction:"before",items:s},e.add_tag_after={name:"Insert Tag After",icon:"tag_add",tagAction:"after",items:s},e.add_tag_around={name:"Insert Tag Around",icon:"tag_add",tagAction:"around",items:l},e.add_tag_inside={name:"Insert Tag Inside",icon:"tag_add",tagAction:"inside",items:a},e.sep1="---"),e.edit_tag={name:"Edit Tag/Entity",icon:"tag_edit",callback:function(){return t.w.tagger.editTagDialog(t.tagId)}},!this.isEntity){var c=n.getAttribute("_tag");this.w.schemaManager.isTagEntity(c)&&(e.convert_tag={name:"Convert to Entity",icon:"tag_edit",callback:function(){return t.w.schemaManager.mapper.convertTagToEntity(n,!0)}})}return e.change_tag={name:"Change Tag",icon:"tag_edit",tagAction:"change",items:s},this.isEntity?e.copy_entity={name:"Copy Entity",icon:"tag_copy",callback:function(){return t.w.tagger.copyTag(t.tagId)}}:e.copy_tag={name:"Copy Tag and Contents",icon:"tag_copy",callback:function(){return t.w.tagger.copyTag(t.tagId)}},null!==this.w.editor.copiedElement.element?e.paste_tag={name:"Paste Tag",icon:"tag_paste",callback:function(){return t.w.tagger.pasteTag()}}:null!==this.w.editor.copiedEntity&&(e.paste_entity={name:"Paste Entity",icon:"tag_paste",callback:function(){return t.w.tagger.pasteEntity()}}),this.useSelection&&(e.split_tag={name:"Split Tag",icon:"tag_split",callback:function(){return t.w.tagger.splitTag()}}),e.sep2="---",this.isEntity&&(e.remove_entity={name:"Remove Entity",icon:"tag_remove",callback:function(){return t.w.tagger.removeEntity(t.tagId)}}),e.remove_tag={name:"Remove Tag",icon:"tag_remove",callback:function(){return t.w.tagger.removeStructureTag(t.tagId,!1)}},e.remove_content={name:"Remove Content Only",icon:"tag_remove",callback:function(){return t.w.tagger.removeStructureTagContents(t.tagId)}},e.remove_all={name:"Remove All",icon:"tag_remove",callback:function(){return t.w.tagger.removeStructureTag(t.tagId,!0)}},e}function pn(t){var e=this;t.add_entity={name:"Insert Entity",icon:"tag_add",className:"entities",items:{add_person:{name:"Tag Person",icon:"person",callback:function(){return e.w.tagger.addEntityDialog("person")}},add_place:{name:"Tag Place",icon:"place",callback:function(){return e.w.tagger.addEntityDialog("place")}},add_date:{name:"Tag Date",icon:"date",callback:function(){return e.w.tagger.addEntityDialog("date")}},add_org:{name:"Tag Organization",icon:"org",callback:function(){return e.w.tagger.addEntityDialog("org")}},add_citation:{name:"Tag Citation",icon:"citation",callback:function(){return e.w.tagger.addEntityDialog("citation")}},add_note:{name:"Tag Note",icon:"note",callback:function(){return e.w.tagger.addEntityDialog("note")}},add_title:{name:"Tag Text/Title",icon:"title",callback:function(){return e.w.tagger.addEntityDialog("title")}},add_correction:{name:"Tag Correction",icon:"correction",callback:function(){return e.w.tagger.addEntityDialog("correction")}},add_keyword:{name:"Tag Keyword",icon:"keyword",callback:function(){return e.w.tagger.addEntityDialog("keyword")}},add_link:{name:"Tag Link",icon:"link",callback:function(){return e.w.tagger.addEntityDialog("link")}},add_rs:{name:"Tag RS",icon:"rs",callback:function(){return e.w.tagger.addEntityDialog("rs")}}}};var n=this.w.schemaManager.mapper.getMappings().entities;for(var i in t.add_entity.items){void 0===n[t.add_entity.items[i].icon]&&delete t.add_entity.items[i]}}function fn(t){var e=this,n=Ct.a.Deferred();return setTimeout((function(){var i=e.w.utilities.getElementXPath(t),o=e.w.schemaManager.getChildrenForPath(i);n.resolve(mn(o))}),0),n.promise()}function gn(t){var e=this,n=Ct.a.Deferred();return setTimeout((function(){var i=Ct()(t).parents("[_tag]"),o=e.w.utilities.getElementXPath(i[0]),r=e.w.schemaManager.getChildrenForPath(o);n.resolve(mn(r))}),0),n.promise()}function hn(t){var e=this,n=Ct.a.Deferred();return setTimeout((function(){for(var i=e.w.utilities.getElementXPath(t),o=e.w.schemaManager.getParentsForPath(i),r=Ct()(t).parents("[_tag]"),a=e.w.utilities.getElementXPath(r[0]),s=e.w.schemaManager.getChildrenForPath(a),l=[],c=0;c<o.length;c++)for(var d=o[c],u=0;u<s.length;u++){var p=s[u];if(d.name==p.name){l.push(d);break}}n.resolve(mn(l))}),0),n.promise()}dn.prototype={constructor:dn,show:function(t,e,n){if(t.preventDefault(),t.stopImmediatePropagation(),!this.w.isReadOnly&&!this.w.isEditorReadOnly()){if(void 0!==e&&Array.isArray(e))this.isMultiple=!0,this.isEntity=!1,this.useSelection=!1;else{this.isMultiple=!1;var i=this.w.tagger.getCurrentTag(e)[0];void 0===e&&(e=i.getAttribute("id"));var o=i.getAttribute("_tag");if(o==this.w.schemaManager.getRoot()||o==this.w.schemaManager.getHeader())return;this.isEntity=null!==i.getAttribute("_entity"),this.useSelection=void 0!==n&&n}this.tagId=e,Ct()(this.selector).contextMenu({x:t.pageX,y:t.pageY})}},destroy:function(){Ct()(this.container).contextMenu("destroy")}},Ct.a.contextMenu.types.cwrcTag=function(t,e,n){t.icon&&this.addClass("".concat(n.classNames.icon," ").concat(n.classNames.icon,"-").concat(t.icon)),Ct()("<span>".concat(t.name,"</span>")).appendTo(this),this.data("action",e.tagAction)};var mn=function(t){var e={};if(0===t.length)return e.no_tags={name:"No Tags Available",icon:"no_tags"},e;e.tag_filter={name:"Filter Tags",type:"text",events:{keyup:function(t){var e=this.value;t.data.$menu.find("li").each((function(t,n){if(t>0){var i=Ct()(n).children("span")[0].firstChild.data;""===e||-1!==i.indexOf(e)?Ct()(n).show():Ct()(n).hide()}}))}}};for(var n=0;n<t.length;n++){var i=t[n],o=i.name,r=i.name;""!==i.fullName&&(r+=' <span class="fullName">('.concat(i.fullName,")</span>")),e[o]={name:r,type:"cwrcTag",icon:"tag"}}return e},vn=dn,yn=n(3),bn=n(306),wn=n(307),_n=n(309),xn=n(407),Cn=n(408),kn=n(409),Tn=n(412),En=n(426);var Sn=function(t){t=t||{};var e={};if(e.initialConfig=t,e.containerId,void 0!==t.container){e.containerId=t.container,e.editor=null,e.triples=[],e.cwrcRootUrl=t.cwrcRootUrl,null!=e.cwrcRootUrl&&""!=e.cwrcRootUrl||(e.cwrcRootUrl=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+"/",console.info("using default cwrcRootUrl",e.cwrcRootUrl)),e.currentDocId=null,e.isInitialized=!1,e.isDocLoaded=!1,e.isReadOnly=!1,void 0!==t.readonly&&"boolean"==typeof t.readonly&&(e.isReadOnly=t.readonly),e.isAnnotator=!1,void 0!==t.annotator&&"boolean"==typeof t.annotator&&(e.isAnnotator=t.annotator),e.XMLRDF=0,e.XML=1,e.RDF=2,e.JSON=3,e.mode=e.XMLRDF,void 0!==t.mode&&("xml"===t.mode?e.mode=e.XML:"rdf"===t.mode&&(e.mode=e.RDF)),e.annotationMode=e.JSON,e.allowOverlap=!1,void 0!==t.allowOverlap&&"boolean"==typeof t.allowOverlap&&(e.allowOverlap=t.allowOverlap),e.allowOverlap&&e.mode===e.XML&&(e.allowOverlap=!1,console&&console.warn("Mode set to XML and overlap allowed. Disabling overlap since XML doesn't allow it.")),e.getUniqueId=function(t){return tinymce.DOM.uniqueId(t)},e.loadDocumentURL=function(t){e.converter.loadDocumentURL(t)},e.loadDocumentXML=function(t){e.converter.loadDocumentXML(t)},e.showLoadDialog=function(){e.storageDialogs.load(e)},e.showSaveDialog=function(){e.storageDialogs.save(e)},e.getDocumentURI=function(){return e.storageDialogs.getDocumentURI?e.storageDialogs.getDocumentURI():e.filePathInGithub?"https://github.com/"+e.repoName+"/blob/master"+e.filePathInGithub:"https://github.com/placeholder/blob/master/placeholder.xml"},e.getUserInfo=function(){if(e.storageDialogs.getUserInfo){var t=e.storageDialogs.getUserInfo();return{id:t.userUrl,name:t.userName,nick:t.userId}}return{id:"http://id.cwrc.ca/user/placeholder",name:"Placeholder",nick:"plchldr"}},e.showSaveAsDialog=function(){},e.saveAndExit=function(){},e.exit=function(){e.storageDialogs.logOut?e.storageDialogs.logOut(e):console.warn("writer: no exit/logout method found!")},e.validate=function(t){if(void 0!==t){e.event("documentValidated").subscribe((function n(i){t.call(e,i),e.event("documentValidated").unsubscribe(n)}))}e.event("validationRequested").publish()},e.getDocumentXML=function(t){e.converter.getDocument(!1,t)},e.getDocumentString=function(t){e.converter.getDocument(!0,t)},e.setDocument=function(t){e.converter.setDocument(t)},e.getDocRawContent=function(){return e.editor.getContent({format:"raw"})},e.isEditorReadOnly=function(){return"false"===e.editor.getBody().getAttribute("contenteditable")},e.destroy=function(){console.info("destroying",e.editor.id);try{yn(e.editor.getBody()).empty()}catch(t){}window.removeEventListener("beforeunload",n),e.editor.remove(),e.editor.destroy(),e.settings.destroy(),e.utilities.destroy(),e.dialogManager.destroy(),e.layoutManager.destroy(),e.eventManager.destroy(),e.tagMenu.destroy()};var n=function(t){if((!1===e.isReadOnly||!0===e.isAnnotator)&&"localhost"!=window.location.hostname&&tinymce.get(i).isDirty()){var n="You have unsaved changes.";return(t||window.event).returnValue=n,n}};window.addEventListener("beforeunload",n),yn(window).on("unload",(function(t){try{e.utilities.getRootTag().remove()}catch(t){}})),null!=t.storageDialogs?e.storageDialogs=t.storageDialogs:alert("Error: you must specify a storage dialogs class in the CWRCWriter config to allow loading and saving documents."),null!=t.entityLookupDialogs?e.entityLookupDialogs=t.entityLookupDialogs:alert("Error: you must specify entity lookups in the CWRCWriter config for full functionality!"),e.eventManager=new bn(e),e.event("processingDocument").subscribe((function(){e.triples=[]})),e.event("documentLoaded").subscribe((function(t){e.isDocLoaded=!!t})),e.event("tinymceInitialized").subscribe((function(){e.layoutManager.$outerLayout.options.onresizeall_end=function(){e.layoutManager.$outerLayout.options.onresizeall_end=null,e.layoutManager.$loadingMask.fadeOut(350)},setTimeout((function(){e.layoutManager.resizeAll(),setTimeout((function(){e.isInitialized=!0,e.event("writerInitialized").publish(e)}),350)}),1e3)})),e.utilities=new wn(e);var i=e.getUniqueId("editor_");e.layoutManager=new cn(e),e.layoutManager.init({editorId:i,modules:t.modules,container:yn("#"+e.containerId)}),e.schemaManager=new _n(e,t.schema),e.entitiesManager=new xn(e),e.dialogManager=new ne(e),e.tagger=new Cn(e),e.converter=new kn(e),e.annotationsManager=new Tn(e),e.settings=Fe(e,{helpUrl:t.helpUrl,showEntities:!0,showTags:!1}),e.tagMenu=new vn(e);var o=e.layoutManager.getContainer().attr("id");return En.init({writer:e,editorId:i,layoutContainerId:o,buttons1:t.buttons1,buttons2:t.buttons2,buttons3:t.buttons3}),e}alert("Error: no container supplied for CWRCWriter!")};y.credentials.username="cwrcgeonames",window.Drupal=window.Drupal||{},bt.setEntityRoot(Drupal.settings.CWRCWriter.cwrcDialogs.repositoryBaseObjectUrl),bt.setSearchRoot(Drupal.settings.CWRCWriter.cwrcDialogs.cwrcApiUrl),bt.setProjectLookupConfig({projectLookupUrl:Drupal.settings.CWRCWriter.cwrcDialogs.projectLookupUrl,projectLogoRoot:Drupal.settings.CWRCWriter.cwrcDialogs.projectLogoRoot,cwrcProjectId:Drupal.settings.CWRCWriter.cwrcDialogs.cwrcProjectId}),_t.a.showNoLinkButton(!0),_t.a.showCreateNewButton(!0),_t.a.setEntityCollectionsUrl("".concat(window.location.origin,"/islandora/get_entity_collections")),_t.a.showEditButton(!0),_t.a.setEntityFormsRoot(Drupal.settings.CWRCWriter.cwrcDialogs.entityFormsRootUrl),_t.a.setCollectionsRoot(Drupal.settings.CWRCWriter.cwrcDialogs.entityFormsCollectionUrl),_t.a.registerEntitySources({person:(new Map).set("cwrc",bt).set("viaf",F).set("wikidata",tt).set("getty",D).set("dbpedia",c),place:(new Map).set("cwrc",bt).set("geonames",y).set("viaf",F).set("dbpedia",c).set("wikidata",tt),organization:(new Map).set("cwrc",bt).set("viaf",F).set("wikidata",tt).set("dbpedia",c),title:(new Map).set("cwrc",bt).set("viaf",F).set("wikidata",tt).set("dbpedia",c),rs:(new Map).set("viaf",F).set("wikidata",tt).set("dbpedia",c)}),window.Drupal.CWRCWriterDialogs=_t.a,window.Drupal.CWRCWriter=Sn}])}));
//# sourceMappingURL=app.js.map